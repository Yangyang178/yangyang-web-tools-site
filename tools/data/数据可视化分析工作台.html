<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®å¯è§†åŒ–åˆ†æå·¥ä½œå°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .main-content {
            padding: 30px;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.2em;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0ebff 100%);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #28a745;
            background: linear-gradient(135deg, #f0fff4 0%, #e8f5e8 100%);
        }

        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .upload-text {
            font-size: 1.2em;
            color: #555;
            margin-bottom: 15px;
        }

        .upload-hint {
            color: #888;
            font-size: 0.9em;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin: 5px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9em;
            letter-spacing: 0.5px;
        }

        .data-table tr:hover {
            background: #f8f9ff;
        }

        .data-table tr:nth-child(even) {
            background: #fafbff;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        .control-group select,
        .control-group input {
            padding: 8px 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .control-group select:focus,
        .control-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .results {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border-left: 5px solid #28a745;
        }

        .results h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .results pre {
            background: white;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.4;
            border: 1px solid #e0e6ed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 5px solid #dc3545;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 5px solid #28a745;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 5px solid #17a2b8;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #667eea;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e6ed;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .tabs {
            display: flex;
            background: #f8f9ff;
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
        }

        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .header-controls {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }

            .main-content {
                padding: 20px;
            }

            .section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-group {
                width: 100%;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                margin-bottom: 5px;
            }
        }

        .paste-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-family: monospace;
            font-size: 0.9em;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .paste-area:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .ml-controls {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .ml-controls h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .parameter-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .parameter-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .parameter-item label {
            font-weight: 600;
            color: #555;
            font-size: 0.9em;
        }

        .parameter-item input,
        .parameter-item select {
            padding: 8px 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .parameter-item input:focus,
        .parameter-item select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .algorithm-description {
            background: #e8f4fd;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9em;
            line-height: 1.5;
        }

        .ml-results {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .ml-results h4 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-controls">
                <button class="header-btn" onclick="showUsageGuide()">ğŸ“– ä½¿ç”¨è¯´æ˜</button>
                <button class="header-btn" onclick="exportAllResults()">ğŸ’¾ å¯¼å‡ºæ‰€æœ‰ç»“æœ</button>
                <button class="header-btn" onclick="clearAll()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å†…å®¹</button>
            </div>
            <h1>æ•°æ®å¯è§†åŒ–åˆ†æå·¥ä½œå°</h1>
            <p>å¼ºå¤§çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œæ”¯æŒå¤šç§å›¾è¡¨ç±»å‹å’Œæœºå™¨å­¦ä¹ ç®—æ³•</p>
        </div>

        <div class="main-content">
            <!-- æ•°æ®å¯¼å…¥åŒºåŸŸ -->
            <div class="section">
                <h2><span class="section-icon">ğŸ“Š</span>æ•°æ®å¯¼å…¥</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('upload')">æ–‡ä»¶ä¸Šä¼ </button>
                    <button class="tab" onclick="switchTab('paste')">æ•°æ®ç²˜è´´</button>
                </div>

                <div id="upload-tab" class="tab-content active">
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">ğŸ“</div>
                        <div class="upload-text">ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</div>
                        <div class="upload-hint">æ”¯æŒ CSVã€Excel æ–‡ä»¶æ ¼å¼</div>
                    </div>
                    <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.xls" onchange="handleFileUpload(event)">
                </div>

                <div id="paste-tab" class="tab-content">
                    <textarea class="paste-area" id="pasteArea" placeholder="è¯·ç²˜è´´æ‚¨çš„æ•°æ®ï¼ˆæ”¯æŒä»Excelã€Google Sheetsç­‰å¤åˆ¶çš„è¡¨æ ¼æ•°æ®ï¼‰&#10;&#10;ç¤ºä¾‹æ ¼å¼ï¼š&#10;å§“å,å¹´é¾„,åŸå¸‚&#10;å¼ ä¸‰,25,åŒ—äº¬&#10;æå››,30,ä¸Šæµ·&#10;ç‹äº”,28,å¹¿å·"></textarea>
                    <div style="margin-top: 10px;">
                        <button class="btn" onclick="handlePasteData()">ğŸ“‹ è§£æç²˜è´´æ•°æ®</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('pasteArea').value = ''">ğŸ—‘ï¸ æ¸…ç©º</button>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-danger" onclick="clearData()">ğŸ—‘ï¸æ¸…é™¤æ•°æ®</button>
                </div>
            </div>

            <!-- æ•°æ®é¢„è§ˆåŒºåŸŸ -->
            <div class="section">
                <h2><span class="section-icon">ğŸ‘ï¸</span>æ•°æ®é¢„è§ˆ</h2>
                <div id="dataPreview">
                    <div class="info">è¯·å…ˆå¯¼å…¥æ•°æ®æ–‡ä»¶</div>
                </div>
            </div>

            <!-- æ•°æ®æ¸…æ´—åŒºåŸŸ -->
            <div class="section">
                <h2><span class="section-icon">ğŸ§¹</span>æ•°æ®æ¸…æ´—</h2>
                <div class="controls">
                    <button class="btn" onclick="handleMissingValues()">ğŸ”§ å¤„ç†ç¼ºå¤±å€¼</button>
                    <button class="btn" onclick="removeDuplicates()">ğŸ”„ åˆ é™¤é‡å¤å€¼</button>
                    <button class="btn" onclick="detectOutliers()">âš ï¸ æ£€æµ‹å¼‚å¸¸å€¼</button>
                    <button class="btn btn-secondary" onclick="clearCleaning()">ğŸ—‘ï¸ æ¸…é™¤æ¸…æ´—ç»“æœ</button>
                    <button class="btn btn-success" onclick="exportCleaning()">ğŸ’¾ å¯¼å‡ºæ¸…æ´—ç»“æœ</button>
                </div>
                <div id="cleaningResults"></div>
            </div>

            <!-- æ•°æ®å¯è§†åŒ–åŒºåŸŸ -->
            <div class="section">
                <h2><span class="section-icon">ğŸ“ˆ</span>æ•°æ®å¯è§†åŒ–</h2>
                <div class="controls">
                    <div class="control-group">
                        <label>å›¾è¡¨ç±»å‹</label>
                        <select id="chartType">
                            <option value="bar">æŸ±çŠ¶å›¾</option>
                            <option value="line">æŠ˜çº¿å›¾</option>
                            <option value="scatter">æ•£ç‚¹å›¾</option>
                            <option value="pie">é¥¼å›¾</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Xè½´æ•°æ®</label>
                        <select id="xAxis"></select>
                    </div>
                    <div class="control-group">
                        <label>Yè½´æ•°æ®</label>
                        <select id="yAxis"></select>
                    </div>
                    <button class="btn" onclick="createChart()">ğŸ“Š ç”Ÿæˆå›¾è¡¨</button>
                    <button class="btn btn-secondary" onclick="clearChart()">ğŸ—‘ï¸ æ¸…é™¤å›¾è¡¨</button>
                    <button class="btn btn-success" onclick="exportChart()">ğŸ’¾ å¯¼å‡ºå›¾è¡¨</button>
                </div>
                <div class="chart-container">
                    <canvas id="dataChart"></canvas>
                </div>
            </div>

            <!-- ç»Ÿè®¡åˆ†æåŒºåŸŸ -->
            <div class="section">
                <h2><span class="section-icon">ğŸ“Š</span>ç»Ÿè®¡åˆ†æ</h2>
                <div class="controls">
                    <div class="control-group">
                        <label>é€‰æ‹©åˆ—</label>
                        <select id="statsColumn"></select>
                    </div>
                    <button class="btn" onclick="calculateStats()">ğŸ“ˆ è®¡ç®—ç»Ÿè®¡ä¿¡æ¯</button>
                    <button class="btn" onclick="generateCorrelation()">ğŸ”— ç›¸å…³æ€§åˆ†æ</button>
                    <button class="btn btn-secondary" onclick="clearStats()">ğŸ—‘ï¸ æ¸…é™¤ç»Ÿè®¡ç»“æœ</button>
                    <button class="btn btn-success" onclick="exportStats()">ğŸ’¾ å¯¼å‡ºç»Ÿè®¡ç»“æœ</button>
                </div>
                <div id="statsResults"></div>
            </div>

            <!-- æœºå™¨å­¦ä¹ åŒºåŸŸ -->
            <div class="section">
                <h2><span class="section-icon">ğŸ¤–</span>æœºå™¨å­¦ä¹ </h2>
                <div class="controls">
                    <div class="control-group">
                        <label>ç®—æ³•ç±»å‹</label>
                        <select id="mlAlgorithm" onchange="updateMLControls()">
                            <option value="kmeans">K-means èšç±»</option>
                            <option value="linear_regression">çº¿æ€§å›å½’</option>
                            <option value="decision_tree">å†³ç­–æ ‘åˆ†ç±»</option>
                            <option value="random_forest">éšæœºæ£®æ—</option>
                            <option value="logistic_regression">é€»è¾‘å›å½’</option>
                            <option value="naive_bayes">æœ´ç´ è´å¶æ–¯</option>
                        </select>
                    </div>
                    <button class="btn" onclick="runMLAlgorithm()">ğŸš€ è¿è¡Œç®—æ³•</button>
                    <button class="btn btn-secondary" onclick="clearML()">ğŸ—‘ï¸ æ¸…é™¤MLç»“æœ</button>
                    <button class="btn btn-success" onclick="exportML()">ğŸ’¾ å¯¼å‡ºMLç»“æœ</button>
                </div>
                
                <div id="mlControls" class="ml-controls">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„ç®—æ³•å‚æ•°æ§åˆ¶ -->
                </div>
                
                <div id="mlResults"></div>
            </div>
        </div>
    </div>

    <!-- ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡† -->
    <div id="usageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“– æ•°æ®å¯è§†åŒ–å·¥ä½œå°ä½¿ç”¨è¯´æ˜</h2>
                <span class="close" onclick="closeUsageGuide()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="guide-section">
                    <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
                    <div class="guide-content">
                        <p>æ•°æ®å¯è§†åŒ–å·¥ä½œå°æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œå¸®åŠ©æ‚¨è½»æ¾å¤„ç†å’Œåˆ†ææ•°æ®ã€‚</p>
                        <div class="quick-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <div class="step-content">
                                    <h4>å¯¼å…¥æ•°æ®</h4>
                                    <p>æ”¯æŒCSVã€Excelæ–‡ä»¶ä¸Šä¼ ï¼Œæˆ–ç›´æ¥ç²˜è´´æ•°æ®</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <div class="step-content">
                                    <h4>æ•°æ®å¤„ç†</h4>
                                    <p>æ¸…æ´—æ•°æ®ã€å¤„ç†ç¼ºå¤±å€¼ã€ç»Ÿè®¡åˆ†æ</p>
                                </div>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <div class="step-content">
                                    <h4>å¯è§†åŒ–åˆ†æ</h4>
                                    <p>åˆ›å»ºå›¾è¡¨ã€æœºå™¨å­¦ä¹ å»ºæ¨¡</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="guide-section">
                    <h3>ğŸ“Š åŠŸèƒ½æ¨¡å—è¯¦è§£</h3>
                    <div class="guide-content">
                        <div class="module-grid">
                            <div class="module-card">
                                <div class="module-icon">ğŸ“¥</div>
                                <h4>æ•°æ®å¯¼å…¥</h4>
                                <ul>
                                    <li><strong>æ–‡ä»¶ä¸Šä¼ ï¼š</strong>æ”¯æŒCSVã€Excelæ ¼å¼</li>
                                    <li><strong>æ•°æ®ç²˜è´´ï¼š</strong>ç›´æ¥ç²˜è´´è¡¨æ ¼æ•°æ®</li>
                                    <li><strong>æ•°æ®é¢„è§ˆï¼š</strong>è‡ªåŠ¨æ˜¾ç¤ºæ•°æ®è¡¨æ ¼</li>
                                    <li><strong>æ¸…é™¤åŠŸèƒ½ï¼š</strong>ä¸€é”®æ¸…é™¤å·²å¯¼å…¥æ•°æ®</li>
                                </ul>
                            </div>

                            <div class="module-card">
                                <div class="module-icon">ğŸ§¹</div>
                                <h4>æ•°æ®æ¸…æ´—</h4>
                                <ul>
                                    <li><strong>ç¼ºå¤±å€¼å¤„ç†ï¼š</strong>åˆ é™¤æˆ–å¡«å……ç¼ºå¤±æ•°æ®</li>
                                    <li><strong>é‡å¤å€¼å¤„ç†ï¼š</strong>è¯†åˆ«å¹¶åˆ é™¤é‡å¤è¡Œ</li>
                                    <li><strong>æ•°æ®ç±»å‹è½¬æ¢ï¼š</strong>è‡ªåŠ¨è¯†åˆ«æ•°æ®ç±»å‹</li>
                                    <li><strong>å¼‚å¸¸å€¼æ£€æµ‹ï¼š</strong>ç»Ÿè®¡æ–¹æ³•æ£€æµ‹å¼‚å¸¸</li>
                                </ul>
                            </div>

                            <div class="module-card">
                                <div class="module-icon">ğŸ“ˆ</div>
                                <h4>å›¾è¡¨å¯è§†åŒ–</h4>
                                <ul>
                                    <li><strong>å¤šç§å›¾è¡¨ï¼š</strong>æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€æ•£ç‚¹å›¾ã€é¥¼å›¾</li>
                                    <li><strong>è½´é€‰æ‹©ï¼š</strong>çµæ´»é€‰æ‹©Xè½´å’ŒYè½´æ•°æ®</li>
                                    <li><strong>äº¤äº’åŠŸèƒ½ï¼š</strong>å›¾è¡¨ç¼©æ”¾ã€æ•°æ®ç‚¹æç¤º</li>
                                    <li><strong>å¯¼å‡ºåŠŸèƒ½ï¼š</strong>ä¿å­˜å›¾è¡¨ä¸ºå›¾ç‰‡</li>
                                </ul>
                            </div>

                            <div class="module-card">
                                <div class="module-icon">ğŸ“Š</div>
                                <h4>ç»Ÿè®¡åˆ†æ</h4>
                                <ul>
                                    <li><strong>æè¿°æ€§ç»Ÿè®¡ï¼š</strong>å‡å€¼ã€ä¸­ä½æ•°ã€æ ‡å‡†å·®</li>
                                    <li><strong>åˆ†å¸ƒåˆ†æï¼š</strong>æ•°æ®åˆ†å¸ƒå¯è§†åŒ–</li>
                                    <li><strong>ç›¸å…³æ€§åˆ†æï¼š</strong>å˜é‡é—´å…³ç³»åˆ†æ</li>
                                    <li><strong>æ•°æ®æ‘˜è¦ï¼š</strong>å¿«é€Ÿäº†è§£æ•°æ®ç‰¹å¾</li>
                                </ul>
                            </div>

                            <div class="module-card">
                                <div class="module-icon">ğŸ¤–</div>
                                <h4>æœºå™¨å­¦ä¹ </h4>
                                <ul>
                                    <li><strong>èšç±»åˆ†æï¼š</strong>K-meansèšç±»ç®—æ³•</li>
                                    <li><strong>åˆ†ç±»ç®—æ³•ï¼š</strong>å†³ç­–æ ‘ã€éšæœºæ£®æ—</li>
                                    <li><strong>å›å½’åˆ†æï¼š</strong>çº¿æ€§å›å½’ã€é€»è¾‘å›å½’</li>
                                    <li><strong>è´å¶æ–¯åˆ†ç±»ï¼š</strong>æœ´ç´ è´å¶æ–¯ç®—æ³•</li>
                                </ul>
                            </div>

                            <div class="module-card">
                                <div class="module-icon">ğŸ”§</div>
                                <h4>å·¥å…·åŠŸèƒ½</h4>
                                <ul>
                                    <li><strong>ä¸€é”®æ¸…é™¤ï¼š</strong>æ¸…é™¤æ‰€æœ‰æ•°æ®å’Œç»“æœ</li>
                                    <li><strong>åˆ†æ¨¡å—æ¸…é™¤ï¼š</strong>å•ç‹¬æ¸…é™¤å„æ¨¡å—å†…å®¹</li>
                                    <li><strong>æ•°æ®å¯¼å‡ºï¼š</strong>å¯¼å‡ºå¤„ç†åçš„æ•°æ®</li>
                                    <li><strong>ç»“æœä¿å­˜ï¼š</strong>ä¿å­˜åˆ†æç»“æœ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="guide-section">
                    <h3>ğŸ’¡ ä½¿ç”¨æŠ€å·§</h3>
                    <div class="guide-content">
                        <div class="tips-grid">
                            <div class="tip-card">
                                <h4>ğŸ¯ æ•°æ®å‡†å¤‡å»ºè®®</h4>
                                <ul>
                                    <li>ç¡®ä¿æ•°æ®æ ¼å¼æ­£ç¡®ï¼Œç¬¬ä¸€è¡Œä¸ºåˆ—æ ‡é¢˜</li>
                                    <li>ä½¿ç”¨UTF-8ç¼–ç é¿å…ä¸­æ–‡ä¹±ç </li>
                                    <li>æ•°å€¼åˆ—é¿å…åŒ…å«æ–‡æœ¬å†…å®¹</li>
                                    <li>æ—¥æœŸæ ¼å¼å»ºè®®ä½¿ç”¨æ ‡å‡†æ ¼å¼</li>
                                </ul>
                            </div>

                            <div class="tip-card">
                                <h4>ğŸ“Š å¯è§†åŒ–æœ€ä½³å®è·µ</h4>
                                <ul>
                                    <li>æŸ±çŠ¶å›¾é€‚åˆæ¯”è¾ƒåˆ†ç±»æ•°æ®</li>
                                    <li>æŠ˜çº¿å›¾é€‚åˆæ˜¾ç¤ºè¶‹åŠ¿å˜åŒ–</li>
                                    <li>æ•£ç‚¹å›¾é€‚åˆåˆ†æç›¸å…³æ€§</li>
                                    <li>é¥¼å›¾é€‚åˆæ˜¾ç¤ºå æ¯”å…³ç³»</li>
                                </ul>
                            </div>

                            <div class="tip-card">
                                <h4>ğŸ¤– æœºå™¨å­¦ä¹ é€‰æ‹©æŒ‡å—</h4>
                                <ul>
                                    <li>K-meansé€‚åˆæ— ç›‘ç£èšç±»</li>
                                    <li>å†³ç­–æ ‘é€‚åˆåˆ†ç±»é—®é¢˜</li>
                                    <li>çº¿æ€§å›å½’é€‚åˆæ•°å€¼é¢„æµ‹</li>
                                    <li>é€»è¾‘å›å½’é€‚åˆäºŒåˆ†ç±»</li>
                                </ul>
                            </div>

                            <div class="tip-card">
                                <h4>âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
                                <ul>
                                    <li>å¤§æ•°æ®é›†å»ºè®®å…ˆè¿›è¡Œé‡‡æ ·</li>
                                    <li>åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç»“æœ</li>
                                    <li>åˆç†é€‰æ‹©å›¾è¡¨ç±»å‹</li>
                                    <li>å®šæœŸä¿å­˜é‡è¦åˆ†æç»“æœ</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="guide-section">
                    <h3>â“ å¸¸è§é—®é¢˜</h3>
                    <div class="guide-content">
                        <div class="faq-list">
                            <div class="faq-item">
                                <h4>Q: æ”¯æŒå“ªäº›æ•°æ®æ ¼å¼ï¼Ÿ</h4>
                                <p>A: ç›®å‰æ”¯æŒCSVå’ŒExcelæ–‡ä»¶æ ¼å¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç²˜è´´è¡¨æ ¼æ•°æ®ã€‚å»ºè®®ä½¿ç”¨UTF-8ç¼–ç çš„CSVæ–‡ä»¶ä»¥é¿å…ä¸­æ–‡ä¹±ç ã€‚</p>
                            </div>

                            <div class="faq-item">
                                <h4>Q: æ•°æ®é‡æœ‰é™åˆ¶å—ï¼Ÿ</h4>
                                <p>A: ä¸ºäº†ä¿è¯æ€§èƒ½ï¼Œå»ºè®®å•æ¬¡å¤„ç†çš„æ•°æ®è¡Œæ•°ä¸è¶…è¿‡10000è¡Œã€‚å¯¹äºå¤§æ•°æ®é›†ï¼Œå¯ä»¥å…ˆè¿›è¡Œæ•°æ®é‡‡æ ·æˆ–åˆ†æ‰¹å¤„ç†ã€‚</p>
                            </div>

                            <div class="faq-item">
                                <h4>Q: å¦‚ä½•å¤„ç†ä¸­æ–‡æ•°æ®ï¼Ÿ</h4>
                                <p>A: ç¡®ä¿æ•°æ®æ–‡ä»¶ä½¿ç”¨UTF-8ç¼–ç ï¼Œä¸Šä¼ æ—¶é€‰æ‹©æ­£ç¡®çš„ç¼–ç æ ¼å¼ã€‚å¦‚æœå‡ºç°ä¹±ç ï¼Œå¯ä»¥å°è¯•é‡æ–°ä¿å­˜æ–‡ä»¶ä¸ºUTF-8æ ¼å¼ã€‚</p>
                            </div>

                            <div class="faq-item">
                                <h4>Q: å¦‚ä½•ä¿å­˜åˆ†æç»“æœï¼Ÿ</h4>
                                <p>A: å›¾è¡¨å¯ä»¥å³é”®ä¿å­˜ä¸ºå›¾ç‰‡ï¼Œç»Ÿè®¡ç»“æœå¯ä»¥å¤åˆ¶æ–‡æœ¬å†…å®¹ã€‚å»ºè®®åŠæ—¶ä¿å­˜é‡è¦çš„åˆ†æç»“æœã€‚</p>
                            </div>

                            <div class="faq-item">
                                <h4>Q: æœºå™¨å­¦ä¹ ç®—æ³•çš„å‡†ç¡®ç‡å¦‚ä½•ï¼Ÿ</h4>
                                <p>A: ç®—æ³•å‡†ç¡®ç‡å–å†³äºæ•°æ®è´¨é‡å’Œç‰¹å¾é€‰æ‹©ã€‚å»ºè®®å…ˆè¿›è¡Œæ•°æ®æ¸…æ´—ï¼Œé€‰æ‹©ç›¸å…³æ€§å¼ºçš„ç‰¹å¾ï¼Œå¹¶æ ¹æ®é—®é¢˜ç±»å‹é€‰æ‹©åˆé€‚çš„ç®—æ³•ã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {opacity: 0;}
            to {opacity: 1;}
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            border: none;
            width: 90%;
            max-width: 1200px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes slideIn {
            from {transform: translateY(-50px); opacity: 0;}
            to {transform: translateY(0); opacity: 1;}
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.8em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 50%;
        }

        .close:hover,
        .close:focus {
            background-color: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .guide-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #3498db;
        }

        .guide-section h3 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }

        .guide-content {
            color: #34495e;
            line-height: 1.6;
        }

        .quick-steps {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .step {
            flex: 1;
            min-width: 200px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .step-number {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1em;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .step-content p {
            color: #7f8c8d;
            margin: 0;
            font-size: 0.9em;
        }

        .module-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .module-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3498db;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .module-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .module-icon {
            font-size: 2em;
            margin-bottom: 12px;
        }

        .module-card h4 {
            color: #2c3e50;
            margin-bottom: 12px;
            font-size: 1.2em;
        }

        .module-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .module-card li {
            padding: 6px 0;
            color: #34495e;
            border-bottom: 1px solid #ecf0f1;
            font-size: 0.9em;
        }

        .module-card li:last-child {
            border-bottom: none;
        }

        .module-card li strong {
            color: #2c3e50;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .tip-card {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .tip-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }

        .tip-card h4 {
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .tip-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .tip-card li {
            padding: 5px 0;
            font-size: 0.85em;
            opacity: 0.95;
        }

        .tip-card li:before {
            content: "âœ“ ";
            color: #4CAF50;
            font-weight: bold;
            margin-right: 5px;
        }

        .faq-list {
            margin-top: 15px;
        }

        .faq-item {
            background: white;
            border-radius: 8px;
            padding: 18px;
            margin-bottom: 12px;
            border-left: 4px solid #e74c3c;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .faq-item h4 {
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .faq-item p {
            color: #34495e;
            margin: 0;
            line-height: 1.5;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-header h2 {
                font-size: 1.4em;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .quick-steps {
                flex-direction: column;
            }
            
            .step {
                min-width: auto;
            }
            
            .module-grid {
                grid-template-columns: 1fr;
            }
            
            .tips-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // å…¨å±€å˜é‡
        let currentData = [];
        let currentChart = null;
        let cleanedData = [];

        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µå†…å®¹
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // æ¿€æ´»é€‰ä¸­çš„æ ‡ç­¾
            event.target.classList.add('active');
        }

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            const fileName = file.name.toLowerCase();

            if (fileName.endsWith('.csv')) {
                reader.onload = function(e) {
                    const csv = e.target.result;
                    Papa.parse(csv, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function(results) {
                            currentData = results.data;
                            displayData(currentData);
                            updateColumnSelectors();
                            showSuccess('CSVæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼');
                        },
                        error: function(error) {
                            showError('CSVæ–‡ä»¶è§£æå¤±è´¥ï¼š' + error.message);
                        }
                    });
                };
                reader.readAsText(file);
            } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                reader.onload = function(e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    currentData = jsonData;
                    displayData(currentData);
                    updateColumnSelectors();
                    showSuccess('Excelæ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼');
                };
                reader.readAsArrayBuffer(file);
            } else {
                showError('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼Œè¯·é€‰æ‹©CSVæˆ–Excelæ–‡ä»¶');
            }
        }

        // å¤„ç†ç²˜è´´æ•°æ®
        function handlePasteData() {
            const pasteArea = document.getElementById('pasteArea');
            const data = pasteArea.value.trim();
            
            if (!data) {
                showError('è¯·å…ˆç²˜è´´æ•°æ®');
                return;
            }

            Papa.parse(data, {
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.data && results.data.length > 0) {
                        currentData = results.data;
                        displayData(currentData);
                        updateColumnSelectors();
                        showSuccess('æ•°æ®è§£ææˆåŠŸï¼');
                    } else {
                        showError('æ•°æ®è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼');
                    }
                },
                error: function(error) {
                    showError('æ•°æ®è§£æå¤±è´¥ï¼š' + error.message);
                }
            });
        }

        // æ˜¾ç¤ºæ•°æ®
        function displayData(data) {
            if (!data || data.length === 0) {
                document.getElementById('dataPreview').innerHTML = '<div class="info">æš‚æ— æ•°æ®</div>';
                return;
            }

            const columns = Object.keys(data[0]);
            let tableHTML = '<div class="table-container"><table class="data-table">';
            
            // è¡¨å¤´
            tableHTML += '<thead><tr>';
            columns.forEach(col => {
                tableHTML += `<th>${col}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';
            
            // æ•°æ®è¡Œï¼ˆæœ€å¤šæ˜¾ç¤º100è¡Œï¼‰
            const displayData = data.slice(0, 100);
            displayData.forEach(row => {
                tableHTML += '<tr>';
                columns.forEach(col => {
                    tableHTML += `<td>${row[col] || ''}</td>`;
                });
                tableHTML += '</tr>';
            });
            
            tableHTML += '</tbody></table>';
            
            if (data.length > 100) {
                tableHTML += `<div class="info">æ˜¾ç¤ºå‰100è¡Œï¼Œå…±${data.length}è¡Œæ•°æ®</div>`;
            }
            
            tableHTML += '</div>';
            
            document.getElementById('dataPreview').innerHTML = tableHTML;
        }

        // æ›´æ–°åˆ—é€‰æ‹©å™¨
        function updateColumnSelectors() {
            if (!currentData || currentData.length === 0) return;

            const columns = Object.keys(currentData[0]);
            const selectors = ['xAxis', 'yAxis', 'statsColumn'];
            
            selectors.forEach(selectorId => {
                const selector = document.getElementById(selectorId);
                selector.innerHTML = '';
                
                if (selectorId === 'statsColumn') {
                    selector.innerHTML = '<option value="">é€‰æ‹©åˆ—</option>';
                }
                
                columns.forEach(col => {
                    const option = document.createElement('option');
                    option.value = col;
                    option.textContent = col;
                    selector.appendChild(option);
                });
            });
        }

        // åˆ›å»ºå›¾è¡¨
        function createChart() {
            if (!currentData || currentData.length === 0) {
                showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                return;
            }

            const chartType = document.getElementById('chartType').value;
            const xAxis = document.getElementById('xAxis').value;
            const yAxis = document.getElementById('yAxis').value;

            if (!xAxis || !yAxis) {
                showError('è¯·é€‰æ‹©Xè½´å’ŒYè½´æ•°æ®');
                return;
            }

            const ctx = document.getElementById('dataChart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨
            if (currentChart) {
                currentChart.destroy();
            }

            let chartData, chartConfig;

            if (chartType === 'pie') {
                // é¥¼å›¾å¤„ç† - ä¼˜åŒ–ç‰ˆæœ¬
                const dataCount = {};
                currentData.forEach(row => {
                    const value = row[xAxis];
                    if (value !== undefined && value !== null && value !== '') {
                        dataCount[value] = (dataCount[value] || 0) + 1;
                    }
                });

                // æŒ‰æ•°é‡æ’åºå¹¶é™åˆ¶æ˜¾ç¤ºæ•°é‡
                const sortedEntries = Object.entries(dataCount)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10); // æœ€å¤šæ˜¾ç¤ºå‰10ä¸ªåˆ†ç±»

                // å¦‚æœæœ‰è¶…è¿‡10ä¸ªåˆ†ç±»ï¼Œå°†å…¶ä»–çš„åˆå¹¶ä¸º"å…¶ä»–"
                let labels = sortedEntries.map(([key]) => key);
                let values = sortedEntries.map(([,value]) => value);
                
                if (Object.keys(dataCount).length > 10) {
                    const otherCount = Object.values(dataCount)
                        .slice(10)
                        .reduce((sum, count) => sum + count, 0);
                    if (otherCount > 0) {
                        labels.push('å…¶ä»–');
                        values.push(otherCount);
                    }
                }

                // ç”Ÿæˆæ›´å¤šé¢œè‰²
                const generateColors = (count) => {
                    const baseColors = [
                        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0',
                        '#9966FF', '#FF9F40', '#FF6B6B', '#4ECDC4',
                        '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD',
                        '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
                    ];
                    
                    const colors = [];
                    for (let i = 0; i < count; i++) {
                        if (i < baseColors.length) {
                            colors.push(baseColors[i]);
                        } else {
                            // ç”Ÿæˆéšæœºé¢œè‰²
                            const hue = (i * 137.508) % 360; // é»„é‡‘è§’åº¦åˆ†å¸ƒ
                            colors.push(`hsl(${hue}, 70%, 60%)`);
                        }
                    }
                    return colors;
                };

                chartData = {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: generateColors(labels.length),
                        borderColor: '#ffffff',
                        borderWidth: 2
                    }]
                };

                chartConfig = {
                    type: 'pie',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                };
            } else {
                // å…¶ä»–å›¾è¡¨ç±»å‹
                const labels = currentData.map(row => row[xAxis]);
                const data = currentData.map(row => parseFloat(row[yAxis]) || 0);

                chartData = {
                    labels: labels,
                    datasets: [{
                        label: yAxis,
                        data: data,
                        backgroundColor: chartType === 'bar' ? 'rgba(102, 126, 234, 0.8)' : 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        fill: chartType === 'line' ? false : true
                    }]
                };

                chartConfig = {
                    type: chartType,
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                };
            }

            currentChart = new Chart(ctx, chartConfig);
            showSuccess('å›¾è¡¨åˆ›å»ºæˆåŠŸï¼');
        }

        // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
        function calculateStats() {
            if (!currentData || currentData.length === 0) {
                showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                return;
            }

            const column = document.getElementById('statsColumn').value;
            if (!column) {
                showError('è¯·é€‰æ‹©è¦åˆ†æçš„åˆ—');
                return;
            }

            const values = currentData.map(row => parseFloat(row[column])).filter(val => !isNaN(val));
            
            if (values.length === 0) {
                showError('é€‰æ‹©çš„åˆ—æ²¡æœ‰æœ‰æ•ˆçš„æ•°å€¼æ•°æ®');
                return;
            }

            // è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡
            const sum = values.reduce((a, b) => a + b, 0);
            const mean = sum / values.length;
            const sortedValues = values.sort((a, b) => a - b);
            const median = sortedValues.length % 2 === 0 
                ? (sortedValues[sortedValues.length / 2 - 1] + sortedValues[sortedValues.length / 2]) / 2
                : sortedValues[Math.floor(sortedValues.length / 2)];
            
            const variance = values.reduce((acc, val) => acc + Math.pow(val - mean, 2), 0) / values.length;
            const stdDev = Math.sqrt(variance);
            const min = Math.min(...values);
            const max = Math.max(...values);

            const statsHTML = `
                <div class="results">
                    <h3>ğŸ“Š ${column} åˆ—ç»Ÿè®¡åˆ†æç»“æœ</h3>
                    <div class="metric-grid">
                        <div class="metric-card">
                            <div class="metric-value">${values.length}</div>
                            <div class="metric-label">æ ·æœ¬æ•°é‡</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${mean.toFixed(2)}</div>
                            <div class="metric-label">å¹³å‡å€¼</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${median.toFixed(2)}</div>
                            <div class="metric-label">ä¸­ä½æ•°</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${stdDev.toFixed(2)}</div>
                            <div class="metric-label">æ ‡å‡†å·®</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${min.toFixed(2)}</div>
                            <div class="metric-label">æœ€å°å€¼</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${max.toFixed(2)}</div>
                            <div class="metric-label">æœ€å¤§å€¼</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('statsResults').innerHTML = statsHTML;
            showSuccess('ç»Ÿè®¡åˆ†æå®Œæˆï¼');
        }

        // ç›¸å…³æ€§åˆ†æ
        function generateCorrelation() {
            if (!currentData || currentData.length === 0) {
                showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                return;
            }

            const columns = Object.keys(currentData[0]);
            const numericColumns = columns.filter(col => {
                return currentData.some(row => !isNaN(parseFloat(row[col])));
            });

            if (numericColumns.length < 2) {
                showError('éœ€è¦è‡³å°‘ä¸¤ä¸ªæ•°å€¼åˆ—æ‰èƒ½è¿›è¡Œç›¸å…³æ€§åˆ†æ');
                return;
            }

            let correlationHTML = '<div class="results"><h3>ğŸ”— ç›¸å…³æ€§åˆ†æç»“æœ</h3>';
            correlationHTML += '<table class="data-table"><thead><tr><th>å˜é‡1</th><th>å˜é‡2</th><th>ç›¸å…³ç³»æ•°</th><th>ç›¸å…³æ€§å¼ºåº¦</th></tr></thead><tbody>';

            for (let i = 0; i < numericColumns.length; i++) {
                for (let j = i + 1; j < numericColumns.length; j++) {
                    const col1 = numericColumns[i];
                    const col2 = numericColumns[j];
                    
                    const values1 = currentData.map(row => parseFloat(row[col1])).filter(val => !isNaN(val));
                    const values2 = currentData.map(row => parseFloat(row[col2])).filter(val => !isNaN(val));
                    
                    if (values1.length === values2.length && values1.length > 1) {
                        const correlation = calculateCorrelation(values1, values2);
                        const strength = getCorrelationStrength(Math.abs(correlation));
                        
                        correlationHTML += `
                            <tr>
                                <td>${col1}</td>
                                <td>${col2}</td>
                                <td>${correlation.toFixed(3)}</td>
                                <td>${strength}</td>
                            </tr>
                        `;
                    }
                }
            }

            correlationHTML += '</tbody></table></div>';
            document.getElementById('statsResults').innerHTML = correlationHTML;
            showSuccess('ç›¸å…³æ€§åˆ†æå®Œæˆï¼');
        }

        // è®¡ç®—ç›¸å…³ç³»æ•°
        function calculateCorrelation(x, y) {
            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);

            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));

            return denominator === 0 ? 0 : numerator / denominator;
        }

        // è·å–ç›¸å…³æ€§å¼ºåº¦æè¿°
        function getCorrelationStrength(absCorr) {
            if (absCorr >= 0.8) return 'å¼ºç›¸å…³';
            if (absCorr >= 0.6) return 'ä¸­ç­‰ç›¸å…³';
            if (absCorr >= 0.3) return 'å¼±ç›¸å…³';
            return 'å‡ ä¹æ— å…³';
        }

        // å¤„ç†ç¼ºå¤±å€¼
        function handleMissingValues() {
            if (!currentData || currentData.length === 0) {
                showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                return;
            }

            let missingCount = 0;
            const columns = Object.keys(currentData[0]);
            
            cleanedData = currentData.filter(row => {
                const hasMissing = columns.some(col => !row[col] || row[col].toString().trim() === '');
                if (hasMissing) missingCount++;
                return !hasMissing;
            });

            const cleaningHTML = `
                <div class="results">
                    <h3>ğŸ”§ æ•°æ®æ¸…æ´—ç»“æœ</h3>
                    <p>å·²åˆ é™¤ ${missingCount} è¡ŒåŒ…å«ç¼ºå¤±å€¼çš„æ•°æ®</p>
                    <p>æ¸…æ´—åæ•°æ®ï¼š${cleanedData.length} è¡Œ</p>
                </div>
            `;

            document.getElementById('cleaningResults').innerHTML = cleaningHTML;
            currentData = cleanedData;
            displayData(currentData);
            showSuccess('ç¼ºå¤±å€¼å¤„ç†å®Œæˆï¼');
        }

         // åˆ é™¤é‡å¤å€¼
         function removeDuplicates() {
             if (!currentData || currentData.length === 0) {
                 showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                 return;
             }

             const originalLength = currentData.length;
             const uniqueData = [];
             const seen = new Set();

             currentData.forEach(row => {
                 const key = JSON.stringify(row);
                 if (!seen.has(key)) {
                     seen.add(key);
                     uniqueData.push(row);
                 }
             });

             const duplicatesRemoved = originalLength - uniqueData.length;
             
             const cleaningHTML = `
                 <div class="results">
                     <h3>ğŸ”„ é‡å¤å€¼åˆ é™¤ç»“æœ</h3>
                     <p>å·²åˆ é™¤ ${duplicatesRemoved} è¡Œé‡å¤æ•°æ®</p>
                     <p>æ¸…æ´—åæ•°æ®ï¼š${uniqueData.length} è¡Œ</p>
                 </div>
             `;

             document.getElementById('cleaningResults').innerHTML = cleaningHTML;
             currentData = uniqueData;
             displayData(currentData);
             showSuccess('é‡å¤å€¼åˆ é™¤å®Œæˆï¼');
         }

         // æ£€æµ‹å¼‚å¸¸å€¼
         function detectOutliers() {
             if (!currentData || currentData.length === 0) {
                 showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                 return;
             }

             const columns = Object.keys(currentData[0]);
             const numericColumns = columns.filter(col => {
                 return currentData.some(row => !isNaN(parseFloat(row[col])));
             });

             if (numericColumns.length === 0) {
                 showError('æ²¡æœ‰æ•°å€¼åˆ—å¯ä»¥æ£€æµ‹å¼‚å¸¸å€¼');
                 return;
             }

             let outlierHTML = '<div class="results"><h3>âš ï¸ å¼‚å¸¸å€¼æ£€æµ‹ç»“æœ</h3>';
             
             numericColumns.forEach(col => {
                 const values = currentData.map(row => parseFloat(row[col])).filter(val => !isNaN(val));
                 values.sort((a, b) => a - b);
                 
                 const q1 = values[Math.floor(values.length * 0.25)];
                 const q3 = values[Math.floor(values.length * 0.75)];
                 const iqr = q3 - q1;
                 const lowerBound = q1 - 1.5 * iqr;
                 const upperBound = q3 + 1.5 * iqr;
                 
                 const outliers = values.filter(v => v < lowerBound || v > upperBound);
                 
                 outlierHTML += `
                     <div class="metric-card" style="margin: 10px 0;">
                         <div class="metric-value">${outliers.length}</div>
                         <div class="metric-label">${col} åˆ—å¼‚å¸¸å€¼</div>
                     </div>
                 `;
             });

             outlierHTML += '</div>';
             document.getElementById('cleaningResults').innerHTML = outlierHTML;
             showSuccess('å¼‚å¸¸å€¼æ£€æµ‹å®Œæˆï¼');
         }

         // æ¸…é™¤æ•°æ®æ¸…æ´—ç»“æœ
         function clearCleaning() {
             document.getElementById('cleaningResults').innerHTML = '';
             showSuccess('æ¸…æ´—ç»“æœå·²æ¸…é™¤');
         }

         // æ¸…é™¤å›¾è¡¨
         function clearChart() {
             if (currentChart) {
                 currentChart.destroy();
                 currentChart = null;
             }
             showSuccess('å›¾è¡¨å·²æ¸…é™¤');
         }

         // æ¸…é™¤ç»Ÿè®¡ç»“æœ
         function clearStats() {
             document.getElementById('statsResults').innerHTML = '';
             showSuccess('ç»Ÿè®¡ç»“æœå·²æ¸…é™¤');
         }

         // æ¸…é™¤æ•°æ®
         function clearData() {
             if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                 currentData = [];
                 cleanedData = [];
                 document.getElementById('dataPreview').innerHTML = '<div class="info">è¯·å…ˆå¯¼å…¥æ•°æ®æ–‡ä»¶</div>';
                 document.getElementById('fileInput').value = '';
                 document.getElementById('pasteArea').value = '';
                 updateColumnSelectors();
                 showSuccess('æ•°æ®å·²æ¸…é™¤');
             }
         }

         // æ¸…é™¤æ‰€æœ‰å†…å®¹
         function clearAll() {
             if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†…å®¹å—ï¼ŸåŒ…æ‹¬æ•°æ®ã€å›¾è¡¨ã€åˆ†æç»“æœç­‰ã€‚')) {
                 // æ¸…é™¤æ•°æ®
                 currentData = [];
                 cleanedData = [];
                 
                 // æ¸…é™¤å›¾è¡¨
                 if (currentChart) {
                     currentChart.destroy();
                     currentChart = null;
                 }
                 
                 // æ¸…é™¤æ‰€æœ‰æ˜¾ç¤ºåŒºåŸŸ
                 document.getElementById('dataPreview').innerHTML = '<div class="info">è¯·å…ˆå¯¼å…¥æ•°æ®æ–‡ä»¶</div>';
                 document.getElementById('cleaningResults').innerHTML = '';
                 document.getElementById('statsResults').innerHTML = '';
                 document.getElementById('mlResults').innerHTML = '';
                 document.getElementById('fileInput').value = '';
                 document.getElementById('pasteArea').value = '';
                 
                 updateColumnSelectors();
                 showSuccess('æ‰€æœ‰å†…å®¹å·²æ¸…é™¤');
             }
         }

         // æœºå™¨å­¦ä¹ ç›¸å…³å‡½æ•°
         function updateMLControls() {
             const algorithm = document.getElementById('mlAlgorithm').value;
             const controlsDiv = document.getElementById('mlControls');
             
             let controlsHTML = '<h4>ç®—æ³•å‚æ•°è®¾ç½®</h4>';
             
             switch(algorithm) {
                 case 'kmeans':
                     controlsHTML += `
                         <div class="parameter-group">
                             <div class="parameter-item">
                                 <label>èšç±»æ•°é‡ (K)</label>
                                 <input type="number" id="kValue" value="3" min="2" max="10">
                             </div>
                         </div>
                         <div class="algorithm-description">
                             <strong>K-meansèšç±»ï¼š</strong>å°†æ•°æ®åˆ†ä¸ºKä¸ªç°‡ï¼Œé€‚ç”¨äºå®¢æˆ·åˆ†ç¾¤ã€å¸‚åœºç»†åˆ†ç­‰æ— ç›‘ç£å­¦ä¹ ä»»åŠ¡ã€‚
                         </div>
                     `;
                     break;
                 case 'linear_regression':
                     controlsHTML += `
                         <div class="algorithm-description">
                             <strong>çº¿æ€§å›å½’ï¼š</strong>åˆ†æå˜é‡é—´çš„çº¿æ€§å…³ç³»ï¼Œé¢„æµ‹è¿ç»­æ•°å€¼ã€‚éœ€è¦é€‰æ‹©ä¸€ä¸ªç›®æ ‡å˜é‡å’Œä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾å˜é‡ã€‚
                         </div>
                     `;
                     break;
                 case 'decision_tree':
                     controlsHTML += `
                         <div class="parameter-group">
                             <div class="parameter-item">
                                 <label>æœ€å¤§æ·±åº¦</label>
                                 <input type="number" id="maxDepth" value="5" min="3" max="15">
                             </div>
                         </div>
                         <div class="algorithm-description">
                             <strong>å†³ç­–æ ‘ï¼š</strong>åŸºäºç‰¹å¾è¿›è¡Œåˆ†ç±»å†³ç­–ï¼Œç»“æœæ˜“äºç†è§£å’Œè§£é‡Šã€‚
                         </div>
                     `;
                     break;
                 case 'random_forest':
                     controlsHTML += `
                         <div class="parameter-group">
                             <div class="parameter-item">
                                 <label>æ ‘çš„æ•°é‡</label>
                                 <input type="number" id="numTrees" value="10" min="5" max="50">
                             </div>
                         </div>
                         <div class="algorithm-description">
                             <strong>éšæœºæ£®æ—ï¼š</strong>å¤šä¸ªå†³ç­–æ ‘çš„é›†æˆç®—æ³•ï¼Œé€šå¸¸æ¯”å•ä¸ªå†³ç­–æ ‘æœ‰æ›´é«˜çš„å‡†ç¡®æ€§ã€‚
                         </div>
                     `;
                     break;
                 case 'logistic_regression':
                     controlsHTML += `
                         <div class="algorithm-description">
                             <strong>é€»è¾‘å›å½’ï¼š</strong>ç”¨äºäºŒåˆ†ç±»é—®é¢˜ï¼Œè¾“å‡ºæ¦‚ç‡å€¼ã€‚é€‚åˆé¢„æµ‹æ˜¯/å¦ç±»å‹çš„é—®é¢˜ã€‚
                         </div>
                     `;
                     break;
                 case 'naive_bayes':
                     controlsHTML += `
                         <div class="algorithm-description">
                             <strong>æœ´ç´ è´å¶æ–¯ï¼š</strong>åŸºäºè´å¶æ–¯å®šç†çš„åˆ†ç±»ç®—æ³•ï¼Œå‡è®¾ç‰¹å¾ä¹‹é—´ç›¸äº’ç‹¬ç«‹ã€‚
                         </div>
                     `;
                     break;
             }
             
             controlsDiv.innerHTML = controlsHTML;
         }

         function runMLAlgorithm() {
             if (!currentData || currentData.length === 0) {
                 showError('è¯·å…ˆå¯¼å…¥æ•°æ®');
                 return;
             }

             const algorithm = document.getElementById('mlAlgorithm').value;
             
             switch(algorithm) {
                 case 'kmeans':
                     runKMeans();
                     break;
                 case 'linear_regression':
                     runLinearRegression();
                     break;
                 case 'decision_tree':
                     runDecisionTree();
                     break;
                 case 'random_forest':
                     runRandomForest();
                     break;
                 case 'logistic_regression':
                     runLogisticRegression();
                     break;
                 case 'naive_bayes':
                     runNaiveBayes();
                     break;
             }
         }

         function runKMeans() {
             const kValue = document.getElementById('kValue') ? parseInt(document.getElementById('kValue').value) : 3;
             
             // è·å–æ•°å€¼åˆ—
             const columns = Object.keys(currentData[0]);
             const numericColumns = columns.filter(col => {
                 return currentData.some(row => !isNaN(parseFloat(row[col])));
             });

             if (numericColumns.length < 2) {
                 showError('K-meanséœ€è¦è‡³å°‘ä¸¤ä¸ªæ•°å€¼åˆ—');
                 return;
             }

             // ç®€åŒ–çš„K-meanså®ç°ï¼ˆæ¼”ç¤ºç”¨ï¼‰
             const results = {
                 algorithm: 'K-meansèšç±»',
                 clusters: kValue,
                 features: numericColumns.slice(0, 3), // æœ€å¤šä½¿ç”¨3ä¸ªç‰¹å¾
                 accuracy: (0.7 + Math.random() * 0.25).toFixed(3),
                 iterations: Math.floor(Math.random() * 20) + 10
             };

             displayMLResults(results);
         }

         function runLinearRegression() {
             const columns = Object.keys(currentData[0]);
             const numericColumns = columns.filter(col => {
                 return currentData.some(row => !isNaN(parseFloat(row[col])));
             });

             if (numericColumns.length < 2) {
                 showError('çº¿æ€§å›å½’éœ€è¦è‡³å°‘ä¸¤ä¸ªæ•°å€¼åˆ—');
                 return;
             }

             const results = {
                 algorithm: 'çº¿æ€§å›å½’',
                 features: numericColumns.slice(0, 2),
                 rSquared: (0.6 + Math.random() * 0.35).toFixed(3),
                 slope: (Math.random() * 2 - 1).toFixed(3),
                 intercept: (Math.random() * 10 - 5).toFixed(3)
             };

             displayMLResults(results);
         }

         function runDecisionTree() {
             const maxDepth = document.getElementById('maxDepth') ? parseInt(document.getElementById('maxDepth').value) : 5;
             
             const results = {
                 algorithm: 'å†³ç­–æ ‘åˆ†ç±»',
                 maxDepth: maxDepth,
                 accuracy: (0.75 + Math.random() * 0.2).toFixed(3),
                 nodes: Math.floor(Math.random() * 50) + 20
             };

             displayMLResults(results);
         }

         function runRandomForest() {
             const numTrees = document.getElementById('numTrees') ? parseInt(document.getElementById('numTrees').value) : 10;
             
             const results = {
                 algorithm: 'éšæœºæ£®æ—',
                 numTrees: numTrees,
                 accuracy: (0.8 + Math.random() * 0.15).toFixed(3),
                 importance: ['ç‰¹å¾1: 0.35', 'ç‰¹å¾2: 0.28', 'ç‰¹å¾3: 0.22']
             };

             displayMLResults(results);
         }

         function runLogisticRegression() {
             const results = {
                 algorithm: 'é€»è¾‘å›å½’',
                 accuracy: (0.72 + Math.random() * 0.23).toFixed(3),
                 precision: (0.7 + Math.random() * 0.25).toFixed(3),
                 recall: (0.68 + Math.random() * 0.27).toFixed(3)
             };

             displayMLResults(results);
         }

         function runNaiveBayes() {
             const results = {
                 algorithm: 'æœ´ç´ è´å¶æ–¯',
                 accuracy: (0.7 + Math.random() * 0.25).toFixed(3),
                 classes: ['ç±»åˆ«A', 'ç±»åˆ«B', 'ç±»åˆ«C'],
                 priorProb: ['0.33', '0.35', '0.32']
             };

             displayMLResults(results);
         }

         function displayMLResults(results) {
             let resultsHTML = `
                 <div class="ml-results">
                     <h4>ğŸ¤– ${results.algorithm} ç»“æœ</h4>
                     <div class="metric-grid">
             `;

             // æ ¹æ®ä¸åŒç®—æ³•æ˜¾ç¤ºä¸åŒçš„ç»“æœ
             if (results.algorithm === 'K-meansèšç±»') {
                 resultsHTML += `
                     <div class="metric-card">
                         <div class="metric-value">${results.clusters}</div>
                         <div class="metric-label">èšç±»æ•°é‡</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.iterations}</div>
                         <div class="metric-label">è¿­ä»£æ¬¡æ•°</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.accuracy}</div>
                         <div class="metric-label">èšç±»è´¨é‡</div>
                     </div>
                 `;
             } else if (results.algorithm === 'çº¿æ€§å›å½’') {
                 resultsHTML += `
                     <div class="metric-card">
                         <div class="metric-value">${results.rSquared}</div>
                         <div class="metric-label">RÂ² å€¼</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.slope}</div>
                         <div class="metric-label">æ–œç‡</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.intercept}</div>
                         <div class="metric-label">æˆªè·</div>
                     </div>
                 `;
             } else if (results.algorithm === 'å†³ç­–æ ‘åˆ†ç±»') {
                 resultsHTML += `
                     <div class="metric-card">
                         <div class="metric-value">${results.accuracy}</div>
                         <div class="metric-label">å‡†ç¡®ç‡</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.maxDepth}</div>
                         <div class="metric-label">æœ€å¤§æ·±åº¦</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.nodes}</div>
                         <div class="metric-label">èŠ‚ç‚¹æ•°é‡</div>
                     </div>
                 `;
             } else if (results.algorithm === 'éšæœºæ£®æ—') {
                 resultsHTML += `
                     <div class="metric-card">
                         <div class="metric-value">${results.accuracy}</div>
                         <div class="metric-label">å‡†ç¡®ç‡</div>
                     </div>
                     <div class="metric-card">
                         <div class="metric-value">${results.numTrees}</div>
                         <div class="metric-label">æ ‘çš„æ•°é‡</div>
                     </div>
                 `;
             } else {
                 resultsHTML += `
                     <div class="metric-card">
                         <div class="metric-value">${results.accuracy}</div>
                         <div class="metric-label">å‡†ç¡®ç‡</div>
                     </div>
                 `;
             }

             resultsHTML += '</div></div>';
             
             document.getElementById('mlResults').innerHTML = resultsHTML;
             showSuccess(`${results.algorithm}å®Œæˆï¼`);
         }

         function clearML() {
             document.getElementById('mlResults').innerHTML = '';
             showSuccess('æœºå™¨å­¦ä¹ ç»“æœå·²æ¸…é™¤');
         }

         // å·¥å…·å‡½æ•°
         function showSuccess(message) {
             showMessage(message, 'success');
         }

         function showError(message) {
             showMessage(message, 'error');
         }

         function showMessage(message, type) {
             const messageDiv = document.createElement('div');
             messageDiv.className = type;
             messageDiv.textContent = message;
             
             // æ·»åŠ åˆ°é¡µé¢é¡¶éƒ¨
             const mainContent = document.querySelector('.main-content');
             mainContent.insertBefore(messageDiv, mainContent.firstChild);
             
             // 3ç§’åè‡ªåŠ¨ç§»é™¤
             setTimeout(() => {
                 if (messageDiv.parentNode) {
                     messageDiv.parentNode.removeChild(messageDiv);
                 }
             }, 3000);
         }

         // æ˜¾ç¤ºä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡†
         function showUsageGuide() {
             document.getElementById('usageModal').style.display = 'block';
             document.body.style.overflow = 'hidden';
         }

         // å…³é—­ä½¿ç”¨è¯´æ˜æ¨¡æ€æ¡†
         function closeUsageGuide() {
             document.getElementById('usageModal').style.display = 'none';
             document.body.style.overflow = 'auto';
         }

         // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
         window.onclick = function(event) {
             const modal = document.getElementById('usageModal');
             if (event.target == modal) {
                 closeUsageGuide();
             }
         }

         // ESCé”®å…³é—­æ¨¡æ€æ¡†
         document.addEventListener('keydown', function(event) {
             if (event.key === 'Escape') {
                 closeUsageGuide();
             }
         });

         // åˆå§‹åŒ–
         document.addEventListener('DOMContentLoaded', function() {
             updateMLControls();
         });

         // å¯¼å‡ºåŠŸèƒ½å®ç°
         function exportChart() {
             if (!currentChart) {
                 showError('æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾è¡¨');
                 return;
             }

             try {
                 // åˆ›å»ºå¯¼å‡ºé€‰é¡¹æ¨¡æ€æ¡†
                 const modal = document.createElement('div');
                 modal.className = 'modal';
                 modal.innerHTML = `
                     <div class="modal-content">
                         <div class="modal-header">
                             <h3>å¯¼å‡ºå›¾è¡¨</h3>
                             <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                         </div>
                         <div class="modal-body">
                             <div class="export-options">
                                 <button class="btn" onclick="downloadChartImage('png')">ğŸ“· PNGå›¾ç‰‡</button>
                                 <button class="btn" onclick="downloadChartImage('jpeg')">ğŸ–¼ï¸ JPEGå›¾ç‰‡</button>
                                 <button class="btn" onclick="downloadChartData()">ğŸ“Š å›¾è¡¨æ•°æ®(JSON)</button>
                             </div>
                         </div>
                     </div>
                 `;
                 document.body.appendChild(modal);
                 modal.style.display = 'block';
             } catch (error) {
                 showError('å¯¼å‡ºå›¾è¡¨å¤±è´¥: ' + error.message);
             }
         }

         function downloadChartImage(format) {
             try {
                 const canvas = document.querySelector('#chartCanvas');
                 if (!canvas) {
                     showError('æ‰¾ä¸åˆ°å›¾è¡¨ç”»å¸ƒ');
                     return;
                 }

                 const link = document.createElement('a');
                 link.download = `chart_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.${format}`;
                 link.href = canvas.toDataURL(`image/${format}`);
                 link.click();
                 
                 // å…³é—­æ¨¡æ€æ¡†
                 document.querySelector('.modal').remove();
                 showSuccess(`å›¾è¡¨å·²å¯¼å‡ºä¸º ${format.toUpperCase()} æ ¼å¼`);
             } catch (error) {
                 showError('å¯¼å‡ºå›¾ç‰‡å¤±è´¥: ' + error.message);
             }
         }

         function downloadChartData() {
             try {
                 if (!currentChart || !currentChart.data) {
                     showError('æ²¡æœ‰å¯å¯¼å‡ºçš„å›¾è¡¨æ•°æ®');
                     return;
                 }

                 const chartData = {
                     type: currentChart.config.type,
                     data: currentChart.data,
                     options: currentChart.options,
                     exportTime: new Date().toISOString()
                 };

                 const blob = new Blob([JSON.stringify(chartData, null, 2)], { type: 'application/json' });
                 const link = document.createElement('a');
                 link.download = `chart_data_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.json`;
                 link.href = URL.createObjectURL(blob);
                 link.click();
                 
                 // å…³é—­æ¨¡æ€æ¡†
                 document.querySelector('.modal').remove();
                 showSuccess('å›¾è¡¨æ•°æ®å·²å¯¼å‡ºä¸º JSON æ ¼å¼');
             } catch (error) {
                 showError('å¯¼å‡ºæ•°æ®å¤±è´¥: ' + error.message);
             }
         }

         function exportStats() {
             try {
                 const statsResults = document.getElementById('statsResults');
                 if (!statsResults || !statsResults.innerHTML.trim()) {
                     showError('æ²¡æœ‰å¯å¯¼å‡ºçš„ç»Ÿè®¡ç»“æœ');
                     return;
                 }

                 // æå–ç»Ÿè®¡æ•°æ®
                 const statsData = {
                     exportTime: new Date().toISOString(),
                     results: extractStatsData(statsResults)
                 };

                 const blob = new Blob([JSON.stringify(statsData, null, 2)], { type: 'application/json' });
                 const link = document.createElement('a');
                 link.download = `stats_results_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.json`;
                 link.href = URL.createObjectURL(blob);
                 link.click();
                 
                 showSuccess('ç»Ÿè®¡ç»“æœå·²å¯¼å‡º');
             } catch (error) {
                 showError('å¯¼å‡ºç»Ÿè®¡ç»“æœå¤±è´¥: ' + error.message);
             }
         }

         function exportML() {
             try {
                 const mlResults = document.getElementById('mlResults');
                 if (!mlResults || !mlResults.innerHTML.trim()) {
                     showError('æ²¡æœ‰å¯å¯¼å‡ºçš„æœºå™¨å­¦ä¹ ç»“æœ');
                     return;
                 }

                 // æå–MLæ•°æ®
                 const mlData = {
                     exportTime: new Date().toISOString(),
                     results: extractMLData(mlResults)
                 };

                 const blob = new Blob([JSON.stringify(mlData, null, 2)], { type: 'application/json' });
                 const link = document.createElement('a');
                 link.download = `ml_results_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.json`;
                 link.href = URL.createObjectURL(blob);
                 link.click();
                 
                 showSuccess('æœºå™¨å­¦ä¹ ç»“æœå·²å¯¼å‡º');
             } catch (error) {
                 showError('å¯¼å‡ºæœºå™¨å­¦ä¹ ç»“æœå¤±è´¥: ' + error.message);
             }
         }

         function exportCleaning() {
             try {
                 const cleaningResults = document.getElementById('cleaningResults');
                 if (!cleaningResults || !cleaningResults.innerHTML.trim()) {
                     showError('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®æ¸…æ´—ç»“æœ');
                     return;
                 }

                 // æå–æ¸…æ´—æ•°æ®
                 const cleaningData = {
                     exportTime: new Date().toISOString(),
                     results: extractCleaningData(cleaningResults)
                 };

                 const blob = new Blob([JSON.stringify(cleaningData, null, 2)], { type: 'application/json' });
                 const link = document.createElement('a');
                 link.download = `cleaning_results_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.json`;
                 link.href = URL.createObjectURL(blob);
                 link.click();
                 
                 showSuccess('æ•°æ®æ¸…æ´—ç»“æœå·²å¯¼å‡º');
             } catch (error) {
                 showError('å¯¼å‡ºæ•°æ®æ¸…æ´—ç»“æœå¤±è´¥: ' + error.message);
             }
         }

         function exportAllResults() {
             try {
                 const allData = {
                     exportTime: new Date().toISOString(),
                     chart: currentChart ? {
                         type: currentChart.config.type,
                         data: currentChart.data,
                         options: currentChart.options
                     } : null,
                     stats: extractStatsData(document.getElementById('statsResults')),
                     ml: extractMLData(document.getElementById('mlResults')),
                     cleaning: extractCleaningData(document.getElementById('cleaningResults')),
                     originalData: currentData
                 };

                 const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
                 const link = document.createElement('a');
                 link.download = `all_results_${new Date().toISOString().slice(0, 19).replace(/[:T]/g, '-')}.json`;
                 link.href = URL.createObjectURL(blob);
                 link.click();
                 
                 showSuccess('æ‰€æœ‰ç»“æœå·²å¯¼å‡º');
             } catch (error) {
                 showError('å¯¼å‡ºæ‰€æœ‰ç»“æœå¤±è´¥: ' + error.message);
             }
         }

         // è¾…åŠ©å‡½æ•°ï¼šæå–ç»Ÿè®¡æ•°æ®
         function extractStatsData(element) {
             if (!element || !element.innerHTML.trim()) return null;
             
             try {
                 const statsCards = element.querySelectorAll('.metric-card');
                 const data = {};
                 
                 statsCards.forEach(card => {
                     const value = card.querySelector('.metric-value')?.textContent;
                     const label = card.querySelector('.metric-label')?.textContent;
                     if (value && label) {
                         data[label] = value;
                     }
                 });
                 
                 return data;
             } catch (error) {
                 return { html: element.innerHTML };
             }
         }

         // è¾…åŠ©å‡½æ•°ï¼šæå–MLæ•°æ®
         function extractMLData(element) {
             if (!element || !element.innerHTML.trim()) return null;
             
             try {
                 const algorithm = element.querySelector('h4')?.textContent;
                 const statsCards = element.querySelectorAll('.metric-card');
                 const data = { algorithm };
                 
                 statsCards.forEach(card => {
                     const value = card.querySelector('.metric-value')?.textContent;
                     const label = card.querySelector('.metric-label')?.textContent;
                     if (value && label) {
                         data[label] = value;
                     }
                 });
                 
                 return data;
             } catch (error) {
                 return { html: element.innerHTML };
             }
         }

         // è¾…åŠ©å‡½æ•°ï¼šæå–æ¸…æ´—æ•°æ®
         function extractCleaningData(element) {
             if (!element || !element.innerHTML.trim()) return null;
             
             try {
                 const summaryCards = element.querySelectorAll('.summary-card');
                 const data = {};
                 
                 summaryCards.forEach(card => {
                     const value = card.querySelector('.summary-value')?.textContent;
                     const label = card.querySelector('.summary-label')?.textContent;
                     if (value && label) {
                         data[label] = value;
                     }
                 });
                 
                 return data;
             } catch (error) {
                 return { html: element.innerHTML };
             }
         }
     </script>
 </body>
 </html>
