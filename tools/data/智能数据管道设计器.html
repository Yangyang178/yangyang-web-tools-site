<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能数据管道设计器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            overflow: hidden;
        }

        /* 主布局 */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* 顶部工具栏 */
        .toolbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toolbar-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-primary:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #2ecc71;
            transform: translateY(-1px);
        }

        /* 主工作区 */
        .main-workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* 左侧组件面板 */
        .component-panel {
            width: 280px;
            background: white;
            border-right: 1px solid #e1e8ed;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        .panel-header {
            padding: 16px;
            border-bottom: 1px solid #e1e8ed;
            background: #f8fafc;
            font-weight: 600;
            color: #2c3e50;
        }

        .component-tabs {
            display: flex;
            border-bottom: 1px solid #e1e8ed;
        }

        .tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            background: #f8fafc;
            border: none;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .component-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .component-category {
            margin-bottom: 20px;
        }

        .category-title {
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .component-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 6px;
            background: #f8fafc;
            border-radius: 8px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .component-item:hover {
            background: #e2e8f0;
            transform: translateX(4px);
            border-color: #667eea;
        }

        .component-item:active {
            cursor: grabbing;
        }

        .component-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
        }

        .icon-extract { background: #3498db; }
        .icon-transform { background: #e74c3c; }
        .icon-load { background: #27ae60; }
        .icon-template { background: #9b59b6; }

        /* 中央画布区域 */
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }

        .canvas-toolbar {
            padding: 12px 16px;
            background: white;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canvas-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f1f5f9;
            padding: 4px 8px;
            border-radius: 6px;
        }

        .zoom-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: #e2e8f0;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .canvas {
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle, #cbd5e1 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
            cursor: grab;
        }

        .canvas:active {
            cursor: grabbing;
        }

        /* 管道节点样式 */
        .pipeline-node {
            position: absolute;
            min-width: 160px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 2px solid #e1e8ed;
            cursor: move;
            transition: all 0.3s ease;
        }

        .pipeline-node:hover {
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .pipeline-node.selected {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .node-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e1e8ed;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            border-radius: 10px 10px 0 0;
        }

        .node-body {
            padding: 16px;
        }

        .node-title {
            font-weight: 600;
            font-size: 14px;
            color: #2c3e50;
        }

        .node-description {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .node-ports {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
        }

        .port {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #94a3b8;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .port:hover {
            background: #667eea;
            transform: scale(1.3);
        }

        .port.input {
            background: #3498db;
        }

        .port.output {
            background: #27ae60;
        }

        /* 连接线 */
        .connection-line {
            position: absolute;
            pointer-events: none;
            z-index: 1;
        }

        .connection-path {
            fill: none;
            stroke: #667eea;
            stroke-width: 2;
            stroke-dasharray: 0;
            transition: all 0.3s ease;
        }

        .connection-path:hover {
            stroke-width: 3;
            stroke: #5a67d8;
        }

        /* 右侧属性面板 */
        .properties-panel {
            width: 320px;
            background: white;
            border-left: 1px solid #e1e8ed;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0,0,0,0.05);
        }

        .properties-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .property-group {
            margin-bottom: 24px;
        }

        .property-group-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e1e8ed;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 6px;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }

        /* 底部面板 */
        .bottom-panel {
            height: 300px;
            background: white;
            border-top: 1px solid #e1e8ed;
            display: flex;
            flex-direction: column;
        }

        .bottom-tabs {
            display: flex;
            border-bottom: 1px solid #e1e8ed;
            background: #f8fafc;
        }

        .bottom-tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            transition: all 0.3s ease;
            font-size: 14px;
            color: #64748b;
        }

        .bottom-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 2px solid #667eea;
        }

        .bottom-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* 控制台样式 */
        .console {
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 16px;
            height: 100%;
            overflow-y: auto;
        }

        .console-line {
            margin-bottom: 4px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .console-timestamp {
            color: #718096;
            font-size: 11px;
            min-width: 80px;
        }

        .console-level {
            min-width: 50px;
            font-weight: bold;
        }

        .console-level.info { color: #63b3ed; }
        .console-level.success { color: #68d391; }
        .console-level.warning { color: #fbd38d; }
        .console-level.error { color: #fc8181; }

        /* 数据预览表格 */
        .data-preview {
            overflow: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e1e8ed;
        }

        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background: #f1f5f9;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e1e8ed;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: #f1f5f9;
            color: #2c3e50;
        }

        /* 代码编辑器 */
        .code-editor {
            width: 100%;
            height: 300px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 12px;
            background: #1a202c;
            color: #e2e8f0;
            resize: vertical;
        }

        /* 状态指示器 */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-running { background: #3498db; }
        .status-success { background: #27ae60; }
        .status-error { background: #e74c3c; }
        .status-idle { background: #95a5a6; }

        /* 进度条 */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e1e8ed;
            border-radius: 2px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        /* 响应式设计 */
        @media (max-width: 1200px) {
            .component-panel {
                width: 240px;
            }
            .properties-panel {
                width: 280px;
            }
        }

        @media (max-width: 768px) {
            .component-panel,
            .properties-panel {
                position: absolute;
                top: 0;
                bottom: 0;
                z-index: 100;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .component-panel.show,
            .properties-panel.show {
                transform: translateX(0);
            }
            
            .bottom-panel {
                height: 200px;
            }
        }

        /* 动画效果 */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Schema显示样式 */
        .schema-section {
            margin-top: 15px;
            border-top: 1px solid #e1e8ed;
            padding-top: 15px;
        }

        .schema-info {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 12px;
        }

        .schema-meta {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .schema-type, .schema-db, .schema-format {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .schema-db {
            background: #28a745;
        }

        .schema-format {
            background: #6f42c1;
        }

        .schema-fields {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
        }

        .schema-field {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-bottom: 1px solid #f1f3f4;
            font-size: 13px;
        }

        .schema-field:last-child {
            border-bottom: none;
        }

        .field-name {
            font-weight: 500;
            color: #2c3e50;
            min-width: 120px;
        }

        .field-type {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #495057;
        }

        .field-required {
            background: #dc3545;
            color: white;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: bold;
        }

        .field-key {
            background: #ffc107;
            color: #212529;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: bold;
        }

        .schema-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            background: white;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-sm:hover {
            background: #f8f9fa;
            border-color: #adb5bd;
        }

        /* 连接状态指示器 */
        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .connection-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .connection-status.failed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .connection-status.testing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .connection-status::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        /* 测试连接按钮 */
        .test-connection-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .test-connection-btn:hover {
            background: #138496;
        }

        .test-connection-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        /* 调试面板样式 */
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 300px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            font-size: 14px;
        }

        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #ddd;
            border-radius: 8px 8px 0 0;
        }

        .debug-header h4 {
            margin: 0;
            font-size: 16px;
            color: #333;
        }

        .debug-controls {
            padding: 16px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .debug-controls .btn {
            flex: 1;
            min-width: 80px;
        }

        .debug-info {
            padding: 12px 16px;
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            border-radius: 0 0 8px 8px;
        }

        .debug-step, .debug-node {
            margin: 4px 0;
            color: #666;
        }

        .debug-step span, .debug-node span {
            font-weight: bold;
            color: #333;
        }

        /* 调试状态下的节点高亮 */
        .node.debugging {
            border: 3px solid #ff6b35 !important;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.4) !important;
            animation: debugPulse 2s infinite;
        }

        @keyframes debugPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 性能分析样式 */
        .performance-analysis {
            padding: 20px;
        }

        .performance-analysis h4 {
            margin: 0 0 16px 0;
            color: #333;
        }

        .performance-analysis h5 {
            margin: 16px 0 8px 0;
            color: #666;
        }

        .metric {
            margin: 8px 0;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 4px;
            font-weight: bold;
        }

        .node-metrics {
            max-height: 300px;
            overflow-y: auto;
        }

        .node-metric {
            margin: 8px 0;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }

        .node-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .node-time {
            color: #007bff;
            font-weight: bold;
        }

        .node-data {
            color: #666;
            font-size: 12px;
            margin-top: 4px;
        }

        /* 数据采样按钮 */
        .sample-data-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 4px 0;
        }

        .sample-data-btn:hover {
            background: #218838;
        }

        /* 部署设置样式 */
        .deployment-settings {
            width: 100%;
            max-width: 900px;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #007bff;
            background-color: #f8f9fa;
        }

        .tab-btn.active {
            color: #007bff;
            border-bottom-color: #007bff;
            font-weight: 600;
        }

        /* 环境管理样式 */
        .environment-management {
            padding: 20px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h4 {
            margin: 0;
            color: #333;
        }

        .environment-list {
            display: grid;
            gap: 16px;
        }

        .environment-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .environment-card:hover {
            border-color: #007bff;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1);
        }

        .environment-card.active {
            border-color: #28a745;
            background: #f8fff9;
        }

        .env-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .env-header h5 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .env-actions {
            display: flex;
            gap: 8px;
        }

        .env-description {
            color: #666;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .env-config {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 13px;
        }

        .config-item .label {
            font-weight: 600;
            color: #555;
        }

        .config-item .value {
            color: #333;
        }

        /* 调度管理样式 */
        .schedule-management {
            padding: 20px 0;
        }

        .schedule-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .interval-config {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .interval-config input {
            width: 80px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .schedule-list {
            margin-top: 30px;
        }

        .schedule-list h5 {
            margin-bottom: 16px;
            color: #333;
        }

        .schedule-item, .trigger-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 12px;
            background: #fff;
        }

        .schedule-info, .trigger-info {
            flex: 1;
        }

        .schedule-info h6, .trigger-info h6 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }

        .schedule-details, .trigger-details {
            display: flex;
            gap: 16px;
            align-items: center;
            font-size: 13px;
        }

        .schedule-type, .trigger-type {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            text-transform: uppercase;
        }

        .schedule-expression, .trigger-condition {
            color: #666;
            font-family: monospace;
        }

        .schedule-status, .trigger-status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .schedule-status.enabled, .trigger-status.enabled {
            background: #d4edda;
            color: #155724;
        }

        .schedule-status.disabled, .trigger-status.disabled {
            background: #f8d7da;
            color: #721c24;
        }

        .schedule-actions, .trigger-actions {
            display: flex;
            gap: 8px;
        }

        /* 触发器管理样式 */
        .trigger-management {
            padding: 20px 0;
        }

        .trigger-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 30px;
        }

        .trigger-type-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
        }

        .trigger-type-card:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1);
        }

        .trigger-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .trigger-type-card h5 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }

        .trigger-type-card p {
            margin: 0;
            color: #666;
            font-size: 13px;
        }

        /* 导出管理样式 */
        .export-management {
            padding: 20px 0;
        }

        .export-options {
            display: grid;
            gap: 30px;
        }

        .export-format h5, .export-config h5 {
            margin: 0 0 16px 0;
            color: #333;
        }

        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .format-option {
            cursor: pointer;
        }

        .format-option input[type="radio"] {
            display: none;
        }

        .format-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            background: #fff;
        }

        .format-option input[type="radio"]:checked + .format-card {
            border-color: #007bff;
            background: #f0f8ff;
        }

        .format-card:hover {
            border-color: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1);
        }

        .format-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .format-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .format-desc {
            color: #666;
            font-size: 13px;
        }

        .export-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .export-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }

        .empty-state {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        /* 环境编辑表单样式 */
        .environment-edit-form {
            width: 100%;
            max-width: 500px;
        }

        .environment-edit-form .form-group {
            margin-bottom: 20px;
        }

        .environment-edit-form label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
        }

        .environment-edit-form input,
        .environment-edit-form select,
        .environment-edit-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .environment-edit-form textarea {
            height: 80px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        /* 监控面板样式 */
        .monitoring-panel {
            width: 100%;
            max-width: 1200px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-header h4 {
            margin: 0;
            color: #333;
            font-size: 16px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }

        .metric-value.warning {
            color: #ffc107;
        }

        .metric-value.error {
            color: #dc3545;
        }

        .metric-chart {
            height: 100px;
            background: #f8f9fa;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
        }

        .monitoring-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .monitoring-status {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .status-indicators {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 14px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
        }

        .status-item.inactive .status-dot {
            background: #6c757d;
        }

        .status-item.error .status-dot {
            background: #dc3545;
        }

        /* 执行历史样式 */
        .history-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .history-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .history-item {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
            background: #fff;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .node-id {
            font-weight: 600;
            color: #333;
        }

        .status {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
        }

        .timestamp {
            color: #666;
            font-size: 13px;
        }

        .history-details {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 13px;
        }

        /* 数据血缘样式 */
        .lineage-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
        }

        .lineage-visualization {
            margin: 30px 0;
        }

        .lineage-graph {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 8px;
            overflow-x: auto;
        }

        .lineage-node {
            background: #fff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            min-width: 150px;
            text-align: center;
        }

        .lineage-node.source {
            border-color: #28a745;
        }

        .lineage-node.transform {
            border-color: #ffc107;
        }

        .lineage-node.target {
            border-color: #dc3545;
        }

        .lineage-node h5 {
            margin: 0 0 12px 0;
            color: #333;
        }

        .node-info p {
            margin: 4px 0;
            font-size: 13px;
            color: #666;
        }

        .lineage-arrow {
            font-size: 24px;
            color: #007bff;
            font-weight: bold;
        }

        .lineage-details {
            margin-top: 30px;
        }

        .lineage-table table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .lineage-table th,
        .lineage-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .lineage-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        /* 告警管理样式 */
        .alerts-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .alerts-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .alert-item {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 12px;
            background: #fff;
        }

        .alert-item.error {
            border-left: 4px solid #dc3545;
        }

        .alert-item.warning {
            border-left: 4px solid #ffc107;
        }

        .alert-item.info {
            border-left: 4px solid #17a2b8;
        }

        .alert-item.acknowledged {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .alert-level {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: #007bff;
            color: white;
        }

        .alert-title {
            font-weight: 600;
            color: #333;
            flex: 1;
            margin: 0 12px;
        }

        .alert-time {
            color: #666;
            font-size: 13px;
        }

        .alert-message {
            color: #666;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .alert-actions {
            display: flex;
            justify-content: flex-end;
        }

        .acknowledged-label {
            color: #28a745;
            font-size: 13px;
            font-weight: 600;
        }

        /* 智能推荐样式 */
        .recommendation-panel {
            width: 100%;
            max-width: 800px;
        }

        .recommendation-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .recommendation-tabs .tab-button {
            background: none;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .recommendation-tabs .tab-button:hover {
            color: #007bff;
            background: #f8f9fa;
        }

        .recommendation-tabs .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
            font-weight: 600;
        }

        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .recommendation-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .recommendation-item.high {
            border-left: 4px solid #28a745;
        }

        .recommendation-item.low {
            border-left: 4px solid #6c757d;
        }

        .recommendation-item.performance {
            border-left: 4px solid #007bff;
        }

        .recommendation-item.security {
            border-left: 4px solid #dc3545;
        }

        .recommendation-item.reliability {
            border-left: 4px solid #ffc107;
        }

        .recommendation-item.quality {
            border-left: 4px solid #17a2b8;
        }

        .rec-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .rec-header h5 {
            margin: 0;
            color: #333;
            font-size: 16px;
        }

        .priority-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-badge.high {
            background: #d4edda;
            color: #155724;
        }

        .priority-badge.low {
            background: #f8f9fa;
            color: #6c757d;
        }

        .type-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: white;
        }

        .type-badge.performance {
            background: #007bff;
        }

        .type-badge.security {
            background: #dc3545;
        }

        .type-badge.reliability {
            background: #ffc107;
        }

        .type-badge.quality {
            background: #17a2b8;
        }

        .rec-reason,
        .rec-message {
            color: #666;
            margin: 8px 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .current-metrics {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .current-metrics h5 {
            margin: 0 0 12px 0;
            color: #333;
        }

        .metrics-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #fff;
            border-radius: 6px;
            font-size: 14px;
        }

        .metric-item span:first-child {
            color: #666;
        }

        .metric-item span:last-child {
            font-weight: 600;
        }

        .metric-item .normal {
            color: #28a745;
        }

        .metric-item .warning {
            color: #ffc107;
        }

        .no-recommendations {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
        }

        /* 协作功能样式 */
        .collaboration-panel {
            max-width: 800px;
            margin: 0 auto;
        }

        .collaboration-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .collaboration-tabs .tab-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }

        .collaboration-tabs .tab-button:hover {
            background-color: #f5f5f5;
            color: #333;
        }

        .collaboration-tabs .tab-button.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            background-color: #f8f9fa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 版本控制样式 */
        .version-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .versions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .version-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .version-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .version-item.current {
            border-color: #007bff;
            background-color: #f8f9fa;
        }

        .version-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .version-header h5 {
            margin: 0;
            color: #333;
        }

        .version-id {
            font-size: 12px;
            color: #666;
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .version-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 10px;
            font-size: 12px;
            color: #666;
        }

        .version-actions {
            display: flex;
            gap: 8px;
        }

        .no-versions {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 0;
        }

        /* 团队协作样式 */
        .team-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .team-members {
            margin-bottom: 30px;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 8px;
            background: #fff;
        }

        .member-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .member-avatar {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 50%;
        }

        .member-details h5 {
            margin: 0;
            font-size: 14px;
            color: #333;
        }

        .member-role {
            font-size: 12px;
            color: #666;
            text-transform: capitalize;
        }

        .member-status {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-dot.online {
            background-color: #28a745;
        }

        .status-dot.offline {
            background-color: #dc3545;
        }

        .status-text {
            font-size: 12px;
            color: #666;
        }

        .sharing-settings {
            border-top: 1px solid #e0e0e0;
            padding-top: 20px;
        }

        .sharing-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .sharing-options label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .sharing-options label:hover {
            background-color: #f8f9fa;
        }

        /* 评论系统样式 */
        .comments-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .comments-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .comment-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .comment-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .comment-item.resolved {
            opacity: 0.7;
            background-color: #f8f9fa;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: 500;
            color: #333;
        }

        .comment-time {
            font-size: 12px;
            color: #666;
        }

        .comment-content {
            margin-bottom: 10px;
            line-height: 1.5;
            color: #333;
        }

        .comment-actions {
            display: flex;
            gap: 8px;
        }

        .resolved-label {
            color: #28a745;
            font-size: 12px;
            font-weight: 500;
        }

        .no-comments {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 0;
        }

        /* 版本预览样式 */
        .version-preview {
            text-align: center;
        }

        .preview-meta {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }

        .preview-meta p {
            margin: 8px 0;
            color: #333;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .collaboration-panel {
                max-width: 100%;
                padding: 0 10px;
            }

            .collaboration-tabs {
                flex-direction: column;
            }

            .collaboration-tabs .tab-button {
                text-align: left;
                border-bottom: 1px solid #e0e0e0;
            }

            .version-controls,
            .team-controls,
            .comments-controls {
                flex-direction: column;
            }

            .member-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .member-status {
                align-self: flex-end;
            }
        }

        /* 扩展性架构样式 */
        .extensibility-panel {
            max-width: 1000px;
            width: 100%;
        }

        .extensibility-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .extensibility-tabs .tab-button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }

        .extensibility-tabs .tab-button:hover {
            background: #f8f9fa;
            color: #333;
        }

        .extensibility-tabs .tab-button.active {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            background: #f8f9fa;
        }

        /* 插件管理样式 */
        .plugin-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .plugins-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .plugin-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .plugin-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .plugin-item.enabled {
            border-left: 4px solid #28a745;
        }

        .plugin-item.disabled {
            border-left: 4px solid #dc3545;
            opacity: 0.7;
        }

        .plugin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .plugin-info h5 {
            margin: 0;
            color: #333;
        }

        .plugin-version {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }

        .plugin-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #007bff;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .plugin-meta {
            color: #666;
        }

        .plugin-description {
            margin: 8px 0;
            font-size: 14px;
        }

        .plugin-details {
            display: flex;
            gap: 20px;
            font-size: 12px;
        }

        .plugin-author {
            color: #007bff;
        }

        .plugin-hooks {
            color: #28a745;
        }

        .no-plugins {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 0;
        }

        /* 自定义节点样式 */
        .custom-node-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .custom-nodes-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .custom-node-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .custom-node-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .node-preview {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .node-icon {
            font-size: 24px;
            margin-right: 12px;
        }

        .node-info h5 {
            margin: 0;
            color: #333;
        }

        .node-category {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .node-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .node-ports {
            display: flex;
            gap: 15px;
        }

        .port-info {
            font-size: 12px;
            color: #666;
        }

        .node-actions {
            display: flex;
            gap: 8px;
        }

        .no-custom-nodes {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 0;
        }

        /* API接口样式 */
        .api-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .api-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .api-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .api-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .api-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .api-endpoint {
            background: #f8f9fa;
            color: #495057;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .api-actions {
            display: flex;
            gap: 8px;
        }

        .no-apis {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 0;
        }

        /* 扩展市场样式 */
        .marketplace-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .marketplace-controls input {
            flex: 1;
        }

        .marketplace-categories {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 6px 12px;
            border: 1px solid #e0e0e0;
            background: #fff;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .category-btn:hover {
            background: #f8f9fa;
        }

        .category-btn.active {
            background: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        .marketplace-items {
            max-height: 500px;
            overflow-y: auto;
        }

        .marketplace-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            background: #fff;
            transition: all 0.3s ease;
        }

        .marketplace-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .item-header h5 {
            margin: 0;
            color: #333;
        }

        .item-rating {
            color: #ffc107;
            font-size: 14px;
        }

        .item-description {
            color: #666;
            font-size: 14px;
            margin: 8px 0;
        }

        .item-meta {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #666;
            margin-bottom: 12px;
        }

        .item-author {
            color: #007bff;
        }

        .item-downloads {
            color: #28a745;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        /* 插件编辑器样式 */
        .plugin-editor {
            width: 100%;
        }

        .plugin-editor textarea {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .editor-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        /* 自定义节点编辑器样式 */
        .custom-node-editor {
            width: 100%;
        }

        .node-config-form .form-group {
            margin-bottom: 15px;
        }

        .node-config-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        /* 调试工具栏 */
        .debug-toolbar {
            display: flex;
            gap: 8px;
            margin: 8px 0;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .debug-toolbar .btn {
            font-size: 12px;
            padding: 4px 8px;
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        /* 工具提示 */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- 顶部工具栏 -->
        <div class="toolbar">
            <div class="toolbar-left">
                <div class="logo">
                    <span>🔧</span>
                    智能数据管道设计器
                </div>
                <div class="toolbar-actions">
                    <button class="btn btn-primary" onclick="newPipeline()">
                        <span>📄</span> 新建
                    </button>
                    <button class="btn btn-primary" onclick="openPipeline()">
                        <span>📁</span> 打开
                    </button>
                    <button class="btn btn-primary" onclick="savePipeline()">
                        <span>💾</span> 保存
                    </button>
                </div>
            </div>
            <div class="toolbar-actions">
                <button class="btn btn-primary" onclick="exportPipeline()">
                    <span>📤</span> 导出
                </button>
                <button class="btn btn-success" onclick="runPipeline()">
                    <span>▶️</span> 运行
                </button>
                <button class="btn btn-secondary" onclick="startStepByStepDebugging()">
                    <span>🐛</span> 调试
                </button>
                <button class="btn btn-info" onclick="analyzePerformance()">
                    <span>📊</span> 性能
                </button>
                <button class="btn btn-success" onclick="showMonitoringPanel()">
                    <span>📈</span> 监控
                </button>
                <button class="btn btn-info" onclick="showRecommendationPanel()">
                    <span>🤖</span> 推荐
                </button>
                <button class="btn btn-success" onclick="showCollaborationPanel()">
                    <span>👥</span> 协作
                </button>
                <button class="btn btn-info" onclick="showExtensibilityPanel()">
                    <span>🔧</span> 扩展
                </button>
                <button class="btn btn-warning" onclick="showDeploymentSettings()">
                    <span>🚀</span> 部署
                </button>
                <button class="btn btn-primary" onclick="showSettings()">
                    <span>⚙️</span> 设置
                </button>
            </div>
        </div>

        <!-- 主工作区 -->
        <div class="main-workspace">
            <!-- 左侧组件面板 -->
            <div class="component-panel">
                <div class="panel-header">组件库</div>
                <div class="component-tabs">
                    <button class="tab active" onclick="switchTab('nodes')">节点</button>
                    <button class="tab" onclick="switchTab('templates')">模板</button>
                </div>
                <div class="component-list" id="componentList">
                    <!-- 数据源节点 -->
                    <div class="component-category">
                        <div class="category-title">数据源</div>
                        <div class="component-item" draggable="true" data-type="database-source">
                            <div class="component-icon icon-extract">DB</div>
                            <div>
                                <div class="component-title">数据库源</div>
                                <div class="component-description">连接各种数据库</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="api-source">
                            <div class="component-icon icon-extract">API</div>
                            <div>
                                <div class="component-title">API源</div>
                                <div class="component-description">REST/GraphQL接口</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="file-source">
                            <div class="component-icon icon-extract">📁</div>
                            <div>
                                <div class="component-title">文件源</div>
                                <div class="component-description">CSV/JSON/XML文件</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="stream-source">
                            <div class="component-icon icon-extract">🌊</div>
                            <div>
                                <div class="component-title">流数据源</div>
                                <div class="component-description">实时数据流</div>
                            </div>
                        </div>
                    </div>

                    <!-- 转换节点 -->
                    <div class="component-category">
                        <div class="category-title">数据转换</div>
                        <div class="component-item" draggable="true" data-type="filter">
                            <div class="component-icon icon-transform">🔍</div>
                            <div>
                                <div class="component-title">数据过滤</div>
                                <div class="component-description">条件筛选数据</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="transform">
                            <div class="component-icon icon-transform">🔄</div>
                            <div>
                                <div class="component-title">字段转换</div>
                                <div class="component-description">映射和转换字段</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="aggregate">
                            <div class="component-icon icon-transform">📊</div>
                            <div>
                                <div class="component-title">聚合统计</div>
                                <div class="component-description">分组聚合计算</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="join">
                            <div class="component-icon icon-transform">🔗</div>
                            <div>
                                <div class="component-title">数据关联</div>
                                <div class="component-description">多表关联操作</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="clean">
                            <div class="component-icon icon-transform">🧹</div>
                            <div>
                                <div class="component-title">数据清洗</div>
                                <div class="component-description">去重和标准化</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="custom-code">
                            <div class="component-icon icon-transform">💻</div>
                            <div>
                                <div class="component-title">自定义代码</div>
                                <div class="component-description">JavaScript处理</div>
                            </div>
                        </div>
                    </div>

                    <!-- 输出节点 -->
                    <div class="component-category">
                        <div class="category-title">数据输出</div>
                        <div class="component-item" draggable="true" data-type="database-sink">
                            <div class="component-icon icon-load">DB</div>
                            <div>
                                <div class="component-title">数据库输出</div>
                                <div class="component-description">写入数据库</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="file-sink">
                            <div class="component-icon icon-load">📄</div>
                            <div>
                                <div class="component-title">文件输出</div>
                                <div class="component-description">导出到文件</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="api-sink">
                            <div class="component-icon icon-load">🚀</div>
                            <div>
                                <div class="component-title">API输出</div>
                                <div class="component-description">推送到API</div>
                            </div>
                        </div>
                        <div class="component-item" draggable="true" data-type="visualization">
                            <div class="component-icon icon-load">📈</div>
                            <div>
                                <div class="component-title">数据可视化</div>
                                <div class="component-description">图表展示</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中央画布区域 -->
            <div class="canvas-area">
                <div class="canvas-toolbar">
                    <div class="canvas-controls">
                        <button class="btn btn-primary" onclick="fitToScreen()">
                            <span>🔍</span> 适应屏幕
                        </button>
                        <button class="btn btn-primary" onclick="centerCanvas()">
                            <span>🎯</span> 居中
                        </button>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomOut()">-</button>
                        <span id="zoomLevel">100%</span>
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                    </div>
                </div>
                <div class="canvas-container">
                    <div class="canvas" id="canvas">
                        <svg id="connectionSvg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
                        </svg>
                    </div>
                </div>
            </div>

            <!-- 右侧属性面板 -->
            <div class="properties-panel">
                <div class="panel-header">属性配置</div>
                <div class="properties-content" id="propertiesContent">
                    <div class="property-group">
                        <div class="property-group-title">选择节点以配置属性</div>
                        <p style="color: #64748b; font-size: 14px; line-height: 1.5;">
                            在画布中选择一个节点来查看和编辑其配置属性。您可以设置数据源连接、转换规则、输出格式等。
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部面板 -->
        <div class="bottom-panel">
            <div class="bottom-tabs">
                <button class="bottom-tab active" onclick="switchBottomTab('console')">
                    <span class="status-indicator status-idle"></span>
                    执行控制台
                </button>
                <button class="bottom-tab" onclick="switchBottomTab('logs')">
                    <span>📋</span> 执行日志
                </button>
                <button class="bottom-tab" onclick="switchBottomTab('preview')">
                    <span>👁️</span> 数据预览
                </button>
                <button class="bottom-tab" onclick="switchBottomTab('monitor')">
                    <span>📊</span> 性能监控
                </button>
            </div>
            <div class="bottom-content" id="bottomContent">
                <div class="console" id="console">
                    <div class="console-line">
                        <span class="console-timestamp">10:30:15</span>
                        <span class="console-level info">INFO</span>
                        <span>数据管道设计器已就绪</span>
                    </div>
                    <div class="console-line">
                        <span class="console-timestamp">10:30:16</span>
                        <span class="console-level success">SUCCESS</span>
                        <span>组件库加载完成</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 节点配置模态框 -->
    <div class="modal" id="nodeConfigModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">节点配置</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- 动态内容 -->
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 16px; border-top: 1px solid #e1e8ed;">
                <button class="btn btn-primary" onclick="closeModal()">取消</button>
                <button class="btn btn-success" onclick="saveNodeConfig()">保存</button>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let canvas = document.getElementById('canvas');
        let connectionSvg = document.getElementById('connectionSvg');
        let nodes = [];
        let connections = [];
        let selectedNode = null;
        let draggedNode = null;
        let isConnecting = false;
        let connectionStart = null;
        let zoomLevel = 1;
        let panX = 0;
        let panY = 0;
        let nodeIdCounter = 1;
        let isPanning = false;
        let lastPanPoint = { x: 0, y: 0 };

        // SVG箭头标记定义
        function initSvgMarkers() {
            if (!connectionSvg) return;
            
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            marker.setAttribute('id', 'arrowhead');
            marker.setAttribute('markerWidth', '10');
            marker.setAttribute('markerHeight', '7');
            marker.setAttribute('refX', '9');
            marker.setAttribute('refY', '3.5');
            marker.setAttribute('orient', 'auto');
            
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
            polygon.setAttribute('fill', '#667eea');
            
            marker.appendChild(polygon);
            defs.appendChild(marker);
            connectionSvg.appendChild(defs);
        }

        // 初始化应用
        function initApp() {
            setupEventListeners();
            updateConsole('info', '应用初始化完成');
            loadSamplePipeline();
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 拖放事件
            setupDragAndDrop();
            
            // 画布事件
            canvas.addEventListener('mousedown', handleCanvasMouseDown);
            canvas.addEventListener('mousemove', handleCanvasMouseMove);
            canvas.addEventListener('mouseup', handleCanvasMouseUp);
            canvas.addEventListener('wheel', handleCanvasWheel);
            
            // 键盘事件
            document.addEventListener('keydown', handleKeyDown);
            
            // 窗口调整
            window.addEventListener('resize', handleResize);
        }

        // 拖放设置
        function setupDragAndDrop() {
            const componentItems = document.querySelectorAll('.component-item');
            
            componentItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', item.dataset.type);
                });
            });

            canvas.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            canvas.addEventListener('drop', (e) => {
                e.preventDefault();
                const nodeType = e.dataTransfer.getData('text/plain');
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left - panX) / zoomLevel;
                const y = (e.clientY - rect.top - panY) / zoomLevel;
                createNode(nodeType, x, y);
            });
        }

        // 创建节点
        function createNode(type, x, y) {
            const nodeConfig = getNodeConfig(type);
            const node = {
                id: `node_${nodeIdCounter++}`,
                type: type,
                x: x,
                y: y,
                config: { ...nodeConfig.defaultConfig },
                inputs: nodeConfig.inputs,
                outputs: nodeConfig.outputs
            };

            nodes.push(node);
            renderNode(node);
            updateConsole('success', `创建节点: ${nodeConfig.title}`);
        }

        // 获取节点配置
        function getNodeConfig(type) {
            const configs = {
                'database-source': {
                    title: '数据库源',
                    icon: 'DB',
                    color: '#3498db',
                    inputs: [],
                    outputs: ['data'],
                    defaultConfig: {
                        connectionString: '',
                        query: 'SELECT * FROM table_name',
                        database: 'mysql',
                        host: 'localhost',
                        port: 3306,
                        username: '',
                        password: ''
                    }
                },
                'api-source': {
                    title: 'API源',
                    icon: 'API',
                    color: '#3498db',
                    inputs: [],
                    outputs: ['data'],
                    defaultConfig: {
                        url: 'https://api.example.com/data',
                        method: 'GET',
                        headers: '{}',
                        body: '',
                        authentication: 'none'
                    }
                },
                'file-source': {
                    title: '文件源',
                    icon: '📁',
                    color: '#3498db',
                    inputs: [],
                    outputs: ['data'],
                    defaultConfig: {
                        filePath: '',
                        fileType: 'csv',
                        delimiter: ',',
                        encoding: 'utf-8',
                        hasHeader: true
                    }
                },
                'stream-source': {
                    title: '流数据源',
                    icon: '🌊',
                    color: '#3498db',
                    inputs: [],
                    outputs: ['data'],
                    defaultConfig: {
                        streamType: 'websocket',
                        endpoint: 'ws://localhost:8080/stream',
                        bufferSize: 1000,
                        batchSize: 100
                    }
                },
                'filter': {
                    title: '数据过滤',
                    icon: '🔍',
                    color: '#e74c3c',
                    inputs: ['data'],
                    outputs: ['filtered'],
                    defaultConfig: {
                        conditions: [],
                        operator: 'AND',
                        customFilter: ''
                    }
                },
                'transform': {
                    title: '字段转换',
                    icon: '🔄',
                    color: '#e74c3c',
                    inputs: ['data'],
                    outputs: ['transformed'],
                    defaultConfig: {
                        mappings: [],
                        renameFields: {},
                        computedFields: []
                    }
                },
                'aggregate': {
                    title: '聚合统计',
                    icon: '📊',
                    color: '#e74c3c',
                    inputs: ['data'],
                    outputs: ['aggregated'],
                    defaultConfig: {
                        groupBy: [],
                        aggregations: [],
                        having: ''
                    }
                },
                'join': {
                    title: '数据关联',
                    icon: '🔗',
                    color: '#e74c3c',
                    inputs: ['left', 'right'],
                    outputs: ['joined'],
                    defaultConfig: {
                        joinType: 'inner',
                        leftKey: '',
                        rightKey: '',
                        selectFields: []
                    }
                },
                'clean': {
                    title: '数据清洗',
                    icon: '🧹',
                    color: '#e74c3c',
                    inputs: ['data'],
                    outputs: ['cleaned'],
                    defaultConfig: {
                        removeDuplicates: true,
                        fillMissingValues: true,
                        defaultValue: '',
                        trimWhitespace: true,
                        validateFormats: []
                    }
                },
                'custom-code': {
                    title: '自定义代码',
                    icon: '💻',
                    color: '#e74c3c',
                    inputs: ['data'],
                    outputs: ['processed'],
                    defaultConfig: {
                        code: '// 在这里编写JavaScript代码\nfunction process(data) {\n    // 处理数据\n    return data;\n}',
                        language: 'javascript'
                    }
                },
                'database-sink': {
                    title: '数据库输出',
                    icon: 'DB',
                    color: '#27ae60',
                    inputs: ['data'],
                    outputs: [],
                    defaultConfig: {
                        connectionString: '',
                        tableName: '',
                        insertMode: 'insert',
                        batchSize: 1000
                    }
                },
                'file-sink': {
                    title: '文件输出',
                    icon: '📄',
                    color: '#27ae60',
                    inputs: ['data'],
                    outputs: [],
                    defaultConfig: {
                        filePath: 'output.csv',
                        fileType: 'csv',
                        delimiter: ',',
                        encoding: 'utf-8',
                        includeHeader: true
                    }
                },
                'api-sink': {
                    title: 'API输出',
                    icon: '🚀',
                    color: '#27ae60',
                    inputs: ['data'],
                    outputs: [],
                    defaultConfig: {
                        url: 'https://api.example.com/data',
                        method: 'POST',
                        headers: '{"Content-Type": "application/json"}',
                        batchSize: 100
                    }
                },
                'visualization': {
                    title: '数据可视化',
                    icon: '📈',
                    color: '#27ae60',
                    inputs: ['data'],
                    outputs: [],
                    defaultConfig: {
                        chartType: 'line',
                        xAxis: '',
                        yAxis: '',
                        title: '数据图表',
                        width: 800,
                        height: 400
                    }
                }
            };

            return configs[type] || {
                title: '未知节点',
                icon: '?',
                color: '#95a5a6',
                inputs: ['input'],
                outputs: ['output'],
                defaultConfig: {}
            };
        }

        // 渲染节点
        function renderNode(node) {
            const nodeConfig = getNodeConfig(node.type);
            const nodeElement = document.createElement('div');
            nodeElement.className = 'pipeline-node';
            nodeElement.id = node.id;
            nodeElement.style.left = `${node.x}px`;
            nodeElement.style.top = `${node.y}px`;
            nodeElement.style.transform = `scale(${zoomLevel})`;

            nodeElement.innerHTML = `
                <div class="node-header" style="background: ${nodeConfig.color}20; border-bottom-color: ${nodeConfig.color}40;">
                    <div class="component-icon" style="background: ${nodeConfig.color}; color: white; width: 20px; height: 20px; font-size: 10px;">
                        ${nodeConfig.icon}
                    </div>
                    <div>
                        <div class="node-title">${nodeConfig.title}</div>
                        <div class="node-description">ID: ${node.id}</div>
                    </div>
                </div>
                <div class="node-body">
                    <div class="node-ports">
                        <div class="input-ports">
                            ${node.inputs.map((input, index) => 
                                `<div class="port input" data-port="${input}" data-index="${index}" title="输入: ${input}"></div>`
                            ).join('')}
                        </div>
                        <div class="output-ports">
                            ${node.outputs.map((output, index) => 
                                `<div class="port output" data-port="${output}" data-index="${index}" title="输出: ${output}"></div>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;

            // 添加事件监听器
            nodeElement.addEventListener('mousedown', (e) => handleNodeMouseDown(e, node));
            nodeElement.addEventListener('click', (e) => selectNode(node));
            nodeElement.addEventListener('dblclick', (e) => openNodeConfig(node));

            // 端口事件
            const ports = nodeElement.querySelectorAll('.port');
            ports.forEach(port => {
                port.addEventListener('mousedown', (e) => handlePortMouseDown(e, node, port));
                port.addEventListener('mouseup', (e) => handlePortMouseUp(e, node, port));
            });

            canvas.appendChild(nodeElement);
        }

        // 处理节点鼠标按下
        function handleNodeMouseDown(e, node) {
            if (e.target.classList.contains('port')) return;
            
            e.stopPropagation();
            draggedNode = node;
            selectNode(node);
            
            const rect = canvas.getBoundingClientRect();
            const nodeElement = document.getElementById(node.id);
            const nodeRect = nodeElement.getBoundingClientRect();
            
            draggedNode.offsetX = e.clientX - nodeRect.left;
            draggedNode.offsetY = e.clientY - nodeRect.top;
        }

        // 选择节点
        function selectNode(node) {
            // 清除之前的选择
            document.querySelectorAll('.pipeline-node').forEach(n => n.classList.remove('selected'));
            
            // 选择当前节点
            const nodeElement = document.getElementById(node.id);
            nodeElement.classList.add('selected');
            selectedNode = node;
            
            // 更新属性面板
            updatePropertiesPanel(node);
        }

        // 更新属性面板
        function updatePropertiesPanel(node) {
            const nodeConfig = getNodeConfig(node.type);
            const propertiesContent = document.getElementById('propertiesContent');
            
            let html = `
                <div class="property-group">
                    <div class="property-group-title">${nodeConfig.title} 配置</div>
                    <div class="form-group">
                        <label class="form-label">节点ID</label>
                        <input type="text" class="form-input" value="${node.id}" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">节点类型</label>
                        <input type="text" class="form-input" value="${nodeConfig.title}" readonly>
                    </div>
                </div>
            `;

            // 根据节点类型生成配置表单
            html += generateConfigForm(node);

            propertiesContent.innerHTML = html;

            // 添加表单事件监听器
            const inputs = propertiesContent.querySelectorAll('.form-input, .form-select, .form-textarea');
            inputs.forEach(input => {
                input.addEventListener('change', (e) => {
                    const key = e.target.dataset.config;
                    if (key) {
                        node.config[key] = e.target.value;
                        updateConsole('info', `更新节点配置: ${key} = ${e.target.value}`);
                    }
                });
            });
        }

        // 生成配置表单
        function generateConfigForm(node) {
            const nodeConfig = getNodeConfig(node.type);
            let html = '';

            // 添加连接状态显示（仅对数据源节点）
            if (node.type.includes('database') || node.type.includes('api') || node.type.includes('file') || node.type.includes('stream')) {
                const connection = dataConnectors.connections.get(node.id);
                let statusClass = 'testing';
                let statusText = '未测试';
                
                if (connection) {
                    if (connection.status === 'connected') {
                        statusClass = 'connected';
                        statusText = '已连接';
                    } else if (connection.status === 'failed') {
                        statusClass = 'failed';
                        statusText = '连接失败';
                    }
                }
                
                html += `
                    <div class="connection-status ${statusClass}">
                        ${statusText}
                    </div>
                `;
            }

            html += '<div class="property-group"><div class="property-group-title">参数配置</div>';

            for (const [key, value] of Object.entries(node.config)) {
                html += `<div class="form-group">`;
                html += `<label class="form-label">${getConfigLabel(key)}</label>`;
                
                if (key === 'code') {
                    html += `<textarea class="form-textarea code-editor" data-config="${key}" rows="10">${value}</textarea>`;
                } else if (key.includes('Type') || key.includes('Mode') || key.includes('Method')) {
                    html += `<select class="form-select" data-config="${key}">`;
                    const options = getSelectOptions(key);
                    options.forEach(option => {
                        html += `<option value="${option.value}" ${option.value === value ? 'selected' : ''}>${option.label}</option>`;
                    });
                    html += `</select>`;
                } else if (typeof value === 'boolean') {
                    html += `<select class="form-select" data-config="${key}">
                        <option value="true" ${value ? 'selected' : ''}>是</option>
                        <option value="false" ${!value ? 'selected' : ''}>否</option>
                    </select>`;
                } else {
                    html += `<input type="text" class="form-input" data-config="${key}" value="${value}">`;
                }
                html += `</div>`;
            }

            // 添加测试连接按钮（仅对数据源节点）
            if (node.type.includes('database') || node.type.includes('api') || node.type.includes('file') || node.type.includes('stream')) {
                html += `
                    <button class="test-connection-btn" onclick="testConnectionForNode('${node.id}')">
                        测试连接
                    </button>
                    <button class="sample-data-btn" onclick="sampleData('${node.id}', 50)">
                        数据采样
                    </button>
                `;
            }

            html += '</div>';
            return html;
        }

        // 获取配置标签
        function getConfigLabel(key) {
            const labels = {
                connectionString: '连接字符串',
                query: 'SQL查询',
                database: '数据库类型',
                host: '主机地址',
                port: '端口',
                username: '用户名',
                password: '密码',
                url: 'URL地址',
                method: '请求方法',
                headers: '请求头',
                body: '请求体',
                authentication: '认证方式',
                filePath: '文件路径',
                fileType: '文件类型',
                delimiter: '分隔符',
                encoding: '编码',
                hasHeader: '包含标题行',
                streamType: '流类型',
                endpoint: '端点地址',
                bufferSize: '缓冲区大小',
                batchSize: '批处理大小',
                conditions: '过滤条件',
                operator: '逻辑操作符',
                customFilter: '自定义过滤器',
                mappings: '字段映射',
                renameFields: '字段重命名',
                computedFields: '计算字段',
                groupBy: '分组字段',
                aggregations: '聚合函数',
                having: 'Having条件',
                joinType: '关联类型',
                leftKey: '左表键',
                rightKey: '右表键',
                selectFields: '选择字段',
                removeDuplicates: '去除重复',
                fillMissingValues: '填充缺失值',
                defaultValue: '默认值',
                trimWhitespace: '去除空白',
                validateFormats: '格式验证',
                code: '代码',
                language: '编程语言',
                tableName: '表名',
                insertMode: '插入模式',
                includeHeader: '包含标题',
                chartType: '图表类型',
                xAxis: 'X轴字段',
                yAxis: 'Y轴字段',
                title: '标题',
                width: '宽度',
                height: '高度'
            };
            return labels[key] || key;
        }

        // 数据源连接器管理
        const dataConnectors = {
            connections: new Map(),
            schemas: new Map(),
            credentials: new Map()
        };

        // 测试数据源连接
        async function testConnection(nodeId, config) {
            updateConsole('info', `正在测试连接: ${config.database || config.streamType || 'Unknown'}`);
            
            try {
                // 模拟连接测试
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // 根据不同数据源类型进行模拟测试
                const success = Math.random() > 0.2; // 80%成功率
                
                if (success) {
                    dataConnectors.connections.set(nodeId, {
                        status: 'connected',
                        timestamp: new Date(),
                        config: config
                    });
                    updateConsole('success', '连接测试成功');
                    
                    // 自动发现Schema
                    await discoverSchema(nodeId, config);
                    return true;
                } else {
                    throw new Error('连接失败：无法连接到数据源');
                }
            } catch (error) {
                dataConnectors.connections.set(nodeId, {
                    status: 'failed',
                    timestamp: new Date(),
                    error: error.message
                });
                updateConsole('error', `连接测试失败: ${error.message}`);
                return false;
            }
        }

        // Schema发现功能
        async function discoverSchema(nodeId, config) {
            updateConsole('info', '正在发现数据结构...');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 根据数据源类型生成模拟Schema
                let schema = {};
                
                if (config.database) {
                    schema = generateDatabaseSchema(config.database);
                } else if (config.streamType) {
                    schema = generateStreamSchema(config.streamType);
                } else if (config.fileType) {
                    schema = generateFileSchema(config.fileType);
                } else if (config.url) {
                    schema = generateApiSchema();
                }
                
                dataConnectors.schemas.set(nodeId, {
                    schema: schema,
                    timestamp: new Date(),
                    source: config
                });
                
                updateConsole('success', `发现 ${Object.keys(schema.fields || {}).length} 个字段`);
                
                // 更新节点配置界面显示Schema信息
                updateSchemaDisplay(nodeId, schema);
                
                return schema;
            } catch (error) {
                updateConsole('error', `Schema发现失败: ${error.message}`);
                return null;
            }
        }

        // 生成数据库Schema
        function generateDatabaseSchema(dbType) {
            const schemas = {
                mysql: {
                    type: 'database',
                    database: 'sample_db',
                    tables: ['users', 'orders', 'products'],
                    fields: {
                        'users.id': { type: 'int', nullable: false, key: 'primary' },
                        'users.name': { type: 'varchar(255)', nullable: false },
                        'users.email': { type: 'varchar(255)', nullable: false, unique: true },
                        'users.created_at': { type: 'timestamp', nullable: false },
                        'orders.id': { type: 'int', nullable: false, key: 'primary' },
                        'orders.user_id': { type: 'int', nullable: false, key: 'foreign' },
                        'orders.total': { type: 'decimal(10,2)', nullable: false },
                        'orders.status': { type: 'enum', values: ['pending', 'completed', 'cancelled'] }
                    }
                },
                postgresql: {
                    type: 'database',
                    database: 'analytics_db',
                    tables: ['events', 'sessions', 'users'],
                    fields: {
                        'events.id': { type: 'serial', nullable: false, key: 'primary' },
                        'events.event_name': { type: 'varchar(100)', nullable: false },
                        'events.user_id': { type: 'integer', nullable: true },
                        'events.timestamp': { type: 'timestamptz', nullable: false },
                        'events.properties': { type: 'jsonb', nullable: true }
                    }
                },
                mongodb: {
                    type: 'document',
                    database: 'app_data',
                    collections: ['users', 'posts', 'comments'],
                    fields: {
                        '_id': { type: 'ObjectId', nullable: false },
                        'username': { type: 'String', nullable: false },
                        'profile': { type: 'Object', nested: true },
                        'posts': { type: 'Array', items: 'ObjectId' },
                        'created_at': { type: 'Date', nullable: false }
                    }
                }
            };
            return schemas[dbType] || schemas.mysql;
        }

        // 生成流数据Schema
        function generateStreamSchema(streamType) {
            const schemas = {
                websocket: {
                    type: 'stream',
                    format: 'json',
                    fields: {
                        'timestamp': { type: 'datetime', nullable: false },
                        'event_type': { type: 'string', nullable: false },
                        'user_id': { type: 'string', nullable: true },
                        'data': { type: 'object', nullable: true }
                    }
                },
                kafka: {
                    type: 'stream',
                    format: 'avro',
                    fields: {
                        'key': { type: 'string', nullable: false },
                        'value': { type: 'bytes', nullable: false },
                        'timestamp': { type: 'long', nullable: false },
                        'partition': { type: 'int', nullable: false }
                    }
                }
            };
            return schemas[streamType] || schemas.websocket;
        }

        // 生成文件Schema
        function generateFileSchema(fileType) {
            const schemas = {
                csv: {
                    type: 'file',
                    format: 'csv',
                    delimiter: ',',
                    hasHeader: true,
                    fields: {
                        'id': { type: 'integer', nullable: false },
                        'name': { type: 'string', nullable: false },
                        'email': { type: 'string', nullable: true },
                        'age': { type: 'integer', nullable: true },
                        'created_date': { type: 'date', nullable: false }
                    }
                },
                json: {
                    type: 'file',
                    format: 'json',
                    fields: {
                        'id': { type: 'number', nullable: false },
                        'title': { type: 'string', nullable: false },
                        'content': { type: 'string', nullable: true },
                        'tags': { type: 'array', items: 'string' },
                        'metadata': { type: 'object', nested: true }
                    }
                }
            };
            return schemas[fileType] || schemas.csv;
        }

        // 生成API Schema
        function generateApiSchema() {
            return {
                type: 'api',
                format: 'json',
                endpoint: '/api/data',
                fields: {
                    'id': { type: 'number', nullable: false },
                    'status': { type: 'string', enum: ['active', 'inactive'] },
                    'data': { type: 'object', nullable: true },
                    'timestamp': { type: 'string', format: 'iso8601' }
                }
            };
        }

        // 更新Schema显示
        function updateSchemaDisplay(nodeId, schema) {
            const node = nodes.find(n => n.id === nodeId);
            if (!node) return;

            // 在属性面板中添加Schema信息
            const propertiesContent = document.getElementById('properties-content');
            if (propertiesContent && selectedNode && selectedNode.id === nodeId) {
                const schemaHtml = generateSchemaDisplay(schema);
                
                // 查找或创建Schema显示区域
                let schemaSection = propertiesContent.querySelector('.schema-section');
                if (!schemaSection) {
                    schemaSection = document.createElement('div');
                    schemaSection.className = 'schema-section';
                    propertiesContent.appendChild(schemaSection);
                }
                
                schemaSection.innerHTML = schemaHtml;
            }
        }

        // 生成Schema显示HTML
        function generateSchemaDisplay(schema) {
            let html = `
                <div class="property-group">
                    <div class="property-group-title">数据结构 (Schema)</div>
                    <div class="schema-info">
                        <div class="schema-meta">
                            <span class="schema-type">${schema.type}</span>
                            ${schema.database ? `<span class="schema-db">${schema.database}</span>` : ''}
                            ${schema.format ? `<span class="schema-format">${schema.format}</span>` : ''}
                        </div>
                        <div class="schema-fields">
            `;

            if (schema.fields) {
                for (const [fieldName, fieldInfo] of Object.entries(schema.fields)) {
                    html += `
                        <div class="schema-field">
                            <span class="field-name">${fieldName}</span>
                            <span class="field-type">${fieldInfo.type}</span>
                            ${fieldInfo.nullable === false ? '<span class="field-required">必填</span>' : ''}
                            ${fieldInfo.key ? `<span class="field-key">${fieldInfo.key}</span>` : ''}
                        </div>
                    `;
                }
            }

            html += `
                        </div>
                        <div class="schema-actions">
                            <button class="btn btn-sm" onclick="refreshSchema('${schema.nodeId}')">刷新Schema</button>
                            <button class="btn btn-sm" onclick="exportSchema('${schema.nodeId}')">导出Schema</button>
                        </div>
                    </div>
                </div>
            `;

            return html;
        }

        // 刷新Schema
        async function refreshSchema(nodeId) {
            const connection = dataConnectors.connections.get(nodeId);
            if (connection && connection.status === 'connected') {
                await discoverSchema(nodeId, connection.config);
            } else {
                updateConsole('warning', '请先测试连接');
            }
        }

        // 导出Schema
        function exportSchema(nodeId) {
            const schema = dataConnectors.schemas.get(nodeId);
            if (schema) {
                const dataStr = JSON.stringify(schema.schema, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `schema_${nodeId}.json`;
                link.click();
                URL.revokeObjectURL(url);
                updateConsole('success', 'Schema导出成功');
            }
        }

        // 为节点测试连接
        async function testConnectionForNode(nodeId) {
            const node = nodes.find(n => n.id === nodeId);
            if (!node) return;

            const testBtn = document.querySelector('.test-connection-btn');
            if (testBtn) {
                testBtn.disabled = true;
                testBtn.textContent = '测试中...';
            }

            try {
                const success = await testConnection(nodeId, node.config);
                
                // 刷新属性面板显示
                if (selectedNode && selectedNode.id === nodeId) {
                    showNodeProperties(node);
                }
                
                if (success) {
                    updateConsole('success', `节点 ${node.config.name || node.type} 连接测试成功`);
                } else {
                    updateConsole('error', `节点 ${node.config.name || node.type} 连接测试失败`);
                }
            } finally {
                if (testBtn) {
                    testBtn.disabled = false;
                    testBtn.textContent = '测试连接';
                }
            }
        }

        // 凭据管理
        function saveCredentials(nodeId, credentials) {
            // 简单的本地存储（实际应用中应该加密）
            const encryptedCreds = btoa(JSON.stringify(credentials));
            dataConnectors.credentials.set(nodeId, encryptedCreds);
            localStorage.setItem(`creds_${nodeId}`, encryptedCreds);
            updateConsole('info', '凭据已保存');
        }

        // 测试调试环境
        const debugEnvironment = {
            isDebugging: false,
            currentStep: 0,
            breakpoints: new Set(),
            executionHistory: [],
            sampleData: new Map(),
            performanceMetrics: new Map()
        };

        // 数据采样功能
        async function sampleData(nodeId, sampleSize = 100) {
            updateConsole('info', `正在采样数据，样本大小: ${sampleSize}`);
            
            try {
                const node = nodes.find(n => n.id === nodeId);
                if (!node) throw new Error('节点不存在');

                // 模拟数据采样
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const sampleData = generateSampleData(node.type, sampleSize);
                debugEnvironment.sampleData.set(nodeId, {
                    data: sampleData,
                    timestamp: new Date(),
                    size: sampleSize
                });

                updateConsole('success', `采样完成，获得 ${sampleData.length} 条记录`);
                updateDataPreview(sampleData);
                
                return sampleData;
            } catch (error) {
                updateConsole('error', `数据采样失败: ${error.message}`);
                return null;
            }
        }

        // 生成示例数据
        function generateSampleData(nodeType, size) {
            const data = [];
            
            for (let i = 0; i < size; i++) {
                let record = {};
                
                if (nodeType.includes('database')) {
                    record = {
                        id: i + 1,
                        name: `用户${i + 1}`,
                        email: `user${i + 1}@example.com`,
                        age: Math.floor(Math.random() * 50) + 18,
                        created_at: new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toISOString()
                    };
                } else if (nodeType.includes('api')) {
                    record = {
                        id: i + 1,
                        status: Math.random() > 0.5 ? 'active' : 'inactive',
                        data: { value: Math.random() * 100 },
                        timestamp: new Date().toISOString()
                    };
                } else if (nodeType.includes('file')) {
                    record = {
                        row: i + 1,
                        column1: `值${i + 1}`,
                        column2: Math.floor(Math.random() * 1000),
                        column3: Math.random() > 0.5
                    };
                } else if (nodeType.includes('stream')) {
                    record = {
                        timestamp: new Date(Date.now() - Math.random() * 60000).toISOString(),
                        event_type: ['click', 'view', 'purchase'][Math.floor(Math.random() * 3)],
                        user_id: `user_${Math.floor(Math.random() * 1000)}`,
                        data: { session_id: `session_${Math.floor(Math.random() * 100)}` }
                    };
                } else {
                    // 默认数据结构
                    record = {
                        id: i + 1,
                        value: Math.random() * 100,
                        category: ['A', 'B', 'C'][Math.floor(Math.random() * 3)],
                        timestamp: new Date().toISOString()
                    };
                }
                
                data.push(record);
            }
            
            return data;
        }

        // 逐步调试功能
        async function startStepByStepDebugging() {
            if (nodes.length === 0) {
                updateConsole('warning', '请先添加节点到管道中');
                return;
            }

            debugEnvironment.isDebugging = true;
            debugEnvironment.currentStep = 0;
            debugEnvironment.executionHistory = [];
            
            updateConsole('info', '开始逐步调试模式');
            
            // 获取执行顺序
            const executionOrder = getExecutionOrder();
            if (executionOrder.length === 0) {
                updateConsole('error', '无法确定执行顺序，请检查节点连接');
                return;
            }

            // 显示调试控制面板
            showDebugControls();
            
            // 高亮第一个节点
            highlightCurrentNode(executionOrder[0]);
            
            updateConsole('info', `调试准备就绪，共 ${executionOrder.length} 个步骤`);
        }

        // 获取执行顺序
        function getExecutionOrder() {
            const visited = new Set();
            const order = [];
            
            // 找到起始节点（没有输入连接的节点）
            const startNodes = nodes.filter(node => 
                !connections.some(conn => conn.end.node.id === node.id)
            );
            
            function dfs(node) {
                if (visited.has(node.id)) return;
                visited.add(node.id);
                order.push(node);
                
                // 找到所有输出连接的目标节点
                const outputConnections = connections.filter(conn => conn.start.node.id === node.id);
                outputConnections.forEach(conn => {
                    dfs(conn.end.node);
                });
            }
            
            startNodes.forEach(node => dfs(node));
            return order;
        }

        // 显示调试控制面板
        function showDebugControls() {
            const debugPanel = document.createElement('div');
            debugPanel.id = 'debug-panel';
            debugPanel.className = 'debug-panel';
            debugPanel.innerHTML = `
                <div class="debug-header">
                    <h4>调试控制</h4>
                    <button class="btn btn-sm" onclick="stopDebugging()">停止调试</button>
                </div>
                <div class="debug-controls">
                    <button class="btn btn-primary" onclick="debugNextStep()">下一步</button>
                    <button class="btn btn-secondary" onclick="debugContinue()">继续执行</button>
                    <button class="btn btn-warning" onclick="debugReset()">重置</button>
                </div>
                <div class="debug-info">
                    <div class="debug-step">步骤: <span id="debug-step-counter">0</span></div>
                    <div class="debug-node">当前节点: <span id="debug-current-node">-</span></div>
                </div>
            `;
            
            document.body.appendChild(debugPanel);
        }

        // 执行下一步调试
        async function debugNextStep() {
            const executionOrder = getExecutionOrder();
            if (debugEnvironment.currentStep >= executionOrder.length) {
                updateConsole('info', '调试完成');
                stopDebugging();
                return;
            }

            const currentNode = executionOrder[debugEnvironment.currentStep];
            updateConsole('info', `执行步骤 ${debugEnvironment.currentStep + 1}: ${currentNode.config.name || currentNode.type}`);
            
            // 高亮当前节点
            highlightCurrentNode(currentNode);
            
            // 更新调试信息
            document.getElementById('debug-step-counter').textContent = debugEnvironment.currentStep + 1;
            document.getElementById('debug-current-node').textContent = currentNode.config.name || currentNode.type;
            
            // 执行节点处理
            const startTime = performance.now();
            const result = await executeNodeStep(currentNode);
            const endTime = performance.now();
            
            // 记录性能指标
            debugEnvironment.performanceMetrics.set(currentNode.id, {
                executionTime: endTime - startTime,
                inputSize: result.inputSize || 0,
                outputSize: result.outputSize || 0,
                memoryUsage: result.memoryUsage || 0
            });
            
            // 记录执行历史
            debugEnvironment.executionHistory.push({
                step: debugEnvironment.currentStep,
                node: currentNode,
                result: result,
                timestamp: new Date(),
                executionTime: endTime - startTime
            });
            
            // 更新数据预览
            if (result.data) {
                updateDataPreview(result.data.slice(0, 50)); // 只显示前50条
            }
            
            debugEnvironment.currentStep++;
            
            updateConsole('success', `步骤完成，耗时: ${(endTime - startTime).toFixed(2)}ms`);
        }

        // 执行节点步骤
        async function executeNodeStep(node) {
            // 模拟节点执行
            await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 1000));
            
            // 获取输入数据
            let inputData = [];
            const inputConnections = connections.filter(conn => conn.end.node.id === node.id);
            
            if (inputConnections.length > 0) {
                // 从前一个节点获取数据
                const prevStep = debugEnvironment.executionHistory.find(h => 
                    inputConnections.some(conn => conn.start.node.id === h.node.id)
                );
                inputData = prevStep ? prevStep.result.data || [] : [];
            } else {
                // 起始节点，生成或采样数据
                inputData = await sampleData(node.id, 100) || [];
            }
            
            // 根据节点类型处理数据
            let outputData = processNodeData(node, inputData);
            
            return {
                data: outputData,
                inputSize: inputData.length,
                outputSize: outputData.length,
                memoryUsage: Math.floor(Math.random() * 1024 * 1024) // 模拟内存使用
            };
        }

        // 处理节点数据
        function processNodeData(node, inputData) {
            let outputData = [...inputData];
            
            switch (node.type) {
                case 'filter':
                    // 模拟过滤操作
                    outputData = inputData.filter(() => Math.random() > 0.3);
                    break;
                case 'transform':
                    // 模拟转换操作
                    outputData = inputData.map(item => ({
                        ...item,
                        transformed: true,
                        processedAt: new Date().toISOString()
                    }));
                    break;
                case 'aggregate':
                    // 模拟聚合操作
                    outputData = [{
                        count: inputData.length,
                        sum: inputData.reduce((sum, item) => sum + (item.value || 0), 0),
                        avg: inputData.length > 0 ? inputData.reduce((sum, item) => sum + (item.value || 0), 0) / inputData.length : 0
                    }];
                    break;
                default:
                    // 默认不处理
                    break;
            }
            
            return outputData;
        }

        // 高亮当前节点
        function highlightCurrentNode(node) {
            // 清除之前的高亮
            document.querySelectorAll('.node').forEach(n => n.classList.remove('debugging'));
            
            // 高亮当前节点
            const nodeElement = document.querySelector(`[data-node-id="${node.id}"]`);
            if (nodeElement) {
                nodeElement.classList.add('debugging');
            }
        }

        // 继续执行调试
        async function debugContinue() {
            const executionOrder = getExecutionOrder();
            while (debugEnvironment.currentStep < executionOrder.length && debugEnvironment.isDebugging) {
                await debugNextStep();
                await new Promise(resolve => setTimeout(resolve, 500)); // 短暂延迟以便观察
            }
        }

        // 重置调试
        function debugReset() {
            debugEnvironment.currentStep = 0;
            debugEnvironment.executionHistory = [];
            debugEnvironment.performanceMetrics.clear();
            
            // 清除高亮
            document.querySelectorAll('.node').forEach(n => n.classList.remove('debugging'));
            
            updateConsole('info', '调试已重置');
        }

        // 停止调试
        function stopDebugging() {
            debugEnvironment.isDebugging = false;
            
            // 移除调试面板
            const debugPanel = document.getElementById('debug-panel');
            if (debugPanel) {
                debugPanel.remove();
            }
            
            // 清除高亮
            document.querySelectorAll('.node').forEach(n => n.classList.remove('debugging'));
            
            updateConsole('info', '调试已停止');
        }

        // 性能分析
        function analyzePerformance() {
            if (debugEnvironment.performanceMetrics.size === 0) {
                updateConsole('warning', '请先运行调试以收集性能数据');
                return;
            }

            const metrics = Array.from(debugEnvironment.performanceMetrics.entries());
            const totalTime = metrics.reduce((sum, [_, metric]) => sum + metric.executionTime, 0);
            
            let analysis = `
                <div class="performance-analysis">
                    <h4>性能分析报告</h4>
                    <div class="metric">总执行时间: ${totalTime.toFixed(2)}ms</div>
                    <div class="metric">节点数量: ${metrics.length}</div>
                    <div class="metric">平均执行时间: ${(totalTime / metrics.length).toFixed(2)}ms</div>
                    <h5>各节点性能:</h5>
                    <div class="node-metrics">
            `;
            
            metrics.forEach(([nodeId, metric]) => {
                const node = nodes.find(n => n.id === nodeId);
                const nodeName = node ? (node.config.name || node.type) : nodeId;
                const percentage = ((metric.executionTime / totalTime) * 100).toFixed(1);
                
                analysis += `
                    <div class="node-metric">
                        <div class="node-name">${nodeName}</div>
                        <div class="node-time">${metric.executionTime.toFixed(2)}ms (${percentage}%)</div>
                        <div class="node-data">输入: ${metric.inputSize}, 输出: ${metric.outputSize}</div>
                    </div>
                `;
            });
            
            analysis += `</div></div>`;
            
            // 显示分析结果
            showModal('性能分析', analysis);
            updateConsole('info', '性能分析完成');
        }

        // 调度部署系统
        const deploymentSystem = {
            environments: new Map(),
            schedules: new Map(),
            triggers: new Map(),
            deployments: new Map(),
            currentEnvironment: 'development'
        };

        // 环境管理
        function initializeEnvironments() {
            const defaultEnvironments = [
                {
                    id: 'development',
                    name: '开发环境',
                    description: '用于开发和测试',
                    config: {
                        resources: { cpu: 2, memory: '4GB', storage: '50GB' },
                        security: 'basic',
                        monitoring: true,
                        logging: 'debug'
                    }
                },
                {
                    id: 'staging',
                    name: '预发布环境',
                    description: '用于预发布测试',
                    config: {
                        resources: { cpu: 4, memory: '8GB', storage: '100GB' },
                        security: 'enhanced',
                        monitoring: true,
                        logging: 'info'
                    }
                },
                {
                    id: 'production',
                    name: '生产环境',
                    description: '生产环境部署',
                    config: {
                        resources: { cpu: 8, memory: '16GB', storage: '500GB' },
                        security: 'strict',
                        monitoring: true,
                        logging: 'warn'
                    }
                }
            ];

            defaultEnvironments.forEach(env => {
                deploymentSystem.environments.set(env.id, env);
            });
        }

        // 显示部署设置
        function showDeploymentSettings() {
            const content = `
                <div class="deployment-settings">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchDeploymentTab('environments')">环境管理</button>
                        <button class="tab-btn" onclick="switchDeploymentTab('schedules')">调度设置</button>
                        <button class="tab-btn" onclick="switchDeploymentTab('triggers')">触发器</button>
                        <button class="tab-btn" onclick="switchDeploymentTab('export')">导出部署</button>
                    </div>
                    
                    <div id="deployment-content">
                        ${generateEnvironmentContent()}
                    </div>
                </div>
            `;
            
            showModal('部署设置', content);
        }

        // 切换部署标签
        function switchDeploymentTab(tab) {
            // 更新标签状态
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 更新内容
            const contentDiv = document.getElementById('deployment-content');
            switch (tab) {
                case 'environments':
                    contentDiv.innerHTML = generateEnvironmentContent();
                    break;
                case 'schedules':
                    contentDiv.innerHTML = generateScheduleContent();
                    break;
                case 'triggers':
                    contentDiv.innerHTML = generateTriggerContent();
                    break;
                case 'export':
                    contentDiv.innerHTML = generateExportContent();
                    break;
            }
        }

        // 生成环境管理内容
        function generateEnvironmentContent() {
            let html = `
                <div class="environment-management">
                    <div class="section-header">
                        <h4>环境管理</h4>
                        <button class="btn btn-primary btn-sm" onclick="createNewEnvironment()">新建环境</button>
                    </div>
                    <div class="environment-list">
            `;
            
            deploymentSystem.environments.forEach((env, id) => {
                const isActive = id === deploymentSystem.currentEnvironment;
                html += `
                    <div class="environment-card ${isActive ? 'active' : ''}">
                        <div class="env-header">
                            <h5>${env.name}</h5>
                            <div class="env-actions">
                                <button class="btn btn-sm ${isActive ? 'btn-success' : 'btn-secondary'}" 
                                        onclick="switchEnvironment('${id}')" ${isActive ? 'disabled' : ''}>
                                    ${isActive ? '当前环境' : '切换'}
                                </button>
                                <button class="btn btn-sm btn-info" onclick="editEnvironment('${id}')">编辑</button>
                                ${id !== 'production' ? `<button class="btn btn-sm btn-danger" onclick="deleteEnvironment('${id}')">删除</button>` : ''}
                            </div>
                        </div>
                        <div class="env-description">${env.description}</div>
                        <div class="env-config">
                            <div class="config-item">
                                <span class="label">资源:</span>
                                <span class="value">${env.config.resources.cpu}核 ${env.config.resources.memory} ${env.config.resources.storage}</span>
                            </div>
                            <div class="config-item">
                                <span class="label">安全级别:</span>
                                <span class="value">${env.config.security}</span>
                            </div>
                            <div class="config-item">
                                <span class="label">日志级别:</span>
                                <span class="value">${env.config.logging}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `</div></div>`;
            return html;
        }

        // 生成调度设置内容
        function generateScheduleContent() {
            return `
                <div class="schedule-management">
                    <div class="section-header">
                        <h4>调度设置</h4>
                        <button class="btn btn-primary btn-sm" onclick="createNewSchedule()">新建调度</button>
                    </div>
                    
                    <div class="schedule-form">
                        <div class="form-group">
                            <label>调度类型:</label>
                            <select id="schedule-type" onchange="updateScheduleForm()">
                                <option value="cron">Cron表达式</option>
                                <option value="interval">固定间隔</option>
                                <option value="manual">手动触发</option>
                            </select>
                        </div>
                        
                        <div id="schedule-config">
                            <div class="form-group">
                                <label>Cron表达式:</label>
                                <input type="text" id="cron-expression" placeholder="0 0 * * *" />
                                <small>每天午夜执行</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>目标环境:</label>
                            <select id="target-environment">
                                ${Array.from(deploymentSystem.environments.entries()).map(([id, env]) => 
                                    `<option value="${id}">${env.name}</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>失败重试次数:</label>
                            <input type="number" id="retry-count" value="3" min="0" max="10" />
                        </div>
                        
                        <div class="form-group">
                            <label>通知设置:</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="notify-success" /> 成功时通知</label>
                                <label><input type="checkbox" id="notify-failure" checked /> 失败时通知</label>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="saveSchedule()">保存调度</button>
                    </div>
                    
                    <div class="schedule-list">
                        <h5>已配置的调度</h5>
                        <div id="schedule-items">
                            ${generateScheduleList()}
                        </div>
                    </div>
                </div>
            `;
        }

        // 生成触发器内容
        function generateTriggerContent() {
            return `
                <div class="trigger-management">
                    <div class="section-header">
                        <h4>触发器管理</h4>
                        <button class="btn btn-primary btn-sm" onclick="createNewTrigger()">新建触发器</button>
                    </div>
                    
                    <div class="trigger-types">
                        <div class="trigger-type-card" onclick="selectTriggerType('webhook')">
                            <div class="trigger-icon">🔗</div>
                            <h5>Webhook触发器</h5>
                            <p>通过HTTP请求触发管道执行</p>
                        </div>
                        
                        <div class="trigger-type-card" onclick="selectTriggerType('file')">
                            <div class="trigger-icon">📁</div>
                            <h5>文件触发器</h5>
                            <p>监控文件变化自动触发</p>
                        </div>
                        
                        <div class="trigger-type-card" onclick="selectTriggerType('data')">
                            <div class="trigger-icon">📊</div>
                            <h5>数据触发器</h5>
                            <p>基于数据条件触发执行</p>
                        </div>
                        
                        <div class="trigger-type-card" onclick="selectTriggerType('event')">
                            <div class="trigger-icon">⚡</div>
                            <h5>事件触发器</h5>
                            <p>响应系统事件触发</p>
                        </div>
                    </div>
                    
                    <div class="trigger-list">
                        <h5>已配置的触发器</h5>
                        <div id="trigger-items">
                            ${generateTriggerList()}
                        </div>
                    </div>
                </div>
            `;
        }

        // 生成导出内容
        function generateExportContent() {
            return `
                <div class="export-management">
                    <div class="section-header">
                        <h4>导出部署</h4>
                    </div>
                    
                    <div class="export-options">
                        <div class="export-format">
                            <h5>导出格式</h5>
                            <div class="format-options">
                                <label class="format-option">
                                    <input type="radio" name="export-format" value="docker" checked />
                                    <div class="format-card">
                                        <div class="format-icon">🐳</div>
                                        <div class="format-name">Docker</div>
                                        <div class="format-desc">生成Docker镜像和配置</div>
                                    </div>
                                </label>
                                
                                <label class="format-option">
                                    <input type="radio" name="export-format" value="kubernetes" />
                                    <div class="format-card">
                                        <div class="format-icon">☸️</div>
                                        <div class="format-name">Kubernetes</div>
                                        <div class="format-desc">生成K8s部署文件</div>
                                    </div>
                                </label>
                                
                                <label class="format-option">
                                    <input type="radio" name="export-format" value="serverless" />
                                    <div class="format-card">
                                        <div class="format-icon">⚡</div>
                                        <div class="format-name">Serverless</div>
                                        <div class="format-desc">生成云函数配置</div>
                                    </div>
                                </label>
                                
                                <label class="format-option">
                                    <input type="radio" name="export-format" value="standalone" />
                                    <div class="format-card">
                                        <div class="format-icon">📦</div>
                                        <div class="format-name">独立应用</div>
                                        <div class="format-desc">生成可执行程序</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <div class="export-config">
                            <h5>导出配置</h5>
                            <div class="form-group">
                                <label>项目名称:</label>
                                <input type="text" id="project-name" value="data-pipeline" />
                            </div>
                            
                            <div class="form-group">
                                <label>版本号:</label>
                                <input type="text" id="project-version" value="1.0.0" />
                            </div>
                            
                            <div class="form-group">
                                <label>目标环境:</label>
                                <select id="export-environment">
                                    ${Array.from(deploymentSystem.environments.entries()).map(([id, env]) => 
                                        `<option value="${id}">${env.name}</option>`
                                    ).join('')}
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label>包含配置:</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" id="include-secrets" /> 包含敏感信息</label>
                                    <label><input type="checkbox" id="include-monitoring" checked /> 包含监控配置</label>
                                    <label><input type="checkbox" id="include-logging" checked /> 包含日志配置</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="export-actions">
                            <button class="btn btn-primary" onclick="generateDeploymentPackage()">生成部署包</button>
                            <button class="btn btn-secondary" onclick="previewDeploymentConfig()">预览配置</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // 调度部署辅助函数
        function generateScheduleList() {
            if (deploymentSystem.schedules.size === 0) {
                return '<div class="empty-state">暂无调度配置</div>';
            }
            
            let html = '';
            deploymentSystem.schedules.forEach((schedule, id) => {
                html += `
                    <div class="schedule-item">
                        <div class="schedule-info">
                            <h6>${schedule.name}</h6>
                            <div class="schedule-details">
                                <span class="schedule-type">${schedule.type}</span>
                                <span class="schedule-expression">${schedule.expression}</span>
                                <span class="schedule-status ${schedule.enabled ? 'enabled' : 'disabled'}">
                                    ${schedule.enabled ? '启用' : '禁用'}
                                </span>
                            </div>
                        </div>
                        <div class="schedule-actions">
                            <button class="btn btn-sm btn-info" onclick="editSchedule('${id}')">编辑</button>
                            <button class="btn btn-sm ${schedule.enabled ? 'btn-warning' : 'btn-success'}" 
                                    onclick="toggleSchedule('${id}')">
                                ${schedule.enabled ? '禁用' : '启用'}
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteSchedule('${id}')">删除</button>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }

        function generateTriggerList() {
            if (deploymentSystem.triggers.size === 0) {
                return '<div class="empty-state">暂无触发器配置</div>';
            }
            
            let html = '';
            deploymentSystem.triggers.forEach((trigger, id) => {
                html += `
                    <div class="trigger-item">
                        <div class="trigger-info">
                            <h6>${trigger.name}</h6>
                            <div class="trigger-details">
                                <span class="trigger-type">${trigger.type}</span>
                                <span class="trigger-condition">${trigger.condition}</span>
                                <span class="trigger-status ${trigger.enabled ? 'enabled' : 'disabled'}">
                                    ${trigger.enabled ? '启用' : '禁用'}
                                </span>
                            </div>
                        </div>
                        <div class="trigger-actions">
                            <button class="btn btn-sm btn-info" onclick="editTrigger('${id}')">编辑</button>
                            <button class="btn btn-sm ${trigger.enabled ? 'btn-warning' : 'btn-success'}" 
                                    onclick="toggleTrigger('${id}')">
                                ${trigger.enabled ? '禁用' : '启用'}
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteTrigger('${id}')">删除</button>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }

        // 环境管理函数
        function switchEnvironment(envId) {
            deploymentSystem.currentEnvironment = envId;
            updateConsole('info', `已切换到${deploymentSystem.environments.get(envId).name}`);
            // 刷新环境显示
            const contentDiv = document.getElementById('deployment-content');
            if (contentDiv) {
                contentDiv.innerHTML = generateEnvironmentContent();
            }
        }

        function createNewEnvironment() {
            const envId = `env_${Date.now()}`;
            const newEnv = {
                id: envId,
                name: '新环境',
                description: '自定义环境',
                config: {
                    resources: { cpu: 2, memory: '4GB', storage: '50GB' },
                    security: 'basic',
                    monitoring: true,
                    logging: 'info'
                }
            };
            
            deploymentSystem.environments.set(envId, newEnv);
            updateConsole('info', '已创建新环境');
            
            // 刷新显示
            const contentDiv = document.getElementById('deployment-content');
            if (contentDiv) {
                contentDiv.innerHTML = generateEnvironmentContent();
            }
        }

        function editEnvironment(envId) {
            const env = deploymentSystem.environments.get(envId);
            if (!env) return;
            
            const content = `
                <div class="environment-edit-form">
                    <div class="form-group">
                        <label>环境名称:</label>
                        <input type="text" id="env-name" value="${env.name}" />
                    </div>
                    <div class="form-group">
                        <label>描述:</label>
                        <textarea id="env-description">${env.description}</textarea>
                    </div>
                    <div class="form-group">
                        <label>CPU核数:</label>
                        <input type="number" id="env-cpu" value="${env.config.resources.cpu}" min="1" max="32" />
                    </div>
                    <div class="form-group">
                        <label>内存:</label>
                        <select id="env-memory">
                            <option value="2GB" ${env.config.resources.memory === '2GB' ? 'selected' : ''}>2GB</option>
                            <option value="4GB" ${env.config.resources.memory === '4GB' ? 'selected' : ''}>4GB</option>
                            <option value="8GB" ${env.config.resources.memory === '8GB' ? 'selected' : ''}>8GB</option>
                            <option value="16GB" ${env.config.resources.memory === '16GB' ? 'selected' : ''}>16GB</option>
                            <option value="32GB" ${env.config.resources.memory === '32GB' ? 'selected' : ''}>32GB</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>存储:</label>
                        <select id="env-storage">
                            <option value="50GB" ${env.config.resources.storage === '50GB' ? 'selected' : ''}>50GB</option>
                            <option value="100GB" ${env.config.resources.storage === '100GB' ? 'selected' : ''}>100GB</option>
                            <option value="500GB" ${env.config.resources.storage === '500GB' ? 'selected' : ''}>500GB</option>
                            <option value="1TB" ${env.config.resources.storage === '1TB' ? 'selected' : ''}>1TB</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>安全级别:</label>
                        <select id="env-security">
                            <option value="basic" ${env.config.security === 'basic' ? 'selected' : ''}>基础</option>
                            <option value="enhanced" ${env.config.security === 'enhanced' ? 'selected' : ''}>增强</option>
                            <option value="strict" ${env.config.security === 'strict' ? 'selected' : ''}>严格</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>日志级别:</label>
                        <select id="env-logging">
                            <option value="debug" ${env.config.logging === 'debug' ? 'selected' : ''}>调试</option>
                            <option value="info" ${env.config.logging === 'info' ? 'selected' : ''}>信息</option>
                            <option value="warn" ${env.config.logging === 'warn' ? 'selected' : ''}>警告</option>
                            <option value="error" ${env.config.logging === 'error' ? 'selected' : ''}>错误</option>
                        </select>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-primary" onclick="saveEnvironment('${envId}')">保存</button>
                        <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                    </div>
                </div>
            `;
            
            showModal('编辑环境', content);
        }

        function saveEnvironment(envId) {
            const env = deploymentSystem.environments.get(envId);
            if (!env) return;
            
            env.name = document.getElementById('env-name').value;
            env.description = document.getElementById('env-description').value;
            env.config.resources.cpu = parseInt(document.getElementById('env-cpu').value);
            env.config.resources.memory = document.getElementById('env-memory').value;
            env.config.resources.storage = document.getElementById('env-storage').value;
            env.config.security = document.getElementById('env-security').value;
            env.config.logging = document.getElementById('env-logging').value;
            
            updateConsole('info', '环境配置已保存');
            closeModal();
            
            // 刷新显示
            const contentDiv = document.getElementById('deployment-content');
            if (contentDiv) {
                contentDiv.innerHTML = generateEnvironmentContent();
            }
        }

        function deleteEnvironment(envId) {
            if (envId === 'production') {
                updateConsole('error', '不能删除生产环境');
                return;
            }
            
            if (envId === deploymentSystem.currentEnvironment) {
                updateConsole('error', '不能删除当前环境');
                return;
            }
            
            if (confirm('确定要删除这个环境吗？')) {
                deploymentSystem.environments.delete(envId);
                updateConsole('info', '环境已删除');
                
                // 刷新显示
                const contentDiv = document.getElementById('deployment-content');
                if (contentDiv) {
                    contentDiv.innerHTML = generateEnvironmentContent();
                }
            }
        }

        // 调度管理函数
        function updateScheduleForm() {
            const scheduleType = document.getElementById('schedule-type').value;
            const configDiv = document.getElementById('schedule-config');
            
            let html = '';
            switch (scheduleType) {
                case 'cron':
                    html = `
                        <div class="form-group">
                            <label>Cron表达式:</label>
                            <input type="text" id="cron-expression" placeholder="0 0 * * *" />
                            <small>每天午夜执行</small>
                        </div>
                    `;
                    break;
                case 'interval':
                    html = `
                        <div class="form-group">
                            <label>间隔时间:</label>
                            <div class="interval-config">
                                <input type="number" id="interval-value" value="1" min="1" />
                                <select id="interval-unit">
                                    <option value="minutes">分钟</option>
                                    <option value="hours">小时</option>
                                    <option value="days">天</option>
                                </select>
                            </div>
                        </div>
                    `;
                    break;
                case 'manual':
                    html = '<div class="form-group"><p>手动触发模式，无需配置时间参数</p></div>';
                    break;
            }
            
            configDiv.innerHTML = html;
        }

        function saveSchedule() {
            const scheduleId = `schedule_${Date.now()}`;
            const scheduleType = document.getElementById('schedule-type').value;
            const targetEnv = document.getElementById('target-environment').value;
            const retryCount = parseInt(document.getElementById('retry-count').value);
            const notifySuccess = document.getElementById('notify-success').checked;
            const notifyFailure = document.getElementById('notify-failure').checked;
            
            let expression = '';
            switch (scheduleType) {
                case 'cron':
                    expression = document.getElementById('cron-expression').value;
                    break;
                case 'interval':
                    const value = document.getElementById('interval-value').value;
                    const unit = document.getElementById('interval-unit').value;
                    expression = `${value} ${unit}`;
                    break;
                case 'manual':
                    expression = '手动触发';
                    break;
            }
            
            const schedule = {
                id: scheduleId,
                name: `调度_${scheduleId.slice(-6)}`,
                type: scheduleType,
                expression: expression,
                targetEnvironment: targetEnv,
                retryCount: retryCount,
                notifications: {
                    success: notifySuccess,
                    failure: notifyFailure
                },
                enabled: true,
                created: new Date().toISOString()
            };
            
            deploymentSystem.schedules.set(scheduleId, schedule);
            updateConsole('info', '调度配置已保存');
            
            // 刷新调度列表
            const scheduleItems = document.getElementById('schedule-items');
            if (scheduleItems) {
                scheduleItems.innerHTML = generateScheduleList();
            }
        }

        // 导出部署包
        function generateDeploymentPackage() {
            const format = document.querySelector('input[name="export-format"]:checked').value;
            const projectName = document.getElementById('project-name').value;
            const version = document.getElementById('project-version').value;
            const environment = document.getElementById('export-environment').value;
            const includeSecrets = document.getElementById('include-secrets').checked;
            const includeMonitoring = document.getElementById('include-monitoring').checked;
            const includeLogging = document.getElementById('include-logging').checked;
            
            const deploymentConfig = {
                project: {
                    name: projectName,
                    version: version,
                    environment: environment
                },
                pipeline: {
                    nodes: Array.from(nodes.values()).map(node => ({
                        id: node.id,
                        type: node.type,
                        config: node.config || {}
                    })),
                    connections: Array.from(connections.values()).map(conn => ({
                        id: conn.id,
                        source: conn.source,
                        target: conn.target
                    }))
                },
                deployment: {
                    format: format,
                    environment: deploymentSystem.environments.get(environment),
                    schedules: Array.from(deploymentSystem.schedules.values()),
                    triggers: Array.from(deploymentSystem.triggers.values())
                },
                options: {
                    includeSecrets: includeSecrets,
                    includeMonitoring: includeMonitoring,
                    includeLogging: includeLogging
                }
            };
            
            // 生成部署文件
            const deploymentFiles = generateDeploymentFiles(deploymentConfig);
            
            // 创建ZIP文件并下载
            downloadDeploymentPackage(deploymentFiles, projectName, version);
            
            updateConsole('info', `${format}部署包生成完成`);
        }

        function generateDeploymentFiles(config) {
            const files = {};
            
            switch (config.deployment.format) {
                case 'docker':
                    files['Dockerfile'] = generateDockerfile(config);
                    files['docker-compose.yml'] = generateDockerCompose(config);
                    files['requirements.txt'] = generateRequirements(config);
                    break;
                case 'kubernetes':
                    files['deployment.yaml'] = generateK8sDeployment(config);
                    files['service.yaml'] = generateK8sService(config);
                    files['configmap.yaml'] = generateK8sConfigMap(config);
                    break;
                case 'serverless':
                    files['serverless.yml'] = generateServerlessConfig(config);
                    files['handler.py'] = generateServerlessHandler(config);
                    break;
                case 'standalone':
                    files['main.py'] = generateStandaloneApp(config);
                    files['config.json'] = JSON.stringify(config, null, 2);
                    break;
            }
            
            return files;
        }

        function downloadDeploymentPackage(files, projectName, version) {
            // 模拟下载部署包
            const blob = new Blob([JSON.stringify(files, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectName}-${version}-deployment.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 生成部署文件模板
        function generateDockerfile(config) {
            return `FROM python:3.9-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .

EXPOSE 8000

CMD ["python", "main.py"]`;
        }

        function generateDockerCompose(config) {
            return `version: '3.8'

services:
  ${config.project.name}:
    build: .
    ports:
      - "8000:8000"
    environment:
      - ENV=${config.project.environment}
    volumes:
      - ./data:/app/data
    restart: unless-stopped`;
        }

        function generateRequirements(config) {
            return `flask==2.3.0
pandas==2.0.0
numpy==1.24.0
requests==2.31.0
sqlalchemy==2.0.0`;
        }

        // 加载凭据
        function loadCredentials(nodeId) {
            const stored = localStorage.getItem(`creds_${nodeId}`);
            if (stored) {
                try {
                    const credentials = JSON.parse(atob(stored));
                    dataConnectors.credentials.set(nodeId, stored);
                    return credentials;
                } catch (error) {
                    updateConsole('error', '凭据加载失败');
                }
            }
            return null;
        }

        // 获取选择选项
        function getSelectOptions(key) {
            const options = {
                database: [
                    { value: 'mysql', label: 'MySQL' },
                    { value: 'postgresql', label: 'PostgreSQL' },
                    { value: 'sqlite', label: 'SQLite' },
                    { value: 'mongodb', label: 'MongoDB' }
                ],
                method: [
                    { value: 'GET', label: 'GET' },
                    { value: 'POST', label: 'POST' },
                    { value: 'PUT', label: 'PUT' },
                    { value: 'DELETE', label: 'DELETE' }
                ],
                fileType: [
                    { value: 'csv', label: 'CSV' },
                    { value: 'json', label: 'JSON' },
                    { value: 'xml', label: 'XML' },
                    { value: 'excel', label: 'Excel' }
                ],
                streamType: [
                    { value: 'websocket', label: 'WebSocket' },
                    { value: 'sse', label: 'Server-Sent Events' },
                    { value: 'kafka', label: 'Kafka' },
                    { value: 'rabbitmq', label: 'RabbitMQ' }
                ],
                joinType: [
                    { value: 'inner', label: 'Inner Join' },
                    { value: 'left', label: 'Left Join' },
                    { value: 'right', label: 'Right Join' },
                    { value: 'full', label: 'Full Join' }
                ],
                insertMode: [
                    { value: 'insert', label: '插入' },
                    { value: 'upsert', label: '更新插入' },
                    { value: 'replace', label: '替换' }
                ],
                chartType: [
                    { value: 'line', label: '折线图' },
                    { value: 'bar', label: '柱状图' },
                    { value: 'pie', label: '饼图' },
                    { value: 'scatter', label: '散点图' }
                ]
            };
            return options[key] || [];
        }

        // 处理端口鼠标按下
        function handlePortMouseDown(e, node, port) {
            e.stopPropagation();
            if (port.classList.contains('output')) {
                isConnecting = true;
                connectionStart = { node, port: port.dataset.port, element: port };
                updateConsole('info', '开始连接...');
            }
        }

        // 处理端口鼠标释放
        function handlePortMouseUp(e, node, port) {
            if (isConnecting && port.classList.contains('input') && connectionStart) {
                createConnection(connectionStart, { node, port: port.dataset.port, element: port });
                isConnecting = false;
                connectionStart = null;
            }
        }

        // 创建连接
        function createConnection(start, end) {
            // 检查是否已存在连接
            const existingConnection = connections.find(conn => 
                conn.start.node.id === start.node.id && 
                conn.start.port === start.port &&
                conn.end.node.id === end.node.id && 
                conn.end.port === end.port
            );

            if (existingConnection) {
                updateConsole('warning', '连接已存在');
                return;
            }

            const connection = {
                id: `conn_${Date.now()}`,
                start: start,
                end: end
            };

            connections.push(connection);
            renderConnection(connection);
            updateConsole('success', `创建连接: ${start.node.id}.${start.port} -> ${end.node.id}.${end.port}`);
        }

        // 渲染连接
        function renderConnection(connection) {
            const startElement = document.getElementById(connection.start.node.id);
            const endElement = document.getElementById(connection.end.node.id);
            
            if (!startElement || !endElement) return;

            const startPort = startElement.querySelector(`[data-port="${connection.start.port}"]`);
            const endPort = endElement.querySelector(`[data-port="${connection.end.port}"]`);
            
            if (!startPort || !endPort) return;

            const startRect = startPort.getBoundingClientRect();
            const endRect = endPort.getBoundingClientRect();
            const canvasRect = canvas.getBoundingClientRect();

            const startX = (startRect.left + startRect.width / 2 - canvasRect.left) / zoomLevel;
            const startY = (startRect.top + startRect.height / 2 - canvasRect.top) / zoomLevel;
            const endX = (endRect.left + endRect.width / 2 - canvasRect.left) / zoomLevel;
            const endY = (endRect.top + endRect.height / 2 - canvasRect.top) / zoomLevel;

            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const d = createBezierPath(startX, startY, endX, endY);
            
            path.setAttribute('d', d);
            path.setAttribute('class', 'connection-path');
            path.setAttribute('data-connection-id', connection.id);
            
            // 添加点击事件删除连接
            path.addEventListener('click', () => {
                removeConnection(connection.id);
            });

            connectionSvg.appendChild(path);
        }

        // 创建贝塞尔曲线路径
        function createBezierPath(x1, y1, x2, y2) {
            const dx = x2 - x1;
            const controlOffset = Math.abs(dx) * 0.5;
            
            const cp1x = x1 + controlOffset;
            const cp1y = y1;
            const cp2x = x2 - controlOffset;
            const cp2y = y2;
            
            return `M ${x1} ${y1} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${x2} ${y2}`;
        }

        // 删除连接
        function removeConnection(connectionId) {
            connections = connections.filter(conn => conn.id !== connectionId);
            const pathElement = connectionSvg.querySelector(`[data-connection-id="${connectionId}"]`);
            if (pathElement) {
                pathElement.remove();
            }
            updateConsole('info', `删除连接: ${connectionId}`);
        }

        // 更新所有连接
        function updateAllConnections() {
            connectionSvg.innerHTML = '';
            connections.forEach(connection => {
                renderConnection(connection);
            });
        }

        // 画布事件处理
        function handleCanvasMouseDown(e) {
            if (e.target === canvas) {
                isPanning = true;
                lastPanPoint = { x: e.clientX, y: e.clientY };
                canvas.style.cursor = 'grabbing';
                
                // 清除节点选择
                document.querySelectorAll('.pipeline-node').forEach(n => n.classList.remove('selected'));
                selectedNode = null;
                updatePropertiesPanel(null);
            }
        }

        function handleCanvasMouseMove(e) {
            if (isPanning) {
                const deltaX = e.clientX - lastPanPoint.x;
                const deltaY = e.clientY - lastPanPoint.y;
                
                panX += deltaX;
                panY += deltaY;
                
                updateCanvasTransform();
                
                lastPanPoint = { x: e.clientX, y: e.clientY };
            } else if (draggedNode) {
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left - draggedNode.offsetX - panX) / zoomLevel;
                const y = (e.clientY - rect.top - draggedNode.offsetY - panY) / zoomLevel;
                
                draggedNode.x = x;
                draggedNode.y = y;
                
                const nodeElement = document.getElementById(draggedNode.id);
                nodeElement.style.left = `${x}px`;
                nodeElement.style.top = `${y}px`;
                
                updateAllConnections();
            }
        }

        function handleCanvasMouseUp(e) {
            isPanning = false;
            draggedNode = null;
            canvas.style.cursor = 'grab';
            
            if (isConnecting) {
                isConnecting = false;
                connectionStart = null;
                updateConsole('info', '取消连接');
            }
        }

        function handleCanvasWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            zoomLevel = Math.max(0.1, Math.min(3, zoomLevel * delta));
            updateCanvasTransform();
            updateZoomDisplay();
        }

        // 更新画布变换
        function updateCanvasTransform() {
            const nodes = document.querySelectorAll('.pipeline-node');
            nodes.forEach(node => {
                node.style.transform = `scale(${zoomLevel})`;
            });
            
            canvas.style.transform = `translate(${panX}px, ${panY}px)`;
            updateAllConnections();
        }

        // 更新缩放显示
        function updateZoomDisplay() {
            document.getElementById('zoomLevel').textContent = `${Math.round(zoomLevel * 100)}%`;
        }

        // 控制台消息管理
        let consoleMessages = [];

        function updateConsole(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            consoleMessages.push({ type, message, timestamp });
            
            // 限制消息数量
            if (consoleMessages.length > 100) {
                consoleMessages = consoleMessages.slice(-100);
            }
            
            // 如果当前显示控制台，更新内容
            const activeTab = document.querySelector('.bottom-tab.active');
            if (activeTab && activeTab.textContent.includes('控制台')) {
                const console = document.getElementById('console');
                if (console) {
                    console.innerHTML = getConsoleContent();
                    console.scrollTop = console.scrollHeight;
                }
            }
        }

        function updateZoomDisplay() {
            const zoomDisplay = document.getElementById('zoomLevel');
            if (zoomDisplay) {
                zoomDisplay.textContent = Math.round(zoomLevel * 100) + '%';
            }
        }

        function updateCanvasTransform() {
            const canvasContent = canvas.querySelector('.canvas-content') || canvas;
            canvasContent.style.transform = `translate(${panX}px, ${panY}px) scale(${zoomLevel})`;
        }

        function updateAllConnections() {
            if (!connectionSvg) return;
            
            connectionSvg.innerHTML = '';
            
            connections.forEach(connection => {
                const startElement = document.getElementById(connection.start.node.id);
                const endElement = document.getElementById(connection.end.node.id);
                
                if (startElement && endElement) {
                    const startRect = startElement.getBoundingClientRect();
                    const endRect = endElement.getBoundingClientRect();
                    const canvasRect = canvas.getBoundingClientRect();
                    
                    const startX = startRect.right - canvasRect.left;
                    const startY = startRect.top + startRect.height / 2 - canvasRect.top;
                    const endX = endRect.left - canvasRect.left;
                    const endY = endRect.top + endRect.height / 2 - canvasRect.top;
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midX = (startX + endX) / 2;
                    const d = `M ${startX} ${startY} C ${midX} ${startY}, ${midX} ${endY}, ${endX} ${endY}`;
                    
                    path.setAttribute('d', d);
                    path.setAttribute('stroke', '#667eea');
                    path.setAttribute('stroke-width', '2');
                    path.setAttribute('fill', 'none');
                    path.setAttribute('marker-end', 'url(#arrowhead)');
                    
                    connectionSvg.appendChild(path);
                }
            });
        }

        // 键盘事件处理
        function handleKeyDown(e) {
            if (e.key === 'Delete' && selectedNode) {
                deleteNode(selectedNode);
            } else if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                savePipeline();
            } else if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                // TODO: 实现撤销功能
            }
        }

        // 删除节点
        function deleteNode(node) {
            // 删除相关连接
            connections = connections.filter(conn => 
                conn.start.node.id !== node.id && conn.end.node.id !== node.id
            );
            
            // 删除节点
            nodes = nodes.filter(n => n.id !== node.id);
            const nodeElement = document.getElementById(node.id);
            if (nodeElement) {
                nodeElement.remove();
            }
            
            selectedNode = null;
            updatePropertiesPanel(null);
            updateAllConnections();
            updateConsole('info', `删除节点: ${node.id}`);
        }

        // 窗口调整处理
        function handleResize() {
            updateAllConnections();
        }

        // 工具栏功能
        function newPipeline() {
            if (confirm('确定要创建新的管道吗？当前工作将丢失。')) {
                nodes = [];
                connections = [];
                selectedNode = null;
                canvas.innerHTML = '<svg id="connectionSvg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></svg>';
                connectionSvg = document.getElementById('connectionSvg');
                updatePropertiesPanel(null);
                updateConsole('success', '创建新管道');
            }
        }

        function openPipeline() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const pipelineData = JSON.parse(e.target.result);
                            loadPipelineData(pipelineData);
                            updateConsole('success', `加载管道: ${file.name}`);
                        } catch (error) {
                            updateConsole('error', `加载失败: ${error.message}`);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function savePipeline() {
            const pipelineData = {
                nodes: nodes,
                connections: connections,
                metadata: {
                    name: '数据管道',
                    version: '1.0',
                    created: new Date().toISOString(),
                    zoom: zoomLevel,
                    pan: { x: panX, y: panY }
                }
            };

            const blob = new Blob([JSON.stringify(pipelineData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pipeline_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            updateConsole('success', '管道已保存');
        }

        function exportPipeline() {
            const modal = document.getElementById('nodeConfigModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = '导出管道';
            modalBody.innerHTML = `
                <div class="form-group">
                    <label class="form-label">导出格式</label>
                    <select class="form-select" id="exportFormat">
                        <option value="json">JSON配置文件</option>
                        <option value="python">Python脚本</option>
                        <option value="javascript">JavaScript代码</option>
                        <option value="sql">SQL脚本</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">包含选项</label>
                    <div>
                        <label><input type="checkbox" checked> 包含节点配置</label><br>
                        <label><input type="checkbox" checked> 包含连接信息</label><br>
                        <label><input type="checkbox"> 包含测试数据</label><br>
                        <label><input type="checkbox"> 生成文档</label>
                    </div>
                </div>
            `;
            
            modal.classList.add('show');
        }

        function runPipeline() {
            if (nodes.length === 0) {
                updateConsole('warning', '管道为空，无法执行');
                return;
            }

            updateConsole('info', '开始执行管道...');
            
            // 模拟管道执行
            const executionSteps = [
                { step: '验证管道配置', delay: 500 },
                { step: '初始化数据源', delay: 1000 },
                { step: '执行数据转换', delay: 1500 },
                { step: '写入目标系统', delay: 800 },
                { step: '执行完成', delay: 200 }
            ];

            let currentStep = 0;
            const executeStep = () => {
                if (currentStep < executionSteps.length) {
                    const step = executionSteps[currentStep];
                    updateConsole('info', step.step);
                    
                    setTimeout(() => {
                        currentStep++;
                        executeStep();
                    }, step.delay);
                } else {
                    updateConsole('success', '管道执行完成');
                    // 更新数据预览
                    updateDataPreview();
                }
            };

            executeStep();
        }

        // 显示部署设置
        function showDeploymentSettings() {
            const content = `
                <div class="deployment-settings">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchDeploymentTab('environments')">环境管理</button>
                        <button class="tab-btn" onclick="switchDeploymentTab('schedules')">调度设置</button>
                        <button class="tab-btn" onclick="switchDeploymentTab('triggers')">触发器</button>
                        <button class="tab-btn" onclick="switchDeploymentTab('export')">导出部署</button>
                    </div>
                    
                    <div id="deployment-content">
                        ${generateEnvironmentManagement()}
                    </div>
                </div>
            `;
            
            showModal('部署设置', content);
        }

        // 切换部署设置标签页
        function switchDeploymentTab(tab) {
            // 更新标签按钮状态
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 更新内容
            const contentDiv = document.getElementById('deployment-content');
            switch(tab) {
                case 'environments':
                    contentDiv.innerHTML = generateEnvironmentManagement();
                    break;
                case 'schedules':
                    contentDiv.innerHTML = generateScheduleManagement();
                    break;
                case 'triggers':
                    contentDiv.innerHTML = generateTriggerManagement();
                    break;
                case 'export':
                    contentDiv.innerHTML = generateExportManagement();
                    break;
            }
        }

        function showSettings() {
            const modal = document.getElementById('nodeConfigModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            modalTitle.textContent = '系统设置';
            modalBody.innerHTML = `
                <div class="property-group">
                    <div class="property-group-title">界面设置</div>
                    <div class="form-group">
                        <label class="form-label">主题</label>
                        <select class="form-select">
                            <option value="light">浅色主题</option>
                            <option value="dark">深色主题</option>
                            <option value="auto">自动</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">网格大小</label>
                        <input type="range" min="10" max="50" value="20" class="form-input">
                    </div>
                </div>
                <div class="property-group">
                    <div class="property-group-title">执行设置</div>
                    <div class="form-group">
                        <label class="form-label">默认批处理大小</label>
                        <input type="number" value="1000" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">超时时间(秒)</label>
                        <input type="number" value="300" class="form-input">
                    </div>
                </div>
            `;
            
            modal.classList.add('show');
        }

        // 缩放控制
        function zoomIn() {
            zoomLevel = Math.min(3, zoomLevel * 1.2);
            updateCanvasTransform();
            updateZoomDisplay();
        }

        function zoomOut() {
            zoomLevel = Math.max(0.1, zoomLevel / 1.2);
            updateCanvasTransform();
            updateZoomDisplay();
        }

        function fitToScreen() {
            if (nodes.length === 0) return;
            
            const bounds = getNodesBounds();
            const canvasRect = canvas.getBoundingClientRect();
            
            const scaleX = canvasRect.width / (bounds.width + 100);
            const scaleY = canvasRect.height / (bounds.height + 100);
            zoomLevel = Math.min(scaleX, scaleY, 1);
            
            panX = (canvasRect.width - bounds.width * zoomLevel) / 2 - bounds.left * zoomLevel;
            panY = (canvasRect.height - bounds.height * zoomLevel) / 2 - bounds.top * zoomLevel;
            
            updateCanvasTransform();
            updateZoomDisplay();
        }

        function centerCanvas() {
            if (nodes.length === 0) return;
            
            const bounds = getNodesBounds();
            const canvasRect = canvas.getBoundingClientRect();
            
            panX = (canvasRect.width - bounds.width * zoomLevel) / 2 - bounds.left * zoomLevel;
            panY = (canvasRect.height - bounds.height * zoomLevel) / 2 - bounds.top * zoomLevel;
            
            updateCanvasTransform();
        }

        function getNodesBounds() {
            if (nodes.length === 0) return { left: 0, top: 0, width: 0, height: 0 };
            
            let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
            
            nodes.forEach(node => {
                minX = Math.min(minX, node.x);
                minY = Math.min(minY, node.y);
                maxX = Math.max(maxX, node.x + 160); // 节点宽度
                maxY = Math.max(maxY, node.y + 100); // 节点高度
            });
            
            return {
                left: minX,
                top: minY,
                width: maxX - minX,
                height: maxY - minY
            };
        }

        // 标签页切换
        function switchTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // TODO: 根据标签页显示不同内容
            if (tabName === 'templates') {
                loadTemplates();
            }
        }

        function switchBottomTab(tabName) {
            const tabs = document.querySelectorAll('.bottom-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // 找到对应的标签页并激活
            const targetTab = Array.from(tabs).find(tab => {
                const text = tab.textContent.toLowerCase();
                return (tabName === 'console' && text.includes('控制台')) ||
                       (tabName === 'logs' && text.includes('日志')) ||
                       (tabName === 'preview' && text.includes('预览')) ||
                       (tabName === 'monitor' && text.includes('监控'));
            });
            
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            const bottomContent = document.getElementById('bottomContent');
            if (!bottomContent) return;
            
            switch (tabName) {
                case 'console':
                    bottomContent.innerHTML = `
                        <div class="console" id="console">
                            ${getConsoleContent()}
                        </div>
                    `;
                    break;
                case 'logs':
                    bottomContent.innerHTML = `
                        <div style="padding: 16px;">
                            <h4>执行日志</h4>
                            <div class="data-table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>时间</th>
                                            <th>节点</th>
                                            <th>状态</th>
                                            <th>消息</th>
                                            <th>耗时</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>10:30:15</td>
                                            <td>database-source</td>
                                            <td><span class="status-indicator status-success"></span>成功</td>
                                            <td>数据提取完成</td>
                                            <td>1.2s</td>
                                        </tr>
                                        <tr>
                                            <td>10:30:16</td>
                                            <td>transform</td>
                                            <td><span class="status-indicator status-running"></span>运行中</td>
                                            <td>正在转换数据</td>
                                            <td>-</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    break;
                case 'preview':
                    bottomContent.innerHTML = `
                        <div class="data-preview">
                            <div style="padding: 16px; border-bottom: 1px solid #e1e8ed; display: flex; justify-content: space-between; align-items: center;">
                                <h4>数据预览</h4>
                                <div>
                                    <button class="btn btn-primary" onclick="refreshPreview()">刷新</button>
                                    <button class="btn btn-primary" onclick="exportPreview()">导出</button>
                                </div>
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>姓名</th>
                                        <th>年龄</th>
                                        <th>城市</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td>1</td><td>张三</td><td>25</td><td>北京</td><td>活跃</td></tr>
                                    <tr><td>2</td><td>李四</td><td>30</td><td>上海</td><td>活跃</td></tr>
                                    <tr><td>3</td><td>王五</td><td>28</td><td>广州</td><td>非活跃</td></tr>
                                </tbody>
                            </table>
                        </div>
                    `;
                    break;
                case 'monitor':
                    bottomContent.innerHTML = `
                        <div style="padding: 16px;">
                            <h4>性能监控</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                                    <h5>CPU使用率</h5>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 45%"></div>
                                    </div>
                                    <span>45%</span>
                                </div>
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                                    <h5>内存使用</h5>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%"></div>
                                    </div>
                                    <span>60%</span>
                                </div>
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                                    <h5>处理速度</h5>
                                    <div style="font-size: 24px; font-weight: bold; color: #667eea;">1,250</div>
                                    <span>记录/秒</span>
                                </div>
                                <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                                    <h5>错误率</h5>
                                    <div style="font-size: 24px; font-weight: bold; color: #e74c3c;">0.02%</div>
                                    <span>错误/总数</span>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }
        }

        // 辅助函数
        function getConsoleContent() {
            return consoleMessages.map(msg => 
                `<div class="console-message console-${msg.type}">
                    <span class="console-timestamp">${msg.timestamp}</span>
                    <span class="console-text">${msg.message}</span>
                </div>`
            ).join('');
        }

        function updateDataPreview() {
            // 模拟数据预览更新
            const previewData = [
                { id: 1, name: '张三', age: 25, city: '北京', status: '活跃' },
                { id: 2, name: '李四', age: 30, city: '上海', status: '活跃' },
                { id: 3, name: '王五', age: 28, city: '广州', status: '非活跃' }
            ];
            
            // 如果当前显示的是数据预览标签页，更新内容
            const activeTab = document.querySelector('.bottom-tab.active');
            if (activeTab && activeTab.textContent.includes('数据预览')) {
                switchBottomTab('preview');
            }
        }

        function refreshPreview() {
            updateConsole('info', '刷新数据预览');
            updateDataPreview();
        }

        function exportPreview() {
            updateConsole('info', '导出预览数据');
            // TODO: 实现数据导出功能
        }

        function loadTemplates() {
            const componentList = document.getElementById('componentList');
            componentList.innerHTML = `
                <div class="template-category">
                    <h4>数据集成模板</h4>
                    <div class="template-item" draggable="true" data-template="database-to-api">
                        <div class="template-icon">🔄</div>
                        <div class="template-info">
                            <div class="template-name">数据库到API</div>
                            <div class="template-desc">从数据库提取数据并推送到API</div>
                        </div>
                    </div>
                    <div class="template-item" draggable="true" data-template="file-to-database">
                        <div class="template-icon">📁</div>
                        <div class="template-info">
                            <div class="template-name">文件到数据库</div>
                            <div class="template-desc">读取文件数据并写入数据库</div>
                        </div>
                    </div>
                </div>
                <div class="template-category">
                    <h4>数据清洗模板</h4>
                    <div class="template-item" draggable="true" data-template="data-cleaning">
                        <div class="template-icon">🧹</div>
                        <div class="template-info">
                            <div class="template-name">数据清洗流程</div>
                            <div class="template-desc">去重、填充、格式化数据</div>
                        </div>
                    </div>
                </div>
                <div class="template-category">
                    <h4>实时处理模板</h4>
                    <div class="template-item" draggable="true" data-template="stream-processing">
                        <div class="template-icon">⚡</div>
                        <div class="template-info">
                            <div class="template-name">流式数据处理</div>
                            <div class="template-desc">实时数据流处理和分析</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadPipelineData(data) {
            // 清空当前管道
            nodes = [];
            connections = [];
            canvas.innerHTML = '<svg id="connectionSvg" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;"></svg>';
            connectionSvg = document.getElementById('connectionSvg');
            
            // 加载节点
            if (data.nodes) {
                data.nodes.forEach(nodeData => {
                    const node = createNode(nodeData.type, nodeData.x, nodeData.y);
                    node.config = { ...node.config, ...nodeData.config };
                    nodes.push(node);
                });
            }
            
            // 加载连接
            if (data.connections) {
                data.connections.forEach(connData => {
                    const startNode = nodes.find(n => n.id === connData.start.node.id);
                    const endNode = nodes.find(n => n.id === connData.end.node.id);
                    
                    if (startNode && endNode) {
                        connections.push({
                            start: { node: startNode, port: connData.start.port },
                            end: { node: endNode, port: connData.end.port }
                        });
                    }
                });
            }
            
            // 恢复视图状态
            if (data.metadata) {
                zoomLevel = data.metadata.zoom || 1;
                panX = data.metadata.pan?.x || 0;
                panY = data.metadata.pan?.y || 0;
                updateCanvasTransform();
                updateZoomDisplay();
            }
            
            updateAllConnections();
        }

        // 模态框控制
        function closeModal() {
            const modal = document.getElementById('nodeConfigModal');
            modal.classList.remove('show');
        }

        function saveNodeConfig() {
            if (!selectedNode) return;
            
            const form = document.getElementById('nodeConfigForm');
            const formData = new FormData(form);
            
            // 更新节点配置
            for (let [key, value] of formData.entries()) {
                selectedNode.config[key] = value;
            }
            
            // 更新节点显示
            const nodeElement = document.getElementById(selectedNode.id);
            if (nodeElement) {
                const titleElement = nodeElement.querySelector('.node-title');
                if (titleElement && selectedNode.config.name) {
                    titleElement.textContent = selectedNode.config.name;
                }
            }
            
            updateConsole('success', `更新节点配置: ${selectedNode.id}`);
            closeModal();
        }

        // 初始化应用
        function initApp() {
            // 设置事件监听器
            document.addEventListener('keydown', handleKeyDown);
            window.addEventListener('resize', handleResize);
            
            // 初始化SVG标记
            initSvgMarkers();
            
            // 初始化画布
            updateCanvasTransform();
            updateZoomDisplay();
            
            // 初始化控制台
            updateConsole('success', '智能数据管道设计器已启动');
            
            // 设置默认标签页
            switchBottomTab('console');
            
            // 模态框点击外部关闭
            const modal = document.getElementById('nodeConfigModal');
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
        }

        // 监控分析系统
        const monitoringSystem = {
            isMonitoring: false,
            metrics: {
                executionTime: [],
                throughput: [],
                errorRate: [],
                memoryUsage: [],
                cpuUsage: []
            },
            history: [],
            alerts: [],
            
            // 开始监控
            startMonitoring() {
                this.isMonitoring = true;
                this.startMetricsCollection();
                updateConsole('success', '实时监控已启动');
            },
            
            // 停止监控
            stopMonitoring() {
                this.isMonitoring = false;
                updateConsole('info', '实时监控已停止');
            },
            
            // 收集指标
            startMetricsCollection() {
                if (!this.isMonitoring) return;
                
                // 模拟收集指标数据
                const timestamp = Date.now();
                this.metrics.executionTime.push({
                    timestamp,
                    value: Math.random() * 1000 + 100
                });
                this.metrics.throughput.push({
                    timestamp,
                    value: Math.random() * 1000 + 500
                });
                this.metrics.errorRate.push({
                    timestamp,
                    value: Math.random() * 5
                });
                this.metrics.memoryUsage.push({
                    timestamp,
                    value: Math.random() * 80 + 20
                });
                this.metrics.cpuUsage.push({
                    timestamp,
                    value: Math.random() * 70 + 10
                });
                
                // 保持最近100个数据点
                Object.keys(this.metrics).forEach(key => {
                    if (this.metrics[key].length > 100) {
                        this.metrics[key] = this.metrics[key].slice(-100);
                    }
                });
                
                // 检查告警
                this.checkAlerts();
                
                // 继续收集
                setTimeout(() => this.startMetricsCollection(), 1000);
            },
            
            // 检查告警
            checkAlerts() {
                const latest = {
                    errorRate: this.metrics.errorRate[this.metrics.errorRate.length - 1]?.value || 0,
                    memoryUsage: this.metrics.memoryUsage[this.metrics.memoryUsage.length - 1]?.value || 0,
                    cpuUsage: this.metrics.cpuUsage[this.metrics.cpuUsage.length - 1]?.value || 0
                };
                
                if (latest.errorRate > 3) {
                    this.addAlert('error', '错误率过高', `当前错误率: ${latest.errorRate.toFixed(2)}%`);
                }
                if (latest.memoryUsage > 90) {
                    this.addAlert('warning', '内存使用率过高', `当前内存使用率: ${latest.memoryUsage.toFixed(2)}%`);
                }
                if (latest.cpuUsage > 80) {
                    this.addAlert('warning', 'CPU使用率过高', `当前CPU使用率: ${latest.cpuUsage.toFixed(2)}%`);
                }
            },
            
            // 添加告警
            addAlert(level, title, message) {
                const alert = {
                    id: Date.now(),
                    level,
                    title,
                    message,
                    timestamp: new Date().toLocaleString(),
                    acknowledged: false
                };
                
                this.alerts.unshift(alert);
                if (this.alerts.length > 50) {
                    this.alerts = this.alerts.slice(0, 50);
                }
                
                updateConsole(level, `${title}: ${message}`);
            },
            
            // 记录执行历史
            recordExecution(nodeId, status, duration, data) {
                const record = {
                    id: Date.now(),
                    nodeId,
                    status,
                    duration,
                    data,
                    timestamp: new Date().toLocaleString()
                };
                
                this.history.unshift(record);
                if (this.history.length > 1000) {
                    this.history = this.history.slice(0, 1000);
                }
            }
        };

        // 显示监控面板
        function showMonitoringPanel() {
            const content = `
                <div class="monitoring-panel">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchMonitoringTab('realtime')">实时监控</button>
                        <button class="tab-btn" onclick="switchMonitoringTab('history')">执行历史</button>
                        <button class="tab-btn" onclick="switchMonitoringTab('lineage')">数据血缘</button>
                        <button class="tab-btn" onclick="switchMonitoringTab('alerts')">告警管理</button>
                    </div>
                    
                    <div id="monitoring-content">
                        ${generateRealtimeMonitoring()}
                    </div>
                </div>
            `;
            
            showModal('监控分析', content);
        }

        // 切换监控标签页
        function switchMonitoringTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const contentDiv = document.getElementById('monitoring-content');
            switch(tab) {
                case 'realtime':
                    contentDiv.innerHTML = generateRealtimeMonitoring();
                    break;
                case 'history':
                    contentDiv.innerHTML = generateExecutionHistory();
                    break;
                case 'lineage':
                    contentDiv.innerHTML = generateDataLineage();
                    break;
                case 'alerts':
                    contentDiv.innerHTML = generateAlertsManagement();
                    break;
            }
        }

        // 生成实时监控内容
        function generateRealtimeMonitoring() {
            const isMonitoring = monitoringSystem.isMonitoring;
            const latest = {
                executionTime: monitoringSystem.metrics.executionTime[monitoringSystem.metrics.executionTime.length - 1]?.value || 0,
                throughput: monitoringSystem.metrics.throughput[monitoringSystem.metrics.throughput.length - 1]?.value || 0,
                errorRate: monitoringSystem.metrics.errorRate[monitoringSystem.metrics.errorRate.length - 1]?.value || 0,
                memoryUsage: monitoringSystem.metrics.memoryUsage[monitoringSystem.metrics.memoryUsage.length - 1]?.value || 0,
                cpuUsage: monitoringSystem.metrics.cpuUsage[monitoringSystem.metrics.cpuUsage.length - 1]?.value || 0
            };
            
            return `
                <div class="realtime-monitoring">
                    <div class="monitoring-controls">
                        <button class="btn ${isMonitoring ? 'btn-danger' : 'btn-success'}" 
                                onclick="${isMonitoring ? 'monitoringSystem.stopMonitoring()' : 'monitoringSystem.startMonitoring()'}">
                            ${isMonitoring ? '停止监控' : '开始监控'}
                        </button>
                        <button class="btn btn-secondary" onclick="refreshMonitoringData()">刷新数据</button>
                    </div>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>执行时间</h4>
                                <span class="metric-value">${latest.executionTime.toFixed(0)}ms</span>
                            </div>
                            <div class="metric-chart" id="execution-time-chart"></div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>吞吐量</h4>
                                <span class="metric-value">${latest.throughput.toFixed(0)}/s</span>
                            </div>
                            <div class="metric-chart" id="throughput-chart"></div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>错误率</h4>
                                <span class="metric-value ${latest.errorRate > 3 ? 'error' : ''}">${latest.errorRate.toFixed(2)}%</span>
                            </div>
                            <div class="metric-chart" id="error-rate-chart"></div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>内存使用</h4>
                                <span class="metric-value ${latest.memoryUsage > 90 ? 'warning' : ''}">${latest.memoryUsage.toFixed(1)}%</span>
                            </div>
                            <div class="metric-chart" id="memory-usage-chart"></div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-header">
                                <h4>CPU使用</h4>
                                <span class="metric-value ${latest.cpuUsage > 80 ? 'warning' : ''}">${latest.cpuUsage.toFixed(1)}%</span>
                            </div>
                            <div class="metric-chart" id="cpu-usage-chart"></div>
                        </div>
                    </div>
                    
                    <div class="monitoring-status">
                        <h4>系统状态</h4>
                        <div class="status-indicators">
                            <div class="status-item ${isMonitoring ? 'active' : 'inactive'}">
                                <span class="status-dot"></span>
                                监控服务: ${isMonitoring ? '运行中' : '已停止'}
                            </div>
                            <div class="status-item active">
                                <span class="status-dot"></span>
                                数据管道: 正常
                            </div>
                            <div class="status-item ${latest.errorRate > 3 ? 'error' : 'active'}">
                                <span class="status-dot"></span>
                                错误状态: ${latest.errorRate > 3 ? '异常' : '正常'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // 生成执行历史内容
        function generateExecutionHistory() {
            const history = monitoringSystem.history.slice(0, 20);
            
            return `
                <div class="execution-history">
                    <div class="history-controls">
                        <input type="date" class="form-input" placeholder="开始日期">
                        <input type="date" class="form-input" placeholder="结束日期">
                        <select class="form-select">
                            <option value="">所有状态</option>
                            <option value="success">成功</option>
                            <option value="error">失败</option>
                            <option value="warning">警告</option>
                        </select>
                        <button class="btn btn-primary">筛选</button>
                        <button class="btn btn-secondary" onclick="exportExecutionHistory()">导出</button>
                    </div>
                    
                    <div class="history-list">
                        ${history.length > 0 ? history.map(record => `
                            <div class="history-item">
                                <div class="history-header">
                                    <span class="node-id">节点: ${record.nodeId}</span>
                                    <span class="status ${record.status}">${record.status}</span>
                                    <span class="timestamp">${record.timestamp}</span>
                                </div>
                                <div class="history-details">
                                    <span class="duration">执行时间: ${record.duration}ms</span>
                                    <span class="data-count">处理数据: ${record.data?.length || 0} 条</span>
                                </div>
                            </div>
                        `).join('') : '<div class="empty-state">暂无执行历史记录</div>'}
                    </div>
                </div>
            `;
        }

        // 生成数据血缘内容
        function generateDataLineage() {
            return `
                <div class="data-lineage">
                    <div class="lineage-controls">
                        <select class="form-select">
                            <option value="">选择数据表</option>
                            <option value="users">users</option>
                            <option value="orders">orders</option>
                            <option value="products">products</option>
                        </select>
                        <button class="btn btn-primary">生成血缘图</button>
                        <button class="btn btn-secondary">导出血缘</button>
                    </div>
                    
                    <div class="lineage-visualization">
                        <div class="lineage-graph" id="lineage-graph">
                            <div class="lineage-node source">
                                <h5>数据源</h5>
                                <div class="node-info">
                                    <p>MySQL Database</p>
                                    <p>表: users, orders</p>
                                </div>
                            </div>
                            
                            <div class="lineage-arrow">→</div>
                            
                            <div class="lineage-node transform">
                                <h5>数据转换</h5>
                                <div class="node-info">
                                    <p>JOIN操作</p>
                                    <p>字段映射</p>
                                </div>
                            </div>
                            
                            <div class="lineage-arrow">→</div>
                            
                            <div class="lineage-node target">
                                <h5>目标</h5>
                                <div class="node-info">
                                    <p>Data Warehouse</p>
                                    <p>表: user_orders</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="lineage-details">
                        <h4>血缘详情</h4>
                        <div class="lineage-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>源字段</th>
                                        <th>转换规则</th>
                                        <th>目标字段</th>
                                        <th>数据类型</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>users.id</td>
                                        <td>直接映射</td>
                                        <td>user_orders.user_id</td>
                                        <td>INT</td>
                                    </tr>
                                    <tr>
                                        <td>users.name</td>
                                        <td>直接映射</td>
                                        <td>user_orders.user_name</td>
                                        <td>VARCHAR</td>
                                    </tr>
                                    <tr>
                                        <td>orders.total</td>
                                        <td>SUM聚合</td>
                                        <td>user_orders.total_amount</td>
                                        <td>DECIMAL</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // 生成告警管理内容
        function generateAlertsManagement() {
            const alerts = monitoringSystem.alerts.slice(0, 20);
            
            return `
                <div class="alerts-management">
                    <div class="alerts-controls">
                        <button class="btn btn-primary" onclick="acknowledgeAllAlerts()">确认所有告警</button>
                        <button class="btn btn-secondary" onclick="clearAcknowledgedAlerts()">清除已确认</button>
                        <button class="btn btn-warning" onclick="configureAlertRules()">告警规则</button>
                    </div>
                    
                    <div class="alerts-list">
                        ${alerts.length > 0 ? alerts.map(alert => `
                            <div class="alert-item ${alert.level} ${alert.acknowledged ? 'acknowledged' : ''}">
                                <div class="alert-header">
                                    <span class="alert-level">${alert.level.toUpperCase()}</span>
                                    <span class="alert-title">${alert.title}</span>
                                    <span class="alert-time">${alert.timestamp}</span>
                                </div>
                                <div class="alert-message">${alert.message}</div>
                                <div class="alert-actions">
                                    ${!alert.acknowledged ? `
                                        <button class="btn btn-sm btn-primary" onclick="acknowledgeAlert('${alert.id}')">确认</button>
                                    ` : '<span class="acknowledged-label">已确认</span>'}
                                </div>
                            </div>
                        `).join('') : '<div class="empty-state">暂无告警信息</div>'}
                    </div>
                </div>
            `;
        }

        // 刷新监控数据
        function refreshMonitoringData() {
            if (document.getElementById('monitoring-content')) {
                const activeTab = document.querySelector('.tab-btn.active').textContent;
                if (activeTab === '实时监控') {
                    document.getElementById('monitoring-content').innerHTML = generateRealtimeMonitoring();
                }
            }
        }

        // 确认告警
        function acknowledgeAlert(alertId) {
            const alert = monitoringSystem.alerts.find(a => a.id == alertId);
            if (alert) {
                alert.acknowledged = true;
                refreshMonitoringData();
            }
        }

        // 确认所有告警
        function acknowledgeAllAlerts() {
            monitoringSystem.alerts.forEach(alert => alert.acknowledged = true);
            refreshMonitoringData();
        }

        // 清除已确认告警
        function clearAcknowledgedAlerts() {
            monitoringSystem.alerts = monitoringSystem.alerts.filter(alert => !alert.acknowledged);
            refreshMonitoringData();
        }

        // 导出执行历史
        function exportExecutionHistory() {
            const data = monitoringSystem.history.map(record => ({
                节点ID: record.nodeId,
                状态: record.status,
                执行时间: record.duration + 'ms',
                数据量: record.data?.length || 0,
                时间戳: record.timestamp
            }));
            
            const csv = [
                Object.keys(data[0]).join(','),
                ...data.map(row => Object.values(row).join(','))
            ].join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `execution_history_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // 智能推荐系统
        const recommendationSystem = {
            // 节点推荐规则
            nodeRecommendations: {
                'database': ['transform', 'filter', 'join'],
                'api': ['transform', 'filter', 'cache'],
                'file': ['transform', 'filter', 'validate'],
                'stream': ['transform', 'filter', 'aggregate'],
                'transform': ['filter', 'join', 'aggregate', 'target'],
                'filter': ['transform', 'join', 'target'],
                'join': ['transform', 'aggregate', 'target'],
                'aggregate': ['transform', 'target'],
                'target': []
            },

            // 配置优化建议
            configOptimizations: {
                'database': [
                    { type: 'performance', message: '建议使用连接池以提高数据库连接性能' },
                    { type: 'security', message: '建议使用环境变量存储数据库密码' },
                    { type: 'reliability', message: '建议配置连接超时和重试机制' }
                ],
                'api': [
                    { type: 'performance', message: '建议启用缓存以减少API调用次数' },
                    { type: 'security', message: '建议使用HTTPS协议进行API调用' },
                    { type: 'reliability', message: '建议配置请求超时和错误重试' }
                ],
                'transform': [
                    { type: 'performance', message: '建议对大数据集使用流式处理' },
                    { type: 'quality', message: '建议添加数据验证规则' }
                ]
            },

            // 性能优化建议
            performanceOptimizations: [
                { condition: 'highMemoryUsage', message: '内存使用率过高，建议优化数据处理逻辑或增加内存' },
                { condition: 'slowExecution', message: '执行速度较慢，建议检查数据库查询或API响应时间' },
                { condition: 'highErrorRate', message: '错误率较高，建议检查数据质量和处理逻辑' },
                { condition: 'lowThroughput', message: '吞吐量较低，建议启用并行处理或优化算法' }
            ],

            // 获取节点推荐
            getNodeRecommendations(currentNodeType, existingNodes) {
                const recommendations = this.nodeRecommendations[currentNodeType] || [];
                const existingTypes = existingNodes.map(node => node.type);
                
                return recommendations.map(type => ({
                    type,
                    name: this.getNodeTypeName(type),
                    reason: this.getRecommendationReason(currentNodeType, type),
                    priority: existingTypes.includes(type) ? 'low' : 'high'
                }));
            },

            // 获取配置优化建议
            getConfigOptimizations(nodeType, config) {
                const baseOptimizations = this.configOptimizations[nodeType] || [];
                const contextOptimizations = [];

                // 基于配置内容的动态建议
                if (nodeType === 'database' && !config.connectionPool) {
                    contextOptimizations.push({
                        type: 'performance',
                        message: '当前未启用连接池，建议启用以提高性能'
                    });
                }

                if (nodeType === 'api' && config.url && !config.url.startsWith('https://')) {
                    contextOptimizations.push({
                        type: 'security',
                        message: '建议使用HTTPS协议以确保数据传输安全'
                    });
                }

                return [...baseOptimizations, ...contextOptimizations];
            },

            // 获取性能优化建议
            getPerformanceOptimizations(metrics) {
                const suggestions = [];

                if (metrics.memoryUsage > 80) {
                    suggestions.push(this.performanceOptimizations.find(opt => opt.condition === 'highMemoryUsage'));
                }

                if (metrics.executionTime > 30000) {
                    suggestions.push(this.performanceOptimizations.find(opt => opt.condition === 'slowExecution'));
                }

                if (metrics.errorRate > 5) {
                    suggestions.push(this.performanceOptimizations.find(opt => opt.condition === 'highErrorRate'));
                }

                if (metrics.throughput < 100) {
                    suggestions.push(this.performanceOptimizations.find(opt => opt.condition === 'lowThroughput'));
                }

                return suggestions.filter(Boolean);
            },

            // 获取节点类型名称
            getNodeTypeName(type) {
                const names = {
                    'database': '数据库',
                    'api': 'API接口',
                    'file': '文件',
                    'stream': '数据流',
                    'transform': '数据转换',
                    'filter': '数据过滤',
                    'join': '数据连接',
                    'aggregate': '数据聚合',
                    'target': '目标输出'
                };
                return names[type] || type;
            },

            // 获取推荐原因
            getRecommendationReason(fromType, toType) {
                const reasons = {
                    'database-transform': '数据库数据通常需要转换格式',
                    'database-filter': '建议过滤不需要的数据以提高性能',
                    'api-transform': 'API响应数据通常需要格式转换',
                    'api-cache': '缓存API响应可以提高性能',
                    'transform-target': '转换后的数据可以输出到目标系统',
                    'filter-join': '过滤后的数据适合进行连接操作'
                };
                return reasons[`${fromType}-${toType}`] || `${this.getNodeTypeName(toType)}是常见的下游处理步骤`;
            }
        };

        // 显示智能推荐面板
        function showRecommendationPanel() {
            const selectedNode = nodes.find(node => node.selected);
            if (!selectedNode) {
                alert('请先选择一个节点');
                return;
            }

            const nodeRecommendations = recommendationSystem.getNodeRecommendations(selectedNode.type, nodes);
            const configOptimizations = recommendationSystem.getConfigOptimizations(selectedNode.type, selectedNode.config || {});
            
            // 模拟性能指标
            const mockMetrics = {
                memoryUsage: Math.random() * 100,
                executionTime: Math.random() * 60000,
                errorRate: Math.random() * 10,
                throughput: Math.random() * 1000
            };
            const performanceOptimizations = recommendationSystem.getPerformanceOptimizations(mockMetrics);

            const content = `
                <div class="recommendation-panel">
                    <div class="recommendation-tabs">
                        <button class="tab-button active" onclick="switchRecommendationTab('nodes')">节点推荐</button>
                        <button class="tab-button" onclick="switchRecommendationTab('config')">配置优化</button>
                        <button class="tab-button" onclick="switchRecommendationTab('performance')">性能建议</button>
                    </div>
                    
                    <div id="nodes-recommendations" class="tab-content active">
                        <h4>推荐的下游节点</h4>
                        <div class="recommendations-list">
                            ${nodeRecommendations.map(rec => `
                                <div class="recommendation-item ${rec.priority}">
                                    <div class="rec-header">
                                        <h5>${rec.name}</h5>
                                        <span class="priority-badge ${rec.priority}">${rec.priority === 'high' ? '推荐' : '可选'}</span>
                                    </div>
                                    <p class="rec-reason">${rec.reason}</p>
                                    <button class="btn btn-sm btn-primary" onclick="addRecommendedNode('${rec.type}')">添加节点</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div id="config-recommendations" class="tab-content">
                        <h4>配置优化建议</h4>
                        <div class="recommendations-list">
                            ${configOptimizations.map(opt => `
                                <div class="recommendation-item ${opt.type}">
                                    <div class="rec-header">
                                        <span class="type-badge ${opt.type}">${opt.type}</span>
                                    </div>
                                    <p class="rec-message">${opt.message}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div id="performance-recommendations" class="tab-content">
                        <h4>性能优化建议</h4>
                        <div class="current-metrics">
                            <h5>当前性能指标</h5>
                            <div class="metrics-summary">
                                <div class="metric-item">
                                    <span>内存使用率:</span>
                                    <span class="${mockMetrics.memoryUsage > 80 ? 'warning' : 'normal'}">${mockMetrics.memoryUsage.toFixed(1)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span>执行时间:</span>
                                    <span class="${mockMetrics.executionTime > 30000 ? 'warning' : 'normal'}">${(mockMetrics.executionTime/1000).toFixed(1)}s</span>
                                </div>
                                <div class="metric-item">
                                    <span>错误率:</span>
                                    <span class="${mockMetrics.errorRate > 5 ? 'warning' : 'normal'}">${mockMetrics.errorRate.toFixed(1)}%</span>
                                </div>
                                <div class="metric-item">
                                    <span>吞吐量:</span>
                                    <span class="${mockMetrics.throughput < 100 ? 'warning' : 'normal'}">${mockMetrics.throughput.toFixed(0)} 条/秒</span>
                                </div>
                            </div>
                        </div>
                        <div class="recommendations-list">
                            ${performanceOptimizations.map(opt => `
                                <div class="recommendation-item performance">
                                    <p class="rec-message">${opt.message}</p>
                                </div>
                            `).join('')}
                            ${performanceOptimizations.length === 0 ? '<p class="no-recommendations">当前性能表现良好，暂无优化建议</p>' : ''}
                        </div>
                    </div>
                </div>
            `;

            showModal('智能推荐', content);
        }

        // 切换推荐标签页
        function switchRecommendationTab(tabName) {
            // 移除所有活动状态
            document.querySelectorAll('.recommendation-tabs .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 激活选中的标签页
            event.target.classList.add('active');
            document.getElementById(`${tabName}-recommendations`).classList.add('active');
        }

        // 添加推荐的节点
        function addRecommendedNode(nodeType) {
            const selectedNode = nodes.find(node => node.selected);
            if (!selectedNode) return;

            // 在选中节点右侧添加新节点
            const newNode = {
                id: 'node_' + Date.now(),
                type: nodeType,
                x: selectedNode.x + 200,
                y: selectedNode.y,
                config: {},
                selected: false
            };

            nodes.push(newNode);

            // 自动连接节点
            connections.push({
                from: selectedNode.id,
                to: newNode.id
            });

            drawCanvas();
            closeModal();
            updateConsole('info', `已添加${recommendationSystem.getNodeTypeName(nodeType)}节点并自动连接`);
        }

        // 协作功能系统
        const collaborationSystem = {
            // 版本控制
            versions: [],
            currentVersion: null,
            
            // 团队成员
            teamMembers: [
                { id: 'user1', name: '张三', role: 'admin', avatar: '👨‍💼', online: true },
                { id: 'user2', name: '李四', role: 'editor', avatar: '👩‍💻', online: false },
                { id: 'user3', name: '王五', role: 'viewer', avatar: '👨‍🔬', online: true }
            ],
            
            // 评论系统
            comments: [],
            
            // 保存版本
            saveVersion(description) {
                const version = {
                    id: 'v' + Date.now(),
                    timestamp: new Date(),
                    description: description || '自动保存',
                    author: 'current_user',
                    nodes: JSON.parse(JSON.stringify(nodes)),
                    connections: JSON.parse(JSON.stringify(connections))
                };
                
                this.versions.unshift(version);
                this.currentVersion = version.id;
                
                // 保持最近20个版本
                if (this.versions.length > 20) {
                    this.versions = this.versions.slice(0, 20);
                }
                
                return version;
            },
            
            // 恢复版本
            restoreVersion(versionId) {
                const version = this.versions.find(v => v.id === versionId);
                if (!version) return false;
                
                nodes.length = 0;
                connections.length = 0;
                nodes.push(...JSON.parse(JSON.stringify(version.nodes)));
                connections.push(...JSON.parse(JSON.stringify(version.connections)));
                
                this.currentVersion = versionId;
                drawCanvas();
                updateConsole('info', `已恢复到版本: ${version.description}`);
                return true;
            },
            
            // 添加评论
            addComment(nodeId, content, x, y) {
                const comment = {
                    id: 'comment_' + Date.now(),
                    nodeId: nodeId,
                    content: content,
                    author: 'current_user',
                    timestamp: new Date(),
                    x: x || 0,
                    y: y || 0,
                    resolved: false
                };
                
                this.comments.push(comment);
                return comment;
            },
            
            // 解决评论
            resolveComment(commentId) {
                const comment = this.comments.find(c => c.id === commentId);
                if (comment) {
                    comment.resolved = true;
                    comment.resolvedAt = new Date();
                    comment.resolvedBy = 'current_user';
                }
            },
            
            // 获取节点评论
            getNodeComments(nodeId) {
                return this.comments.filter(c => c.nodeId === nodeId && !c.resolved);
            }
        };

        // 显示协作面板
        function showCollaborationPanel() {
            const content = `
                <div class="collaboration-panel">
                    <div class="collaboration-tabs">
                        <button class="tab-button active" onclick="switchCollaborationTab('versions')">版本控制</button>
                        <button class="tab-button" onclick="switchCollaborationTab('team')">团队协作</button>
                        <button class="tab-button" onclick="switchCollaborationTab('comments')">评论系统</button>
                    </div>
                    
                    <div id="versions-collaboration" class="tab-content active">
                        <div class="version-controls">
                            <button class="btn btn-primary" onclick="saveCurrentVersion()">保存当前版本</button>
                            <button class="btn btn-secondary" onclick="showVersionComparison()">版本对比</button>
                        </div>
                        
                        <div class="versions-list">
                            <h4>版本历史</h4>
                            ${collaborationSystem.versions.map(version => `
                                <div class="version-item ${version.id === collaborationSystem.currentVersion ? 'current' : ''}">
                                    <div class="version-header">
                                        <h5>${version.description}</h5>
                                        <span class="version-id">${version.id}</span>
                                    </div>
                                    <div class="version-meta">
                                        <span class="author">作者: ${version.author}</span>
                                        <span class="timestamp">${version.timestamp.toLocaleString()}</span>
                                    </div>
                                    <div class="version-actions">
                                        <button class="btn btn-sm btn-outline-primary" onclick="restoreVersion('${version.id}')">恢复</button>
                                        <button class="btn btn-sm btn-outline-secondary" onclick="previewVersion('${version.id}')">预览</button>
                                    </div>
                                </div>
                            `).join('')}
                            ${collaborationSystem.versions.length === 0 ? '<p class="no-versions">暂无版本历史</p>' : ''}
                        </div>
                    </div>
                    
                    <div id="team-collaboration" class="tab-content">
                        <div class="team-controls">
                            <button class="btn btn-primary" onclick="inviteTeamMember()">邀请成员</button>
                            <button class="btn btn-secondary" onclick="shareProject()">分享项目</button>
                        </div>
                        
                        <div class="team-members">
                            <h4>团队成员</h4>
                            ${collaborationSystem.teamMembers.map(member => `
                                <div class="member-item">
                                    <div class="member-info">
                                        <span class="member-avatar">${member.avatar}</span>
                                        <div class="member-details">
                                            <h5>${member.name}</h5>
                                            <span class="member-role">${member.role}</span>
                                        </div>
                                    </div>
                                    <div class="member-status">
                                        <span class="status-dot ${member.online ? 'online' : 'offline'}"></span>
                                        <span class="status-text">${member.online ? '在线' : '离线'}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="sharing-settings">
                            <h4>分享设置</h4>
                            <div class="sharing-options">
                                <label>
                                    <input type="radio" name="sharing" value="private" checked>
                                    私有 - 仅团队成员可访问
                                </label>
                                <label>
                                    <input type="radio" name="sharing" value="link">
                                    链接分享 - 拥有链接的人可查看
                                </label>
                                <label>
                                    <input type="radio" name="sharing" value="public">
                                    公开 - 任何人都可以查看
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="comments-collaboration" class="tab-content">
                        <div class="comments-controls">
                            <button class="btn btn-primary" onclick="toggleCommentMode()">添加评论</button>
                            <button class="btn btn-secondary" onclick="showAllComments()">显示所有评论</button>
                        </div>
                        
                        <div class="comments-list">
                            <h4>评论列表</h4>
                            ${collaborationSystem.comments.map(comment => `
                                <div class="comment-item ${comment.resolved ? 'resolved' : ''}">
                                    <div class="comment-header">
                                        <span class="comment-author">${comment.author}</span>
                                        <span class="comment-time">${comment.timestamp.toLocaleString()}</span>
                                    </div>
                                    <div class="comment-content">${comment.content}</div>
                                    <div class="comment-actions">
                                        ${!comment.resolved ? `
                                            <button class="btn btn-sm btn-success" onclick="resolveComment('${comment.id}')">解决</button>
                                            <button class="btn btn-sm btn-outline-primary" onclick="replyToComment('${comment.id}')">回复</button>
                                        ` : `
                                            <span class="resolved-label">已解决</span>
                                        `}
                                    </div>
                                </div>
                            `).join('')}
                            ${collaborationSystem.comments.length === 0 ? '<p class="no-comments">暂无评论</p>' : ''}
                        </div>
                    </div>
                </div>
            `;

            showModal('团队协作', content);
        }

        // 切换协作标签页
        function switchCollaborationTab(tabName) {
            // 移除所有活动状态
            document.querySelectorAll('.collaboration-tabs .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 激活选中的标签页
            event.target.classList.add('active');
            document.getElementById(`${tabName}-collaboration`).classList.add('active');
        }

        // 保存当前版本
        function saveCurrentVersion() {
            const description = prompt('请输入版本描述:', '版本更新');
            if (description !== null) {
                const version = collaborationSystem.saveVersion(description);
                updateConsole('info', `版本已保存: ${version.description}`);
                showCollaborationPanel(); // 刷新面板
            }
        }

        // 恢复版本
        function restoreVersion(versionId) {
            if (confirm('确定要恢复到此版本吗？当前未保存的更改将丢失。')) {
                collaborationSystem.restoreVersion(versionId);
                closeModal();
            }
        }

        // 预览版本
        function previewVersion(versionId) {
            const version = collaborationSystem.versions.find(v => v.id === versionId);
            if (!version) return;

            // 创建预览窗口
            const previewContent = `
                <div class="version-preview">
                    <h4>版本预览: ${version.description}</h4>
                    <div class="preview-meta">
                        <p>版本ID: ${version.id}</p>
                        <p>创建时间: ${version.timestamp.toLocaleString()}</p>
                        <p>作者: ${version.author}</p>
                        <p>节点数量: ${version.nodes.length}</p>
                        <p>连接数量: ${version.connections.length}</p>
                    </div>
                    <div class="preview-actions">
                        <button class="btn btn-primary" onclick="restoreVersion('${versionId}'); closeModal();">恢复此版本</button>
                        <button class="btn btn-secondary" onclick="closeModal()">关闭预览</button>
                    </div>
                </div>
            `;

            showModal('版本预览', previewContent);
        }

        // 邀请团队成员
        function inviteTeamMember() {
            const email = prompt('请输入要邀请的成员邮箱:');
            if (email) {
                updateConsole('info', `邀请邮件已发送到: ${email}`);
            }
        }

        // 分享项目
        function shareProject() {
            const shareUrl = `${window.location.origin}${window.location.pathname}?share=${Date.now()}`;
            navigator.clipboard.writeText(shareUrl).then(() => {
                updateConsole('info', '分享链接已复制到剪贴板');
            });
        }

        // 解决评论
        function resolveComment(commentId) {
            collaborationSystem.resolveComment(commentId);
            updateConsole('info', '评论已标记为已解决');
            showCollaborationPanel(); // 刷新面板
        }

        // 扩展性架构系统
        const extensibilitySystem = {
            // 插件系统
            plugins: new Map(),
            pluginHooks: new Map(),
            
            // 自定义节点类型
            customNodeTypes: new Map(),
            
            // API接口
            apiEndpoints: new Map(),
            
            // 注册插件
            registerPlugin(pluginId, plugin) {
                if (this.plugins.has(pluginId)) {
                    console.warn(`插件 ${pluginId} 已存在，将被覆盖`);
                }
                
                this.plugins.set(pluginId, {
                    id: pluginId,
                    name: plugin.name || pluginId,
                    version: plugin.version || '1.0.0',
                    description: plugin.description || '',
                    author: plugin.author || 'Unknown',
                    enabled: true,
                    hooks: plugin.hooks || {},
                    init: plugin.init || (() => {}),
                    destroy: plugin.destroy || (() => {})
                });
                
                // 注册插件钩子
                if (plugin.hooks) {
                    Object.keys(plugin.hooks).forEach(hookName => {
                        if (!this.pluginHooks.has(hookName)) {
                            this.pluginHooks.set(hookName, []);
                        }
                        this.pluginHooks.get(hookName).push({
                            pluginId: pluginId,
                            handler: plugin.hooks[hookName]
                        });
                    });
                }
                
                // 初始化插件
                try {
                    this.plugins.get(pluginId).init();
                    updateConsole('info', `插件 ${plugin.name} 已加载`);
                } catch (error) {
                    updateConsole('error', `插件 ${plugin.name} 初始化失败: ${error.message}`);
                }
                
                return true;
            },
            
            // 卸载插件
            unregisterPlugin(pluginId) {
                const plugin = this.plugins.get(pluginId);
                if (!plugin) return false;
                
                try {
                    plugin.destroy();
                } catch (error) {
                    console.error(`插件 ${pluginId} 销毁失败:`, error);
                }
                
                // 移除插件钩子
                this.pluginHooks.forEach((hooks, hookName) => {
                    this.pluginHooks.set(hookName, hooks.filter(hook => hook.pluginId !== pluginId));
                });
                
                this.plugins.delete(pluginId);
                updateConsole('info', `插件 ${plugin.name} 已卸载`);
                return true;
            },
            
            // 执行钩子
            executeHook(hookName, ...args) {
                const hooks = this.pluginHooks.get(hookName) || [];
                const results = [];
                
                hooks.forEach(hook => {
                    const plugin = this.plugins.get(hook.pluginId);
                    if (plugin && plugin.enabled) {
                        try {
                            const result = hook.handler(...args);
                            results.push(result);
                        } catch (error) {
                            console.error(`插件 ${hook.pluginId} 钩子 ${hookName} 执行失败:`, error);
                        }
                    }
                });
                
                return results;
            },
            
            // 注册自定义节点类型
            registerCustomNodeType(nodeType, config) {
                this.customNodeTypes.set(nodeType, {
                    type: nodeType,
                    name: config.name || nodeType,
                    category: config.category || 'custom',
                    icon: config.icon || '🔧',
                    color: config.color || '#6c757d',
                    inputs: config.inputs || [],
                    outputs: config.outputs || [],
                    properties: config.properties || {},
                    execute: config.execute || (() => {}),
                    validate: config.validate || (() => true),
                    render: config.render || null
                });
                
                updateConsole('info', `自定义节点类型 ${config.name} 已注册`);
                return true;
            },
            
            // 注册API接口
            registerAPI(endpoint, handler) {
                this.apiEndpoints.set(endpoint, handler);
                updateConsole('info', `API接口 ${endpoint} 已注册`);
                return true;
            },
            
            // 调用API接口
            callAPI(endpoint, ...args) {
                const handler = this.apiEndpoints.get(endpoint);
                if (!handler) {
                    throw new Error(`API接口 ${endpoint} 不存在`);
                }
                
                try {
                    return handler(...args);
                } catch (error) {
                    console.error(`API接口 ${endpoint} 调用失败:`, error);
                    throw error;
                }
            },
            
            // 获取所有插件
            getAllPlugins() {
                return Array.from(this.plugins.values());
            },
            
            // 获取所有自定义节点类型
            getAllCustomNodeTypes() {
                return Array.from(this.customNodeTypes.values());
            },
            
            // 获取所有API接口
            getAllAPIEndpoints() {
                return Array.from(this.apiEndpoints.keys());
            }
        };

        // 显示扩展性面板
        function showExtensibilityPanel() {
            const content = `
                <div class="extensibility-panel">
                    <div class="extensibility-tabs">
                        <button class="tab-button active" onclick="switchExtensibilityTab('plugins')">插件管理</button>
                        <button class="tab-button" onclick="switchExtensibilityTab('custom-nodes')">自定义节点</button>
                        <button class="tab-button" onclick="switchExtensibilityTab('api')">API接口</button>
                        <button class="tab-button" onclick="switchExtensibilityTab('marketplace')">扩展市场</button>
                    </div>
                    
                    <div id="plugins-extensibility" class="tab-content active">
                        <div class="plugin-controls">
                            <button class="btn btn-primary" onclick="installPlugin()">安装插件</button>
                            <button class="btn btn-secondary" onclick="createPlugin()">创建插件</button>
                            <button class="btn btn-info" onclick="importPlugin()">导入插件</button>
                        </div>
                        
                        <div class="plugins-list">
                            <h4>已安装插件</h4>
                            ${extensibilitySystem.getAllPlugins().map(plugin => `
                                <div class="plugin-item ${plugin.enabled ? 'enabled' : 'disabled'}">
                                    <div class="plugin-header">
                                        <div class="plugin-info">
                                            <h5>${plugin.name}</h5>
                                            <span class="plugin-version">v${plugin.version}</span>
                                        </div>
                                        <div class="plugin-actions">
                                            <label class="switch">
                                                <input type="checkbox" ${plugin.enabled ? 'checked' : ''} 
                                                       onchange="togglePlugin('${plugin.id}')">
                                                <span class="slider"></span>
                                            </label>
                                            <button class="btn btn-sm btn-outline-danger" onclick="uninstallPlugin('${plugin.id}')">卸载</button>
                                        </div>
                                    </div>
                                    <div class="plugin-meta">
                                        <p class="plugin-description">${plugin.description}</p>
                                        <div class="plugin-details">
                                            <span class="plugin-author">作者: ${plugin.author}</span>
                                            <span class="plugin-hooks">钩子: ${Object.keys(plugin.hooks).length}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${extensibilitySystem.getAllPlugins().length === 0 ? '<p class="no-plugins">暂无已安装插件</p>' : ''}
                        </div>
                    </div>
                    
                    <div id="custom-nodes-extensibility" class="tab-content">
                        <div class="custom-node-controls">
                            <button class="btn btn-primary" onclick="createCustomNode()">创建自定义节点</button>
                            <button class="btn btn-secondary" onclick="importCustomNodes()">导入节点</button>
                            <button class="btn btn-info" onclick="exportCustomNodes()">导出节点</button>
                        </div>
                        
                        <div class="custom-nodes-list">
                            <h4>自定义节点类型</h4>
                            ${extensibilitySystem.getAllCustomNodeTypes().map(nodeType => `
                                <div class="custom-node-item">
                                    <div class="node-preview">
                                        <span class="node-icon">${nodeType.icon}</span>
                                        <div class="node-info">
                                            <h5>${nodeType.name}</h5>
                                            <span class="node-category">${nodeType.category}</span>
                                        </div>
                                    </div>
                                    <div class="node-details">
                                        <div class="node-ports">
                                            <span class="port-info">输入: ${nodeType.inputs.length}</span>
                                            <span class="port-info">输出: ${nodeType.outputs.length}</span>
                                        </div>
                                        <div class="node-actions">
                                            <button class="btn btn-sm btn-outline-primary" onclick="editCustomNode('${nodeType.type}')">编辑</button>
                                            <button class="btn btn-sm btn-outline-secondary" onclick="duplicateCustomNode('${nodeType.type}')">复制</button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteCustomNode('${nodeType.type}')">删除</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${extensibilitySystem.getAllCustomNodeTypes().length === 0 ? '<p class="no-custom-nodes">暂无自定义节点类型</p>' : ''}
                        </div>
                    </div>
                    
                    <div id="api-extensibility" class="tab-content">
                        <div class="api-controls">
                            <button class="btn btn-primary" onclick="createAPIEndpoint()">创建API接口</button>
                            <button class="btn btn-secondary" onclick="testAPIEndpoints()">测试接口</button>
                            <button class="btn btn-info" onclick="generateAPIDoc()">生成文档</button>
                        </div>
                        
                        <div class="api-list">
                            <h4>API接口列表</h4>
                            ${extensibilitySystem.getAllAPIEndpoints().map(endpoint => `
                                <div class="api-item">
                                    <div class="api-header">
                                        <code class="api-endpoint">${endpoint}</code>
                                        <div class="api-actions">
                                            <button class="btn btn-sm btn-outline-primary" onclick="testAPI('${endpoint}')">测试</button>
                                            <button class="btn btn-sm btn-outline-secondary" onclick="editAPI('${endpoint}')">编辑</button>
                                            <button class="btn btn-sm btn-outline-danger" onclick="deleteAPI('${endpoint}')">删除</button>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                            ${extensibilitySystem.getAllAPIEndpoints().length === 0 ? '<p class="no-apis">暂无API接口</p>' : ''}
                        </div>
                    </div>
                    
                    <div id="marketplace-extensibility" class="tab-content">
                        <div class="marketplace-controls">
                            <input type="text" class="form-control" placeholder="搜索扩展..." id="marketplace-search">
                            <button class="btn btn-primary" onclick="searchMarketplace()">搜索</button>
                            <button class="btn btn-secondary" onclick="refreshMarketplace()">刷新</button>
                        </div>
                        
                        <div class="marketplace-categories">
                            <button class="category-btn active" onclick="filterMarketplace('all')">全部</button>
                            <button class="category-btn" onclick="filterMarketplace('data-processing')">数据处理</button>
                            <button class="category-btn" onclick="filterMarketplace('visualization')">可视化</button>
                            <button class="category-btn" onclick="filterMarketplace('integration')">集成</button>
                            <button class="category-btn" onclick="filterMarketplace('utilities')">工具</button>
                        </div>
                        
                        <div class="marketplace-items">
                            <div class="marketplace-item">
                                <div class="item-header">
                                    <h5>数据清洗工具包</h5>
                                    <span class="item-rating">⭐ 4.8</span>
                                </div>
                                <p class="item-description">提供常用的数据清洗和预处理功能</p>
                                <div class="item-meta">
                                    <span class="item-author">DataTools Inc.</span>
                                    <span class="item-downloads">1.2k 下载</span>
                                </div>
                                <div class="item-actions">
                                    <button class="btn btn-sm btn-primary">安装</button>
                                    <button class="btn btn-sm btn-outline-secondary">详情</button>
                                </div>
                            </div>
                            
                            <div class="marketplace-item">
                                <div class="item-header">
                                    <h5>高级图表组件</h5>
                                    <span class="item-rating">⭐ 4.6</span>
                                </div>
                                <p class="item-description">丰富的图表类型和自定义选项</p>
                                <div class="item-meta">
                                    <span class="item-author">ChartMaster</span>
                                    <span class="item-downloads">856 下载</span>
                                </div>
                                <div class="item-actions">
                                    <button class="btn btn-sm btn-primary">安装</button>
                                    <button class="btn btn-sm btn-outline-secondary">详情</button>
                                </div>
                            </div>
                            
                            <div class="marketplace-item">
                                <div class="item-header">
                                    <h5>数据库连接器</h5>
                                    <span class="item-rating">⭐ 4.9</span>
                                </div>
                                <p class="item-description">支持多种数据库的连接和操作</p>
                                <div class="item-meta">
                                    <span class="item-author">DBConnect</span>
                                    <span class="item-downloads">2.1k 下载</span>
                                </div>
                                <div class="item-actions">
                                    <button class="btn btn-sm btn-primary">安装</button>
                                    <button class="btn btn-sm btn-outline-secondary">详情</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            showModal('扩展性管理', content);
        }

        // 切换扩展性标签页
        function switchExtensibilityTab(tabName) {
            // 移除所有活动状态
            document.querySelectorAll('.extensibility-tabs .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // 激活选中的标签页
            event.target.classList.add('active');
            document.getElementById(`${tabName}-extensibility`).classList.add('active');
        }

        // 插件管理功能
        function installPlugin() {
            const pluginCode = prompt('请输入插件代码或URL:');
            if (pluginCode) {
                try {
                    // 这里应该是实际的插件安装逻辑
                    updateConsole('info', '插件安装功能开发中...');
                } catch (error) {
                    updateConsole('error', `插件安装失败: ${error.message}`);
                }
            }
        }

        function createPlugin() {
            const pluginTemplate = `
// 插件模板
const myPlugin = {
    name: '我的插件',
    version: '1.0.0',
    description: '插件描述',
    author: '作者名称',
    
    // 插件初始化
    init() {
        console.log('插件已初始化');
    },
    
    // 插件销毁
    destroy() {
        console.log('插件已销毁');
    },
    
    // 插件钩子
    hooks: {
        'node.created': (node) => {
            console.log('节点已创建:', node);
        },
        'pipeline.executed': (result) => {
            console.log('管道执行完成:', result);
        }
    }
};

// 注册插件
extensibilitySystem.registerPlugin('my-plugin', myPlugin);
            `;
            
            showModal('创建插件', `
                <div class="plugin-editor">
                    <h4>插件代码编辑器</h4>
                    <textarea class="form-control" rows="20" id="plugin-code">${pluginTemplate}</textarea>
                    <div class="editor-actions">
                        <button class="btn btn-primary" onclick="savePlugin()">保存插件</button>
                        <button class="btn btn-secondary" onclick="testPlugin()">测试插件</button>
                        <button class="btn btn-info" onclick="loadPluginTemplate()">加载模板</button>
                    </div>
                </div>
            `);
        }

        function togglePlugin(pluginId) {
            const plugin = extensibilitySystem.plugins.get(pluginId);
            if (plugin) {
                plugin.enabled = !plugin.enabled;
                updateConsole('info', `插件 ${plugin.name} 已${plugin.enabled ? '启用' : '禁用'}`);
            }
        }

        function uninstallPlugin(pluginId) {
            if (confirm('确定要卸载此插件吗？')) {
                extensibilitySystem.unregisterPlugin(pluginId);
                showExtensibilityPanel(); // 刷新面板
            }
        }

        // 自定义节点管理功能
        function createCustomNode() {
            const nodeTemplate = {
                name: '自定义节点',
                category: 'custom',
                icon: '🔧',
                color: '#6c757d',
                inputs: [{ name: 'input', type: 'any' }],
                outputs: [{ name: 'output', type: 'any' }],
                properties: {
                    title: { type: 'string', default: '自定义节点' }
                },
                execute: function(inputs, properties) {
                    // 节点执行逻辑
                    return { output: inputs.input };
                }
            };
            
            showModal('创建自定义节点', `
                <div class="custom-node-editor">
                    <h4>自定义节点配置</h4>
                    <form class="node-config-form">
                        <div class="form-group">
                            <label>节点名称:</label>
                            <input type="text" class="form-control" value="${nodeTemplate.name}" id="node-name">
                        </div>
                        <div class="form-group">
                            <label>节点类别:</label>
                            <select class="form-control" id="node-category">
                                <option value="custom">自定义</option>
                                <option value="data">数据处理</option>
                                <option value="transform">数据转换</option>
                                <option value="output">输出</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>节点图标:</label>
                            <input type="text" class="form-control" value="${nodeTemplate.icon}" id="node-icon">
                        </div>
                        <div class="form-group">
                            <label>节点颜色:</label>
                            <input type="color" class="form-control" value="${nodeTemplate.color}" id="node-color">
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-primary" onclick="saveCustomNode()">保存节点</button>
                            <button type="button" class="btn btn-secondary" onclick="previewCustomNode()">预览节点</button>
                        </div>
                    </form>
                </div>
            `);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
