<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘å¥æ”¶é›†å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 30px;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .control-group select, .control-group input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .control-group select:focus, .control-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .add-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .add-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }

        .btn-danger {
            background: #dc3545;
            padding: 8px 15px;
            font-size: 14px;
        }

        .advanced-search {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .advanced-search h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .tag-cloud {
            margin-top: 20px;
        }

        .tag-cloud h5 {
            color: #555;
            margin-bottom: 10px;
        }

        .tag {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tag:hover {
            background: #1976d2;
            color: white;
            transform: translateY(-2px);
        }

        .tag.active {
            background: #667eea;
            color: white;
        }

        .direction-filter {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .direction-filter h5 {
            color: #555;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .direction-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .direction-btn {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #dee2e6;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .direction-btn:hover {
            background: #e9ecef;
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .direction-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .search-summary {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #2e7d32;
        }

        .quotes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .quote-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .quote-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .quote-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 15px;
            font-style: italic;
        }

        .quote-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .quote-author {
            font-weight: bold;
            color: #667eea;
        }

        .quote-category {
            background: #f0f0f0;
            color: #555;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .quote-source {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .quote-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close {
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .close:hover {
            color: #333;
        }

        @media (max-width: 768px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .quotes-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š é‡‘å¥æ”¶é›†å·¥å…·</h1>
            <p>æ”¶é›†æ™ºæ…§ï¼Œç§¯ç´¯çµæ„Ÿï¼Œè®©æ¯ä¸€å¥è¯éƒ½æˆä¸ºå¿ƒçµçš„ç¯å¡”</p>
        </div>

        <div class="main-content">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalQuotes">0</div>
                    <div class="stat-label">æ€»é‡‘å¥æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAuthors">0</div>
                    <div class="stat-label">ä½œè€…æ•°é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalCategories">0</div>
                    <div class="stat-label">åˆ†ç±»æ•°é‡</div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="filterAuthor">æŒ‰ä½œè€…æŸ¥æ‰¾</label>
                    <select id="filterAuthor">
                        <option value="">å…¨éƒ¨ä½œè€…</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="filterCategory">æŒ‰æ–¹å‘æŸ¥æ‰¾</label>
                    <select id="filterCategory">
                        <option value="">å…¨éƒ¨åˆ†ç±»</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="searchText">æœç´¢é‡‘å¥</label>
                    <input type="text" id="searchText" placeholder="è¾“å…¥å…³é”®è¯æœç´¢...">
                </div>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <button type="button" class="btn" onclick="performSearch()" style="padding: 12px 30px; font-size: 16px;">
                    ğŸ” å¼€å§‹æŸ¥æ‰¾
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetFilters()" style="margin-left: 10px; padding: 12px 30px; font-size: 16px;">
                    ğŸ”„ é‡ç½®æŸ¥æ‰¾
                </button>
            </div>

            <div class="advanced-search">
                <h4>ğŸ” é«˜çº§æŸ¥æ‰¾</h4>
                <div class="search-grid">
                    <div class="form-group">
                        <label for="dateRange">æ—¶é—´èŒƒå›´</label>
                        <select id="dateRange">
                            <option value="">å…¨éƒ¨æ—¶é—´</option>
                            <option value="today">ä»Šå¤©</option>
                            <option value="week">æœ¬å‘¨</option>
                            <option value="month">æœ¬æœˆ</option>
                            <option value="year">ä»Šå¹´</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sortBy">æ’åºæ–¹å¼</label>
                        <select id="sortBy">
                            <option value="newest">æœ€æ–°ä¼˜å…ˆ</option>
                            <option value="oldest">æœ€æ—©ä¼˜å…ˆ</option>
                            <option value="author">æŒ‰ä½œè€…æ’åº</option>
                            <option value="category">æŒ‰åˆ†ç±»æ’åº</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lengthFilter">é•¿åº¦ç­›é€‰</label>
                        <select id="lengthFilter">
                            <option value="">å…¨éƒ¨é•¿åº¦</option>
                            <option value="short">çŸ­å¥ (â‰¤30å­—)</option>
                            <option value="medium">ä¸­å¥ (31-80å­—)</option>
                            <option value="long">é•¿å¥ (>80å­—)</option>
                        </select>
                    </div>
                </div>
                <div class="direction-filter">
                    <h5>æŒ‰æ–¹å‘å¿«é€ŸæŸ¥æ‰¾</h5>
                    <div class="direction-buttons">
                        <button class="direction-btn" data-direction="äººç”Ÿå“²ç†" onclick="selectDirection(this)">äººç”Ÿå“²ç†</button>
                        <button class="direction-btn" data-direction="åŠ±å¿—å¥‹æ–—" onclick="selectDirection(this)">åŠ±å¿—å¥‹æ–—</button>
                        <button class="direction-btn" data-direction="çˆ±æƒ…æƒ…æ„Ÿ" onclick="selectDirection(this)">çˆ±æƒ…æƒ…æ„Ÿ</button>
                        <button class="direction-btn" data-direction="èŒåœºæ™ºæ…§" onclick="selectDirection(this)">èŒåœºæ™ºæ…§</button>
                        <button class="direction-btn" data-direction="å­¦ä¹ æˆé•¿" onclick="selectDirection(this)">å­¦ä¹ æˆé•¿</button>
                        <button class="direction-btn" data-direction="å‹æƒ…äº²æƒ…" onclick="selectDirection(this)">å‹æƒ…äº²æƒ…</button>
                        <button class="direction-btn" data-direction="å¹½é»˜é£è¶£" onclick="selectDirection(this)">å¹½é»˜é£è¶£</button>
                        <button class="direction-btn" data-direction="å…¶ä»–" onclick="selectDirection(this)">å…¶ä»–</button>
                        <button class="direction-btn active" data-direction="" onclick="selectDirection(this)">å…¨éƒ¨æ–¹å‘</button>
                    </div>
                </div>
                <div class="tag-cloud" id="tagCloud">
                    <h5>çƒ­é—¨æ ‡ç­¾</h5>
                    <div id="tagsContainer"></div>
                </div>
            </div>

            <div class="add-section">
                <h3>âœ¨ æ·»åŠ æ–°é‡‘å¥</h3>
                <form id="addQuoteForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="quoteText">é‡‘å¥å†…å®¹ *</label>
                            <textarea id="quoteText" placeholder="è¯·è¾“å…¥é‡‘å¥å†…å®¹..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="quoteAuthor">ä½œè€… *</label>
                            <input type="text" id="quoteAuthor" placeholder="è¯·è¾“å…¥ä½œè€…å§“å..." required>
                        </div>
                        <div class="form-group">
                            <label for="quoteCategory">æ–¹å‘/åˆ†ç±» *</label>
                            <select id="quoteCategory" required>
                                <option value="">é€‰æ‹©åˆ†ç±»</option>
                                <option value="äººç”Ÿå“²ç†">äººç”Ÿå“²ç†</option>
                                <option value="åŠ±å¿—å¥‹æ–—">åŠ±å¿—å¥‹æ–—</option>
                                <option value="çˆ±æƒ…æƒ…æ„Ÿ">çˆ±æƒ…æƒ…æ„Ÿ</option>
                                <option value="èŒåœºæ™ºæ…§">èŒåœºæ™ºæ…§</option>
                                <option value="å­¦ä¹ æˆé•¿">å­¦ä¹ æˆé•¿</option>
                                <option value="å‹æƒ…äº²æƒ…">å‹æƒ…äº²æƒ…</option>
                                <option value="å¹½é»˜é£è¶£">å¹½é»˜é£è¶£</option>
                                <option value="å…¶ä»–">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="quoteSource">æ¥æº</label>
                            <input type="text" id="quoteSource" placeholder="ä¹¦ç±ã€ç”µå½±ã€æ¼”è®²ç­‰...">
                        </div>
                    </div>
                    <button type="submit" class="btn">æ·»åŠ é‡‘å¥</button>
                    <button type="button" class="btn btn-secondary" onclick="clearForm()">æ¸…ç©º</button>
                </form>
                <div style="margin-top: 15px;">
                    <button type="button" class="btn btn-secondary" onclick="resetFilters()" style="background: #6f42c1;">é‡ç½®æ‰€æœ‰ç­›é€‰</button>
                </div>
            </div>

            <div id="quotesContainer">
                <div class="empty-state">
                    <h3>è¿˜æ²¡æœ‰é‡‘å¥</h3>
                    <p>å¼€å§‹æ·»åŠ ä½ çš„ç¬¬ä¸€æ¡é‡‘å¥å§ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ç¼–è¾‘é‡‘å¥</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label>é‡‘å¥å†…å®¹</label>
                    <textarea id="editText" required></textarea>
                </div>
                <div class="form-group">
                    <label>ä½œè€…</label>
                    <input type="text" id="editAuthor" required>
                </div>
                <div class="form-group">
                    <label>æ–¹å‘/åˆ†ç±»</label>
                    <select id="editCategory" required>
                        <option value="äººç”Ÿå“²ç†">äººç”Ÿå“²ç†</option>
                        <option value="åŠ±å¿—å¥‹æ–—">åŠ±å¿—å¥‹æ–—</option>
                        <option value="çˆ±æƒ…æƒ…æ„Ÿ">çˆ±æƒ…æƒ…æ„Ÿ</option>
                        <option value="èŒåœºæ™ºæ…§">èŒåœºæ™ºæ…§</option>
                        <option value="å­¦ä¹ æˆé•¿">å­¦ä¹ æˆé•¿</option>
                        <option value="å‹æƒ…äº²æƒ…">å‹æƒ…äº²æƒ…</option>
                        <option value="å¹½é»˜é£è¶£">å¹½é»˜é£è¶£</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>æ¥æº</label>
                    <input type="text" id="editSource">
                </div>
                <button type="submit" class="btn">ä¿å­˜ä¿®æ”¹</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            </form>
        </div>
    </div>

    <script>
        let quotes = JSON.parse(localStorage.getItem('quotes')) || [];
        let currentEditId = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            performSearch();
            updateFilters();
            updateStats();
            updateTags();
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('addQuoteForm').addEventListener('submit', addQuote);
            document.getElementById('editForm').addEventListener('submit', saveEdit);
            document.getElementById('filterAuthor').addEventListener('change', syncSearchButton);
            document.getElementById('filterCategory').addEventListener('change', function() {
                syncDirectionButtons(this.value);
                syncSearchButton();
            });
            document.getElementById('searchText').addEventListener('input', syncSearchButton);
            document.getElementById('dateRange').addEventListener('change', syncSearchButton);
            document.getElementById('sortBy').addEventListener('change', syncSearchButton);
            document.getElementById('lengthFilter').addEventListener('change', syncSearchButton);
        });

        // æ·»åŠ é‡‘å¥
        function addQuote(e) {
            e.preventDefault();
            
            const quote = {
                id: Date.now(),
                text: document.getElementById('quoteText').value.trim(),
                author: document.getElementById('quoteAuthor').value.trim(),
                category: document.getElementById('quoteCategory').value,
                source: document.getElementById('quoteSource').value.trim(),
                date: new Date().toLocaleDateString('zh-CN')
            };

            quotes.unshift(quote);
            saveQuotes();
            renderQuotes();
            updateFilters();
            updateStats();
            updateTags();
            clearForm();
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showNotification('é‡‘å¥æ·»åŠ æˆåŠŸï¼');
        }

        // æ¸²æŸ“é‡‘å¥åˆ—è¡¨
        function renderQuotes() {
            const container = document.getElementById('quotesContainer');
            const filteredQuotes = getFilteredQuotes();

            if (filteredQuotes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>${quotes.length === 0 ? 'è¿˜æ²¡æœ‰é‡‘å¥' : 'æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é‡‘å¥'}</h3>
                        <p>${quotes.length === 0 ? 'å¼€å§‹æ·»åŠ ä½ çš„ç¬¬ä¸€æ¡é‡‘å¥å§ï¼' : 'å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶'}</p>
                    </div>
                `;
                return;
            }

            let html = '<div class="quotes-grid">';
            html += filteredQuotes.map(quote => `
                <div class="quote-card">
                    <div class="quote-text">"${quote.text}"</div>
                    <div class="quote-meta">
                        <span class="quote-author">${quote.author}</span>
                        <span class="quote-category">${quote.category}</span>
                    </div>
                    ${quote.source ? `<div class="quote-source">ğŸ“– ${quote.source}</div>` : ''}
                    <div class="quote-source">ğŸ“… ${quote.date}</div>
                    <div class="quote-actions">
                        <button class="btn" onclick="editQuote(${quote.id})">ç¼–è¾‘</button>
                        <button class="btn btn-danger" onclick="deleteQuote(${quote.id})">åˆ é™¤</button>
                        <button class="btn" onclick="copyQuote('${quote.text}', '${quote.author}')" style="background: #28a745;">ğŸ“‹ å¤åˆ¶</button>
                    </div>
                </div>
            `).join('');
            html += '</div>';
            
            container.innerHTML = html;
            showSearchSummary(filteredQuotes);
        }

        // è·å–è¿‡æ»¤åçš„é‡‘å¥
        function getFilteredQuotes() {
            const authorFilter = document.getElementById('filterAuthor').value;
            const categoryFilter = document.getElementById('filterCategory').value;
            const searchText = document.getElementById('searchText').value.toLowerCase();
            const dateRange = document.getElementById('dateRange').value;
            const lengthFilter = document.getElementById('lengthFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            const activeTag = document.querySelector('.tag.active')?.dataset.tag;
            const activeDirection = document.querySelector('.direction-btn.active')?.dataset.direction;

            let filtered = quotes.filter(quote => {
                const matchesAuthor = !authorFilter || quote.author === authorFilter;
                const matchesCategory = !categoryFilter || quote.category === categoryFilter;
                const matchesDirection = !activeDirection || activeDirection === '' || quote.category === activeDirection;
                const matchesSearch = !searchText || 
                    quote.text.toLowerCase().includes(searchText) ||
                    quote.author.toLowerCase().includes(searchText) ||
                    quote.source.toLowerCase().includes(searchText);
                const matchesDate = !dateRange || isInDateRange(quote.date, dateRange);
                const matchesLength = !lengthFilter || checkLength(quote.text, lengthFilter);
                const matchesTag = !activeTag || quote.text.toLowerCase().includes(activeTag.toLowerCase());

                return matchesAuthor && matchesCategory && matchesDirection && matchesSearch && matchesDate && matchesLength && matchesTag;
            });

            // æ’åº
            filtered.sort((a, b) => {
                switch (sortBy) {
                    case 'newest':
                        return b.id - a.id;
                    case 'oldest':
                        return a.id - b.id;
                    case 'author':
                        return a.author.localeCompare(b.author);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    default:
                        return b.id - a.id;
                }
            });

            return filtered;
        }

        // æ£€æŸ¥æ—¥æœŸèŒƒå›´
        function isInDateRange(quoteDate, range) {
            const quote = new Date(quoteDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            switch (range) {
                case 'today':
                    return quote.toDateString() === today.toDateString();
                case 'week':
                    const weekAgo = new Date(today);
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return quote >= weekAgo && quote <= today;
                case 'month':
                    const monthAgo = new Date(today);
                    monthAgo.setMonth(monthAgo.getMonth() - 1);
                    return quote >= monthAgo && quote <= today;
                case 'year':
                    const yearAgo = new Date(today);
                    yearAgo.setFullYear(yearAgo.getFullYear() - 1);
                    return quote >= yearAgo && quote <= today;
                default:
                    return true;
            }
        }

        // æ£€æŸ¥é•¿åº¦
        function checkLength(text, lengthFilter) {
            const len = text.length;
            switch (lengthFilter) {
                case 'short':
                    return len <= 30;
                case 'medium':
                    return len > 30 && len <= 80;
                case 'long':
                    return len > 80;
                default:
                    return true;
            }
        }

        // æ›´æ–°ç­›é€‰å™¨é€‰é¡¹
        function updateFilters() {
            const authors = [...new Set(quotes.map(q => q.author))].sort();
            const categories = [...new Set(quotes.map(q => q.category))].sort();

            const authorSelect = document.getElementById('filterAuthor');
            const categorySelect = document.getElementById('filterCategory');

            authorSelect.innerHTML = '<option value="">å…¨éƒ¨ä½œè€…</option>' +
                authors.map(author => `<option value="${author}">${author}</option>`).join('');

            categorySelect.innerHTML = '<option value="">å…¨éƒ¨åˆ†ç±»</option>' +
                categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            document.getElementById('totalQuotes').textContent = quotes.length;
            document.getElementById('totalAuthors').textContent = new Set(quotes.map(q => q.author)).size;
            document.getElementById('totalCategories').textContent = new Set(quotes.map(q => q.category)).size;
        }

        // æ›´æ–°æ ‡ç­¾äº‘
        function updateTags() {
            const tagsContainer = document.getElementById('tagsContainer');
            const allWords = quotes.map(q => q.text.toLowerCase()).join(' ');
            const words = allWords.split(/\s+/).filter(word => word.length > 2);
            const wordCount = {};
            
            words.forEach(word => {
                const cleanWord = word.replace(/[.,!?;:"']/g, '');
                if (cleanWord && cleanWord.length > 2 && !['è¿™ä¸ª', 'é‚£ä¸ª', 'å°±æ˜¯', 'ä¸æ˜¯', 'ä½†æ˜¯', 'å› ä¸º', 'æ‰€ä»¥', 'å¦‚æœ', 'é‚£ä¹ˆ'].includes(cleanWord)) {
                    wordCount[cleanWord] = (wordCount[cleanWord] || 0) + 1;
                }
            });
            
            const topTags = Object.entries(wordCount)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 15)
                .map(([word, count]) => ({ word, count }));
            
            tagsContainer.innerHTML = topTags.map(tag => 
                `<span class="tag" data-tag="${tag.word}" onclick="selectTag(this)">${tag.word} (${tag.count})</span>`
            ).join('');
        }

        // é€‰æ‹©æ ‡ç­¾
        function selectTag(element) {
            document.querySelectorAll('.tag').forEach(tag => tag.classList.remove('active'));
            if (element.classList.contains('active')) {
                element.classList.remove('active');
            } else {
                element.classList.add('active');
            }
        }

        // é€‰æ‹©æ–¹å‘
        function selectDirection(element) {
            document.querySelectorAll('.direction-btn').forEach(btn => btn.classList.remove('active'));
            element.classList.add('active');
            
            const direction = element.dataset.direction;
            document.getElementById('filterCategory').value = direction;
            performSearch();
        }

        // åŒæ­¥æ–¹å‘æŒ‰é’®çŠ¶æ€
        function syncDirectionButtons(category) {
            document.querySelectorAll('.direction-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.direction === category) {
                    btn.classList.add('active');
                }
            });
            
            // å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ–¹å‘ï¼Œé€‰ä¸­"å…¨éƒ¨æ–¹å‘"
            if (!category) {
                document.querySelector('.direction-btn[data-direction=""]').classList.add('active');
            }
        }

        // æ˜¾ç¤ºæœç´¢æ‘˜è¦å’Œæå–çš„é‡‘å¥åˆ—è¡¨
        function showSearchSummary(filteredQuotes) {
            const container = document.getElementById('quotesContainer');
            const existingSummary = document.querySelector('.search-summary');
            if (existingSummary) {
                existingSummary.remove();
            }
            
            // åªè¦æœ‰æ‰¾åˆ°é‡‘å¥ï¼Œå°±æ˜¾ç¤ºæ‘˜è¦å’Œæå–åˆ—è¡¨
            if (filteredQuotes.length > 0) {
                // åˆ›å»ºæ‘˜è¦åŒºåŸŸ
                const summary = document.createElement('div');
                summary.className = 'search-summary';
                summary.style.cssText = 'background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;';
                summary.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                        <div>
                            <strong>æŸ¥æ‰¾ç»“æœï¼š</strong>å…±æ‰¾åˆ° ${filteredQuotes.length} æ¡é‡‘å¥ï¼Œ
                            æ¥è‡ª ${new Set(filteredQuotes.map(q => q.author)).size} ä½ä½œè€…ï¼Œ
                            æ¶µç›– ${new Set(filteredQuotes.map(q => q.category)).size} ä¸ªåˆ†ç±»
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button type="button" class="btn" onclick="copyAllResults()" style="padding: 8px 16px; font-size: 14px; background: #28a745;">
                                ğŸ“‹ å¤åˆ¶å…¨éƒ¨
                            </button>
                            <button type="button" class="btn" onclick="downloadSearchResults()" style="padding: 8px 16px; font-size: 14px;">
                                ğŸ“¥ ä¸‹è½½æŸ¥æ‰¾ç»“æœ
                            </button>
                        </div>
                    </div>
                `;
                container.insertBefore(summary, container.firstChild);

                // æ·»åŠ æå–çš„é‡‘å¥åˆ—è¡¨
                const quotesList = document.createElement('div');
                quotesList.className = 'found-quotes-list';
                quotesList.style.cssText = 'margin-top: 15px; border-top: 1px solid #dee2e6; padding-top: 15px;';
                quotesList.innerHTML = `
                    <h4 style="margin-bottom: 15px; color: #495057;">ğŸ“‹ æå–çš„é‡‘å¥åˆ—è¡¨ï¼š</h4>
                    <div class="quotes-list" style="max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px;">
                        ${filteredQuotes.map((quote, index) => `
                            <div style="padding: 12px; border-bottom: 1px solid #f8f9fa; background: white; display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="font-weight: bold; color: #495057; margin-bottom: 4px;">${index + 1}. "${quote.text}"</div>
                                    <div style="color: #6c757d; font-size: 0.9em;">â€”â€” ${quote.author}${quote.category ? `ã€${quote.category}ã€‘` : ''}</div>
                                </div>
                                <button type="button" class="btn" onclick="copyQuote('${quote.text.replace(/'/g, "\\'")}', '${quote.author.replace(/'/g, "\\'")}')" 
                                        style="padding: 4px 8px; font-size: 12px; background: #28a745; margin-left: 10px;">
                                    ğŸ“‹
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                // å°†æå–çš„åˆ—è¡¨æ’å…¥åˆ°æ‘˜è¦ä¸‹æ–¹
                summary.appendChild(quotesList);
            }
        }

        // æ‰§è¡ŒæŸ¥æ‰¾
        function performSearch() {
            const filteredQuotes = getFilteredQuotes();
            
            if (filteredQuotes.length === 0) {
                // æ²¡æœ‰æ‰¾åˆ°é‡‘å¥æ—¶ï¼Œæ˜¾ç¤ºæ¸…æ™°çš„æç¤º
                const container = document.getElementById('quotesContainer');
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 60px 20px;">
                        <h3 style="color: #dc3545; margin-bottom: 15px;">ğŸ˜” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é‡‘å¥</h3>
                        <p style="color: #666; font-size: 1.1em;">è¯·å°è¯•è°ƒæ•´æŸ¥æ‰¾æ¡ä»¶ï¼Œæˆ–æ·»åŠ æ–°çš„é‡‘å¥</p>
                        <div style="margin-top: 20px;">
                            <button class="btn" onclick="resetFilters()">é‡ç½®æŸ¥æ‰¾æ¡ä»¶</button>
                        </div>
                    </div>
                `;
                
                // ç§»é™¤æœç´¢æ‘˜è¦
                const existingSummary = document.querySelector('.search-summary');
                if (existingSummary) {
                    existingSummary.remove();
                }
                
                showNotification('æœªæ‰¾åˆ°åŒ¹é…çš„é‡‘å¥ï¼Œè¯·è°ƒæ•´æŸ¥æ‰¾æ¡ä»¶');
            } else {
                // æ‰¾åˆ°é‡‘å¥æ—¶ï¼Œæ­£å¸¸æ¸²æŸ“å¹¶æ˜¾ç¤ºç»“æœ
                renderQuotes();
                showSearchSummary(filteredQuotes);
                showNotification(`æ‰¾åˆ° ${filteredQuotes.length} æ¡é‡‘å¥`);
            }
        }

        // åŒæ­¥æŸ¥æ‰¾æŒ‰é’®çŠ¶æ€
        function syncSearchButton() {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æŸ¥æ‰¾æ¡ä»¶çš„å®æ—¶æç¤ºï¼Œæš‚æ—¶ç•™ç©º
        }

        // è¿‡æ»¤é‡‘å¥ï¼ˆä¿æŒåŸæœ‰åŠŸèƒ½ï¼Œä½†æ”¹ä¸ºæ‰‹åŠ¨è§¦å‘ï¼‰
        function filterQuotes() {
            const filteredQuotes = getFilteredQuotes();
            renderQuotes();
            showSearchSummary(filteredQuotes);
        }

        // ç¼–è¾‘é‡‘å¥
        function editQuote(id) {
            const quote = quotes.find(q => q.id === id);
            if (!quote) return;

            currentEditId = id;
            document.getElementById('editText').value = quote.text;
            document.getElementById('editAuthor').value = quote.author;
            document.getElementById('editCategory').value = quote.category;
            document.getElementById('editSource').value = quote.source || '';
            
            document.getElementById('editModal').style.display = 'block';
        }

        // ä¿å­˜ç¼–è¾‘
        function saveEdit(e) {
            e.preventDefault();
            
            const quote = quotes.find(q => q.id === currentEditId);
            if (!quote) return;

            quote.text = document.getElementById('editText').value.trim();
            quote.author = document.getElementById('editAuthor').value.trim();
            quote.category = document.getElementById('editCategory').value;
            quote.source = document.getElementById('editSource').value.trim();

            saveQuotes();
            renderQuotes();
            updateFilters();
            updateTags();
            closeModal();
            showNotification('é‡‘å¥ä¿®æ”¹æˆåŠŸï¼');
        }

        // åˆ é™¤é‡‘å¥
        function deleteQuote(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡é‡‘å¥å—ï¼Ÿ')) {
                quotes = quotes.filter(q => q.id !== id);
                saveQuotes();
                renderQuotes();
                updateFilters();
                updateStats();
                updateTags();
                showNotification('é‡‘å¥åˆ é™¤æˆåŠŸï¼');
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditId = null;
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('addQuoteForm').reset();
        }

        // é‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶
        function resetFilters() {
            document.getElementById('filterAuthor').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('searchText').value = '';
            document.getElementById('dateRange').value = '';
            document.getElementById('lengthFilter').value = '';
            document.getElementById('sortBy').value = 'newest';
            document.querySelectorAll('.tag').forEach(tag => tag.classList.remove('active'));
            document.querySelectorAll('.direction-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.direction-btn[data-direction=""]').classList.add('active');
            performSearch();
            showNotification('å·²é‡ç½®æ‰€æœ‰ç­›é€‰æ¡ä»¶');
        }

        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        function saveQuotes() {
            localStorage.setItem('quotes', JSON.stringify(quotes));
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1001;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // æ·»åŠ åŠ¨ç”»æ ·å¼
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);

        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // å¯¼å‡ºåŠŸèƒ½
        function exportQuotes() {
            const data = JSON.stringify(quotes, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `quotes_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // å¤åˆ¶å•ä¸ªé‡‘å¥
        function copyQuote(text, author) {
            const content = `"${text}" - ${author}`;
            navigator.clipboard.writeText(content).then(() => {
                showNotification('é‡‘å¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(err => {
                // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = content;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('é‡‘å¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            });
        }

        // å¤åˆ¶æ‰€æœ‰æŸ¥æ‰¾ç»“æœ
        function copyAllResults() {
            const filteredQuotes = getFilteredQuotes();
            
            if (filteredQuotes.length === 0) {
                showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„æŸ¥æ‰¾ç»“æœ');
                return;
            }

            let content = `é‡‘å¥æŸ¥æ‰¾ç»“æœï¼ˆå…± ${filteredQuotes.length} æ¡ï¼‰\n`;
            content += '='.repeat(30) + '\n\n';
            
            filteredQuotes.forEach((quote, index) => {
                content += `${index + 1}. "${quote.text}"\n`;
                content += `   â€”â€” ${quote.author}`;
                if (quote.category) {
                    content += `ã€${quote.category}ã€‘`;
                }
                content += '\n\n';
            });

            navigator.clipboard.writeText(content).then(() => {
                showNotification(`å·²å¤åˆ¶ ${filteredQuotes.length} æ¡é‡‘å¥åˆ°å‰ªè´´æ¿`);
            }).catch(err => {
                // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
                const textArea = document.createElement('textarea');
                textArea.value = content;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification(`å·²å¤åˆ¶ ${filteredQuotes.length} æ¡é‡‘å¥åˆ°å‰ªè´´æ¿`);
            });
        }

        // ä¸‹è½½æŸ¥æ‰¾ç»“æœ
        function downloadSearchResults() {
            const filteredQuotes = getFilteredQuotes();
            
            if (filteredQuotes.length === 0) {
                showNotification('æ²¡æœ‰å¯ä¸‹è½½çš„æŸ¥æ‰¾ç»“æœ');
                return;
            }

            // åˆ›å»ºæ ¼å¼åŒ–çš„æ–‡æœ¬å†…å®¹
            let content = `é‡‘å¥æŸ¥æ‰¾ç»“æœ\n`;
            content += `===============\n`;
            content += `æŸ¥æ‰¾æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n`;
            content += `ç»“æœæ•°é‡ï¼š${filteredQuotes.length} æ¡\n`;
            content += `æ¶‰åŠä½œè€…ï¼š${new Set(filteredQuotes.map(q => q.author)).size} ä½\n`;
            content += `æ¶µç›–åˆ†ç±»ï¼š${new Set(filteredQuotes.map(q => q.category)).size} ä¸ª\n\n`;
            
            filteredQuotes.forEach((quote, index) => {
                content += `${index + 1}. ${quote.text}\n`;
                content += `   ä½œè€…ï¼š${quote.author}\n`;
                content += `   åˆ†ç±»ï¼š${quote.category}\n`;
                if (quote.source) {
                    content += `   æ¥æºï¼š${quote.source}\n`;
                }
                content += `   æ—¥æœŸï¼š${quote.date}\n`;
                content += `   ${'-'.repeat(50)}\n\n`;
            });

            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `é‡‘å¥æŸ¥æ‰¾ç»“æœ_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification(`å·²ä¸‹è½½ ${filteredQuotes.length} æ¡é‡‘å¥æŸ¥æ‰¾ç»“æœ`);
        }

        // å¯¼å…¥åŠŸèƒ½
        function importQuotes() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const imported = JSON.parse(e.target.result);
                            if (Array.isArray(imported)) {
                                quotes = [...quotes, ...imported];
                                saveQuotes();
                                renderQuotes();
                                updateFilters();
                                updateStats();
                                showNotification('å¯¼å…¥æˆåŠŸï¼');
                            }
                        } catch (error) {
                            alert('å¯¼å…¥å¤±è´¥ï¼šæ–‡ä»¶æ ¼å¼é”™è¯¯');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // æ·»åŠ å¯¼å‡ºå¯¼å…¥æŒ‰é’®
        const addSection = document.querySelector('.add-section');
        const importExportDiv = document.createElement('div');
        importExportDiv.style.marginTop = '15px';
        importExportDiv.innerHTML = `
            <button type="button" class="btn" onclick="exportQuotes()" style="margin-right: 10px;">å¯¼å‡ºé‡‘å¥</button>
            <button type="button" class="btn btn-secondary" onclick="importQuotes()">å¯¼å…¥é‡‘å¥</button>
        `;
        addSection.appendChild(importExportDiv);
    </script>
</body>
</html>
