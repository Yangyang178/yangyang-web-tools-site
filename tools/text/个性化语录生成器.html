<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªæ€§åŒ–è¯­å½•ç”Ÿæˆå™¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@300;400;500;700&family=Ma+Shan+Zheng&family=Zhi+Mang+Xing&family=Long+Cang&family=Liu+Jian+Mao+Cao&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            min-height: 600px;
        }

        .sidebar {
            background: #f8f9fa;
            padding: 30px;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
            max-height: 80vh;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-area {
            position: relative;
        }

        .input-wrapper {
            position: relative;
        }

        #textInput {
            width: 100%;
            height: 120px;
            padding: 15px 45px 15px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        #textInput:focus {
            outline: none;
            border-color: #667eea;
        }

        .clear-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            background: #6c757d;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            z-index: 10;
        }

        .clear-btn:hover {
            background: #e74c3c;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }

        .clear-btn:active {
            transform: scale(0.95);
        }

        .input-wrapper:hover .clear-btn,
        #textInput:focus + .clear-btn,
        .input-wrapper:focus-within .clear-btn {
            opacity: 1;
            visibility: visible;
        }

        /* å½“è¾“å…¥æ¡†æœ‰å†…å®¹æ—¶æ˜¾ç¤ºæ¸…é™¤æŒ‰é’® */
        .input-wrapper.has-content .clear-btn {
            opacity: 1;
            visibility: visible;
        }

        .clear-btn svg {
            width: 12px;
            height: 12px;
            transition: transform 0.2s ease;
        }

        .clear-btn:hover svg {
            transform: rotate(90deg);
        }

        .char-count {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 12px;
            color: #6c757d;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .template-item {
            aspect-ratio: 4/3;
            border: 3px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .template-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .template-item.active {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .template-preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            font-size: 14px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* æ¨¡æ¿é¢„è§ˆæ ·å¼ - ä¼˜åŒ–èƒŒæ™¯è‰²åŒºåˆ«åº¦ */
        .classic-preview { background: linear-gradient(135deg, #2c3e50, #34495e); }
        .modern-preview { background: linear-gradient(135deg, #3498db, #2980b9); }
        .elegant-preview { background: radial-gradient(circle, #e91e63, #ad1457); }
        .gradient-preview { background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4); }
        .nature-preview { background: linear-gradient(to bottom, #228b22, #32cd32); }
        .dark-preview { background: linear-gradient(135deg, #1a1a1a, #000000); }
        .sunset-preview { background: linear-gradient(to bottom, #ff4500, #ff6347); }
        .ocean-preview { background: linear-gradient(to bottom, #006994, #0077be); }
        .forest-preview { background: linear-gradient(to bottom, #2e7d32, #4caf50); }
        .galaxy-preview { background: radial-gradient(circle, #4a148c, #7b1fa2); }
        .vintage-preview { background: linear-gradient(135deg, #8d6e63, #5d4037); }
        .neon-preview { background: linear-gradient(45deg, #000000, #ff00ff, #00ffff); }
        .spring-preview { background: linear-gradient(135deg, #81c784, #a5d6a7); }
        .autumn-preview { background: linear-gradient(135deg, #ff8a65, #ffab40); }
        .winter-preview { background: linear-gradient(135deg, #81d4fa, #4fc3f7); }
        .summer-preview { background: linear-gradient(135deg, #ffeb3b, #ffc107); }
        .romantic-preview { background: linear-gradient(135deg, #f48fb1, #f06292); }
        .mysterious-preview { background: linear-gradient(135deg, #673ab7, #9c27b0); }
        .energetic-preview { background: linear-gradient(135deg, #ff5722, #e64a19); }
        .peaceful-preview { background: linear-gradient(135deg, #66bb6a, #4caf50); }
        .cosmic-preview { background: radial-gradient(circle, #1a237e, #303f9f); }
        .cyberpunk-preview { background: linear-gradient(45deg, #e91e63, #00bcd4, #9c27b0); }
        .aurora-preview { background: linear-gradient(135deg, #00e676, #00acc1, #7c4dff); }
        .desert-preview { background: linear-gradient(to bottom, #ff8f00, #ff6f00, #e65100); }
        .crystal-preview { background: linear-gradient(45deg, #b3e5fc, #4fc3f7, #29b6f6); }
        .fire-preview { background: linear-gradient(to top, #d32f2f, #f44336, #ff5722); }
        .ice-preview { background: linear-gradient(135deg, #e1f5fe, #81d4fa, #29b6f6); }
        .marble-preview { background: linear-gradient(135deg, #eceff1, #cfd8dc, #90a4ae); }
        .gold-preview { background: linear-gradient(135deg, #ffc107, #ff8f00, #ff6f00); }
        .silver-preview { background: linear-gradient(135deg, #9e9e9e, #757575, #424242); }
        .copper-preview { background: linear-gradient(135deg, #ff8a65, #ff7043, #ff5722); }
        .pastel-preview { background: linear-gradient(45deg, #f8bbd9, #e1bee7, #c5cae9, #b2dfdb); }
        .monochrome-preview { background: linear-gradient(135deg, #ffffff, #9e9e9e, #212121); }
        .retro-preview { background: linear-gradient(45deg, #ff4081, #7c4dff, #ffab00, #536dfe); }
        .minimalist-preview { background: linear-gradient(135deg, #fafafa, #f5f5f5); }
        .cyberpunk-preview { background: linear-gradient(45deg, #ff0080, #00ffff, #8000ff); }
        .aurora-preview { background: linear-gradient(135deg, #00ff88, #0088ff, #8800ff); }
        .desert-preview { background: linear-gradient(to bottom, #ffd700, #ff8c00, #cd853f); }
        .crystal-preview { background: linear-gradient(45deg, #e0f7fa, #b2ebf2, #4dd0e1); }
        .fire-preview { background: linear-gradient(to top, #ff4500, #ff6347, #ffa500); }
        .ice-preview { background: linear-gradient(135deg, #e3f2fd, #bbdefb, #90caf9); }
        .rainbow-preview { background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff0080); }
        .marble-preview { background: linear-gradient(135deg, #f5f5f5, #e0e0e0, #bdbdbd); }
        .gold-preview { background: linear-gradient(135deg, #ffd700, #ffb300, #ff8c00); }
        .silver-preview { background: linear-gradient(135deg, #e8eaf6, #c5cae9, #9fa8da); }
        .copper-preview { background: linear-gradient(135deg, #d4a574, #cd853f, #8b4513); }
        .pastel-preview { background: linear-gradient(45deg, #ffb3ba, #ffdfba, #ffffba, #baffc9, #bae1ff); }
        .monochrome-preview { background: linear-gradient(135deg, #ffffff, #808080, #000000); }
        .retro-preview { background: linear-gradient(45deg, #ff6b9d, #c44569, #f8b500, #40407a); }
        .minimalist-preview { background: linear-gradient(135deg, #f8f9fa, #e9ecef); }
        .fire-preview { background: linear-gradient(135deg, #d32f2f, #ff5722); }
        .water-preview { background: linear-gradient(135deg, #0277bd, #03a9f4); }
        .earth-preview { background: linear-gradient(135deg, #5d4037, #8d6e63); }
        .air-preview { background: linear-gradient(135deg, #e0f2f1, #b2dfdb); }
        .golden-preview { background: linear-gradient(135deg, #ffd700, #ffb300); }
        .silver-preview { background: linear-gradient(135deg, #e0e0e0, #bdbdbd); }
        .copper-preview { background: linear-gradient(135deg, #d2691e, #cd853f); }
        .rainbow-preview { background: linear-gradient(45deg, #ff0000, #ff8000, #ffff00, #80ff00, #00ff00, #00ff80, #00ffff, #0080ff, #0000ff, #8000ff, #ff00ff, #ff0080); }
        .pastel-preview { background: linear-gradient(135deg, #fce4ec, #e1f5fe, #f3e5f5, #e8f5e8); }
        .monochrome-preview { background: linear-gradient(135deg, #ffffff, #000000); }

        .upload-template {
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
        }

        .upload-area {
            width: 100%;
            height: 100%;
            border: 2px dashed #dee2e6;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-template .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-area span {
            font-size: 20px;
            color: #666;
        }

        .upload-area p {
            font-size: 10px;
            color: #666;
            margin: 0;
        }

        .remove-btn {
            width: 100%;
            padding: 8px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 10px;
            transition: background 0.3s;
        }

        .remove-btn:hover {
            background: #c0392b;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-item label {
            font-size: 13px;
            font-weight: 500;
            color: #555;
        }

        .setting-item select,
        .setting-item input[type="range"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 13px;
        }

        .setting-item input[type="color"] {
            width: 50px;
            height: 35px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .setting-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        #fontSizeValue {
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .preview-area {
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #ffffff;
        }

        .preview-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        #canvas {
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-width: 100%;
            height: auto;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .templates-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* é£æ ¼å’Œè£…é¥°ç½‘æ ¼ */
        .style-grid,
        .decoration-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .style-item,
        .decoration-item {
            padding: 8px 12px;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .style-item:hover,
        .decoration-item:hover {
            background: #e9ecef;
        }

        .style-item.active,
        .decoration-item.active {
            background: #667eea;
            color: white;
            border-color: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¨ ä¸ªæ€§åŒ–è¯­å½•ç”Ÿæˆå™¨</h1>
            <p>å°†æ‚¨çš„æ–‡å­—è½¬åŒ–ä¸ºç²¾ç¾çš„è§†è§‰ä½œå“</p>
        </header>

        <main class="main-content">
            <div class="sidebar">
                <!-- æ–‡å­—è¾“å…¥åŒºåŸŸ -->
                <div class="section">
                    <h3>âœï¸ è¾“å…¥æ–‡å­—</h3>
                    <div class="input-area">
                        <div class="input-wrapper">
                            <textarea id="textInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥ä½ çš„è¯­å½•æ–‡å­—..." maxlength="200"></textarea>
                            <button id="clearBtn" class="clear-btn" title="æ¸…é™¤æ–‡å­—">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="char-count">0/200</div>
                    </div>
                </div>

                <!-- èƒŒæ™¯æ¨¡æ¿é€‰æ‹© -->
                <div class="section">
                    <h3>ğŸ­ é€‰æ‹©æ¨¡æ¿</h3>
                    <div class="templates-grid">
                        <div class="template-item active" data-template="classic">
                            <div class="template-preview classic-preview">ç»å…¸</div>
                        </div>
                        <div class="template-item" data-template="modern">
                            <div class="template-preview modern-preview">ç°ä»£</div>
                        </div>
                        <div class="template-item" data-template="elegant">
                            <div class="template-preview elegant-preview">ä¼˜é›…</div>
                        </div>
                        <div class="template-item" data-template="gradient">
                            <div class="template-preview gradient-preview">æ¸å˜</div>
                        </div>
                        <div class="template-item" data-template="nature">
                            <div class="template-preview nature-preview">è‡ªç„¶</div>
                        </div>
                        <div class="template-item" data-template="dark">
                            <div class="template-preview dark-preview">æš—é»‘</div>
                        </div>
                        <div class="template-item" data-template="sunset">
                            <div class="template-preview sunset-preview">æ—¥è½</div>
                        </div>
                        <div class="template-item" data-template="ocean">
                            <div class="template-preview ocean-preview">æµ·æ´‹</div>
                        </div>
                        <div class="template-item" data-template="forest">
                            <div class="template-preview forest-preview">æ£®æ—</div>
                        </div>
                        <div class="template-item" data-template="galaxy">
                            <div class="template-preview galaxy-preview">æ˜Ÿç³»</div>
                        </div>
                        <div class="template-item" data-template="vintage">
                            <div class="template-preview vintage-preview">å¤å¤</div>
                        </div>
                        <div class="template-item" data-template="neon">
                            <div class="template-preview neon-preview">éœ“è™¹</div>
                        </div>
                        <div class="template-item" data-template="spring">
                            <div class="template-preview spring-preview">æ˜¥å¤©</div>
                        </div>
                        <div class="template-item" data-template="summer">
                            <div class="template-preview summer-preview">å¤å¤©</div>
                        </div>
                        <div class="template-item" data-template="autumn">
                            <div class="template-preview autumn-preview">ç§‹å¤©</div>
                        </div>
                        <div class="template-item" data-template="winter">
                            <div class="template-preview winter-preview">å†¬å¤©</div>
                        </div>
                        <div class="template-item" data-template="romantic">
                            <div class="template-preview romantic-preview">æµªæ¼«</div>
                        </div>
                        <div class="template-item" data-template="mysterious">
                            <div class="template-preview mysterious-preview">ç¥ç§˜</div>
                        </div>
                        <div class="template-item" data-template="energetic">
                            <div class="template-preview energetic-preview">æ´»åŠ›</div>
                        </div>
                        <div class="template-item" data-template="peaceful">
                            <div class="template-preview peaceful-preview">å®é™</div>
                        </div>
                        <div class="template-item" data-template="cosmic">
                            <div class="template-preview cosmic-preview">å®‡å®™</div>
                        </div>
                        <div class="template-item" data-template="cyberpunk">
                            <div class="template-preview cyberpunk-preview">èµ›åšæœ‹å…‹</div>
                        </div>
                        <div class="template-item" data-template="aurora">
                            <div class="template-preview aurora-preview">æå…‰</div>
                        </div>
                        <div class="template-item" data-template="desert">
                            <div class="template-preview desert-preview">æ²™æ¼ </div>
                        </div>
                        <div class="template-item" data-template="crystal">
                            <div class="template-preview crystal-preview">æ°´æ™¶</div>
                        </div>
                        <div class="template-item" data-template="fire">
                            <div class="template-preview fire-preview">çƒˆç«</div>
                        </div>
                        <div class="template-item" data-template="ice">
                            <div class="template-preview ice-preview">å¯’å†°</div>
                        </div>
                        <div class="template-item" data-template="rainbow">
                            <div class="template-preview rainbow-preview">å½©è™¹</div>
                        </div>
                        <div class="template-item" data-template="marble">
                            <div class="template-preview marble-preview">å¤§ç†çŸ³</div>
                        </div>
                        <div class="template-item" data-template="gold">
                            <div class="template-preview gold-preview">é»„é‡‘</div>
                        </div>
                        <div class="template-item" data-template="silver">
                            <div class="template-preview silver-preview">ç™½é“¶</div>
                        </div>
                        <div class="template-item" data-template="copper">
                            <div class="template-preview copper-preview">é’é“œ</div>
                        </div>
                        <div class="template-item" data-template="pastel">
                            <div class="template-preview pastel-preview">é©¬å¡é¾™</div>
                        </div>
                        <div class="template-item" data-template="monochrome">
                            <div class="template-preview monochrome-preview">é»‘ç™½</div>
                        </div>
                        <div class="template-item" data-template="retro">
                            <div class="template-preview retro-preview">å¤å¤æ³¢æ™®</div>
                        </div>
                        <div class="template-item" data-template="minimalist">
                            <div class="template-preview minimalist-preview">æç®€</div>
                        </div>
                        <div class="template-item upload-template" data-template="upload">
                            <div class="upload-area">
                                <span>+</span>
                                <p>è‡ªå®šä¹‰</p>
                            </div>
                        </div>
                    </div>
                    <button id="removeImageBtn" class="remove-btn" style="display: none;">ç§»é™¤è‡ªå®šä¹‰èƒŒæ™¯</button>
                </div>

                <!-- æ–‡å­—è®¾ç½® -->
                <div class="section">
                    <h3>âœï¸ æ–‡å­—è®¾ç½®</h3>
                    <div class="settings-grid">
                        <div class="setting-item">
                            <label>å­—ä½“</label>
                            <select id="fontFamily">
                                <option value="'Noto Sans SC', sans-serif">æ€æºé»‘ä½“</option>
                                <option value="'Noto Serif SC', serif">æ€æºå®‹ä½“</option>
                                <option value="'Ma Shan Zheng', cursive">é©¬å–„æ”¿æ¥·ä½“</option>
                                <option value="'Zhi Mang Xing', cursive">å¿—å¿™æ˜Ÿè¡Œä¹¦</option>
                                <option value="'Long Cang', cursive">é¾™è—ä½“</option>
                                <option value="'Liu Jian Mao Cao', cursive">åˆ˜å»ºæ¯›è‰</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="'Times New Roman', serif">Times New Roman</option>
                                <option value="Helvetica, sans-serif">Helvetica</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                                <option value="Impact, sans-serif">Impact</option>
                                <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>å¤§å°</label>
                            <input type="range" id="fontSize" min="12" max="120" value="48">
                            <span id="fontSizeValue">48px</span>
                        </div>
                        <div class="setting-item">
                            <label>é¢œè‰²</label>
                            <input type="color" id="textColor" value="#ffffff">
                        </div>
                        <div class="setting-item">
                            <label>é˜´å½±</label>
                            <input type="checkbox" id="textShadow" checked>
                        </div>
                        <div class="setting-item">
                            <label>å¯¹é½</label>
                            <select id="textAlign">
                                <option value="left">å·¦å¯¹é½</option>
                                <option value="center" selected>å±…ä¸­</option>
                                <option value="right">å³å¯¹é½</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label>å›¾ç‰‡å°ºå¯¸</label>
                            <select id="imageSize">
                                <option value="800,600" selected>800Ã—600</option>
                                <option value="1024,768">1024Ã—768</option>
                                <option value="1200,900">1200Ã—900</option>
                                <option value="1600,1200">1600Ã—1200</option>
                                <option value="2048,1536">2048Ã—1536</option>
                                <option value="1920,1080">1920Ã—1080 (Full HD)</option>
                                <option value="1080,1920">1080Ã—1920 (ç«–å±)</option>
                                <option value="1080,1080">1080Ã—1080 (æ­£æ–¹å½¢)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- æ–‡å­—é£æ ¼ -->
                <div class="section">
                    <h3>ğŸ¨ æ–‡å­—é£æ ¼</h3>
                    <div class="style-grid">
                        <div class="style-item active" data-style="normal">æ­£å¸¸</div>
                        <div class="style-item" data-style="bold">ç²—ä½“</div>
                        <div class="style-item" data-style="italic">æ–œä½“</div>
                        <div class="style-item" data-style="bold-italic">ç²—æ–œä½“</div>
                        <div class="style-item" data-style="light">ç»†ä½“</div>
                        <div class="style-item" data-style="medium">ä¸­ç­‰</div>
                        <div class="style-item" data-style="semi-bold">åŠç²—ä½“</div>
                        <div class="style-item" data-style="extra-bold">è¶…ç²—ä½“</div>
                        <div class="style-item" data-style="black">é»‘ä½“</div>
                        <div class="style-item" data-style="condensed">ç´§ç¼©</div>
                    </div>
                </div>

                <!-- æ–‡å­—è£…é¥° -->
                <div class="section">
                    <h3>âœ¨ æ–‡å­—è£…é¥°</h3>
                    <div class="decoration-grid">
                        <div class="decoration-item active" data-decoration="none">æ— è£…é¥°</div>
                        <div class="decoration-item" data-decoration="underline">ä¸‹åˆ’çº¿</div>
                        <div class="decoration-item" data-decoration="overline">ä¸Šåˆ’çº¿</div>
                        <div class="decoration-item" data-decoration="line-through">åˆ é™¤çº¿</div>
                        <div class="decoration-item" data-decoration="double-underline">åŒä¸‹åˆ’çº¿</div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§é¢„è§ˆåŒºåŸŸ -->
            <div class="preview-area">
                <div class="preview-container">
                    <canvas id="canvas"></canvas>
                </div>
                <div class="action-buttons">
                    <button id="generateBtn" class="btn btn-primary">ğŸ¨ ç”Ÿæˆé¢„è§ˆ</button>
                    <button id="downloadBtn" class="btn btn-success">ğŸ’¾ ä¸‹è½½å›¾ç‰‡</button>
                </div>
            </div>
        </main>
    </div>

    <!-- éšè—çš„æ–‡ä»¶ä¸Šä¼ è¾“å…¥ -->
    <input type="file" id="backgroundUpload" accept="image/*" style="display: none;">

    <script>
        class QuoteGenerator {
            constructor() {
                this.canvas = null;
                this.ctx = null;
                this.currentTemplate = 'classic';
                this.customBackground = null;
                this.settings = {
                    fontSize: 48,
                    fontFamily: "'Noto Sans SC', sans-serif",
                    textColor: '#ffffff',
                    textAlign: 'center',
                    textShadow: true,
                    imageSize: '800,600',
                    textStyle: 'normal',
                    decoration: 'none'
                };
                
                this.templates = {
                    classic: {
                        name: 'ç»å…¸',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#2c3e50');
                            gradient.addColorStop(1, '#34495e');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    modern: {
                        name: 'ç°ä»£',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#3498db');
                            gradient.addColorStop(1, '#2980b9');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    elegant: {
                        name: 'ä¼˜é›…',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, Math.max(width, height)/2);
                            gradient.addColorStop(0, '#e91e63');
                            gradient.addColorStop(1, '#ad1457');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    gradient: {
                        name: 'æ¸å˜',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ff6b6b');
                            gradient.addColorStop(0.25, '#4ecdc4');
                            gradient.addColorStop(0.5, '#45b7d1');
                            gradient.addColorStop(0.75, '#96ceb4');
                            gradient.addColorStop(1, '#feca57');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    nature: {
                        name: 'è‡ªç„¶',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, 0, height);
                            gradient.addColorStop(0, '#87ceeb');
                            gradient.addColorStop(0.7, '#98fb98');
                            gradient.addColorStop(1, '#228b22');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    dark: {
                        name: 'æš—é»‘',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#1a1a1a');
                            gradient.addColorStop(1, '#000000');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    sunset: {
                        name: 'æ—¥è½',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, 0, height);
                            gradient.addColorStop(0, '#ff4500');
                            gradient.addColorStop(1, '#ff6347');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    ocean: {
                        name: 'æµ·æ´‹',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, 0, height);
                            gradient.addColorStop(0, '#006994');
                            gradient.addColorStop(1, '#0077be');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    forest: {
                        name: 'æ£®æ—',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, 0, height);
                            gradient.addColorStop(0, '#2e7d32');
                            gradient.addColorStop(1, '#4caf50');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    galaxy: {
                        name: 'æ˜Ÿç³»',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, Math.max(width, height)/2);
                            gradient.addColorStop(0, '#4a148c');
                            gradient.addColorStop(1, '#7b1fa2');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    vintage: {
                        name: 'å¤å¤',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#8d6e63');
                            gradient.addColorStop(1, '#5d4037');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    neon: {
                        name: 'éœ“è™¹',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#000000');
                            gradient.addColorStop(0.5, '#ff00ff');
                            gradient.addColorStop(1, '#00ffff');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    spring: {
                        name: 'æ˜¥å¤©',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#81c784');
                            gradient.addColorStop(1, '#a5d6a7');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    summer: {
                        name: 'å¤å¤©',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ffeb3b');
                            gradient.addColorStop(1, '#ffc107');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    autumn: {
                        name: 'ç§‹å¤©',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ff8a65');
                            gradient.addColorStop(1, '#ffab40');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    winter: {
                        name: 'å†¬å¤©',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#e1f5fe');
                            gradient.addColorStop(1, '#b3e5fc');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    romantic: {
                        name: 'æµªæ¼«',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#fce4ec');
                            gradient.addColorStop(1, '#f8bbd9');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    mysterious: {
                        name: 'ç¥ç§˜',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#4a148c');
                            gradient.addColorStop(1, '#7b1fa2');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    energetic: {
                        name: 'æ´»åŠ›',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ff5722');
                            gradient.addColorStop(1, '#ff9800');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    peaceful: {
                        name: 'å®é™',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#e8f5e8');
                            gradient.addColorStop(1, '#c8e6c9');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    cosmic: {
                        name: 'å®‡å®™',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createRadialGradient(width/2, height/2, 0, width/2, height/2, Math.max(width, height)/2);
                            gradient.addColorStop(0, '#1a237e');
                            gradient.addColorStop(1, '#3f51b5');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    cyberpunk: {
                        name: 'èµ›åšæœ‹å…‹',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ff0080');
                            gradient.addColorStop(0.5, '#00ffff');
                            gradient.addColorStop(1, '#8000ff');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    aurora: {
                        name: 'æå…‰',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#00ff88');
                            gradient.addColorStop(0.5, '#0088ff');
                            gradient.addColorStop(1, '#8800ff');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    desert: {
                        name: 'æ²™æ¼ ',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, 0, height);
                            gradient.addColorStop(0, '#ffd700');
                            gradient.addColorStop(0.5, '#ff8c00');
                            gradient.addColorStop(1, '#cd853f');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    crystal: {
                        name: 'æ°´æ™¶',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#e0f7fa');
                            gradient.addColorStop(0.5, '#b2ebf2');
                            gradient.addColorStop(1, '#4dd0e1');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    fire: {
                        name: 'çƒˆç«',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, height, 0, 0);
                            gradient.addColorStop(0, '#ff4500');
                            gradient.addColorStop(0.5, '#ff6347');
                            gradient.addColorStop(1, '#ffa500');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    ice: {
                        name: 'å¯’å†°',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#e3f2fd');
                            gradient.addColorStop(0.5, '#bbdefb');
                            gradient.addColorStop(1, '#90caf9');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    rainbow: {
                        name: 'å½©è™¹',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, 0);
                            gradient.addColorStop(0, '#ff0000');
                            gradient.addColorStop(0.17, '#ff8000');
                            gradient.addColorStop(0.33, '#ffff00');
                            gradient.addColorStop(0.5, '#00ff00');
                            gradient.addColorStop(0.67, '#0080ff');
                            gradient.addColorStop(0.83, '#8000ff');
                            gradient.addColorStop(1, '#ff0080');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    marble: {
                        name: 'å¤§ç†çŸ³',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#f5f5f5');
                            gradient.addColorStop(0.5, '#e0e0e0');
                            gradient.addColorStop(1, '#bdbdbd');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    gold: {
                        name: 'é»„é‡‘',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ffd700');
                            gradient.addColorStop(0.5, '#ffb300');
                            gradient.addColorStop(1, '#ff8c00');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    silver: {
                        name: 'ç™½é“¶',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#e8eaf6');
                            gradient.addColorStop(0.5, '#c5cae9');
                            gradient.addColorStop(1, '#9fa8da');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    copper: {
                        name: 'é’é“œ',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#d4a574');
                            gradient.addColorStop(0.5, '#cd853f');
                            gradient.addColorStop(1, '#8b4513');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    pastel: {
                        name: 'é©¬å¡é¾™',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ffb3ba');
                            gradient.addColorStop(0.25, '#ffdfba');
                            gradient.addColorStop(0.5, '#ffffba');
                            gradient.addColorStop(0.75, '#baffc9');
                            gradient.addColorStop(1, '#bae1ff');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    monochrome: {
                        name: 'é»‘ç™½',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ffffff');
                            gradient.addColorStop(0.5, '#808080');
                            gradient.addColorStop(1, '#000000');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    retro: {
                        name: 'å¤å¤æ³¢æ™®',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#ff6b9d');
                            gradient.addColorStop(0.33, '#c44569');
                            gradient.addColorStop(0.67, '#f8b500');
                            gradient.addColorStop(1, '#40407a');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    },
                    minimalist: {
                        name: 'æç®€',
                        background: (ctx, width, height) => {
                            const gradient = ctx.createLinearGradient(0, 0, width, height);
                            gradient.addColorStop(0, '#f8f9fa');
                            gradient.addColorStop(1, '#e9ecef');
                            ctx.fillStyle = gradient;
                            ctx.fillRect(0, 0, width, height);
                        }
                    }
                };
            }

            init() {
                try {
                    this.canvas = document.getElementById('canvas');
                    if (!this.canvas) {
                        throw new Error('Canvas element not found');
                    }
                    
                    this.ctx = this.canvas.getContext('2d');
                    if (!this.ctx) {
                        throw new Error('Canvas context not available');
                    }
                    
                    this.updateCanvasSize();
                    this.bindEvents();
                    this.updatePreview();
                    
                    console.log('QuoteGenerator initialized successfully');
                } catch (error) {
                    console.error('Failed to initialize QuoteGenerator:', error);
                    alert('åˆå§‹åŒ–å¤±è´¥: ' + error.message);
                }
            }

            updateCanvasSize() {
                const [width, height] = this.settings.imageSize.split(',').map(Number);
                this.canvas.width = width;
                this.canvas.height = height;
            }

            bindEvents() {
                // æ–‡æœ¬è¾“å…¥äº‹ä»¶
                const textInput = document.getElementById('textInput');
                if (textInput) {
                    textInput.addEventListener('input', () => {
                        this.updateCharCount();
                        this.updatePreview();
                    });
                }

                // æ¨¡æ¿é€‰æ‹©äº‹ä»¶
                document.querySelectorAll('.template-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const template = item.dataset.template;
                        if (template === 'upload') {
                            this.handleImageUpload();
                        } else {
                            this.selectTemplate(template);
                        }
                    });
                });

                // è®¾ç½®å˜æ›´äº‹ä»¶
                const fontSize = document.getElementById('fontSize');
                if (fontSize) {
                    fontSize.addEventListener('input', (e) => {
                        this.settings.fontSize = parseInt(e.target.value);
                        document.getElementById('fontSizeValue').textContent = e.target.value + 'px';
                        this.updatePreview();
                    });
                }

                const fontFamily = document.getElementById('fontFamily');
                if (fontFamily) {
                    fontFamily.addEventListener('change', (e) => {
                        this.settings.fontFamily = e.target.value;
                        this.updatePreview();
                    });
                }

                const textColor = document.getElementById('textColor');
                if (textColor) {
                    textColor.addEventListener('change', (e) => {
                        this.settings.textColor = e.target.value;
                        this.updatePreview();
                    });
                }

                const textAlign = document.getElementById('textAlign');
                if (textAlign) {
                    textAlign.addEventListener('change', (e) => {
                        this.settings.textAlign = e.target.value;
                        this.updatePreview();
                    });
                }

                const textShadow = document.getElementById('textShadow');
                if (textShadow) {
                    textShadow.addEventListener('change', (e) => {
                        this.settings.textShadow = e.target.checked;
                        this.updatePreview();
                    });
                }

                const imageSize = document.getElementById('imageSize');
                if (imageSize) {
                    imageSize.addEventListener('change', (e) => {
                        this.settings.imageSize = e.target.value;
                        this.updateCanvasSize();
                        this.updatePreview();
                    });
                }

                // æŒ‰é’®äº‹ä»¶
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => {
                        this.updatePreview();
                    });
                }

                const downloadBtn = document.getElementById('downloadBtn');
                if (downloadBtn) {
                    downloadBtn.addEventListener('click', () => {
                        this.downloadImage();
                    });
                }

                // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
                const backgroundUpload = document.getElementById('backgroundUpload');
                if (backgroundUpload) {
                    backgroundUpload.addEventListener('change', (e) => {
                        this.handleBackgroundUpload(e);
                    });
                }

                // æ–‡å­—é£æ ¼é€‰æ‹©
                document.querySelectorAll('.style-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        document.querySelectorAll('.style-item').forEach(i => i.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.settings.textStyle = e.currentTarget.dataset.style;
                        this.updatePreview();
                    });
                });

                // è£…é¥°æ•ˆæœé€‰æ‹©
                document.querySelectorAll('.decoration-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        document.querySelectorAll('.decoration-item').forEach(i => i.classList.remove('active'));
                        e.currentTarget.classList.add('active');
                        this.settings.decoration = e.currentTarget.dataset.decoration;
                        this.updatePreview();
                    });
                });

                // ç§»é™¤èƒŒæ™¯æŒ‰é’®
                const removeImageBtn = document.getElementById('removeImageBtn');
                if (removeImageBtn) {
                    removeImageBtn.addEventListener('click', () => {
                        this.removeCustomBackground();
                    });
                }
            }

            handleImageUpload() {
                const backgroundUpload = document.getElementById('backgroundUpload');
                if (backgroundUpload) {
                    backgroundUpload.click();
                }
            }

            handleBackgroundUpload(event) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onload = () => {
                            this.customBackground = img;
                            this.currentTemplate = 'upload';
                            this.selectTemplate('upload');
                            this.updatePreview();
                            
                            const removeBtn = document.getElementById('removeImageBtn');
                            if (removeBtn) {
                                removeBtn.style.display = 'block';
                            }
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }

            removeCustomBackground() {
                this.customBackground = null;
                this.selectTemplate('classic');
                
                const removeBtn = document.getElementById('removeImageBtn');
                if (removeBtn) {
                    removeBtn.style.display = 'none';
                }
            }

            selectTemplate(templateId) {
                document.querySelectorAll('.template-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const selectedItem = document.querySelector(`[data-template="${templateId}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('active');
                }
                
                this.currentTemplate = templateId;
                this.updatePreview();
            }

            updateCharCount() {
                const textInput = document.getElementById('textInput');
                const charCountEl = document.querySelector('.char-count');
                
                if (textInput && charCountEl) {
                    const charCount = textInput.value.length;
                    charCountEl.textContent = `${charCount}/200`;
                }
            }

            updatePreview() {
                try {
                    if (!this.canvas || !this.ctx) {
                        console.error('Canvas or context not available');
                        return;
                    }

                    const textInput = document.getElementById('textInput');
                    const text = textInput ? textInput.value || 'è¯·è¾“å…¥æ–‡å­—' : 'è¯·è¾“å…¥æ–‡å­—';
                    
                    const width = this.canvas.width;
                    const height = this.canvas.height;

                    // æ¸…ç©ºç”»å¸ƒ
                    this.ctx.clearRect(0, 0, width, height);

                    // ç»˜åˆ¶èƒŒæ™¯
                    this.drawBackground();

                    // ç»˜åˆ¶æ–‡å­—
                    this.drawText(text);

                } catch (error) {
                    console.error('Error updating preview:', error);
                }
            }

            drawBackground() {
                const width = this.canvas.width;
                const height = this.canvas.height;

                if (this.currentTemplate === 'upload' && this.customBackground) {
                    // ç»˜åˆ¶è‡ªå®šä¹‰èƒŒæ™¯
                    this.ctx.drawImage(this.customBackground, 0, 0, width, height);
                } else if (this.templates[this.currentTemplate]) {
                    // ç»˜åˆ¶é¢„è®¾æ¨¡æ¿èƒŒæ™¯
                    this.templates[this.currentTemplate].background(this.ctx, width, height);
                } else {
                    // é»˜è®¤èƒŒæ™¯
                    this.templates.classic.background(this.ctx, width, height);
                }
            }

            drawText(text) {
                const width = this.canvas.width;
                const height = this.canvas.height;

                // è®¾ç½®æ–‡å­—æ ·å¼
                this.ctx.fillStyle = this.settings.textColor;
                
                // åº”ç”¨æ–‡å­—é£æ ¼
                let fontStyle = '';
                switch (this.settings.textStyle) {
                    case 'bold':
                        fontStyle = 'bold ';
                        break;
                    case 'italic':
                        fontStyle = 'italic ';
                        break;
                    case 'bold-italic':
                        fontStyle = 'bold italic ';
                        break;
                    case 'light':
                        fontStyle = '300 ';
                        break;
                    case 'medium':
                        fontStyle = '500 ';
                        break;
                    case 'semi-bold':
                        fontStyle = '600 ';
                        break;
                    case 'extra-bold':
                        fontStyle = '800 ';
                        break;
                    case 'black':
                        fontStyle = '900 ';
                        break;
                    case 'condensed':
                        fontStyle = 'condensed ';
                        break;
                    default:
                        fontStyle = '';
                }
                
                this.ctx.font = `${fontStyle}${this.settings.fontSize}px ${this.settings.fontFamily}`;
                this.ctx.textAlign = this.settings.textAlign;
                this.ctx.textBaseline = 'middle';

                // è®¾ç½®é˜´å½± - æ ¹æ®èƒŒæ™¯è‰²è‡ªåŠ¨è°ƒæ•´é˜´å½±å¼ºåº¦
                if (this.settings.textShadow) {
                    // æ ¹æ®å½“å‰æ¨¡æ¿è°ƒæ•´é˜´å½±å¼ºåº¦
                    const shadowIntensity = this.getShadowIntensity();
                    this.ctx.shadowColor = `rgba(0, 0, 0, ${shadowIntensity})`;
                    this.ctx.shadowBlur = 6;
                    this.ctx.shadowOffsetX = 3;
                    this.ctx.shadowOffsetY = 3;
                } else {
                    this.ctx.shadowColor = 'transparent';
                    this.ctx.shadowBlur = 0;
                    this.ctx.shadowOffsetX = 0;
                    this.ctx.shadowOffsetY = 0;
                }

                // æ–‡å­—æ¢è¡Œå¤„ç†
                const maxWidth = width - 80;
                const lines = this.wrapText(text, maxWidth);
                const lineHeight = this.settings.fontSize * 1.2;
                const totalHeight = lines.length * lineHeight;
                const startY = (height - totalHeight) / 2 + lineHeight / 2;

                // è®¡ç®—Xåæ ‡
                let x;
                switch (this.settings.textAlign) {
                    case 'left':
                        x = 40;
                        break;
                    case 'right':
                        x = width - 40;
                        break;
                    default:
                        x = width / 2;
                }

                // ç»˜åˆ¶æ¯ä¸€è¡Œ
                lines.forEach((line, index) => {
                    const y = startY + index * lineHeight;
                    
                    // ç»˜åˆ¶æ–‡å­—è£…é¥°
                    this.drawTextDecorations(line, x, y, maxWidth);
                    
                    // ç»˜åˆ¶æ–‡å­—
                    this.ctx.fillText(line, x, y);
                });
            }

            drawTextDecorations(text, x, y, maxWidth) {
                if (this.settings.decoration === 'none') return;

                const textWidth = this.ctx.measureText(text).width;
                let decorationX = x;
                
                // æ ¹æ®å¯¹é½æ–¹å¼è°ƒæ•´è£…é¥°ä½ç½®
                switch (this.settings.textAlign) {
                    case 'left':
                        decorationX = x;
                        break;
                    case 'right':
                        decorationX = x - textWidth;
                        break;
                    default:
                        decorationX = x - textWidth / 2;
                }

                this.ctx.save();
                this.ctx.strokeStyle = this.settings.textColor;
                this.ctx.lineWidth = Math.max(1, this.settings.fontSize / 20);

                switch (this.settings.decoration) {
                    case 'underline':
                        this.ctx.beginPath();
                        this.ctx.moveTo(decorationX, y + this.settings.fontSize / 3);
                        this.ctx.lineTo(decorationX + textWidth, y + this.settings.fontSize / 3);
                        this.ctx.stroke();
                        break;
                    case 'overline':
                        this.ctx.beginPath();
                        this.ctx.moveTo(decorationX, y - this.settings.fontSize / 2);
                        this.ctx.lineTo(decorationX + textWidth, y - this.settings.fontSize / 2);
                        this.ctx.stroke();
                        break;
                    case 'line-through':
                        this.ctx.beginPath();
                        this.ctx.moveTo(decorationX, y - this.settings.fontSize / 8);
                        this.ctx.lineTo(decorationX + textWidth, y - this.settings.fontSize / 8);
                        this.ctx.stroke();
                        break;
                    case 'double-underline':
                        this.ctx.beginPath();
                        this.ctx.moveTo(decorationX, y + this.settings.fontSize / 3);
                        this.ctx.lineTo(decorationX + textWidth, y + this.settings.fontSize / 3);
                        this.ctx.moveTo(decorationX, y + this.settings.fontSize / 3 + 4);
                        this.ctx.lineTo(decorationX + textWidth, y + this.settings.fontSize / 3 + 4);
                        this.ctx.stroke();
                        break;
                }
                
                this.ctx.restore();
            }

            wrapText(text, maxWidth) {
                const words = text.split('');
                const lines = [];
                let currentLine = '';

                for (let i = 0; i < words.length; i++) {
                    const testLine = currentLine + words[i];
                    const metrics = this.ctx.measureText(testLine);
                    
                    if (metrics.width > maxWidth && currentLine !== '') {
                        lines.push(currentLine);
                        currentLine = words[i];
                    } else {
                        currentLine = testLine;
                    }
                }

                if (currentLine) {
                    lines.push(currentLine);
                }

                return lines.length > 0 ? lines : [text];
            }

            downloadImage() {
                try {
                    const link = document.createElement('a');
                    link.download = `è¯­å½•_${new Date().getTime()}.png`;
                    link.href = this.canvas.toDataURL('image/png');
                    link.click();
                    
                    console.log('Image downloaded successfully');
                } catch (error) {
                    console.error('Error downloading image:', error);
                    alert('ä¸‹è½½å¤±è´¥: ' + error.message);
                }
            }

            // æ ¹æ®èƒŒæ™¯æ¨¡æ¿è·å–åˆé€‚çš„é˜´å½±å¼ºåº¦
            getShadowIntensity() {
                const lightBackgrounds = ['winter', 'romantic', 'peaceful', 'spring', 'summer', 'classic', 'modern', 'elegant', 'colorful'];
                const mediumBackgrounds = ['nature', 'forest', 'ocean', 'autumn', 'energetic'];
                const darkBackgrounds = ['dark', 'galaxy', 'mysterious', 'vintage', 'neon', 'sunset'];
                
                if (lightBackgrounds.includes(this.currentTemplate)) {
                    return 0.8; // æµ…è‰²èƒŒæ™¯éœ€è¦æ›´å¼ºçš„é˜´å½±
                } else if (mediumBackgrounds.includes(this.currentTemplate)) {
                    return 0.6; // ä¸­ç­‰èƒŒæ™¯é€‚ä¸­é˜´å½±
                } else if (darkBackgrounds.includes(this.currentTemplate)) {
                    return 0.4; // æ·±è‰²èƒŒæ™¯è¾ƒè½»é˜´å½±
                } else {
                    return 0.5; // é»˜è®¤é˜´å½±å¼ºåº¦
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const generator = new QuoteGenerator();
                generator.init();
                
                // è®¾ç½®é»˜è®¤æ–‡å­—
                const textInput = document.getElementById('textInput');
                if (textInput) {
                    textInput.value = 'ç”Ÿæ´»ä¸æ˜¯ç­‰å¾…æš´é£é›¨è¿‡å»ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨é›¨ä¸­èµ·èˆã€‚';
                    generator.updateCharCount();
                    generator.updatePreview();
                }
                
                // æ·»åŠ æ¸…é™¤æŒ‰é’®åŠŸèƒ½
                const clearBtn = document.getElementById('clearBtn');
                const inputWrapper = textInput.parentElement;
                
                if (clearBtn && textInput && inputWrapper) {
                    // æ£€æŸ¥è¾“å…¥æ¡†å†…å®¹å¹¶åˆ‡æ¢æ ·å¼
                    const toggleClearButton = () => {
                        if (textInput.value.trim().length > 0) {
                            inputWrapper.classList.add('has-content');
                        } else {
                            inputWrapper.classList.remove('has-content');
                        }
                    };
                    
                    // åˆå§‹æ£€æŸ¥
                    toggleClearButton();
                    
                    // ç›‘å¬è¾“å…¥å˜åŒ–
                    textInput.addEventListener('input', toggleClearButton);
                    textInput.addEventListener('paste', () => {
                        setTimeout(toggleClearButton, 10);
                    });
                    
                    // æ¸…é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                    clearBtn.addEventListener('click', () => {
                        textInput.value = '';
                        textInput.focus();
                        generator.updateCharCount();
                        generator.updatePreview();
                        toggleClearButton();
                    });
                }
                
                console.log('Application initialized successfully');
            } catch (error) {
                console.error('Failed to initialize application:', error);
                alert('åº”ç”¨åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        });
    </script>
</body>
</html>
