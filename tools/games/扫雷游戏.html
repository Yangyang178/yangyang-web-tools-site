<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® å½©è™¹æ‰«é›·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2), 0 0 0 1px rgba(255,255,255,0.3);
            padding: 40px;
            max-width: 700px;
            width: 100%;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .game-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
        }

        h1 {
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.5em;
            margin-bottom: 30px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        select, input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.8);
            text-align: center;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.2);
            transform: scale(1.05);
        }

        button {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #ff5252, #26a69a);
        }

        button:active {
            transform: translateY(-1px) scale(0.98);
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 20px;
        }

        .info-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .info-card:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .info-card span {
            display: block;
            font-size: 1.2em;
            margin-top: 5px;
        }

        .minefield {
            display: grid;
            gap: 3px;
            margin: 0 auto;
            background: rgba(0,0,0,0.1);
            padding: 20px;
            border-radius: 20px;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.1);
            max-width: 600px;
        }

        .cell {
            width: 35px;
            height: 35px;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            border: none;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15), inset 0 1px 2px rgba(255,255,255,0.8);
            position: relative;
            overflow: hidden;
        }

        .cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .cell:hover:not(.revealed):not(.flagged) {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.25);
        }

        .cell:hover:not(.revealed):not(.flagged)::before {
            transform: translateX(100%);
        }

        .cell:active:not(.revealed):not(.flagged) {
            transform: translateY(0) scale(0.95);
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
        }

        .cell.revealed {
            background: linear-gradient(145deg, #e8e8e8, #d0d0d0);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            cursor: default;
            transform: scale(0.95);
        }

        .cell.mine {
            background: linear-gradient(145deg, #ff4757, #ff3742);
            color: white;
            animation: pulse 1s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(0.95); }
            to { transform: scale(1.05); }
        }

        .cell.flagged {
            background: linear-gradient(145deg, #ffa726, #ff9800);
            color: white;
            animation: bounce 0.6s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }

        .cell.num-1 { color: #1976d2; }
        .cell.num-2 { color: #388e3c; }
        .cell.num-3 { color: #d32f2f; }
        .cell.num-4 { color: #7b1fa2; }
        .cell.num-5 { color: #f57c00; }
        .cell.num-6 { color: #00796b; }
        .cell.num-7 { color: #424242; }
        .cell.num-8 { color: #795548; }

        .game-over {
            text-align: center;
            margin-top: 30px;
        }

        .win {
            background: linear-gradient(45deg, #4caf50, #8bc34a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: bold;
            animation: celebration 2s ease-in-out infinite;
        }

        .lose {
            background: linear-gradient(45deg, #f44336, #ff5722);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: bold;
            animation: shake 0.5s ease-in-out infinite;
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .instructions {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240,240,240,0.9));
            border-radius: 20px;
            font-size: 14px;
            color: #555;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .instructions strong {
            color: #2c3e50;
            font-size: 16px;
        }

        .rules-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .rules-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { 
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to { 
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .rules-content h2 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 28px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .rules-content h3 {
            color: #feca57;
            margin: 20px 0 10px 0;
            font-size: 20px;
        }

        .rules-content p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 16px;
        }

        .rules-content ul {
            margin-bottom: 15px;
            padding-left: 20px;
        }

        .rules-content li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .close-rules {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 20px;
            transition: all 0.3s ease;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .close-rules:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        .show-rules {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .show-rules:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        @media (max-width: 600px) {
            .controls {
                grid-template-columns: 1fr;
            }
            
            .cell {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ¯ æ‰«é›·æ¸¸æˆ</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>éš¾åº¦é€‰æ‹©</label>
                <select id="difficulty">
                    <option value="easy">ç®€å• (9Ã—9, 10é›·)</option>
                    <option value="medium">ä¸­ç­‰ (16Ã—16, 40é›·)</option>
                    <option value="hard">å›°éš¾ (16Ã—30, 99é›·)</option>
                    <option value="custom">è‡ªå®šä¹‰</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>å®½åº¦</label>
                <input type="number" id="width" min="5" max="50" value="9" disabled>
            </div>
            
            <div class="control-group">
                <label>é«˜åº¦</label>
                <input type="number" id="height" min="5" max="50" value="9" disabled>
            </div>
            
            <div class="control-group">
                <label>é›·æ•°</label>
                <input type="number" id="mines" min="1" max="999" value="10" disabled>
            </div>
            
            <div class="control-group">
                <label>&nbsp;</label>
                <button onclick="newGame()">æ–°æ¸¸æˆ</button>
            </div>
        </div>

        <div class="game-info">
            <div class="info-card">
                <div>ğŸ’£ å‰©ä½™é›·æ•°</div>
                <span id="minesLeft">10</span>
            </div>
            <div class="info-card">
                <div>â° ç”¨æ—¶</div>
                <span id="timer">000</span> ç§’
            </div>
        </div>

        <div class="minefield" id="minefield"></div>

        <div class="game-over" id="gameOver"></div>

        <div class="instructions">
            <strong>å¿«é€ŸæŒ‡å—ï¼š</strong><br>
            â€¢ å·¦é”®ç‚¹å‡»ï¼šç¿»å¼€æ–¹å—<br>
            â€¢ å³é”®ç‚¹å‡»ï¼šæ ‡è®°/å–æ¶ˆæ ‡è®°åœ°é›·<br>
            â€¢ æ‰¾å‡ºæ‰€æœ‰éé›·æ–¹å—å³å¯è·èƒœ<br>
            â€¢ å°å¿ƒä¸è¦ç‚¹åˆ°åœ°é›·ï¼
            <button class="show-rules" onclick="showRules()">ğŸ“– æŸ¥çœ‹è¯¦ç»†è§„åˆ™</button>
        </div>

        <!-- æ¸¸æˆè§„åˆ™å¼¹çª— -->
        <div class="rules-modal" id="rulesModal">
            <div class="rules-content">
                <h2>ğŸ¯ æ‰«é›·æ¸¸æˆè§„åˆ™è¯¦è§£</h2>
                
                <h3>ğŸ® æ¸¸æˆç›®æ ‡</h3>
                <p>æ‰¾å‡ºæ‰€æœ‰ä¸å«åœ°é›·çš„æ–¹å—ï¼Œé¿å…è¸©åˆ°åœ°é›·ã€‚é€šè¿‡é€»è¾‘æ¨ç†ï¼Œæ ¹æ®æ•°å­—æç¤ºæ‰¾å‡ºæ‰€æœ‰å®‰å…¨åŒºåŸŸã€‚</p>

                <h3>ğŸ–±ï¸ æ“ä½œæ–¹å¼</h3>
                <ul>
                    <li><strong>å·¦é”®å•å‡»ï¼š</strong>ç¿»å¼€æ–¹å—</li>
                    <li><strong>å³é”®å•å‡»ï¼š</strong>æ ‡è®°/å–æ¶ˆæ ‡è®°åœ°é›·</li>
                    <li><strong>åŒå‡»å·²ç¿»å¼€çš„æ•°å­—ï¼š</strong>å¿«é€Ÿç¿»å¼€å‘¨å›´æœªæ ‡è®°çš„æ–¹å—ï¼ˆé«˜çº§æŠ€å·§ï¼‰</li>
                </ul>

                <h3>ğŸ”¢ æ•°å­—å«ä¹‰</h3>
                <p>æ¯ä¸ªæ•°å­—è¡¨ç¤ºè¯¥æ–¹å—å‘¨å›´8ä¸ªæ–¹å‘çš„åœ°é›·æ•°é‡ï¼š</p>
                <ul>
                    <li>æ•°å­—1-8ï¼šå‘¨å›´åœ°é›·çš„æ•°é‡</li>
                    <li>ç©ºç™½ï¼šå‘¨å›´æ²¡æœ‰åœ°é›·ï¼Œä¼šè‡ªåŠ¨ç¿»å¼€</li>
                    <li>çº¢æ——ï¼šç©å®¶æ ‡è®°çš„åœ°é›·ä½ç½®</li>
                    <li>ğŸ’£ï¼šåœ°é›·ï¼ˆè¸©åˆ°ä¼šæ¸¸æˆç»“æŸï¼‰</li>
                </ul>

                <h3>ğŸ† è·èƒœæ¡ä»¶</h3>
                <p>æˆåŠŸç¿»å¼€æ‰€æœ‰éåœ°é›·æ–¹å—ï¼Œæˆ–æ­£ç¡®æ ‡è®°æ‰€æœ‰åœ°é›·ä½ç½®ã€‚</p>

                <h3>ğŸ’¡ æ¸¸æˆæŠ€å·§</h3>
                <ul>
                    <li>ä»è§’è½æˆ–è¾¹ç¼˜å¼€å§‹ï¼Œè¿™äº›ä½ç½®çš„åœ°é›·æ›´å®¹æ˜“åˆ¤æ–­</li>
                    <li>åˆ©ç”¨æ•°å­—æ¨ç†ï¼šå¦‚æœä¸€ä¸ªæ•°å­—å‘¨å›´å·²æ ‡è®°çš„åœ°é›·æ•°é‡ç­‰äºè¯¥æ•°å­—ï¼Œå‰©ä¸‹çš„æ–¹å—éƒ½æ˜¯å®‰å…¨çš„</li>
                    <li>å…ˆæ ‡è®°ç¡®å®šçš„åœ°é›·ï¼Œå†ç¿»å¼€å®‰å…¨åŒºåŸŸ</li>
                    <li>ä½¿ç”¨é€»è¾‘æ’é™¤æ³•ï¼Œé¿å…çŒœæµ‹</li>
                </ul>

                <h3>âš¡ éš¾åº¦è¯´æ˜</h3>
                <ul>
                    <li><strong>ç®€å•ï¼š</strong>9Ã—9 ç½‘æ ¼ï¼Œ10ä¸ªåœ°é›· - é€‚åˆæ–°æ‰‹</li>
                    <li><strong>ä¸­ç­‰ï¼š</strong>16Ã—16 ç½‘æ ¼ï¼Œ40ä¸ªåœ°é›· - æ ‡å‡†éš¾åº¦</li>
                    <li><strong>å›°éš¾ï¼š</strong>16Ã—30 ç½‘æ ¼ï¼Œ99ä¸ªåœ°é›· - æŒ‘æˆ˜æé™</li>
                    <li><strong>è‡ªå®šä¹‰ï¼š</strong>è‡ªç”±è®¾ç½®ç½‘æ ¼å¤§å°å’Œåœ°é›·æ•°é‡</li>
                </ul>

                <h3>ğŸª ç‰¹è‰²åŠŸèƒ½</h3>
                <ul>
                    <li>é¦–æ¬¡ç‚¹å‡»å¿…ä¸ä¸­é›·</li>
                    <li>å®æ—¶è®¡æ—¶å™¨è®°å½•æ¸¸æˆæ—¶é—´</li>
                    <li>å‰©ä½™åœ°é›·è®¡æ•°å™¨</li>
                    <li>æµç•…çš„åŠ¨ç”»æ•ˆæœå’Œå½©è™¹ä¸»é¢˜</li>
                </ul>

                <button class="close-rules" onclick="closeRules()">âœ¨ å¼€å§‹æ¸¸æˆ</button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            width: 9,
            height: 9,
            mines: 10,
            board: [],
            revealed: [],
            flagged: [],
            gameOver: false,
            firstClick: true,
            minesLeft: 10,
            startTime: null,
            timer: null
        };

        function initGame() {
            const difficulty = document.getElementById('difficulty').value;
            const widthInput = document.getElementById('width');
            const heightInput = document.getElementById('height');
            const minesInput = document.getElementById('mines');

            if (difficulty === 'custom') {
                widthInput.disabled = false;
                heightInput.disabled = false;
                minesInput.disabled = false;
            } else {
                widthInput.disabled = true;
                heightInput.disabled = true;
                minesInput.disabled = true;
                
                switch(difficulty) {
                    case 'easy':
                        widthInput.value = 9;
                        heightInput.value = 9;
                        minesInput.value = 10;
                        break;
                    case 'medium':
                        widthInput.value = 16;
                        heightInput.value = 16;
                        minesInput.value = 40;
                        break;
                    case 'hard':
                        widthInput.value = 30;
                        heightInput.value = 16;
                        minesInput.value = 99;
                        break;
                }
            }
        }

        function newGame() {
            gameState.width = parseInt(document.getElementById('width').value);
            gameState.height = parseInt(document.getElementById('height').value);
            gameState.mines = parseInt(document.getElementById('mines').value);

            if (gameState.mines >= gameState.width * gameState.height) {
                alert('é›·æ•°ä¸èƒ½è¶…è¿‡æ€»æ–¹å—æ•°ï¼');
                return;
            }

            gameState.board = [];
            gameState.revealed = [];
            gameState.flagged = [];
            gameState.gameOver = false;
            gameState.firstClick = true;
            gameState.minesLeft = gameState.mines;
            gameState.startTime = null;

            if (gameState.timer) {
                clearInterval(gameState.timer);
            }

            document.getElementById('minesLeft').textContent = gameState.minesLeft;
            document.getElementById('timer').textContent = '000';
            document.getElementById('gameOver').textContent = '';

            createBoard();
            renderBoard();
        }

        function createBoard() {
            // åˆå§‹åŒ–ç©ºç™½æ£‹ç›˜
            for (let y = 0; y < gameState.height; y++) {
                gameState.board[y] = [];
                gameState.revealed[y] = [];
                gameState.flagged[y] = [];
                for (let x = 0; x < gameState.width; x++) {
                    gameState.board[y][x] = 0;
                    gameState.revealed[y][x] = false;
                    gameState.flagged[y][x] = false;
                }
            }
        }

        function placeMines(excludeX, excludeY) {
            let minesPlaced = 0;
            while (minesPlaced < gameState.mines) {
                const x = Math.floor(Math.random() * gameState.width);
                const y = Math.floor(Math.random() * gameState.height);
                
                if (gameState.board[y][x] !== -1 && !(x === excludeX && y === excludeY)) {
                    gameState.board[y][x] = -1;
                    minesPlaced++;
                }
            }

            // è®¡ç®—å‘¨å›´é›·æ•°
            for (let y = 0; y < gameState.height; y++) {
                for (let x = 0; x < gameState.width; x++) {
                    if (gameState.board[y][x] !== -1) {
                        gameState.board[y][x] = countAdjacentMines(x, y);
                    }
                }
            }
        }

        function countAdjacentMines(x, y) {
            let count = 0;
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    const nx = x + dx;
                    const ny = y + dy;
                    if (nx >= 0 && nx < gameState.width && ny >= 0 && ny < gameState.height) {
                        if (gameState.board[ny][nx] === -1) {
                            count++;
                        }
                    }
                }
            }
            return count;
        }

        function renderBoard() {
            const minefield = document.getElementById('minefield');
            minefield.innerHTML = '';
            minefield.style.gridTemplateColumns = `repeat(${gameState.width}, 30px)`;

            for (let y = 0; y < gameState.height; y++) {
                for (let x = 0; x < gameState.width; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;

                    if (gameState.revealed[y][x]) {
                        cell.classList.add('revealed');
                        if (gameState.board[y][x] === -1) {
                            cell.classList.add('mine');
                            cell.textContent = 'ğŸ’£';
                        } else if (gameState.board[y][x] > 0) {
                            cell.classList.add(`num-${gameState.board[y][x]}`);
                            cell.textContent = gameState.board[y][x];
                        }
                    } else if (gameState.flagged[y][x]) {
                        cell.classList.add('flagged');
                        cell.textContent = 'ğŸš©';
                    }

                    cell.addEventListener('click', (e) => handleLeftClick(e));
                    cell.addEventListener('contextmenu', (e) => handleRightClick(e));
                    
                    minefield.appendChild(cell);
                }
            }
        }

        function handleLeftClick(event) {
            if (gameState.gameOver) return;
            
            const x = parseInt(event.target.dataset.x);
            const y = parseInt(event.target.dataset.y);
            
            if (gameState.flagged[y][x]) return;
            if (gameState.revealed[y][x]) return;

            if (gameState.firstClick) {
                gameState.firstClick = false;
                placeMines(x, y);
                startTimer();
            }

            revealCell(x, y);
            renderBoard();
            checkWin();
        }

        function handleRightClick(event) {
            event.preventDefault();
            if (gameState.gameOver) return;
            
            const x = parseInt(event.target.dataset.x);
            const y = parseInt(event.target.dataset.y);
            
            if (gameState.revealed[y][x]) return;

            gameState.flagged[y][x] = !gameState.flagged[y][x];
            gameState.minesLeft += gameState.flagged[y][x] ? -1 : 1;
            document.getElementById('minesLeft').textContent = gameState.minesLeft;
            
            renderBoard();
        }

        function revealCell(x, y) {
            if (x < 0 || x >= gameState.width || y < 0 || y >= gameState.height) return;
            if (gameState.revealed[y][x] || gameState.flagged[y][x]) return;

            gameState.revealed[y][x] = true;

            if (gameState.board[y][x] === -1) {
                gameOver(false);
                return;
            }

            if (gameState.board[y][x] === 0) {
                // é€’å½’ç¿»å¼€ç©ºç™½åŒºåŸŸ
                for (let dy = -1; dy <= 1; dy++) {
                    for (let dx = -1; dx <= 1; dx++) {
                        revealCell(x + dx, y + dy);
                    }
                }
            }
        }

        function gameOver(won) {
            gameState.gameOver = true;
            clearInterval(gameState.timer);

            // æ˜¾ç¤ºæ‰€æœ‰åœ°é›·
            for (let y = 0; y < gameState.height; y++) {
                for (let x = 0; x < gameState.width; x++) {
                    if (gameState.board[y][x] === -1) {
                        gameState.revealed[y][x] = true;
                    }
                }
            }

            renderBoard();
            
            const gameOverDiv = document.getElementById('gameOver');
            if (won) {
                gameOverDiv.innerHTML = `<div class="win">ğŸ‰ æ­å–œè·èƒœï¼\nç”¨æ—¶ ${Math.floor((Date.now() - gameState.startTime) / 1000)} ç§’</div>`;
            } else {
                gameOverDiv.innerHTML = '<div class="lose">ğŸ’¥ æ¸¸æˆç»“æŸï¼\nä½ è¸©åˆ°åœ°é›·äº†</div>';
            }
        }

        function checkWin() {
            let revealedCount = 0;
            for (let y = 0; y < gameState.height; y++) {
                for (let x = 0; x < gameState.width; x++) {
                    if (gameState.revealed[y][x]) {
                        revealedCount++;
                    }
                }
            }

            if (revealedCount === gameState.width * gameState.height - gameState.mines) {
                gameOver(true);
            }
        }

        function startTimer() {
            gameState.startTime = Date.now();
            gameState.timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                document.getElementById('timer').textContent = elapsed.toString().padStart(3, '0');
            }, 1000);
        }

        // æ¸¸æˆè§„åˆ™å¼¹çª—æ§åˆ¶
        function showRules() {
            document.getElementById('rulesModal').style.display = 'block';
        }

        function closeRules() {
            document.getElementById('rulesModal').style.display = 'none';
        }

        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        window.onclick = function(event) {
            const modal = document.getElementById('rulesModal');
            if (event.target === modal) {
                closeRules();
            }
        }

        // åˆå§‹åŒ–
        document.getElementById('difficulty').addEventListener('change', initGame);
        initGame();
        newGame();
    </script>
</body>
</html>
