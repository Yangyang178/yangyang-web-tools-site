<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å­¦ç”Ÿæ•°å­¦ç»ƒä¹ å·¥å…·</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --card-bg: #fff;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        h1 {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .container {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            border: 1px solid #eee;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .section:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "";
            display: inline-block;
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, var(--primary-color), var(--success-color));
            margin-right: 10px;
            border-radius: 4px;
        }
        
        .difficulty-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .difficulty-option {
            padding: 8px 18px;
            background-color: var(--light-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .difficulty-option:hover {
            background-color: #d5dbdb;
            transform: translateY(-2px);
        }
        
        .difficulty-option.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .settings-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        
        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
        }
        
        .setting-group label {
            font-weight: 500;
            color: var(--dark-color);
            white-space: nowrap;
        }
        
        input[type="number"], input[type="text"] {
            width: 70px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input[type="number"]:focus, input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
            opacity: 0.9;
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        button.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        button.danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        
        button.warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }
        
        button.reset {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }
        
        .quiz-area {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .timer-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
        }
        
        .timer-display.final-countdown {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }
        
        .question {
            margin-bottom: 15px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .question:hover {
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .question input {
            width: 100px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .question input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .result {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid var(--success-color);
            animation: fadeIn 0.5s ease;
        }
        
        .result h3 {
            margin-top: 0;
            color: var(--dark-color);
            font-size: 1.3rem;
        }
        
        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .history {
            margin-top: 40px;
            animation: fadeIn 0.5s ease;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .history h2 {
            color: var(--dark-color);
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .history h2::before {
            content: "ğŸ“š";
        }
        
        .history-item {
            margin-bottom: 15px;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .history-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .history-item-date {
            font-weight: bold;
            color: var(--dark-color);
            font-size: 1.1rem;
        }
        
        .history-item-type {
            background-color: var(--light-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .history-item-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .history-item-level {
            color: var(--gray-color);
            font-size: 0.9rem;
        }
        
        .history-item-score {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--success-color);
        }
        
        .history-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #27ae60);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .correct {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .incorrect {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .question-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
            animation: fadeIn 0.3s ease;
        }
        
        .question-detail-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-detail-item span:first-child {
            flex: 1;
        }
        
        .empty-history {
            text-align: center;
            padding: 30px;
            color: var(--gray-color);
        }
        
        .empty-history i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
            color: var(--light-color);
        }
        
        .theme-selector {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }
        
        .theme-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .theme-option:hover {
            transform: scale(1.1);
        }
        
        .theme-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }
        
        .bg-theme-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .bg-theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .bg-theme-option:hover {
            transform: scale(1.1);
        }
        
        .bg-theme-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }
        
        .mixed-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mixed-option {
            padding: 8px 18px;
            background-color: var(--light-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .mixed-option:hover {
            background-color: #d5dbdb;
            transform: translateY(-2px);
        }
        
        .mixed-option.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .bg-intensity {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bg-intensity input[type="range"] {
            width: 150px;
        }
        
        .custom-settings {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        .custom-settings.active {
            display: block;
        }
        
        .custom-setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .custom-setting-group label {
            min-width: 100px;
            font-weight: 500;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .section {
                padding: 15px;
            }
            
            .difficulty-options, .mixed-options {
                flex-direction: column;
            }
            
            .settings-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .history-item-header, .history-item-body {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .button-group, .result-actions, .history-item-actions {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .custom-setting-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .custom-setting-group label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>å°å­¦ç”Ÿæ•°å­¦ç»ƒä¹ å·¥å…·</h1>
        
        <div class="theme-selector">
            <div class="section-title">é€‰æ‹©ä¸»é¢˜é¢œè‰²</div>
            <div class="theme-options">
                <div class="theme-option selected" style="background: linear-gradient(135deg, #3498db, #2ecc71);" onclick="setTheme('#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #9b59b6, #e74c3c);" onclick="setTheme('#9b59b6', '#e74c3c', '#f39c12', '#3498db', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #f39c12, #e74c3c);" onclick="setTheme('#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #1abc9c, #3498db);" onclick="setTheme('#1abc9c', '#3498db', '#e74c3c', '#f39c12', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #e74c3c, #f39c12);" onclick="setTheme('#e74c3c', '#f39c12', '#3498db', '#2ecc71', '#ecf0f1', '#2c3e50', '#333')"></div>
            </div>
            <div class="section-title" style="margin-top: 15px;">é€‰æ‹©èƒŒæ™¯é¢œè‰²</div>
            <div class="bg-theme-options">
                <div class="bg-theme-option selected" style="background: #f9f9f9;" onclick="setBgTheme('#f9f9f9', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #f0f8ff;" onclick="setBgTheme('#f0f8ff', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #fff0f5;" onclick="setBgTheme('#fff0f5', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #f0fff0;" onclick="setBgTheme('#f0fff0', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #fffaf0;" onclick="setBgTheme('#fffaf0', '#fff', 100)"></div>
            </div>
            <div class="bg-intensity">
                <label for="bg-intensity">èƒŒæ™¯æ·±æµ…:</label>
                <input type="range" id="bg-intensity" min="20" max="100" value="100" oninput="changeBgIntensity(this.value)">
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">åŠ æ³•ç»ƒä¹ </div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="addition" data-level="1">ç®€å• (1ä½æ•°)</div>
                <div class="difficulty-option" data-type="addition" data-level="2">ä¸­ç­‰ (2ä½æ•°)</div>
                <div class="difficulty-option" data-type="addition" data-level="3">å›°éš¾ (3ä½æ•°)</div>
                <div class="difficulty-option" data-type="addition" data-level="custom" onclick="toggleCustomSettings('addition')">è‡ªå®šä¹‰</div>
            </div>
            <div class="custom-settings" id="addition-custom-settings">
                <div class="custom-setting-group">
                    <label for="addition-min-a">ç¬¬ä¸€ä¸ªæ•°æœ€å°å€¼:</label>
                    <input type="number" id="addition-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="addition-max-a">ç¬¬ä¸€ä¸ªæ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="addition-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="addition-min-b">ç¬¬äºŒä¸ªæ•°æœ€å°å€¼:</label>
                    <input type="number" id="addition-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="addition-max-b">ç¬¬äºŒä¸ªæ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="addition-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="addition-count">é¢˜ç›®æ•°é‡:</label>
                    <input type="number" id="addition-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="addition-timer">å€’è®¡æ—¶(ç§’):</label>
                    <input type="number" id="addition-timer" min="0" max="3600" value="0" placeholder="0è¡¨ç¤ºä¸é™æ—¶">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('addition')">ğŸ¯ å¼€å§‹ç»ƒä¹ </button>
                <button class="reset" onclick="resetQuiz('addition')">ğŸ”„ é‡ç½®</button>
            </div>
            <div id="addition-quiz" class="quiz-area"></div>
            <div id="addition-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">å‡æ³•ç»ƒä¹ </div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="subtraction" data-level="1">ç®€å• (1ä½æ•°)</div>
                <div class="difficulty-option" data-type="subtraction" data-level="2">ä¸­ç­‰ (2ä½æ•°)</div>
                <div class="difficulty-option" data-type="subtraction" data-level="3">å›°éš¾ (3ä½æ•°)</div>
                <div class="difficulty-option" data-type="subtraction" data-level="custom" onclick="toggleCustomSettings('subtraction')">è‡ªå®šä¹‰</div>
            </div>
            <div class="custom-settings" id="subtraction-custom-settings">
                <div class="custom-setting-group">
                    <label for="subtraction-min-a">è¢«å‡æ•°æœ€å°å€¼:</label>
                    <input type="number" id="subtraction-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="subtraction-max-a">è¢«å‡æ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="subtraction-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="subtraction-min-b">å‡æ•°æœ€å°å€¼:</label>
                    <input type="number" id="subtraction-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="subtraction-max-b">å‡æ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="subtraction-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="subtraction-count">é¢˜ç›®æ•°é‡:</label>
                    <input type="number" id="subtraction-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="subtraction-timer">å€’è®¡æ—¶(ç§’):</label>
                    <input type="number" id="subtraction-timer" min="0" max="3600" value="0" placeholder="0è¡¨ç¤ºä¸é™æ—¶">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('subtraction')">ğŸ¯ å¼€å§‹ç»ƒä¹ </button>
                <button class="reset" onclick="resetQuiz('subtraction')">ğŸ”„ é‡ç½®</button>
            </div>
            <div id="subtraction-quiz" class="quiz-area"></div>
            <div id="subtraction-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">ä¹˜æ³•ç»ƒä¹ </div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="multiplication" data-level="1">ç®€å• (1ä½æ•°Ã—1ä½æ•°)</div>
                <div class="difficulty-option" data-type="multiplication" data-level="2">ä¸­ç­‰ (2ä½æ•°Ã—1ä½æ•°)</div>
                <div class="difficulty-option" data-type="multiplication" data-level="3">å›°éš¾ (2ä½æ•°Ã—2ä½æ•°)</div>
                <div class="difficulty-option" data-type="multiplication" data-level="custom" onclick="toggleCustomSettings('multiplication')">è‡ªå®šä¹‰</div>
            </div>
            <div class="custom-settings" id="multiplication-custom-settings">
                <div class="custom-setting-group">
                    <label for="multiplication-min-a">ç¬¬ä¸€ä¸ªæ•°æœ€å°å€¼:</label>
                    <input type="number" id="multiplication-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="multiplication-max-a">ç¬¬ä¸€ä¸ªæ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="multiplication-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="multiplication-min-b">ç¬¬äºŒä¸ªæ•°æœ€å°å€¼:</label>
                    <input type="number" id="multiplication-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="multiplication-max-b">ç¬¬äºŒä¸ªæ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="multiplication-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="multiplication-count">é¢˜ç›®æ•°é‡:</label>
                    <input type="number" id="multiplication-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="multiplication-timer">å€’è®¡æ—¶(ç§’):</label>
                    <input type="number" id="multiplication-timer" min="0" max="3600" value="0" placeholder="0è¡¨ç¤ºä¸é™æ—¶">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('multiplication')">ğŸ¯ å¼€å§‹ç»ƒä¹ </button>
                <button class="reset" onclick="resetQuiz('multiplication')">ğŸ”„ é‡ç½®</button>
            </div>
            <div id="multiplication-quiz" class="quiz-area"></div>
            <div id="multiplication-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">é™¤æ³•ç»ƒä¹ </div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="division" data-level="1">ç®€å• (1ä½æ•°Ã·1ä½æ•°)</div>
                <div class="difficulty-option" data-type="division" data-level="2">ä¸­ç­‰ (2ä½æ•°Ã·1ä½æ•°)</div>
                <div class="difficulty-option" data-type="division" data-level="3">å›°éš¾ (2ä½æ•°Ã·2ä½æ•°)</div>
                <div class="difficulty-option" data-type="division" data-level="custom" onclick="toggleCustomSettings('division')">è‡ªå®šä¹‰</div>
            </div>
            <div class="custom-settings" id="division-custom-settings">
                <div class="custom-setting-group">
                    <label for="division-min-a">è¢«é™¤æ•°æœ€å°å€¼:</label>
                    <input type="number" id="division-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="division-max-a">è¢«é™¤æ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="division-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="division-min-b">é™¤æ•°æœ€å°å€¼:</label>
                    <input type="number" id="division-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="division-max-b">é™¤æ•°æœ€å¤§å€¼:</label>
                    <input type="number" id="division-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="division-count">é¢˜ç›®æ•°é‡:</label>
                    <input type="number" id="division-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="division-timer">å€’è®¡æ—¶(ç§’):</label>
                    <input type="number" id="division-timer" min="0" max="3600" value="0" placeholder="0è¡¨ç¤ºä¸é™æ—¶">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('division')">ğŸ¯ å¼€å§‹ç»ƒä¹ </button>
                <button class="reset" onclick="resetQuiz('division')">ğŸ”„ é‡ç½®</button>
            </div>
            <div id="division-quiz" class="quiz-area"></div>
            <div id="division-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">æ··åˆè¿ç®—ç»ƒä¹ </div>
            <div class="mixed-options">
                <div class="mixed-option" data-type="mixed" data-count="2">ä¸¤ç§è¿ç®—æ··åˆ</div>
                <div class="mixed-option" data-type="mixed" data-count="3">ä¸‰ç§è¿ç®—æ··åˆ</div>
                <div class="mixed-option" data-type="mixed" data-count="4">å››ç§è¿ç®—æ··åˆ</div>
            </div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="mixed" data-level="1">ç®€å• (1ä½æ•°)</div>
                <div class="difficulty-option" data-type="mixed" data-level="2">ä¸­ç­‰ (2ä½æ•°)</div>
                <div class="difficulty-option" data-type="mixed" data-level="3">å›°éš¾ (3ä½æ•°)</div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="mixed-count">é¢˜ç›®æ•°é‡:</label>
                    <input type="number" id="mixed-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="mixed-timer">å€’è®¡æ—¶(ç§’):</label>
                    <input type="number" id="mixed-timer" min="0" max="3600" value="0" placeholder="0è¡¨ç¤ºä¸é™æ—¶">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('mixed')">ğŸ¯ å¼€å§‹ç»ƒä¹ </button>
                <button class="reset" onclick="resetQuiz('mixed')">ğŸ”„ é‡ç½®</button>
            </div>
            <div id="mixed-quiz" class="quiz-area"></div>
            <div id="mixed-result" class="result"></div>
        </div>
        
        <div class="history">
            <div class="history-header">
                <h2>ç»ƒä¹ å†å²è®°å½•</h2>
                <div>
                    <button class="danger" onclick="clearAllHistory()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
                </div>
            </div>
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentQuiz = null;
        let selectedLevels = {
            addition: 1,
            subtraction: 1,
            multiplication: 1,
            division: 1,
            mixed: 1
        };
        let selectedMixedCount = 2;
        let history = JSON.parse(localStorage.getItem('mathQuizHistory')) || [];
        let timerInterval = null;
        let timeLeft = 0;
        let currentBgColor = '#f9f9f9';
        let currentCardBg = '#fff';
        let bgIntensity = 100;
        
        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®éš¾åº¦é€‰æ‹©ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const level = this.getAttribute('data-level');
                    
                    // å¦‚æœæ˜¯è‡ªå®šä¹‰éš¾åº¦ï¼Œä¸æ›´æ–°selectedLevels
                    if (level !== 'custom') {
                        selectedLevels[type] = parseInt(level);
                    }
                    
                    // ç§»é™¤åŒç±»å‹çš„æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll(`.difficulty-option[data-type="${type}"]`).forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
                    this.classList.add('selected');
                });
                
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªé€‰é¡¹
                if (option.getAttribute('data-level') === "1") {
                    option.classList.add('selected');
                }
            });
            
            // è®¾ç½®æ··åˆè¿ç®—é€‰æ‹©ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.mixed-option').forEach(option => {
                option.addEventListener('click', function() {
                    const count = parseInt(this.getAttribute('data-count'));
                    
                    // ç§»é™¤åŒç±»å‹çš„æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                    document.querySelectorAll('.mixed-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
                    this.classList.add('selected');
                    
                    // æ›´æ–°é€‰ä¸­çš„æ··åˆè¿ç®—æ•°é‡
                    selectedMixedCount = count;
                });
                
                // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªé€‰é¡¹
                if (option.getAttribute('data-count') === "2") {
                    option.classList.add('selected');
                }
            });
            
            // åŠ è½½å†å²è®°å½•
            renderHistory();
            
            // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
            loadTheme();
            
            // ç¦ç”¨æ‰€æœ‰å¼€å§‹ç»ƒä¹ æŒ‰é’®ä»¥å¤–çš„æŒ‰é’®
            disableOtherButtons();
            
            // åˆå§‹åŒ–è‡ªå®šä¹‰è®¾ç½®
            initializeCustomSettings();
        });
        
        // åˆå§‹åŒ–è‡ªå®šä¹‰è®¾ç½®
        function initializeCustomSettings() {
            // è®¾ç½®åŠ æ³•è‡ªå®šä¹‰èŒƒå›´çš„é»˜è®¤å€¼
            document.getElementById('addition-min-a').value = 1;
            document.getElementById('addition-max-a').value = 9;
            document.getElementById('addition-min-b').value = 1;
            document.getElementById('addition-max-b').value = 9;
            
            // è®¾ç½®å‡æ³•è‡ªå®šä¹‰èŒƒå›´çš„é»˜è®¤å€¼
            document.getElementById('subtraction-min-a').value = 1;
            document.getElementById('subtraction-max-a').value = 9;
            document.getElementById('subtraction-min-b').value = 1;
            document.getElementById('subtraction-max-b').value = 9;
            
            // è®¾ç½®ä¹˜æ³•è‡ªå®šä¹‰èŒƒå›´çš„é»˜è®¤å€¼
            document.getElementById('multiplication-min-a').value = 1;
            document.getElementById('multiplication-max-a').value = 9;
            document.getElementById('multiplication-min-b').value = 1;
            document.getElementById('multiplication-max-b').value = 9;
            
            // è®¾ç½®é™¤æ³•è‡ªå®šä¹‰èŒƒå›´çš„é»˜è®¤å€¼
            document.getElementById('division-min-a').value = 1;
            document.getElementById('division-max-a').value = 9;
            document.getElementById('division-min-b').value = 1;
            document.getElementById('division-max-b').value = 9;
        }
        
        // åˆ‡æ¢è‡ªå®šä¹‰è®¾ç½®æ˜¾ç¤º
        function toggleCustomSettings(type) {
            const customSettings = document.getElementById(`${type}-custom-settings`);
            customSettings.classList.toggle('active');
            
            // ç¡®ä¿è‡ªå®šä¹‰é€‰é¡¹è¢«é€‰ä¸­
            document.querySelectorAll(`.difficulty-option[data-type="${type}"]`).forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.difficulty-option[data-type="${type}"][data-level="custom"]`).classList.add('selected');
            
            // æ›´æ–°é€‰ä¸­çš„éš¾åº¦çº§åˆ«ä¸ºè‡ªå®šä¹‰
            selectedLevels[type] = 'custom';
        }
        
        // è®¾ç½®ä¸»é¢˜é¢œè‰²
        function setTheme(primary, success, danger, warning, light, dark, text) {
            document.documentElement.style.setProperty('--primary-color', primary);
            document.documentElement.style.setProperty('--success-color', success);
            document.documentElement.style.setProperty('--danger-color', danger);
            document.documentElement.style.setProperty('--warning-color', warning);
            document.documentElement.style.setProperty('--light-color', light);
            document.documentElement.style.setProperty('--dark-color', dark);
            document.documentElement.style.setProperty('--text-color', text);
            
            // æ›´æ–°ä¸»é¢˜é€‰é¡¹é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // ä¿å­˜ä¸»é¢˜
            localStorage.setItem('mathQuizTheme', JSON.stringify({
                primary, success, danger, warning, light, dark, text,
                bgColor: currentBgColor,
                cardBg: currentCardBg,
                bgIntensity: bgIntensity
            }));
        }
        
        // è®¾ç½®èƒŒæ™¯é¢œè‰²
        function setBgTheme(bg, cardBg, intensity) {
            currentBgColor = bg;
            currentCardBg = cardBg;
            bgIntensity = intensity;
            
            // è®¡ç®—å®é™…é¢œè‰²å€¼
            const actualBgColor = adjustColorIntensity(bg, intensity);
            const actualCardBg = adjustColorIntensity(cardBg, intensity);
            
            document.documentElement.style.setProperty('--bg-color', actualBgColor);
            document.documentElement.style.setProperty('--card-bg', actualCardBg);
            
            // æ›´æ–°èƒŒæ™¯ä¸»é¢˜é€‰é¡¹é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.bg-theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // æ›´æ–°æ»‘å—å€¼
            document.getElementById('bg-intensity').value = intensity;
            
            // ä¿å­˜èƒŒæ™¯ä¸»é¢˜
            const savedTheme = JSON.parse(localStorage.getItem('mathQuizTheme')) || {};
            savedTheme.bgColor = bg;
            savedTheme.cardBg = cardBg;
            savedTheme.bgIntensity = intensity;
            localStorage.setItem('mathQuizTheme', JSON.stringify(savedTheme));
        }
        
        // è°ƒæ•´é¢œè‰²æ·±æµ…
        function changeBgIntensity(intensity) {
            bgIntensity = parseInt(intensity);
            const actualBgColor = adjustColorIntensity(currentBgColor, bgIntensity);
            const actualCardBg = adjustColorIntensity(currentCardBg, bgIntensity);
            
            document.documentElement.style.setProperty('--bg-color', actualBgColor);
            document.documentElement.style.setProperty('--card-bg', actualCardBg);
            
            // ä¿å­˜èƒŒæ™¯æ·±æµ…
            const savedTheme = JSON.parse(localStorage.getItem('mathQuizTheme')) || {};
            savedTheme.bgIntensity = bgIntensity;
            localStorage.setItem('mathQuizTheme', JSON.stringify(savedTheme));
        }
        
        // è°ƒæ•´é¢œè‰²å¼ºåº¦
        function adjustColorIntensity(color, intensity) {
            if (color === '#fff' || color === '#ffffff') return color;
            
            // å°†åå…­è¿›åˆ¶é¢œè‰²è½¬æ¢ä¸ºRGB
            let r = parseInt(color.substr(1, 2), 16);
            let g = parseInt(color.substr(3, 2), 16);
            let b = parseInt(color.substr(5, 2), 16);
            
            // è®¡ç®—ä¸­é—´å€¼
            const midR = 128;
            const midG = 128;
            const midB = 128;
            
            // è°ƒæ•´å¼ºåº¦
            r = Math.round(midR + (r - midR) * (intensity / 100));
            g = Math.round(midG + (g - midG) * (intensity / 100));
            b = Math.round(midB + (b - midB) * (intensity / 100));
            
            // ç¡®ä¿å€¼åœ¨0-255èŒƒå›´å†…
            r = Math.max(0, Math.min(255, r));
            g = Math.max(0, Math.min(255, g));
            b = Math.max(0, Math.min(255, b));
            
            // è½¬æ¢å›åå…­è¿›åˆ¶
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        }
        
        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
        function loadTheme() {
            const savedTheme = JSON.parse(localStorage.getItem('mathQuizTheme'));
            if (savedTheme) {
                setTheme(
                    savedTheme.primary,
                    savedTheme.success,
                    savedTheme.danger,
                    savedTheme.warning,
                    savedTheme.light,
                    savedTheme.dark,
                    savedTheme.text
                );
                
                // è®¾ç½®èƒŒæ™¯é¢œè‰²
                if (savedTheme.bgColor) {
                    currentBgColor = savedTheme.bgColor;
                    currentCardBg = savedTheme.cardBg || '#fff';
                    bgIntensity = savedTheme.bgIntensity || 100;
                    
                    const bgOption = Array.from(document.querySelectorAll('.bg-theme-option')).find(
                        option => option.style.backgroundColor === savedTheme.bgColor
                    );
                    if (bgOption) {
                        bgOption.classList.add('selected');
                    }
                    
                    // åº”ç”¨èƒŒæ™¯é¢œè‰²å’Œå¼ºåº¦
                    const actualBgColor = adjustColorIntensity(savedTheme.bgColor, bgIntensity);
                    const actualCardBg = adjustColorIntensity(savedTheme.cardBg || '#fff', bgIntensity);
                    
                    document.documentElement.style.setProperty('--bg-color', actualBgColor);
                    document.documentElement.style.setProperty('--card-bg', actualCardBg);
                    
                    // è®¾ç½®æ»‘å—å€¼
                    document.getElementById('bg-intensity').value = bgIntensity;
                }
            }
        }
        
        // ç¦ç”¨å…¶ä»–æŒ‰é’®
        function disableOtherButtons() {
            if (currentQuiz) {
                // ç¦ç”¨æ‰€æœ‰å¼€å§‹ç»ƒä¹ æŒ‰é’®
                document.querySelectorAll('button:not(.reset)').forEach(btn => {
                    if (!btn.closest(`#${currentQuiz}-quiz`) && !btn.closest(`#${currentQuiz}-result`) && 
                        !btn.closest('.history-header') && !btn.closest('.theme-selector')) {
                        btn.disabled = true;
                    }
                });
                
                // ç¦ç”¨æ‰€æœ‰è¾“å…¥æ¡†
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    if (!input.closest(`#${currentQuiz}-quiz`)) {
                        input.disabled = true;
                    }
                });
                
                // ç¦ç”¨æ‰€æœ‰éš¾åº¦é€‰é¡¹
                document.querySelectorAll('.difficulty-option, .mixed-option').forEach(option => {
                    option.style.pointerEvents = 'none';
                    option.style.opacity = '0.6';
                });
            } else {
                // å¯ç”¨æ‰€æœ‰æŒ‰é’®
                document.querySelectorAll('button').forEach(btn => {
                    btn.disabled = false;
                });
                
                // å¯ç”¨æ‰€æœ‰è¾“å…¥æ¡†
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.disabled = false;
                });
                
                // å¯ç”¨æ‰€æœ‰éš¾åº¦é€‰é¡¹
                document.querySelectorAll('.difficulty-option, .mixed-option').forEach(option => {
                    option.style.pointerEvents = 'auto';
                    option.style.opacity = '1';
                });
            }
        }
        
        // å¼€å§‹ç»ƒä¹ 
        function startQuiz(type) {
            const count = parseInt(document.getElementById(`${type}-count`).value);
            const level = selectedLevels[type];
            const timerSeconds = parseInt(document.getElementById(`${type}-timer`).value) || 0;
            
            // éªŒè¯é¢˜ç›®æ•°é‡
            if (isNaN(count) || count < 1 || count > 50) {
                alert('è¯·è¾“å…¥1-50ä¹‹é—´çš„é¢˜ç›®æ•°é‡ï¼');
                return;
            }
            
            // æ¸…é™¤ä¹‹å‰çš„è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // è®¾ç½®å½“å‰ç»ƒä¹ ç±»å‹
            currentQuiz = type;
            disableOtherButtons();
            
            // ç”Ÿæˆé¢˜ç›®
            const questions = type === 'mixed' 
                ? generateMixedQuestions(selectedMixedCount, level, count)
                : generateQuestions(type, level, count);
            
            // æ˜¾ç¤ºç»ƒä¹ åŒºåŸŸ
            const quizArea = document.getElementById(`${type}-quiz`);
            quizArea.style.display = 'block';
            quizArea.innerHTML = '';
            
            // è®¾ç½®å€’è®¡æ—¶
            if (timerSeconds > 0) {
                timeLeft = timerSeconds;
                updateTimerDisplay(type);
                
                const timerDisplay = document.createElement('div');
                timerDisplay.className = 'timer-display';
                timerDisplay.id = `${type}-timer-display`;
                timerDisplay.textContent = `å‰©ä½™æ—¶é—´: ${formatTime(timeLeft)}`;
                quizArea.appendChild(timerDisplay);
                
                // å¯åŠ¨è®¡æ—¶å™¨
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay(type);
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        document.getElementById(`${type}-timer-display`).textContent = 'æ—¶é—´åˆ°ï¼';
                        document.getElementById(`${type}-timer-display`).className = 'timer-display final-countdown';
                        setTimeout(() => {
                            checkAnswers(type, questions, true);
                        }, 1000);
                    }
                }, 1000);
            }
            
            // æ˜¾ç¤ºè¿›åº¦æ¡
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            const progress = document.createElement('div');
            progress.className = 'progress';
            progress.style.width = '0%';
            progressBar.appendChild(progress);
            quizArea.appendChild(progressBar);
            
            // æ·»åŠ é¢˜ç›®
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <span>${index + 1}. ${q.expression} = </span>
                    <input type="number" id="${type}-answer-${index}" data-answer="${q.answer}" step="any">
                    <span id="${type}-feedback-${index}" style="margin-left: 10px;"></span>
                `;
                quizArea.appendChild(questionDiv);
            });
            
            // æ·»åŠ æäº¤æŒ‰é’®
            const submitButton = document.createElement('button');
            submitButton.textContent = 'âœ… æäº¤ç­”æ¡ˆ';
            submitButton.onclick = function() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                checkAnswers(type, questions, false);
            };
            quizArea.appendChild(submitButton);
            
            // éšè—ç»“æœåŒºåŸŸ
            document.getElementById(`${type}-result`).style.display = 'none';
        }
        
        // é‡ç½®ç»ƒä¹ 
        function resetQuiz(type) {
            // æ¸…é™¤è®¡æ—¶å™¨
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // éšè—ç»ƒä¹ åŒºåŸŸå’Œç»“æœåŒºåŸŸ
            document.getElementById(`${type}-quiz`).style.display = 'none';
            document.getElementById(`${type}-result`).style.display = 'none';
            
            // é‡ç½®å½“å‰ç»ƒä¹ 
            currentQuiz = null;
            disableOtherButtons();
        }
        
        // ç”Ÿæˆæ··åˆè¿ç®—é¢˜ç›®
        function generateMixedQuestions(count, level, total) {
            const questions = [];
            const operations = [];
            
            // æ ¹æ®é€‰æ‹©çš„æ··åˆæ•°é‡ç¡®å®šåŒ…å«å“ªäº›è¿ç®—
            if (count >= 1) operations.push('addition');
            if (count >= 2) operations.push('subtraction');
            if (count >= 3) operations.push('multiplication');
            if (count >= 4) operations.push('division');
            
            for (let i = 0; i < total; i++) {
                // éšæœºé€‰æ‹©ä¸€ç§è¿ç®—
                const type = operations[Math.floor(Math.random() * operations.length)];
                
                let a, b, answer, expression;
                
                switch (type) {
                    case 'addition':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * 900) + 100;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('addition-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('addition-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('addition-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('addition-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a + b;
                        expression = `${a} + ${b}`;
                        break;
                    
                    case 'subtraction':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('subtraction-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('subtraction-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('subtraction-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('subtraction-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (Math.min(a, maxB) - minB + 1)) + minB;
                        }
                        answer = a - b;
                        expression = `${a} - ${b}`;
                        break;
                    
                    case 'multiplication':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('multiplication-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('multiplication-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('multiplication-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('multiplication-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a * b;
                        expression = `${a} Ã— ${b}`;
                        break;
                    
                    case 'division':
                        if (level === 1) {
                            b = Math.floor(Math.random() * 8) + 2;
                            a = b * (Math.floor(Math.random() * 8) + 1);
                        } else if (level === 2) {
                            b = Math.floor(Math.random() * 9) + 1;
                            a = b * (Math.floor(Math.random() * 90) + 10);
                        } else if (level === 3) {
                            b = Math.floor(Math.random() * 90) + 10;
                            a = b * (Math.floor(Math.random() * 9) + 1);
                        } else if (level === 'custom') {
                            const minB = parseInt(document.getElementById('division-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('division-max-b').value) || 9;
                            const minA = parseInt(document.getElementById('division-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('division-max-a').value) || 9;
                            
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                            if (b === 0) b = 1; // é¿å…é™¤æ•°ä¸º0
                            
                            // ç¡®ä¿aæ˜¯bçš„å€æ•°
                            const minMultiplier = Math.ceil(minA / b);
                            const maxMultiplier = Math.floor(maxA / b);
                            
                            if (minMultiplier > maxMultiplier) {
                                // å¦‚æœèŒƒå›´æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤å€¼
                                b = Math.floor(Math.random() * 8) + 2;
                                a = b * (Math.floor(Math.random() * 8) + 1);
                            } else {
                                const multiplier = Math.floor(Math.random() * (maxMultiplier - minMultiplier + 1)) + minMultiplier;
                                a = b * multiplier;
                            }
                        }
                        answer = a / b;
                        expression = `${a} Ã· ${b}`;
                        break;
                }
                
                questions.push({
                    type: type,
                    expression: expression,
                    answer: answer,
                    userAnswer: null,
                    isCorrect: false
                });
            }
            
            return questions;
        }
        
        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay(type) {
            const timerDisplay = document.getElementById(`${type}-timer-display`);
            if (timerDisplay) {
                timerDisplay.textContent = `å‰©ä½™æ—¶é—´: ${formatTime(timeLeft)}`;
                
                if (timeLeft <= 30) {
                    timerDisplay.className = 'timer-display final-countdown';
                }
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // ç”Ÿæˆé¢˜ç›®
        function generateQuestions(type, level, count) {
            const questions = [];
            
            for (let i = 0; i < count; i++) {
                let a, b, answer, expression;
                
                switch (type) {
                    case 'addition':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * 900) + 100;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('addition-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('addition-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('addition-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('addition-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a + b;
                        expression = `${a} + ${b}`;
                        break;
                    
                    case 'subtraction':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('subtraction-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('subtraction-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('subtraction-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('subtraction-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (Math.min(a, maxB) - minB + 1)) + minB;
                        }
                        answer = a - b;
                        expression = `${a} - ${b}`;
                        break;
                    
                    case 'multiplication':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('multiplication-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('multiplication-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('multiplication-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('multiplication-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a * b;
                        expression = `${a} Ã— ${b}`;
                        break;
                    
                    case 'division':
                        if (level === 1) {
                            b = Math.floor(Math.random() * 8) + 2;
                            a = b * (Math.floor(Math.random() * 8) + 1);
                        } else if (level === 2) {
                            b = Math.floor(Math.random() * 9) + 1;
                            a = b * (Math.floor(Math.random() * 90) + 10);
                        } else if (level === 3) {
                            b = Math.floor(Math.random() * 90) + 10;
                            a = b * (Math.floor(Math.random() * 9) + 1);
                        } else if (level === 'custom') {
                            const minB = parseInt(document.getElementById('division-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('division-max-b').value) || 9;
                            const minA = parseInt(document.getElementById('division-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('division-max-a').value) || 9;
                            
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                            if (b === 0) b = 1; // é¿å…é™¤æ•°ä¸º0
                            
                            // ç¡®ä¿aæ˜¯bçš„å€æ•°
                            const minMultiplier = Math.ceil(minA / b);
                            const maxMultiplier = Math.floor(maxA / b);
                            
                            if (minMultiplier > maxMultiplier) {
                                // å¦‚æœèŒƒå›´æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤å€¼
                                b = Math.floor(Math.random() * 8) + 2;
                                a = b * (Math.floor(Math.random() * 8) + 1);
                            } else {
                                const multiplier = Math.floor(Math.random() * (maxMultiplier - minMultiplier + 1)) + minMultiplier;
                                a = b * multiplier;
                            }
                        }
                        answer = a / b;
                        expression = `${a} Ã· ${b}`;
                        break;
                }
                
                questions.push({
                    type: type,
                    expression: expression,
                    answer: answer,
                    userAnswer: null,
                    isCorrect: false
                });
            }
            
            return questions;
        }
        
        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswers(type, questions, isTimeUp) {
            let answeredCount = 0;
            let correctCount = 0;
            
            // è®¡ç®—å¾—åˆ†
            questions.forEach((q, index) => {
                const answerInput = document.getElementById(`${type}-answer-${index}`);
                const feedbackSpan = document.getElementById(`${type}-feedback-${index}`);
                
                const userAnswer = parseFloat(answerInput.value);
                q.userAnswer = isNaN(userAnswer) ? null : userAnswer;
                
                if (q.userAnswer !== null) {
                    answeredCount++;
                }
                
                // æ£€æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ï¼ˆå…è®¸å°æ•°é™¤æ³•æœ‰å¾®å°è¯¯å·®ï¼‰
                const isCorrect = q.userAnswer !== null && 
                                (q.type === 'division' 
                                    ? Math.abs(userAnswer - q.answer) < 0.001 
                                    : userAnswer === q.answer);
                
                q.isCorrect = isCorrect;
                
                if (isCorrect) {
                    correctCount++;
                    feedbackSpan.textContent = 'âœ“ æ­£ç¡®';
                    feedbackSpan.className = 'correct';
                } else if (q.userAnswer !== null) {
                    feedbackSpan.textContent = `âœ— é”™è¯¯ (æ­£ç¡®ç­”æ¡ˆ: ${q.answer})`;
                    feedbackSpan.className = 'incorrect';
                } else {
                    feedbackSpan.textContent = `æœªä½œç­” (æ­£ç¡®ç­”æ¡ˆ: ${q.answer})`;
                    feedbackSpan.className = 'incorrect';
                }
            });
            
            // è®¡ç®—å¾—åˆ†ï¼ˆæ»¡åˆ†100åˆ†ï¼Œæ¯é¢˜åˆ†å€¼å‡åˆ†ï¼‰
            const score = Math.round((correctCount / questions.length) * 100);
            
            // æ˜¾ç¤ºç»“æœ
            const resultDiv = document.getElementById(`${type}-result`);
            resultDiv.style.display = 'block';
            
            let timeInfo = '';
            if (parseInt(document.getElementById(`${type}-timer`).value) > 0) {
                const timeUsed = timeLeft > 0 ? (parseInt(document.getElementById(`${type}-timer`).value) - timeLeft) : parseInt(document.getElementById(`${type}-timer`).value);
                timeInfo = `<p>ç”¨æ—¶: ${formatTime(timeUsed)} / ${formatTime(parseInt(document.getElementById(`${type}-timer`).value))}</p>`;
            }
            
            resultDiv.innerHTML = `
                <h3>ç»ƒä¹ ç»“æœ</h3>
                ${isTimeUp ? '<p class="incorrect">æ—¶é—´åˆ°ï¼</p>' : ''}
                <p>å…± ${questions.length} é¢˜ï¼Œç­”å¯¹ ${correctCount} é¢˜ï¼Œå¾—åˆ†: <strong>${score}åˆ†</strong></p>
                ${timeInfo}
                <div class="progress-bar"><div class="progress" style="width: ${score}%"></div></div>
                <div class="result-actions">
                    <button onclick="saveResult('${type}', ${score}, ${questions.length}, ${timeLeft})">ğŸ’¾ ä¿å­˜æˆç»©</button>
                    <button class="secondary" onclick="location.reload()">ğŸ”„ è¿”å›</button>
                </div>
            `;
            
            // æ›´æ–°è¿›åº¦æ¡
            const progress = document.querySelector(`#${type}-quiz .progress`);
            progress.style.width = `${score}%`;
            
            // é‡ç½®å½“å‰ç»ƒä¹ 
            currentQuiz = null;
            disableOtherButtons();
        }
        
        // ä¿å­˜æˆç»©åˆ°å†å²è®°å½•
        function saveResult(type, score, totalQuestions, timeUsed = 0) {
            const now = new Date();
            const dateStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            
            let typeName = '';
            let levelName = '';
            
            switch (type) {
                case 'addition':
                    typeName = 'åŠ æ³•';
                    break;
                case 'subtraction':
                    typeName = 'å‡æ³•';
                    break;
                case 'multiplication':
                    typeName = 'ä¹˜æ³•';
                    break;
                case 'division':
                    typeName = 'é™¤æ³•';
                    break;
                case 'mixed':
                    typeName = `${selectedMixedCount}ç§æ··åˆè¿ç®—`;
                    break;
            }
            
            switch (selectedLevels[type]) {
                case 1:
                    levelName = 'ç®€å•';
                    break;
                case 2:
                    levelName = 'ä¸­ç­‰';
                    break;
                case 3:
                    levelName = 'å›°éš¾';
                    break;
                case 'custom':
                    levelName = 'è‡ªå®šä¹‰';
                    break;
            }
            
            const record = {
                id: Date.now(),
                date: dateStr,
                type: typeName,
                level: levelName,
                score: score,
                total: totalQuestions,
                timeUsed: timeUsed,
                timerSet: parseInt(document.getElementById(`${type}-timer`).value) || 0,
                details: []
            };
            
            // è·å–é¢˜ç›®è¯¦æƒ…
            const quizArea = document.getElementById(`${type}-quiz`);
            const questionInputs = quizArea.querySelectorAll('input[type="number"]');
            
            questionInputs.forEach((input, index) => {
                const answer = parseFloat(input.getAttribute('data-answer'));
                const userAnswer = parseFloat(input.value) || null;
                const questionText = input.previousSibling.textContent.trim();
                const isCorrect = userAnswer !== null && 
                                 (type === 'division' 
                                     ? Math.abs(userAnswer - answer) < 0.001 
                                     : userAnswer === answer);
                
                record.details.push({
                    question: `${index + 1}. ${questionText}`,
                    expression: questionText.replace(/^\d+\.\s/, '').replace(/\s=\s$/, ''),
                    answer: answer,
                    userAnswer: userAnswer,
                    isCorrect: isCorrect
                });
            });
            
            // æ·»åŠ åˆ°å†å²è®°å½•
            history.unshift(record);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('mathQuizHistory', JSON.stringify(history));
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            renderHistory();
            
            alert('æˆç»©å·²ä¿å­˜åˆ°å†å²è®°å½•ï¼');
        }
        
        // æ¸²æŸ“å†å²è®°å½•
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-history">
                        <i>ğŸ“š</i>
                        <p>æš‚æ— ç»ƒä¹ å†å²è®°å½•</p>
                        <p>å¼€å§‹ç»ƒä¹ åï¼Œä½ çš„æˆç»©å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                    </div>
                `;
                return;
            }
            
            history.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'history-item';
                
                const correctRate = Math.round((record.score / 100) * record.total);
                const incorrectRate = record.total - correctRate;
                const timeInfo = record.timerSet > 0 
                    ? `ç”¨æ—¶: ${formatTime(record.timeUsed)} / ${formatTime(record.timerSet)}` 
                    : 'ä¸é™æ—¶';
                
                recordDiv.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-date">${record.date}</div>
                        <div class="history-item-type">${record.type}ç»ƒä¹ </div>
                    </div>
                    <div class="history-item-body">
                        <div>
                            <span class="history-item-level">${record.level}éš¾åº¦</span>
                            <div>${timeInfo}</div>
                        </div>
                        <div class="history-item-score">${record.score}åˆ†</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" style="width: ${record.score}%"></div>
                    </div>
                    <div>æ­£ç¡®: ${correctRate}é¢˜ | é”™è¯¯: ${incorrectRate}é¢˜</div>
                    <div class="history-item-actions">
                        <button onclick="showDetails(${record.id})">ğŸ” æŸ¥çœ‹è¯¦æƒ…</button>
                        <button class="warning" onclick="deleteRecord(${record.id})">ğŸ—‘ï¸ åˆ é™¤è®°å½•</button>
                    </div>
                    <div id="details-${record.id}" class="question-details"></div>
                `;
                
                historyList.appendChild(recordDiv);
            });
        }
        
        // æ˜¾ç¤ºå†å²è®°å½•è¯¦æƒ…
        function showDetails(id) {
            const detailsDiv = document.getElementById(`details-${id}`);
            const record = history.find(r => r.id === id);
            
            if (detailsDiv.style.display === 'none' || !detailsDiv.style.display) {
                detailsDiv.style.display = 'block';
                let detailsHtml = '<h4>é¢˜ç›®è¯¦æƒ…:</h4>';
                
                record.details.forEach(detail => {
                    const answerText = detail.isCorrect 
                        ? '<span class="correct">âœ“ æ­£ç¡®</span>' 
                        : `<span class="incorrect">âœ— é”™è¯¯ (ä½ çš„ç­”æ¡ˆ: ${detail.userAnswer || "æœªä½œç­”"}, æ­£ç¡®ç­”æ¡ˆ: ${detail.answer})</span>`;
                    
                    detailsHtml += `
                        <div class="question-detail-item">
                            <span>${detail.question.replace(/=\s*$/, '')}</span>
                            ${answerText}
                        </div>
                    `;
                });
                
                detailsDiv.innerHTML = detailsHtml;
            } else {
                detailsDiv.style.display = 'none';
                detailsDiv.innerHTML = '';
            }
        }
        
        // åˆ é™¤å•ä¸ªå†å²è®°å½•
        function deleteRecord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                history = history.filter(record => record.id !== id);
                localStorage.setItem('mathQuizHistory', JSON.stringify(history));
                renderHistory();
            }
        }
        
        // æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•
        function clearAllHistory() {
            if (history.length === 0) {
                alert('æ²¡æœ‰å¯æ¸…é™¤çš„å†å²è®°å½•ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                history = [];
                localStorage.removeItem('mathQuizHistory');
                renderHistory();
            }
        }
    </script>
</body>
</html>