<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÂ≠¶ÁîüÊï∞Â≠¶ÁªÉ‰π†Â∑•ÂÖ∑</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --card-bg: #fff;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        body {
            font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
        }
        
        h1 {
            color: var(--dark-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
        }
        
        .container {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 12px;
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            border: 1px solid #eee;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .section:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "";
            display: inline-block;
            width: 8px;
            height: 20px;
            background: linear-gradient(to bottom, var(--primary-color), var(--success-color));
            margin-right: 10px;
            border-radius: 4px;
        }
        
        .difficulty-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .difficulty-option {
            padding: 8px 18px;
            background-color: var(--light-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .difficulty-option:hover {
            background-color: #d5dbdb;
            transform: translateY(-2px);
        }
        
        .difficulty-option.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .settings-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 15px;
        }
        
        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 180px;
        }
        
        .setting-group label {
            font-weight: 500;
            color: var(--dark-color);
            white-space: nowrap;
        }
        
        input[type="number"], input[type="text"] {
            width: 70px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input[type="number"]:focus, input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-width: 120px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
            opacity: 0.9;
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        button.secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }
        
        button.danger {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
        }
        
        button.warning {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }
        
        button.reset {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }
        
        .quiz-area {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .timer-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
            padding: 10px;
            background-color: rgba(52, 152, 219, 0.1);
            border-radius: 8px;
        }
        
        .timer-display.final-countdown {
            color: var(--danger-color);
            animation: pulse 1s infinite;
        }
        
        .question {
            margin-bottom: 15px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .question:hover {
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .question input {
            width: 100px;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .question input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .result {
            display: none;
            margin-top: 25px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid var(--success-color);
            animation: fadeIn 0.5s ease;
        }
        
        .result h3 {
            margin-top: 0;
            color: var(--dark-color);
            font-size: 1.3rem;
        }
        
        .result-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .history {
            margin-top: 40px;
            animation: fadeIn 0.5s ease;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .history h2 {
            color: var(--dark-color);
            font-size: 1.5rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .history h2::before {
            content: "üìö";
        }
        
        .history-item {
            margin-bottom: 15px;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }
        
        .history-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .history-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .history-item-date {
            font-weight: bold;
            color: var(--dark-color);
            font-size: 1.1rem;
        }
        
        .history-item-type {
            background-color: var(--light-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .history-item-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .history-item-level {
            color: var(--gray-color);
            font-size: 0.9rem;
        }
        
        .history-item-score {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--success-color);
        }
        
        .history-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .progress-bar {
            height: 12px;
            background-color: #ecf0f1;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), #27ae60);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .correct {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .incorrect {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .question-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed #eee;
            animation: fadeIn 0.3s ease;
        }
        
        .question-detail-item {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .question-detail-item span:first-child {
            flex: 1;
        }
        
        .empty-history {
            text-align: center;
            padding: 30px;
            color: var(--gray-color);
        }
        
        .empty-history i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
            color: var(--light-color);
        }
        
        .theme-selector {
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }
        
        .theme-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .theme-option:hover {
            transform: scale(1.1);
        }
        
        .theme-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }
        
        .bg-theme-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .bg-theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .bg-theme-option:hover {
            transform: scale(1.1);
        }
        
        .bg-theme-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }
        
        .mixed-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .mixed-option {
            padding: 8px 18px;
            background-color: var(--light-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--dark-color);
        }
        
        .mixed-option:hover {
            background-color: #d5dbdb;
            transform: translateY(-2px);
        }
        
        .mixed-option.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--success-color));
            color: white;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .bg-intensity {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bg-intensity input[type="range"] {
            width: 150px;
        }
        
        .custom-settings {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px dashed #ddd;
        }
        
        .custom-settings.active {
            display: block;
        }
        
        .custom-setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .custom-setting-group label {
            min-width: 100px;
            font-weight: 500;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .section {
                padding: 15px;
            }
            
            .difficulty-options, .mixed-options {
                flex-direction: column;
            }
            
            .settings-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .history-item-header, .history-item-body {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .button-group, .result-actions, .history-item-actions {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .custom-setting-group {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .custom-setting-group label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Â∞èÂ≠¶ÁîüÊï∞Â≠¶ÁªÉ‰π†Â∑•ÂÖ∑</h1>
        
        <div class="theme-selector">
            <div class="section-title">ÈÄâÊã©‰∏ªÈ¢òÈ¢úËâ≤</div>
            <div class="theme-options">
                <div class="theme-option selected" style="background: linear-gradient(135deg, #3498db, #2ecc71);" onclick="setTheme('#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #9b59b6, #e74c3c);" onclick="setTheme('#9b59b6', '#e74c3c', '#f39c12', '#3498db', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #f39c12, #e74c3c);" onclick="setTheme('#f39c12', '#e74c3c', '#9b59b6', '#3498db', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #1abc9c, #3498db);" onclick="setTheme('#1abc9c', '#3498db', '#e74c3c', '#f39c12', '#ecf0f1', '#2c3e50', '#333')"></div>
                <div class="theme-option" style="background: linear-gradient(135deg, #e74c3c, #f39c12);" onclick="setTheme('#e74c3c', '#f39c12', '#3498db', '#2ecc71', '#ecf0f1', '#2c3e50', '#333')"></div>
            </div>
            <div class="section-title" style="margin-top: 15px;">ÈÄâÊã©ËÉåÊôØÈ¢úËâ≤</div>
            <div class="bg-theme-options">
                <div class="bg-theme-option selected" style="background: #f9f9f9;" onclick="setBgTheme('#f9f9f9', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #f0f8ff;" onclick="setBgTheme('#f0f8ff', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #fff0f5;" onclick="setBgTheme('#fff0f5', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #f0fff0;" onclick="setBgTheme('#f0fff0', '#fff', 100)"></div>
                <div class="bg-theme-option" style="background: #fffaf0;" onclick="setBgTheme('#fffaf0', '#fff', 100)"></div>
            </div>
            <div class="bg-intensity">
                <label for="bg-intensity">ËÉåÊôØÊ∑±ÊµÖ:</label>
                <input type="range" id="bg-intensity" min="20" max="100" value="100" oninput="changeBgIntensity(this.value)">
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">Âä†Ê≥ïÁªÉ‰π†</div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="addition" data-level="1">ÁÆÄÂçï (1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="addition" data-level="2">‰∏≠Á≠â (2‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="addition" data-level="3">Âõ∞Èöæ (3‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="addition" data-level="custom" onclick="toggleCustomSettings('addition')">Ëá™ÂÆö‰πâ</div>
            </div>
            <div class="custom-settings" id="addition-custom-settings">
                <div class="custom-setting-group">
                    <label for="addition-min-a">Á¨¨‰∏Ä‰∏™Êï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="addition-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="addition-max-a">Á¨¨‰∏Ä‰∏™Êï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="addition-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="addition-min-b">Á¨¨‰∫å‰∏™Êï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="addition-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="addition-max-b">Á¨¨‰∫å‰∏™Êï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="addition-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="addition-count">È¢òÁõÆÊï∞Èáè:</label>
                    <input type="number" id="addition-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="addition-timer">ÂÄíËÆ°Êó∂(Áßí):</label>
                    <input type="number" id="addition-timer" min="0" max="3600" value="0" placeholder="0Ë°®Á§∫‰∏çÈôêÊó∂">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('addition')">üéØ ÂºÄÂßãÁªÉ‰π†</button>
                <button class="reset" onclick="resetQuiz('addition')">üîÑ ÈáçÁΩÆ</button>
            </div>
            <div id="addition-quiz" class="quiz-area"></div>
            <div id="addition-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">ÂáèÊ≥ïÁªÉ‰π†</div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="subtraction" data-level="1">ÁÆÄÂçï (1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="subtraction" data-level="2">‰∏≠Á≠â (2‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="subtraction" data-level="3">Âõ∞Èöæ (3‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="subtraction" data-level="custom" onclick="toggleCustomSettings('subtraction')">Ëá™ÂÆö‰πâ</div>
            </div>
            <div class="custom-settings" id="subtraction-custom-settings">
                <div class="custom-setting-group">
                    <label for="subtraction-min-a">Ë¢´ÂáèÊï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="subtraction-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="subtraction-max-a">Ë¢´ÂáèÊï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="subtraction-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="subtraction-min-b">ÂáèÊï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="subtraction-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="subtraction-max-b">ÂáèÊï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="subtraction-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="subtraction-count">È¢òÁõÆÊï∞Èáè:</label>
                    <input type="number" id="subtraction-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="subtraction-timer">ÂÄíËÆ°Êó∂(Áßí):</label>
                    <input type="number" id="subtraction-timer" min="0" max="3600" value="0" placeholder="0Ë°®Á§∫‰∏çÈôêÊó∂">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('subtraction')">üéØ ÂºÄÂßãÁªÉ‰π†</button>
                <button class="reset" onclick="resetQuiz('subtraction')">üîÑ ÈáçÁΩÆ</button>
            </div>
            <div id="subtraction-quiz" class="quiz-area"></div>
            <div id="subtraction-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">‰πòÊ≥ïÁªÉ‰π†</div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="multiplication" data-level="1">ÁÆÄÂçï (1‰ΩçÊï∞√ó1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="multiplication" data-level="2">‰∏≠Á≠â (2‰ΩçÊï∞√ó1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="multiplication" data-level="3">Âõ∞Èöæ (2‰ΩçÊï∞√ó2‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="multiplication" data-level="custom" onclick="toggleCustomSettings('multiplication')">Ëá™ÂÆö‰πâ</div>
            </div>
            <div class="custom-settings" id="multiplication-custom-settings">
                <div class="custom-setting-group">
                    <label for="multiplication-min-a">Á¨¨‰∏Ä‰∏™Êï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="multiplication-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="multiplication-max-a">Á¨¨‰∏Ä‰∏™Êï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="multiplication-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="multiplication-min-b">Á¨¨‰∫å‰∏™Êï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="multiplication-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="multiplication-max-b">Á¨¨‰∫å‰∏™Êï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="multiplication-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="multiplication-count">È¢òÁõÆÊï∞Èáè:</label>
                    <input type="number" id="multiplication-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="multiplication-timer">ÂÄíËÆ°Êó∂(Áßí):</label>
                    <input type="number" id="multiplication-timer" min="0" max="3600" value="0" placeholder="0Ë°®Á§∫‰∏çÈôêÊó∂">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('multiplication')">üéØ ÂºÄÂßãÁªÉ‰π†</button>
                <button class="reset" onclick="resetQuiz('multiplication')">üîÑ ÈáçÁΩÆ</button>
            </div>
            <div id="multiplication-quiz" class="quiz-area"></div>
            <div id="multiplication-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">Èô§Ê≥ïÁªÉ‰π†</div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="division" data-level="1">ÁÆÄÂçï (1‰ΩçÊï∞√∑1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="division" data-level="2">‰∏≠Á≠â (2‰ΩçÊï∞√∑1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="division" data-level="3">Âõ∞Èöæ (2‰ΩçÊï∞√∑2‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="division" data-level="custom" onclick="toggleCustomSettings('division')">Ëá™ÂÆö‰πâ</div>
            </div>
            <div class="custom-settings" id="division-custom-settings">
                <div class="custom-setting-group">
                    <label for="division-min-a">Ë¢´Èô§Êï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="division-min-a" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="division-max-a">Ë¢´Èô§Êï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="division-max-a" min="1" value="9">
                </div>
                <div class="custom-setting-group">
                    <label for="division-min-b">Èô§Êï∞ÊúÄÂ∞èÂÄº:</label>
                    <input type="number" id="division-min-b" min="1" value="1">
                </div>
                <div class="custom-setting-group">
                    <label for="division-max-b">Èô§Êï∞ÊúÄÂ§ßÂÄº:</label>
                    <input type="number" id="division-max-b" min="1" value="9">
                </div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="division-count">È¢òÁõÆÊï∞Èáè:</label>
                    <input type="number" id="division-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="division-timer">ÂÄíËÆ°Êó∂(Áßí):</label>
                    <input type="number" id="division-timer" min="0" max="3600" value="0" placeholder="0Ë°®Á§∫‰∏çÈôêÊó∂">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('division')">üéØ ÂºÄÂßãÁªÉ‰π†</button>
                <button class="reset" onclick="resetQuiz('division')">üîÑ ÈáçÁΩÆ</button>
            </div>
            <div id="division-quiz" class="quiz-area"></div>
            <div id="division-result" class="result"></div>
        </div>
        
        <div class="section">
            <div class="section-title">Ê∑∑ÂêàËøêÁÆóÁªÉ‰π†</div>
            <div class="mixed-options">
                <div class="mixed-option" data-type="mixed" data-count="2">‰∏§ÁßçËøêÁÆóÊ∑∑Âêà</div>
                <div class="mixed-option" data-type="mixed" data-count="3">‰∏âÁßçËøêÁÆóÊ∑∑Âêà</div>
                <div class="mixed-option" data-type="mixed" data-count="4">ÂõõÁßçËøêÁÆóÊ∑∑Âêà</div>
            </div>
            <div class="difficulty-options">
                <div class="difficulty-option" data-type="mixed" data-level="1">ÁÆÄÂçï (1‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="mixed" data-level="2">‰∏≠Á≠â (2‰ΩçÊï∞)</div>
                <div class="difficulty-option" data-type="mixed" data-level="3">Âõ∞Èöæ (3‰ΩçÊï∞)</div>
            </div>
            <div class="settings-row">
                <div class="setting-group">
                    <label for="mixed-count">È¢òÁõÆÊï∞Èáè:</label>
                    <input type="number" id="mixed-count" min="1" max="50" value="10">
                </div>
                <div class="setting-group">
                    <label for="mixed-timer">ÂÄíËÆ°Êó∂(Áßí):</label>
                    <input type="number" id="mixed-timer" min="0" max="3600" value="0" placeholder="0Ë°®Á§∫‰∏çÈôêÊó∂">
                </div>
            </div>
            <div class="button-group">
                <button onclick="startQuiz('mixed')">üéØ ÂºÄÂßãÁªÉ‰π†</button>
                <button class="reset" onclick="resetQuiz('mixed')">üîÑ ÈáçÁΩÆ</button>
            </div>
            <div id="mixed-quiz" class="quiz-area"></div>
            <div id="mixed-result" class="result"></div>
        </div>
        
        <div class="history">
            <div class="history-header">
                <h2>ÁªÉ‰π†ÂéÜÂè≤ËÆ∞ÂΩï</h2>
                <div>
                    <button class="danger" onclick="clearAllHistory()">üóëÔ∏è Ê∏ÖÁ©∫ÂÖ®ÈÉ®</button>
                </div>
            </div>
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let currentQuiz = null;
        let selectedLevels = {
            addition: 1,
            subtraction: 1,
            multiplication: 1,
            division: 1,
            mixed: 1
        };
        let selectedMixedCount = 2;
        let history = JSON.parse(localStorage.getItem('mathQuizHistory')) || [];
        let timerInterval = null;
        let timeLeft = 0;
        let currentBgColor = '#f9f9f9';
        let currentCardBg = '#fff';
        let bgIntensity = 100;
        
        // ÂàùÂßãÂåñÈ°µÈù¢
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÈöæÂ∫¶ÈÄâÊã©ÁÇπÂáª‰∫ã‰ª∂
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.addEventListener('click', function() {
                    const type = this.getAttribute('data-type');
                    const level = this.getAttribute('data-level');
                    
                    // Â¶ÇÊûúÊòØËá™ÂÆö‰πâÈöæÂ∫¶Ôºå‰∏çÊõ¥Êñ∞selectedLevels
                    if (level !== 'custom') {
                        selectedLevels[type] = parseInt(level);
                    }
                    
                    // ÁßªÈô§ÂêåÁ±ªÂûãÁöÑÊâÄÊúâÈÄâ‰∏≠Áä∂ÊÄÅ
                    document.querySelectorAll(`.difficulty-option[data-type="${type}"]`).forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Ê∑ªÂä†ÂΩìÂâçÈÄâ‰∏≠Áä∂ÊÄÅ
                    this.classList.add('selected');
                });
                
                // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™ÈÄâÈ°π
                if (option.getAttribute('data-level') === "1") {
                    option.classList.add('selected');
                }
            });
            
            // ËÆæÁΩÆÊ∑∑ÂêàËøêÁÆóÈÄâÊã©ÁÇπÂáª‰∫ã‰ª∂
            document.querySelectorAll('.mixed-option').forEach(option => {
                option.addEventListener('click', function() {
                    const count = parseInt(this.getAttribute('data-count'));
                    
                    // ÁßªÈô§ÂêåÁ±ªÂûãÁöÑÊâÄÊúâÈÄâ‰∏≠Áä∂ÊÄÅ
                    document.querySelectorAll('.mixed-option').forEach(el => {
                        el.classList.remove('selected');
                    });
                    
                    // Ê∑ªÂä†ÂΩìÂâçÈÄâ‰∏≠Áä∂ÊÄÅ
                    this.classList.add('selected');
                    
                    // Êõ¥Êñ∞ÈÄâ‰∏≠ÁöÑÊ∑∑ÂêàËøêÁÆóÊï∞Èáè
                    selectedMixedCount = count;
                });
                
                // ÈªòËÆ§ÈÄâ‰∏≠Á¨¨‰∏Ä‰∏™ÈÄâÈ°π
                if (option.getAttribute('data-count') === "2") {
                    option.classList.add('selected');
                }
            });
            
            // Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï
            renderHistory();
            
            // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
            loadTheme();
            
            // Á¶ÅÁî®ÊâÄÊúâÂºÄÂßãÁªÉ‰π†ÊåâÈíÆ‰ª•Â§ñÁöÑÊåâÈíÆ
            disableOtherButtons();
            
            // ÂàùÂßãÂåñËá™ÂÆö‰πâËÆæÁΩÆ
            initializeCustomSettings();
        });
        
        // ÂàùÂßãÂåñËá™ÂÆö‰πâËÆæÁΩÆ
        function initializeCustomSettings() {
            // ËÆæÁΩÆÂä†Ê≥ïËá™ÂÆö‰πâËåÉÂõ¥ÁöÑÈªòËÆ§ÂÄº
            document.getElementById('addition-min-a').value = 1;
            document.getElementById('addition-max-a').value = 9;
            document.getElementById('addition-min-b').value = 1;
            document.getElementById('addition-max-b').value = 9;
            
            // ËÆæÁΩÆÂáèÊ≥ïËá™ÂÆö‰πâËåÉÂõ¥ÁöÑÈªòËÆ§ÂÄº
            document.getElementById('subtraction-min-a').value = 1;
            document.getElementById('subtraction-max-a').value = 9;
            document.getElementById('subtraction-min-b').value = 1;
            document.getElementById('subtraction-max-b').value = 9;
            
            // ËÆæÁΩÆ‰πòÊ≥ïËá™ÂÆö‰πâËåÉÂõ¥ÁöÑÈªòËÆ§ÂÄº
            document.getElementById('multiplication-min-a').value = 1;
            document.getElementById('multiplication-max-a').value = 9;
            document.getElementById('multiplication-min-b').value = 1;
            document.getElementById('multiplication-max-b').value = 9;
            
            // ËÆæÁΩÆÈô§Ê≥ïËá™ÂÆö‰πâËåÉÂõ¥ÁöÑÈªòËÆ§ÂÄº
            document.getElementById('division-min-a').value = 1;
            document.getElementById('division-max-a').value = 9;
            document.getElementById('division-min-b').value = 1;
            document.getElementById('division-max-b').value = 9;
        }
        
        // ÂàáÊç¢Ëá™ÂÆö‰πâËÆæÁΩÆÊòæÁ§∫
        function toggleCustomSettings(type) {
            const customSettings = document.getElementById(`${type}-custom-settings`);
            customSettings.classList.toggle('active');
            
            // Á°Æ‰øùËá™ÂÆö‰πâÈÄâÈ°πË¢´ÈÄâ‰∏≠
            document.querySelectorAll(`.difficulty-option[data-type="${type}"]`).forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.difficulty-option[data-type="${type}"][data-level="custom"]`).classList.add('selected');
            
            // Êõ¥Êñ∞ÈÄâ‰∏≠ÁöÑÈöæÂ∫¶Á∫ßÂà´‰∏∫Ëá™ÂÆö‰πâ
            selectedLevels[type] = 'custom';
        }
        
        // ËÆæÁΩÆ‰∏ªÈ¢òÈ¢úËâ≤
        function setTheme(primary, success, danger, warning, light, dark, text) {
            document.documentElement.style.setProperty('--primary-color', primary);
            document.documentElement.style.setProperty('--success-color', success);
            document.documentElement.style.setProperty('--danger-color', danger);
            document.documentElement.style.setProperty('--warning-color', warning);
            document.documentElement.style.setProperty('--light-color', light);
            document.documentElement.style.setProperty('--dark-color', dark);
            document.documentElement.style.setProperty('--text-color', text);
            
            // Êõ¥Êñ∞‰∏ªÈ¢òÈÄâÈ°πÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // ‰øùÂ≠ò‰∏ªÈ¢ò
            localStorage.setItem('mathQuizTheme', JSON.stringify({
                primary, success, danger, warning, light, dark, text,
                bgColor: currentBgColor,
                cardBg: currentCardBg,
                bgIntensity: bgIntensity
            }));
        }
        
        // ËÆæÁΩÆËÉåÊôØÈ¢úËâ≤
        function setBgTheme(bg, cardBg, intensity) {
            currentBgColor = bg;
            currentCardBg = cardBg;
            bgIntensity = intensity;
            
            // ËÆ°ÁÆóÂÆûÈôÖÈ¢úËâ≤ÂÄº
            const actualBgColor = adjustColorIntensity(bg, intensity);
            const actualCardBg = adjustColorIntensity(cardBg, intensity);
            
            document.documentElement.style.setProperty('--bg-color', actualBgColor);
            document.documentElement.style.setProperty('--card-bg', actualCardBg);
            
            // Êõ¥Êñ∞ËÉåÊôØ‰∏ªÈ¢òÈÄâÈ°πÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.bg-theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Êõ¥Êñ∞ÊªëÂùóÂÄº
            document.getElementById('bg-intensity').value = intensity;
            
            // ‰øùÂ≠òËÉåÊôØ‰∏ªÈ¢ò
            const savedTheme = JSON.parse(localStorage.getItem('mathQuizTheme')) || {};
            savedTheme.bgColor = bg;
            savedTheme.cardBg = cardBg;
            savedTheme.bgIntensity = intensity;
            localStorage.setItem('mathQuizTheme', JSON.stringify(savedTheme));
        }
        
        // Ë∞ÉÊï¥È¢úËâ≤Ê∑±ÊµÖ
        function changeBgIntensity(intensity) {
            bgIntensity = parseInt(intensity);
            const actualBgColor = adjustColorIntensity(currentBgColor, bgIntensity);
            const actualCardBg = adjustColorIntensity(currentCardBg, bgIntensity);
            
            document.documentElement.style.setProperty('--bg-color', actualBgColor);
            document.documentElement.style.setProperty('--card-bg', actualCardBg);
            
            // ‰øùÂ≠òËÉåÊôØÊ∑±ÊµÖ
            const savedTheme = JSON.parse(localStorage.getItem('mathQuizTheme')) || {};
            savedTheme.bgIntensity = bgIntensity;
            localStorage.setItem('mathQuizTheme', JSON.stringify(savedTheme));
        }
        
        // Ë∞ÉÊï¥È¢úËâ≤Âº∫Â∫¶
        function adjustColorIntensity(color, intensity) {
            if (color === '#fff' || color === '#ffffff') return color;
            
            // Â∞ÜÂçÅÂÖ≠ËøõÂà∂È¢úËâ≤ËΩ¨Êç¢‰∏∫RGB
            let r = parseInt(color.substr(1, 2), 16);
            let g = parseInt(color.substr(3, 2), 16);
            let b = parseInt(color.substr(5, 2), 16);
            
            // ËÆ°ÁÆó‰∏≠Èó¥ÂÄº
            const midR = 128;
            const midG = 128;
            const midB = 128;
            
            // Ë∞ÉÊï¥Âº∫Â∫¶
            r = Math.round(midR + (r - midR) * (intensity / 100));
            g = Math.round(midG + (g - midG) * (intensity / 100));
            b = Math.round(midB + (b - midB) * (intensity / 100));
            
            // Á°Æ‰øùÂÄºÂú®0-255ËåÉÂõ¥ÂÜÖ
            r = Math.max(0, Math.min(255, r));
            g = Math.max(0, Math.min(255, g));
            b = Math.max(0, Math.min(255, b));
            
            // ËΩ¨Êç¢ÂõûÂçÅÂÖ≠ËøõÂà∂
            return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
        }
        
        // Âä†ËΩΩ‰øùÂ≠òÁöÑ‰∏ªÈ¢ò
        function loadTheme() {
            const savedTheme = JSON.parse(localStorage.getItem('mathQuizTheme'));
            if (savedTheme) {
                setTheme(
                    savedTheme.primary,
                    savedTheme.success,
                    savedTheme.danger,
                    savedTheme.warning,
                    savedTheme.light,
                    savedTheme.dark,
                    savedTheme.text
                );
                
                // ËÆæÁΩÆËÉåÊôØÈ¢úËâ≤
                if (savedTheme.bgColor) {
                    currentBgColor = savedTheme.bgColor;
                    currentCardBg = savedTheme.cardBg || '#fff';
                    bgIntensity = savedTheme.bgIntensity || 100;
                    
                    const bgOption = Array.from(document.querySelectorAll('.bg-theme-option')).find(
                        option => option.style.backgroundColor === savedTheme.bgColor
                    );
                    if (bgOption) {
                        bgOption.classList.add('selected');
                    }
                    
                    // Â∫îÁî®ËÉåÊôØÈ¢úËâ≤ÂíåÂº∫Â∫¶
                    const actualBgColor = adjustColorIntensity(savedTheme.bgColor, bgIntensity);
                    const actualCardBg = adjustColorIntensity(savedTheme.cardBg || '#fff', bgIntensity);
                    
                    document.documentElement.style.setProperty('--bg-color', actualBgColor);
                    document.documentElement.style.setProperty('--card-bg', actualCardBg);
                    
                    // ËÆæÁΩÆÊªëÂùóÂÄº
                    document.getElementById('bg-intensity').value = bgIntensity;
                }
            }
        }
        
        // Á¶ÅÁî®ÂÖ∂‰ªñÊåâÈíÆ
        function disableOtherButtons() {
            if (currentQuiz) {
                // Á¶ÅÁî®ÊâÄÊúâÂºÄÂßãÁªÉ‰π†ÊåâÈíÆ
                document.querySelectorAll('button:not(.reset)').forEach(btn => {
                    if (!btn.closest(`#${currentQuiz}-quiz`) && !btn.closest(`#${currentQuiz}-result`) && 
                        !btn.closest('.history-header') && !btn.closest('.theme-selector')) {
                        btn.disabled = true;
                    }
                });
                
                // Á¶ÅÁî®ÊâÄÊúâËæìÂÖ•Ê°Ü
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    if (!input.closest(`#${currentQuiz}-quiz`)) {
                        input.disabled = true;
                    }
                });
                
                // Á¶ÅÁî®ÊâÄÊúâÈöæÂ∫¶ÈÄâÈ°π
                document.querySelectorAll('.difficulty-option, .mixed-option').forEach(option => {
                    option.style.pointerEvents = 'none';
                    option.style.opacity = '0.6';
                });
            } else {
                // ÂêØÁî®ÊâÄÊúâÊåâÈíÆ
                document.querySelectorAll('button').forEach(btn => {
                    btn.disabled = false;
                });
                
                // ÂêØÁî®ÊâÄÊúâËæìÂÖ•Ê°Ü
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    input.disabled = false;
                });
                
                // ÂêØÁî®ÊâÄÊúâÈöæÂ∫¶ÈÄâÈ°π
                document.querySelectorAll('.difficulty-option, .mixed-option').forEach(option => {
                    option.style.pointerEvents = 'auto';
                    option.style.opacity = '1';
                });
            }
        }
        
        // ÂºÄÂßãÁªÉ‰π†
        function startQuiz(type) {
            const count = parseInt(document.getElementById(`${type}-count`).value);
            const level = selectedLevels[type];
            const timerSeconds = parseInt(document.getElementById(`${type}-timer`).value) || 0;
            
            // È™åËØÅÈ¢òÁõÆÊï∞Èáè
            if (isNaN(count) || count < 1 || count > 50) {
                alert('ËØ∑ËæìÂÖ•1-50‰πãÈó¥ÁöÑÈ¢òÁõÆÊï∞ÈáèÔºÅ');
                return;
            }
            
            // Ê∏ÖÈô§‰πãÂâçÁöÑËÆ°Êó∂Âô®
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // ËÆæÁΩÆÂΩìÂâçÁªÉ‰π†Á±ªÂûã
            currentQuiz = type;
            disableOtherButtons();
            
            // ÁîüÊàêÈ¢òÁõÆ
            const questions = type === 'mixed' 
                ? generateMixedQuestions(selectedMixedCount, level, count)
                : generateQuestions(type, level, count);
            
            // ÊòæÁ§∫ÁªÉ‰π†Âå∫Âüü
            const quizArea = document.getElementById(`${type}-quiz`);
            quizArea.style.display = 'block';
            quizArea.innerHTML = '';
            
            // ËÆæÁΩÆÂÄíËÆ°Êó∂
            if (timerSeconds > 0) {
                timeLeft = timerSeconds;
                updateTimerDisplay(type);
                
                const timerDisplay = document.createElement('div');
                timerDisplay.className = 'timer-display';
                timerDisplay.id = `${type}-timer-display`;
                timerDisplay.textContent = `Ââ©‰ΩôÊó∂Èó¥: ${formatTime(timeLeft)}`;
                quizArea.appendChild(timerDisplay);
                
                // ÂêØÂä®ËÆ°Êó∂Âô®
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay(type);
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        document.getElementById(`${type}-timer-display`).textContent = 'Êó∂Èó¥Âà∞ÔºÅ';
                        document.getElementById(`${type}-timer-display`).className = 'timer-display final-countdown';
                        setTimeout(() => {
                            checkAnswers(type, questions, true);
                        }, 1000);
                    }
                }, 1000);
            }
            
            // ÊòæÁ§∫ËøõÂ∫¶Êù°
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            const progress = document.createElement('div');
            progress.className = 'progress';
            progress.style.width = '0%';
            progressBar.appendChild(progress);
            quizArea.appendChild(progressBar);
            
            // Ê∑ªÂä†È¢òÁõÆ
            questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <span>${index + 1}. ${q.expression} = </span>
                    <input type="number" id="${type}-answer-${index}" data-answer="${q.answer}" step="any">
                    <span id="${type}-feedback-${index}" style="margin-left: 10px;"></span>
                `;
                quizArea.appendChild(questionDiv);
            });
            
            // Ê∑ªÂä†Êèê‰∫§ÊåâÈíÆ
            const submitButton = document.createElement('button');
            submitButton.textContent = '‚úÖ Êèê‰∫§Á≠îÊ°à';
            submitButton.onclick = function() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                checkAnswers(type, questions, false);
            };
            quizArea.appendChild(submitButton);
            
            // ÈöêËóèÁªìÊûúÂå∫Âüü
            document.getElementById(`${type}-result`).style.display = 'none';
        }
        
        // ÈáçÁΩÆÁªÉ‰π†
        function resetQuiz(type) {
            // Ê∏ÖÈô§ËÆ°Êó∂Âô®
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // ÈöêËóèÁªÉ‰π†Âå∫ÂüüÂíåÁªìÊûúÂå∫Âüü
            document.getElementById(`${type}-quiz`).style.display = 'none';
            document.getElementById(`${type}-result`).style.display = 'none';
            
            // ÈáçÁΩÆÂΩìÂâçÁªÉ‰π†
            currentQuiz = null;
            disableOtherButtons();
        }
        
        // ÁîüÊàêÊ∑∑ÂêàËøêÁÆóÈ¢òÁõÆ
        function generateMixedQuestions(count, level, total) {
            const questions = [];
            const operations = [];
            
            // Ê†πÊçÆÈÄâÊã©ÁöÑÊ∑∑ÂêàÊï∞ÈáèÁ°ÆÂÆöÂåÖÂê´Âì™‰∫õËøêÁÆó
            if (count >= 1) operations.push('addition');
            if (count >= 2) operations.push('subtraction');
            if (count >= 3) operations.push('multiplication');
            if (count >= 4) operations.push('division');
            
            for (let i = 0; i < total; i++) {
                // ÈöèÊú∫ÈÄâÊã©‰∏ÄÁßçËøêÁÆó
                const type = operations[Math.floor(Math.random() * operations.length)];
                
                let a, b, answer, expression;
                
                switch (type) {
                    case 'addition':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * 900) + 100;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('addition-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('addition-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('addition-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('addition-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a + b;
                        expression = `${a} + ${b}`;
                        break;
                    
                    case 'subtraction':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('subtraction-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('subtraction-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('subtraction-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('subtraction-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (Math.min(a, maxB) - minB + 1)) + minB;
                        }
                        answer = a - b;
                        expression = `${a} - ${b}`;
                        break;
                    
                    case 'multiplication':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('multiplication-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('multiplication-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('multiplication-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('multiplication-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a * b;
                        expression = `${a} √ó ${b}`;
                        break;
                    
                    case 'division':
                        if (level === 1) {
                            b = Math.floor(Math.random() * 8) + 2;
                            a = b * (Math.floor(Math.random() * 8) + 1);
                        } else if (level === 2) {
                            b = Math.floor(Math.random() * 9) + 1;
                            a = b * (Math.floor(Math.random() * 90) + 10);
                        } else if (level === 3) {
                            b = Math.floor(Math.random() * 90) + 10;
                            a = b * (Math.floor(Math.random() * 9) + 1);
                        } else if (level === 'custom') {
                            const minB = parseInt(document.getElementById('division-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('division-max-b').value) || 9;
                            const minA = parseInt(document.getElementById('division-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('division-max-a').value) || 9;
                            
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                            if (b === 0) b = 1; // ÈÅøÂÖçÈô§Êï∞‰∏∫0
                            
                            // Á°Æ‰øùaÊòØbÁöÑÂÄçÊï∞
                            const minMultiplier = Math.ceil(minA / b);
                            const maxMultiplier = Math.floor(maxA / b);
                            
                            if (minMultiplier > maxMultiplier) {
                                // Â¶ÇÊûúËåÉÂõ¥Êó†ÊïàÔºå‰ΩøÁî®ÈªòËÆ§ÂÄº
                                b = Math.floor(Math.random() * 8) + 2;
                                a = b * (Math.floor(Math.random() * 8) + 1);
                            } else {
                                const multiplier = Math.floor(Math.random() * (maxMultiplier - minMultiplier + 1)) + minMultiplier;
                                a = b * multiplier;
                            }
                        }
                        answer = a / b;
                        expression = `${a} √∑ ${b}`;
                        break;
                }
                
                questions.push({
                    type: type,
                    expression: expression,
                    answer: answer,
                    userAnswer: null,
                    isCorrect: false
                });
            }
            
            return questions;
        }
        
        // Êõ¥Êñ∞ËÆ°Êó∂Âô®ÊòæÁ§∫
        function updateTimerDisplay(type) {
            const timerDisplay = document.getElementById(`${type}-timer-display`);
            if (timerDisplay) {
                timerDisplay.textContent = `Ââ©‰ΩôÊó∂Èó¥: ${formatTime(timeLeft)}`;
                
                if (timeLeft <= 30) {
                    timerDisplay.className = 'timer-display final-countdown';
                }
            }
        }
        
        // Ê†ºÂºèÂåñÊó∂Èó¥ÊòæÁ§∫
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // ÁîüÊàêÈ¢òÁõÆ
        function generateQuestions(type, level, count) {
            const questions = [];
            
            for (let i = 0; i < count; i++) {
                let a, b, answer, expression;
                
                switch (type) {
                    case 'addition':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * 900) + 100;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('addition-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('addition-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('addition-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('addition-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a + b;
                        expression = `${a} + ${b}`;
                        break;
                    
                    case 'subtraction':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 900) + 100;
                            b = Math.floor(Math.random() * a) + 1;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('subtraction-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('subtraction-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('subtraction-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('subtraction-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (Math.min(a, maxB) - minB + 1)) + minB;
                        }
                        answer = a - b;
                        expression = `${a} - ${b}`;
                        break;
                    
                    case 'multiplication':
                        if (level === 1) {
                            a = Math.floor(Math.random() * 9) + 1;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 2) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 9) + 1;
                        } else if (level === 3) {
                            a = Math.floor(Math.random() * 90) + 10;
                            b = Math.floor(Math.random() * 90) + 10;
                        } else if (level === 'custom') {
                            const minA = parseInt(document.getElementById('multiplication-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('multiplication-max-a').value) || 9;
                            const minB = parseInt(document.getElementById('multiplication-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('multiplication-max-b').value) || 9;
                            a = Math.floor(Math.random() * (maxA - minA + 1)) + minA;
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                        }
                        answer = a * b;
                        expression = `${a} √ó ${b}`;
                        break;
                    
                    case 'division':
                        if (level === 1) {
                            b = Math.floor(Math.random() * 8) + 2;
                            a = b * (Math.floor(Math.random() * 8) + 1);
                        } else if (level === 2) {
                            b = Math.floor(Math.random() * 9) + 1;
                            a = b * (Math.floor(Math.random() * 90) + 10);
                        } else if (level === 3) {
                            b = Math.floor(Math.random() * 90) + 10;
                            a = b * (Math.floor(Math.random() * 9) + 1);
                        } else if (level === 'custom') {
                            const minB = parseInt(document.getElementById('division-min-b').value) || 1;
                            const maxB = parseInt(document.getElementById('division-max-b').value) || 9;
                            const minA = parseInt(document.getElementById('division-min-a').value) || 1;
                            const maxA = parseInt(document.getElementById('division-max-a').value) || 9;
                            
                            b = Math.floor(Math.random() * (maxB - minB + 1)) + minB;
                            if (b === 0) b = 1; // ÈÅøÂÖçÈô§Êï∞‰∏∫0
                            
                            // Á°Æ‰øùaÊòØbÁöÑÂÄçÊï∞
                            const minMultiplier = Math.ceil(minA / b);
                            const maxMultiplier = Math.floor(maxA / b);
                            
                            if (minMultiplier > maxMultiplier) {
                                // Â¶ÇÊûúËåÉÂõ¥Êó†ÊïàÔºå‰ΩøÁî®ÈªòËÆ§ÂÄº
                                b = Math.floor(Math.random() * 8) + 2;
                                a = b * (Math.floor(Math.random() * 8) + 1);
                            } else {
                                const multiplier = Math.floor(Math.random() * (maxMultiplier - minMultiplier + 1)) + minMultiplier;
                                a = b * multiplier;
                            }
                        }
                        answer = a / b;
                        expression = `${a} √∑ ${b}`;
                        break;
                }
                
                questions.push({
                    type: type,
                    expression: expression,
                    answer: answer,
                    userAnswer: null,
                    isCorrect: false
                });
            }
            
            return questions;
        }
        
        // Ê£ÄÊü•Á≠îÊ°à
        function checkAnswers(type, questions, isTimeUp) {
            let answeredCount = 0;
            let correctCount = 0;
            
            // ËÆ°ÁÆóÂæóÂàÜ
            questions.forEach((q, index) => {
                const answerInput = document.getElementById(`${type}-answer-${index}`);
                const feedbackSpan = document.getElementById(`${type}-feedback-${index}`);
                
                const userAnswer = parseFloat(answerInput.value);
                q.userAnswer = isNaN(userAnswer) ? null : userAnswer;
                
                if (q.userAnswer !== null) {
                    answeredCount++;
                }
                
                // Ê£ÄÊü•Á≠îÊ°àÊòØÂê¶Ê≠£Á°ÆÔºàÂÖÅËÆ∏Â∞èÊï∞Èô§Ê≥ïÊúâÂæÆÂ∞èËØØÂ∑ÆÔºâ
                const isCorrect = q.userAnswer !== null && 
                                (q.type === 'division' 
                                    ? Math.abs(userAnswer - q.answer) < 0.001 
                                    : userAnswer === q.answer);
                
                q.isCorrect = isCorrect;
                
                if (isCorrect) {
                    correctCount++;
                    feedbackSpan.textContent = '‚úì Ê≠£Á°Æ';
                    feedbackSpan.className = 'correct';
                } else if (q.userAnswer !== null) {
                    feedbackSpan.textContent = `‚úó ÈîôËØØ (Ê≠£Á°ÆÁ≠îÊ°à: ${q.answer})`;
                    feedbackSpan.className = 'incorrect';
                } else {
                    feedbackSpan.textContent = `Êú™‰ΩúÁ≠î (Ê≠£Á°ÆÁ≠îÊ°à: ${q.answer})`;
                    feedbackSpan.className = 'incorrect';
                }
            });
            
            // ËÆ°ÁÆóÂæóÂàÜÔºàÊª°ÂàÜ100ÂàÜÔºåÊØèÈ¢òÂàÜÂÄºÂùáÂàÜÔºâ
            const score = Math.round((correctCount / questions.length) * 100);
            
            // ÊòæÁ§∫ÁªìÊûú
            const resultDiv = document.getElementById(`${type}-result`);
            resultDiv.style.display = 'block';
            
            let timeInfo = '';
            if (parseInt(document.getElementById(`${type}-timer`).value) > 0) {
                const timeUsed = timeLeft > 0 ? (parseInt(document.getElementById(`${type}-timer`).value) - timeLeft) : parseInt(document.getElementById(`${type}-timer`).value);
                timeInfo = `<p>Áî®Êó∂: ${formatTime(timeUsed)} / ${formatTime(parseInt(document.getElementById(`${type}-timer`).value))}</p>`;
            }
            
            resultDiv.innerHTML = `
                <h3>ÁªÉ‰π†ÁªìÊûú</h3>
                ${isTimeUp ? '<p class="incorrect">Êó∂Èó¥Âà∞ÔºÅ</p>' : ''}
                <p>ÂÖ± ${questions.length} È¢òÔºåÁ≠îÂØπ ${correctCount} È¢òÔºåÂæóÂàÜ: <strong>${score}ÂàÜ</strong></p>
                ${timeInfo}
                <div class="progress-bar"><div class="progress" style="width: ${score}%"></div></div>
                <div class="result-actions">
                    <button onclick="saveResult('${type}', ${score}, ${questions.length}, ${timeLeft})">üíæ ‰øùÂ≠òÊàêÁª©</button>
                    <button class="secondary" onclick="location.reload()">üîÑ ËøîÂõû</button>
                </div>
            `;
            
            // Êõ¥Êñ∞ËøõÂ∫¶Êù°
            const progress = document.querySelector(`#${type}-quiz .progress`);
            progress.style.width = `${score}%`;
            
            // ÈáçÁΩÆÂΩìÂâçÁªÉ‰π†
            currentQuiz = null;
            disableOtherButtons();
        }
        
        // ‰øùÂ≠òÊàêÁª©Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
        function saveResult(type, score, totalQuestions, timeUsed = 0) {
            const now = new Date();
            const dateStr = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            
            let typeName = '';
            let levelName = '';
            
            switch (type) {
                case 'addition':
                    typeName = 'Âä†Ê≥ï';
                    break;
                case 'subtraction':
                    typeName = 'ÂáèÊ≥ï';
                    break;
                case 'multiplication':
                    typeName = '‰πòÊ≥ï';
                    break;
                case 'division':
                    typeName = 'Èô§Ê≥ï';
                    break;
                case 'mixed':
                    typeName = `${selectedMixedCount}ÁßçÊ∑∑ÂêàËøêÁÆó`;
                    break;
            }
            
            switch (selectedLevels[type]) {
                case 1:
                    levelName = 'ÁÆÄÂçï';
                    break;
                case 2:
                    levelName = '‰∏≠Á≠â';
                    break;
                case 3:
                    levelName = 'Âõ∞Èöæ';
                    break;
                case 'custom':
                    levelName = 'Ëá™ÂÆö‰πâ';
                    break;
            }
            
            const record = {
                id: Date.now(),
                date: dateStr,
                type: typeName,
                level: levelName,
                score: score,
                total: totalQuestions,
                timeUsed: timeUsed,
                timerSet: parseInt(document.getElementById(`${type}-timer`).value) || 0,
                details: []
            };
            
            // Ëé∑ÂèñÈ¢òÁõÆËØ¶ÊÉÖ
            const quizArea = document.getElementById(`${type}-quiz`);
            const questionInputs = quizArea.querySelectorAll('input[type="number"]');
            
            questionInputs.forEach((input, index) => {
                const answer = parseFloat(input.getAttribute('data-answer'));
                const userAnswer = parseFloat(input.value) || null;
                const questionText = input.previousSibling.textContent.trim();
                const isCorrect = userAnswer !== null && 
                                 (type === 'division' 
                                     ? Math.abs(userAnswer - answer) < 0.001 
                                     : userAnswer === answer);
                
                record.details.push({
                    question: `${index + 1}. ${questionText}`,
                    expression: questionText.replace(/^\d+\.\s/, '').replace(/\s=\s$/, ''),
                    answer: answer,
                    userAnswer: userAnswer,
                    isCorrect: isCorrect
                });
            });
            
            // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
            history.unshift(record);
            
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('mathQuizHistory', JSON.stringify(history));
            
            // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
            renderHistory();
            
            alert('ÊàêÁª©Â∑≤‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩïÔºÅ');
        }
        
        // Ê∏≤ÊüìÂéÜÂè≤ËÆ∞ÂΩï
        function renderHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-history">
                        <i>üìö</i>
                        <p>ÊöÇÊó†ÁªÉ‰π†ÂéÜÂè≤ËÆ∞ÂΩï</p>
                        <p>ÂºÄÂßãÁªÉ‰π†ÂêéÔºå‰Ω†ÁöÑÊàêÁª©Â∞ÜÂú®ËøôÈáåÊòæÁ§∫</p>
                    </div>
                `;
                return;
            }
            
            history.forEach(record => {
                const recordDiv = document.createElement('div');
                recordDiv.className = 'history-item';
                
                const correctRate = Math.round((record.score / 100) * record.total);
                const incorrectRate = record.total - correctRate;
                const timeInfo = record.timerSet > 0 
                    ? `Áî®Êó∂: ${formatTime(record.timeUsed)} / ${formatTime(record.timerSet)}` 
                    : '‰∏çÈôêÊó∂';
                
                recordDiv.innerHTML = `
                    <div class="history-item-header">
                        <div class="history-item-date">${record.date}</div>
                        <div class="history-item-type">${record.type}ÁªÉ‰π†</div>
                    </div>
                    <div class="history-item-body">
                        <div>
                            <span class="history-item-level">${record.level}ÈöæÂ∫¶</span>
                            <div>${timeInfo}</div>
                        </div>
                        <div class="history-item-score">${record.score}ÂàÜ</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" style="width: ${record.score}%"></div>
                    </div>
                    <div>Ê≠£Á°Æ: ${correctRate}È¢ò | ÈîôËØØ: ${incorrectRate}È¢ò</div>
                    <div class="history-item-actions">
                        <button onclick="showDetails(${record.id})">üîç Êü•ÁúãËØ¶ÊÉÖ</button>
                        <button class="warning" onclick="deleteRecord(${record.id})">üóëÔ∏è Âà†Èô§ËÆ∞ÂΩï</button>
                    </div>
                    <div id="details-${record.id}" class="question-details"></div>
                `;
                
                historyList.appendChild(recordDiv);
            });
        }
        
        // ÊòæÁ§∫ÂéÜÂè≤ËÆ∞ÂΩïËØ¶ÊÉÖ
        function showDetails(id) {
            const detailsDiv = document.getElementById(`details-${id}`);
            const record = history.find(r => r.id === id);
            
            if (detailsDiv.style.display === 'none' || !detailsDiv.style.display) {
                detailsDiv.style.display = 'block';
                let detailsHtml = '<h4>È¢òÁõÆËØ¶ÊÉÖ:</h4>';
                
                record.details.forEach(detail => {
                    const answerText = detail.isCorrect 
                        ? '<span class="correct">‚úì Ê≠£Á°Æ</span>' 
                        : `<span class="incorrect">‚úó ÈîôËØØ (‰Ω†ÁöÑÁ≠îÊ°à: ${detail.userAnswer || "Êú™‰ΩúÁ≠î"}, Ê≠£Á°ÆÁ≠îÊ°à: ${detail.answer})</span>`;
                    
                    detailsHtml += `
                        <div class="question-detail-item">
                            <span>${detail.question.replace(/=\s*$/, '')}</span>
                            ${answerText}
                        </div>
                    `;
                });
                
                detailsDiv.innerHTML = detailsHtml;
            } else {
                detailsDiv.style.display = 'none';
                detailsDiv.innerHTML = '';
            }
        }
        
        // Âà†Èô§Âçï‰∏™ÂéÜÂè≤ËÆ∞ÂΩï
        function deleteRecord(id) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                history = history.filter(record => record.id !== id);
                localStorage.setItem('mathQuizHistory', JSON.stringify(history));
                renderHistory();
            }
        }
        
        // Ê∏ÖÁ©∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩï
        function clearAllHistory() {
            if (history.length === 0) {
                alert('Ê≤°ÊúâÂèØÊ∏ÖÈô§ÁöÑÂéÜÂè≤ËÆ∞ÂΩïÔºÅ');
                return;
            }
            
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§çÔºÅ')) {
                history = [];
                localStorage.removeItem('mathQuizHistory');
                renderHistory();
            }
        }
    </script>
</body>
</html>