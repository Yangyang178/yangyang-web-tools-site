<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>优化版 Markdown 编辑器</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Source+Code+Pro&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --dark-color: #1a1a2e;
            --light-color: #f8f9fa;
            --border-color: #dee2e6;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin: 0;
            font-weight: 500;
        }
        
        .editor-container {
            display: flex;
            gap: 20px;
            height: 70vh;
            margin-bottom: 20px;
        }
        
        @media (max-width: 992px) {
            .editor-container {
                flex-direction: column;
                height: auto;
            }
        }
        
        .editor-panel, .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        
        .panel-header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 12px 20px;
            font-weight: 500;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-actions {
            display: flex;
            gap: 10px;
        }
        
        .panel-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .panel-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        textarea {
            flex: 1;
            padding: 20px;
            border: none;
            resize: none;
            font-family: 'Source Code Pro', monospace;
            font-size: 15px;
            line-height: 1.5;
            background-color: white;
            outline: none;
        }
        
        #preview {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: white;
        }
        
        .toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .toolbar-btn {
            padding: 8px 12px;
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .toolbar-btn:hover {
            background-color: #f0f2f5;
        }
        
        .btn-clear {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-copy {
            background-color: var(--success-color);
            color: white;
        }
        
        .status-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--dark-color);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .show-message {
            opacity: 1;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-markdown"></i> Markdown 编辑器</h1>
        </header>
        
        <div class="toolbar">
            <button class="toolbar-btn" onclick="insertText('**', '**', '加粗文本')">
                <i class="fas fa-bold"></i> 加粗
            </button>
            <button class="toolbar-btn" onclick="insertText('*', '*', '斜体文本')">
                <i class="fas fa-italic"></i> 斜体
            </button>
            <button class="toolbar-btn" onclick="insertText('# ', '', '标题')">
                <i class="fas fa-heading"></i> 标题
            </button>
            <button class="toolbar-btn" onclick="insertText('- ', '', '列表项')">
                <i class="fas fa-list-ul"></i> 列表
            </button>
            <button class="toolbar-btn" onclick="insertText('1. ', '', '列表项')">
                <i class="fas fa-list-ol"></i> 有序列表
            </button>
            <button class="toolbar-btn" onclick="insertText('> ', '', '引用文本')">
                <i class="fas fa-quote-right"></i> 引用
            </button>
            <button class="toolbar-btn" onclick="insertText('`', '`', '代码')">
                <i class="fas fa-code"></i> 行内代码
            </button>
            <button class="toolbar-btn" onclick="insertText('```\n', '\n```', '代码块')">
                <i class="fas fa-square-code"></i> 代码块
            </button>
            <button class="toolbar-btn" onclick="insertText('[', '](url)', '链接文本')">
                <i class="fas fa-link"></i> 链接
            </button>
            <button class="toolbar-btn" onclick="insertText('![', '](url)', '图片描述')">
                <i class="fas fa-image"></i> 图片
            </button>
        </div>
        
        <div class="editor-container">
            <div class="editor-panel">
                <div class="panel-header">
                    <span><i class="fas fa-edit"></i> 编辑区</span>
                    <div class="panel-actions">
                        <button class="panel-btn btn-clear" onclick="clearEditor()">
                            <i class="fas fa-trash"></i> 清空
                        </button>
                    </div>
                </div>
                <textarea id="editor" placeholder="在这里输入Markdown内容..." autofocus></textarea>
            </div>
            
            <div class="preview-panel">
                <div class="panel-header">
                    <span><i class="fas fa-eye"></i> 预览区</span>
                    <div class="panel-actions">
                        <button class="panel-btn btn-copy" onclick="copyToClipboard()">
                            <i class="fas fa-copy"></i> 复制
                        </button>
                    </div>
                </div>
                <div id="preview"></div>
            </div>
        </div>
    </div>

    <div class="status-message" id="statusMessage"></div>

    <script>
        // 简化的 Markdown 解析器
        function parseMarkdown(markdown) {
            // 替换标题
            markdown = markdown.replace(/^# (.*$)/gm, '<h1>$1</h1>')
                              .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                              .replace(/^### (.*$)/gm, '<h3>$1</h3>');
            
            // 替换粗体和斜体
            markdown = markdown.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                              .replace(/\*(.*?)\*/g, '<em>$1</em>');
            
            // 替换链接和图片
            markdown = markdown.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2">$1</a>')
                              .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">');
            
            // 替换代码块
            markdown = markdown.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                              .replace(/`(.*?)`/g, '<code>$1</code>');
            
            // 替换列表
            markdown = markdown.replace(/^\s*\*\s(.*$)/gm, '<li>$1</li>')
                              .replace(/^\s*-\s(.*$)/gm, '<li>$1</li>')
                              .replace(/^\s*\+\s(.*$)/gm, '<li>$1</li>')
                              .replace(/^\s*\d+\.\s(.*$)/gm, '<li>$1</li>');
            
            // 替换引用
            markdown = markdown.replace(/^\>\s(.*$)/gm, '<blockquote>$1</blockquote>');
            
            // 替换换行符
            markdown = markdown.replace(/\n/g, '<br>');
            
            return markdown;
        }

        // HTML 消毒函数
        function sanitizeHTML(html) {
            return html.replace(/<script.*?>.*?<\/script>/gi, '')
                      .replace(/on\w+=".*?"/gi, '');
        }

        // 获取DOM元素
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const statusMessage = document.getElementById('statusMessage');
        
        // 更新预览函数
        function updatePreview() {
            try {
                const markdownText = editor.value;
                const html = parseMarkdown(markdownText);
                preview.innerHTML = sanitizeHTML(html);
            } catch (e) {
                preview.innerHTML = "<div style='color:red'>预览渲染错误</div>";
            }
        }
        
        // 设置事件监听
        function setupEventListeners() {
            editor.addEventListener('input', updatePreview);
            editor.addEventListener('keyup', updatePreview);
            editor.addEventListener('paste', function() {
                setTimeout(updatePreview, 10);
            });
        }
        
        // 插入文本辅助函数
        function insertText(prefix, suffix, placeholder = '') {
            const textarea = editor;
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            const textToInsert = prefix + (selectedText || placeholder) + suffix;
            
            textarea.value = textarea.value.substring(0, start) + 
                           textToInsert + 
                           textarea.value.substring(end);
            
            if (selectedText) {
                textarea.selectionStart = start + prefix.length;
                textarea.selectionEnd = end + prefix.length;
            } else {
                textarea.selectionStart = start + prefix.length;
                textarea.selectionEnd = start + prefix.length + placeholder.length;
            }
            
            textarea.focus();
            updatePreview();
            showStatusMessage('已插入内容');
        }
        
        // 清空编辑器
        function clearEditor() {
            if (editor.value === '' || confirm('确定要清空编辑器内容吗？')) {
                editor.value = '';
                updatePreview();
                showStatusMessage('已清空编辑器');
            }
        }
        
        // 复制到剪贴板
        function copyToClipboard() {
            const contentToCopy = editor.value || preview.textContent;
            
            navigator.clipboard.writeText(contentToCopy).then(() => {
                showStatusMessage('已复制到剪贴板');
            }).catch(err => {
                showStatusMessage('复制失败: ' + err);
            });
        }
        
        // 显示状态消息
        function showStatusMessage(message) {
            statusMessage.textContent = message;
            statusMessage.classList.add('show-message');
            
            setTimeout(() => {
                statusMessage.classList.remove('show-message');
            }, 3000);
        }
        
        // 初始化编辑器
        function initEditor() {
            editor.value = `# 欢迎使用 Markdown 编辑器\n\n输入内容后，右侧会实时显示预览效果！\n\n试试这些功能：\n- **加粗**文字\n- *斜体*文字\n- [链接示例](https://example.com)`;
            updatePreview();
            setupEventListeners();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initEditor);
    </script>
</body>
</html>