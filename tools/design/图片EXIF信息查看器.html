<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡EXIFä¿¡æ¯æŸ¥çœ‹å™¨</title>
    <script src="../vendor/exifjs/exif.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 40px 20px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: center;
        }

        .upload-area:hover {
            border-color: #74b9ff;
            background-color: #f8fbff;
        }

        .upload-area.dragover {
            border-color: #0984e3;
            background-color: #e3f2fd;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4em;
            color: #ddd;
            margin-bottom: 20px;
        }

        .upload-text {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(116, 185, 255, 0.3);
        }

        .clear-btn {
            background: #e74c3c;
        }

        .clear-btn:hover {
            background: #c0392b;
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .preview-section {
            display: none;
            margin-bottom: 30px;
        }

        .preview-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .image-preview {
            flex: 1;
            max-width: 400px;
        }

        .preview-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .file-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #6c757d;
        }

        .exif-container {
            flex: 2;
        }

        .exif-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .exif-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exif-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            align-items: center;
        }

        .exif-label {
            font-weight: 600;
            color: #495057;
            padding: 8px 0;
        }

        .exif-value {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 8px 12px;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }

        .no-data {
            color: #6c757d;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #74b9ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .gps-map {
            margin-top: 15px;
            border-radius: 5px;
            overflow: hidden;
        }

        .copy-btn {
            background: #28a745;
            font-size: 0.9em;
            padding: 6px 12px;
            margin-left: 10px;
        }

        .copy-btn:hover {
            background: #218838;
        }

        @media (max-width: 768px) {
            .preview-container {
                flex-direction: column;
            }
            
            .exif-grid {
                grid-template-columns: 1fr;
                gap: 5px;
            }
            
            .exif-label {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“· å›¾ç‰‡EXIFä¿¡æ¯æŸ¥çœ‹å™¨</h1>
            <p>ä¸Šä¼ å›¾ç‰‡ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„æ‹æ‘„ä¿¡æ¯å’Œå…ƒæ•°æ®</p>
        </div>
        
        <div class="content">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ–¼ï¸</div>
                <div class="upload-text">ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
                <button class="btn" onclick="document.getElementById('fileInput').click()">é€‰æ‹©æ–‡ä»¶</button>
                <button class="btn clear-btn" id="clearBtn" onclick="clearAll()" style="display: none;">ğŸ—‘ï¸ æ¸…é™¤</button>
                <input type="file" id="fileInput" accept="image/*">
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨è¯»å–EXIFä¿¡æ¯...</p>
            </div>

            <div id="messageArea"></div>

            <div class="preview-section" id="previewSection">
                <div class="preview-container">
                    <div class="image-preview">
                        <img id="previewImage" class="preview-image" alt="é¢„è§ˆå›¾ç‰‡">
                        <div class="file-info" id="fileInfo"></div>
                    </div>
                    
                    <div class="exif-container">
                        <!-- åŸºæœ¬ä¿¡æ¯ -->
                        <div class="exif-section">
                            <div class="exif-title">
                                ğŸ“‹ åŸºæœ¬ä¿¡æ¯
                            </div>
                            <div class="exif-grid" id="basicInfo">
                                <div class="no-data">æš‚æ— æ•°æ®</div>
                            </div>
                        </div>

                        <!-- æ‹æ‘„å‚æ•° -->
                        <div class="exif-section">
                            <div class="exif-title">
                                ğŸ“¸ æ‹æ‘„å‚æ•°
                            </div>
                            <div class="exif-grid" id="cameraInfo">
                                <div class="no-data">æš‚æ— æ•°æ®</div>
                            </div>
                        </div>

                        <!-- GPSä¿¡æ¯ -->
                        <div class="exif-section">
                            <div class="exif-title">
                                ğŸŒ GPSä½ç½®ä¿¡æ¯
                            </div>
                            <div class="exif-grid" id="gpsInfo">
                                <div class="no-data">æš‚æ— GPSæ•°æ®</div>
                            </div>
                        </div>

                        <!-- å…¶ä»–ä¿¡æ¯ -->
                        <div class="exif-section">
                            <div class="exif-title">
                                âš™ï¸ å…¶ä»–ä¿¡æ¯
                            </div>
                            <div class="exif-grid" id="otherInfo">
                                <div class="no-data">æš‚æ— æ•°æ®</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');
        const loading = document.getElementById('loading');
        const messageArea = document.getElementById('messageArea');
        const fileInfo = document.getElementById('fileInfo');
        const clearBtn = document.getElementById('clearBtn');

        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', handleFileSelect);

        // æ‹–æ‹½äº‹ä»¶
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
        uploadArea.addEventListener('click', (e) => {
            if (!e.target.classList.contains('btn')) {
                fileInput.click();
            }
        });

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                showMessage('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
                return;
            }

            // éªŒè¯æ–‡ä»¶å¤§å° (50MB)
            if (file.size > 50 * 1024 * 1024) {
                showMessage('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MBï¼', 'error');
                return;
            }

            clearMessages();
            loading.style.display = 'block';
            previewSection.style.display = 'none';

            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            const fileSize = (file.size / 1024).toFixed(2);
            const fileSizeUnit = fileSize > 1024 ? `${(fileSize / 1024).toFixed(2)} MB` : `${fileSize} KB`;
            
            fileInfo.innerHTML = `
                <strong>æ–‡ä»¶åï¼š</strong>${file.name}<br>
                <strong>æ–‡ä»¶å¤§å°ï¼š</strong>${fileSizeUnit}<br>
                <strong>æ–‡ä»¶ç±»å‹ï¼š</strong>${file.type}<br>
                <strong>æœ€åä¿®æ”¹ï¼š</strong>${new Date(file.lastModified).toLocaleString()}
            `;

            // é¢„è§ˆå›¾ç‰‡
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewImage.onload = () => {
                    // è¯»å–EXIFä¿¡æ¯
                    readExifData(file);
                };
            };
            reader.readAsDataURL(file);
        }

        function readExifData(file) {
            EXIF.getData(file, function() {
                const allMetaData = EXIF.getAllTags(this);
                
                loading.style.display = 'none';
                previewSection.style.display = 'block';
                clearBtn.style.display = 'inline-block';

                if (Object.keys(allMetaData).length === 0) {
                    showMessage('è¯¥å›¾ç‰‡ä¸åŒ…å«EXIFä¿¡æ¯', 'error');
                    clearExifSections();
                    return;
                }

                showMessage('EXIFä¿¡æ¯è¯»å–æˆåŠŸï¼', 'success');
                displayExifData(allMetaData);
            });
        }

        function displayExifData(exifData) {
            // åŸºæœ¬ä¿¡æ¯
            const basicData = {
                'å›¾ç‰‡å®½åº¦': exifData.PixelXDimension || exifData.ExifImageWidth || 'æœªçŸ¥',
                'å›¾ç‰‡é«˜åº¦': exifData.PixelYDimension || exifData.ExifImageHeight || 'æœªçŸ¥',
                'æ‹æ‘„æ—¶é—´': exifData.DateTime || exifData.DateTimeOriginal || 'æœªçŸ¥',
                'ä¿®æ”¹æ—¶é—´': exifData.DateTimeDigitized || 'æœªçŸ¥',
                'å›¾ç‰‡æ–¹å‘': getOrientation(exifData.Orientation),
                'é¢œè‰²ç©ºé—´': exifData.ColorSpace === 1 ? 'sRGB' : (exifData.ColorSpace || 'æœªçŸ¥')
            };

            // æ‹æ‘„å‚æ•°
            const cameraData = {
                'ç›¸æœºå“ç‰Œ': exifData.Make || 'æœªçŸ¥',
                'ç›¸æœºå‹å·': exifData.Model || 'æœªçŸ¥',
                'é•œå¤´å‹å·': exifData.LensModel || 'æœªçŸ¥',
                'å…‰åœˆå€¼': exifData.FNumber ? `f/${exifData.FNumber}` : 'æœªçŸ¥',
                'å¿«é—¨é€Ÿåº¦': formatShutterSpeed(exifData.ExposureTime),
                'ISOæ„Ÿå…‰åº¦': exifData.ISOSpeedRatings || exifData.ISO || 'æœªçŸ¥',
                'ç„¦è·': exifData.FocalLength ? `${exifData.FocalLength}mm` : 'æœªçŸ¥',
                'ç­‰æ•ˆç„¦è·': exifData.FocalLengthIn35mmFilm ? `${exifData.FocalLengthIn35mmFilm}mm` : 'æœªçŸ¥',
                'æ›å…‰æ¨¡å¼': getExposureMode(exifData.ExposureMode),
                'æµ‹å…‰æ¨¡å¼': getMeteringMode(exifData.MeteringMode),
                'é—ªå…‰ç¯': getFlashMode(exifData.Flash),
                'ç™½å¹³è¡¡': getWhiteBalance(exifData.WhiteBalance)
            };

            // GPSä¿¡æ¯
            const gpsData = {};
            if (exifData.GPSLatitude && exifData.GPSLongitude) {
                const lat = convertDMSToDD(exifData.GPSLatitude, exifData.GPSLatitudeRef);
                const lon = convertDMSToDD(exifData.GPSLongitude, exifData.GPSLongitudeRef);
                
                gpsData['çº¬åº¦'] = `${lat.toFixed(6)}Â°`;
                gpsData['ç»åº¦'] = `${lon.toFixed(6)}Â°`;
                gpsData['æµ·æ‹”é«˜åº¦'] = exifData.GPSAltitude ? `${exifData.GPSAltitude}m` : 'æœªçŸ¥';
                gpsData['GPSæ—¶é—´'] = exifData.GPSTimeStamp ? formatGPSTime(exifData.GPSTimeStamp) : 'æœªçŸ¥';
                gpsData['åœ°å›¾é“¾æ¥'] = `https://www.google.com/maps?q=${lat},${lon}`;
            }

            // å…¶ä»–ä¿¡æ¯
            const otherData = {
                'è½¯ä»¶ç‰ˆæœ¬': exifData.Software || 'æœªçŸ¥',
                'è‰ºæœ¯å®¶': exifData.Artist || 'æœªçŸ¥',
                'ç‰ˆæƒä¿¡æ¯': exifData.Copyright || 'æœªçŸ¥',
                'ç”¨æˆ·è¯„è®º': exifData.UserComment || 'æœªçŸ¥',
                'å›¾åƒæè¿°': exifData.ImageDescription || 'æœªçŸ¥',
                'å‹ç¼©æ–¹å¼': exifData.Compression || 'æœªçŸ¥',
                'åˆ†è¾¨ç‡å•ä½': exifData.ResolutionUnit === 2 ? 'è‹±å¯¸' : (exifData.ResolutionUnit === 3 ? 'å˜ç±³' : 'æœªçŸ¥'),
                'Xåˆ†è¾¨ç‡': exifData.XResolution || 'æœªçŸ¥',
                'Yåˆ†è¾¨ç‡': exifData.YResolution || 'æœªçŸ¥'
            };

            // æ˜¾ç¤ºæ•°æ®
            displaySection('basicInfo', basicData);
            displaySection('cameraInfo', cameraData);
            displaySection('gpsInfo', gpsData);
            displaySection('otherInfo', otherData);
        }

        function displaySection(sectionId, data) {
            const section = document.getElementById(sectionId);
            const filteredData = Object.fromEntries(
                Object.entries(data).filter(([key, value]) => value && value !== 'æœªçŸ¥' && value !== '')
            );

            if (Object.keys(filteredData).length === 0) {
                section.innerHTML = '<div class="no-data">æš‚æ— æ•°æ®</div>';
                return;
            }

            let html = '';
            for (const [key, value] of Object.entries(filteredData)) {
                if (key === 'åœ°å›¾é“¾æ¥') {
                    html += `
                        <div class="exif-label">${key}</div>
                        <div class="exif-value">
                            <a href="${value}" target="_blank" style="color: #007bff; text-decoration: none;">
                                ğŸ—ºï¸ åœ¨Googleåœ°å›¾ä¸­æŸ¥çœ‹
                            </a>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="exif-label">${key}</div>
                        <div class="exif-value">
                            ${value}
                            <button class="copy-btn" onclick="copyToClipboard('${value}')">ğŸ“‹</button>
                        </div>
                    `;
                }
            }
            section.innerHTML = html;
        }

        function clearExifSections() {
            ['basicInfo', 'cameraInfo', 'gpsInfo', 'otherInfo'].forEach(id => {
                document.getElementById(id).innerHTML = '<div class="no-data">æš‚æ— æ•°æ®</div>';
            });
        }

        // è¾…åŠ©å‡½æ•°
        function getOrientation(orientation) {
            const orientations = {
                1: 'æ­£å¸¸',
                2: 'æ°´å¹³ç¿»è½¬',
                3: 'æ—‹è½¬180Â°',
                4: 'å‚ç›´ç¿»è½¬',
                5: 'é€†æ—¶é’ˆæ—‹è½¬90Â°å¹¶æ°´å¹³ç¿»è½¬',
                6: 'é¡ºæ—¶é’ˆæ—‹è½¬90Â°',
                7: 'é¡ºæ—¶é’ˆæ—‹è½¬90Â°å¹¶æ°´å¹³ç¿»è½¬',
                8: 'é€†æ—¶é’ˆæ—‹è½¬90Â°'
            };
            return orientations[orientation] || 'æœªçŸ¥';
        }

        function formatShutterSpeed(exposureTime) {
            if (!exposureTime) return 'æœªçŸ¥';
            if (exposureTime >= 1) return `${exposureTime}s`;
            return `1/${Math.round(1/exposureTime)}s`;
        }

        function getExposureMode(mode) {
            const modes = {
                0: 'è‡ªåŠ¨æ›å…‰',
                1: 'æ‰‹åŠ¨æ›å…‰',
                2: 'è‡ªåŠ¨åŒ…å›´æ›å…‰'
            };
            return modes[mode] || 'æœªçŸ¥';
        }

        function getMeteringMode(mode) {
            const modes = {
                0: 'æœªçŸ¥',
                1: 'å¹³å‡æµ‹å…‰',
                2: 'ä¸­å¤®é‡ç‚¹æµ‹å…‰',
                3: 'ç‚¹æµ‹å…‰',
                4: 'å¤šç‚¹æµ‹å…‰',
                5: 'è¯„ä»·æµ‹å…‰',
                6: 'å±€éƒ¨æµ‹å…‰'
            };
            return modes[mode] || 'æœªçŸ¥';
        }

        function getFlashMode(flash) {
            if (!flash) return 'æœªçŸ¥';
            return (flash & 1) ? 'é—ªå…‰ç¯å¼€å¯' : 'é—ªå…‰ç¯å…³é—­';
        }

        function getWhiteBalance(wb) {
            const modes = {
                0: 'è‡ªåŠ¨ç™½å¹³è¡¡',
                1: 'æ‰‹åŠ¨ç™½å¹³è¡¡'
            };
            return modes[wb] || 'æœªçŸ¥';
        }

        function convertDMSToDD(dms, ref) {
            let dd = dms[0] + dms[1]/60 + dms[2]/3600;
            if (ref === 'S' || ref === 'W') dd = dd * -1;
            return dd;
        }

        function formatGPSTime(timeArray) {
            if (!timeArray || timeArray.length < 3) return 'æœªçŸ¥';
            const hours = Math.floor(timeArray[0]);
            const minutes = Math.floor(timeArray[1]);
            const seconds = Math.floor(timeArray[2]);
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showMessage('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showMessage('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            } catch (err) {
                showMessage('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚', 'error');
            }
            document.body.removeChild(textArea);
        }

        function clearAll() {
            fileInput.value = '';
            previewSection.style.display = 'none';
            loading.style.display = 'none';
            clearBtn.style.display = 'none';
            clearMessages();
            previewImage.src = '';
            fileInfo.innerHTML = '';
            clearExifSections();
            showMessage('å·²æ¸…é™¤æ‰€æœ‰å†…å®¹ï¼', 'success');
        }

        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = message;
            messageArea.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }

        function clearMessages() {
            messageArea.innerHTML = '';
        }

        // é˜»æ­¢é¡µé¢é»˜è®¤çš„æ‹–æ‹½è¡Œä¸º
        document.addEventListener('dragover', (e) => e.preventDefault());
        document.addEventListener('drop', (e) => e.preventDefault());
    </script>
</body>
</html>
