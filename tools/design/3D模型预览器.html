<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Dæ¨¡å‹é¢„è§ˆå™¨</title>
    <script src="../vendor/three/r128/three.min.js"></script>
    <script src="../vendor/three/r128/examples/js/loaders/GLTFLoader.js"></script>
    <script src="../vendor/three/r128/examples/js/controls/OrbitControls.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            background: linear-gradient(45deg, #fff, #f0f8ff, #e6f3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            font-weight: 300;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: calc(100vh - 200px);
        }

        .sidebar {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.9));
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.08);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .upload-area {
            border: 3px dashed transparent;
            background: linear-gradient(145deg, #667eea, #764ba2) padding-box, 
                        linear-gradient(145deg, #667eea, #764ba2, #f093fb) border-box;
            border-radius: 15px;
            padding: 35px 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 15px;
            pointer-events: none;
        }

        .upload-area:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .upload-area.dragover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 20px 40px rgba(33, 150, 243, 0.4);
        }

        .upload-icon {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #fff, #f0f8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }

        .upload-text {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 12px;
            font-weight: 600;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .upload-hint {
            font-size: 1rem;
            color: rgba(255,255,255,0.9);
            font-weight: 300;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        #fileInput {
            display: none;
        }

        .controls {
            margin-top: 20px;
        }

        .control-group {
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .control-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1rem;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            outline: none;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(145deg, #fff, #f0f8ff);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid #667eea;
            transition: all 0.2s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
        }

        .slider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(145deg, #fff, #f0f8ff);
            cursor: pointer;
            border: 2px solid #667eea;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .viewer-container {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, 
                #667eea 0%, 
                #764ba2 25%, 
                #f093fb 50%, 
                #f5576c 75%, 
                #4facfe 100%);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .value-display {
            min-width: 50px;
            text-align: center;
            font-weight: 700;
            color: #2c3e50;
            background: linear-gradient(135deg, rgba(255,255,255,0.8), rgba(240,248,255,0.6));
            padding: 5px 10px;
            border-radius: 8px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            font-size: 0.95rem;
        }

        .btn {
            background: linear-gradient(145deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            margin-bottom: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            background: linear-gradient(145deg, #764ba2, #f093fb);
        }

        .btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn:disabled {
            background: linear-gradient(145deg, #bbb, #999);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .btn:disabled::before {
            display: none;
        }

        .viewer-container {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.9));
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1), 0 10px 20px rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        #viewer {
            width: 100%;
            height: 100%;
            display: block;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: white;
            font-size: 18px;
            z-index: 10;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æ¬¢è¿ç•Œé¢æ ·å¼ */
        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(74, 144, 226, 0.8) 0%,
                rgba(80, 200, 120, 0.7) 25%,
                rgba(255, 107, 107, 0.8) 50%,
                rgba(196, 113, 237, 0.7) 75%,
                rgba(255, 159, 67, 0.8) 100%);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
            animation: welcomeFadeIn 1s ease-out;
        }

        @keyframes welcomeFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .welcome-content {
            text-align: center;
            color: white;
            max-width: 600px;
            max-height: 80vh;
            padding: 40px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            position: relative;
        }

        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .welcome-content h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            font-weight: 700;
        }

        .welcome-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #ffffff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            opacity: 0.95;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .feature-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            transform: translateY(-5px);
            background: rgba(0, 0, 0, 0.5);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .feature-item h3 {
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            font-weight: 600;
        }

        .feature-item p {
            font-size: 0.9rem;
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            opacity: 0.9;
            margin: 0;
        }

        .welcome-tips {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 30px;
            text-align: left;
        }

        .welcome-tips h3 {
            margin-bottom: 15px;
            text-align: center;
            color: #ffffff;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8);
        }

        .welcome-tips ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .welcome-tips li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            color: #ffffff;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
        }

        .welcome-tips li:last-child {
            border-bottom: none;
        }

        .upload-prompt {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(45deg, rgba(74, 144, 226, 0.2), rgba(80, 200, 120, 0.2));
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(74, 144, 226, 0.3); }
            to { box-shadow: 0 0 30px rgba(80, 200, 120, 0.4); }
        }

        .upload-prompt-icon {
            font-size: 2rem;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(-10px); }
        }

        .upload-prompt p {
            font-size: 1.1rem;
            margin: 0;
            font-weight: 500;
        }

        /* æ»šåŠ¨å†…å®¹æ ·å¼ */
        .scrolling-content {
            animation: smoothScroll 60s linear infinite;
            padding-bottom: 100px;
        }

        @keyframes smoothScroll {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-50%);
            }
        }

        /* é¼ æ ‡æ‚¬åœæ—¶æš‚åœæ»šåŠ¨ */
        .welcome-content:hover .scrolling-content {
            animation-play-state: paused;
        }

        .model-info {
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(240,248,255,0.1));
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .model-info h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 1rem;
            padding: 8px 12px;
            background: rgba(255,255,255,0.3);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .info-label {
            font-weight: 700;
            color: #34495e;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .info-value {
            color: #2c3e50;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.6);
        }

        .error-message {
            background: linear-gradient(135deg, rgba(255, 235, 238, 0.9), rgba(255, 205, 210, 0.8));
            color: #c62828;
            padding: 18px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #f44336;
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(244, 67, 54, 0.2);
        }

        .success-message {
            background: linear-gradient(135deg, rgba(232, 245, 233, 0.9), rgba(200, 230, 201, 0.8));
            color: #2e7d32;
            padding: 18px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 5px solid #4caf50;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.2);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .sidebar {
                order: 2;
            }
            
            .viewer-container {
                order: 1;
                height: 400px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ 3Dæ¨¡å‹é¢„è§ˆå™¨</h1>
            <p>ä¸Šä¼ GLBæ–‡ä»¶ï¼Œä½“éªŒäº¤äº’å¼3Dé¢„è§ˆ</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ GLBæ–‡ä»¶</div>
                    <div class="upload-hint">æ”¯æŒ.glbæ ¼å¼æ–‡ä»¶</div>
                </div>
                <input type="file" id="fileInput" accept=".glb" />

                <div class="controls">
                    <div class="control-group">
                        <label>ç¯å¢ƒå…‰å¼ºåº¦</label>
                        <div class="control-row">
                            <input type="range" class="slider" id="ambientLight" min="0" max="2" step="0.1" value="0.4">
                            <span class="value-display" id="ambientValue">0.4</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>ä¸»å…‰æºå¼ºåº¦</label>
                        <div class="control-row">
                            <input type="range" class="slider" id="directionalLight" min="0" max="3" step="0.1" value="1">
                            <span class="value-display" id="directionalValue">1.0</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>æ¨¡å‹ç¼©æ”¾</label>
                        <div class="control-row">
                            <input type="range" class="slider" id="modelScale" min="0.1" max="10" step="0.1" value="1">
                            <span class="value-display" id="scaleValue">1.0</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>åŸºå‡†é¢é«˜åº¦</label>
                        <div class="control-row">
                            <input type="range" class="slider" id="gridHeight" min="-50" max="50" step="0.1" value="0" disabled>
                            <span class="value-display" id="gridHeightValue">0.0</span>
                        </div>
                    </div>

                    <button class="btn" id="resetCamera">é‡ç½®è§†è§’</button>
                    <button class="btn" id="toggleWireframe">åˆ‡æ¢çº¿æ¡†æ¨¡å¼</button>
                    <button class="btn" id="toggleAnimation" disabled>æ’­æ”¾åŠ¨ç”»</button>
                    <button class="btn" id="clearModel" disabled style="background: linear-gradient(145deg, #e74c3c, #c0392b);">æ¸…é™¤æ¨¡å‹</button>
                </div>

                <div class="model-info" id="modelInfo" style="display: none;">
                    <h3>æ¨¡å‹ä¿¡æ¯</h3>
                    <div class="info-item">
                        <span class="info-label">æ–‡ä»¶å:</span>
                        <span class="info-value" id="fileName">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">æ–‡ä»¶å¤§å°:</span>
                        <span class="info-value" id="fileSize">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">é¡¶ç‚¹æ•°:</span>
                        <span class="info-value" id="vertexCount">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">é¢æ•°:</span>
                        <span class="info-value" id="faceCount">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">åŠ¨ç”»:</span>
                        <span class="info-value" id="animationCount">-</span>
                    </div>
                </div>

                <div id="messageArea"></div>
            </div>

            <div class="viewer-container">
                <canvas id="viewer"></canvas>
                <div class="loading" id="loading" style="display: none;">
                    <div class="spinner"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
                
                <!-- æ¬¢è¿ç•Œé¢ -->
                <div class="welcome-screen" id="welcomeScreen">
                    <div class="welcome-content">
                        <div class="scrolling-content">
                            <div class="welcome-icon">ğŸ¯</div>
                            <h2>3Dæ¨¡å‹é¢„è§ˆå™¨</h2>
                            <p class="welcome-subtitle">ä¸“ä¸šçš„GLBæ ¼å¼3Dæ¨¡å‹æŸ¥çœ‹å·¥å…·</p>
                            
                            <div class="feature-grid">
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ“</div>
                                    <h3>æ–‡ä»¶ä¸Šä¼ </h3>
                                    <p>æ”¯æŒæ‹–æ‹½ä¸Šä¼ GLBæ ¼å¼æ–‡ä»¶</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ®</div>
                                    <h3>äº¤äº’æ§åˆ¶</h3>
                                    <p>360Â°æ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»æ“ä½œ</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ’¡</div>
                                    <h3>å…‰ç…§è°ƒèŠ‚</h3>
                                    <p>ç¯å¢ƒå…‰å’Œä¸»å…‰æºå¼ºåº¦æ§åˆ¶</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ¬</div>
                                    <h3>åŠ¨ç”»æ’­æ”¾</h3>
                                    <p>æ”¯æŒæ¨¡å‹å†…ç½®åŠ¨ç”»æ’­æ”¾</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ“</div>
                                    <h3>ç²¾ç¡®ç¼©æ”¾</h3>
                                    <p>0.1x - 10xç²¾ç¡®ç¼©æ”¾æ§åˆ¶</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ”§</div>
                                    <h3>çº¿æ¡†æ¨¡å¼</h3>
                                    <p>åˆ‡æ¢æŸ¥çœ‹æ¨¡å‹ç»“æ„æ¡†æ¶</p>
                                </div>
                            </div>
                            
                            <div class="welcome-tips">
                                <h3>ğŸ’¡ ä½¿ç”¨æç¤º</h3>
                                <ul>
                                    <li><strong>é¼ æ ‡å·¦é”®æ‹–æ‹½</strong> - æ—‹è½¬è§†è§’</li>
                                    <li><strong>é¼ æ ‡æ»šè½®</strong> - ç¼©æ”¾æ¨¡å‹</li>
                                    <li><strong>é¼ æ ‡å³é”®æ‹–æ‹½</strong> - å¹³ç§»è§†è§’</li>
                                    <li><strong>åŸºå‡†é¢è°ƒèŠ‚</strong> - è°ƒæ•´å‚è€ƒç½‘æ ¼ä½ç½®</li>
                                </ul>
                            </div>
                            
                            <div class="upload-prompt">
                                <div class="upload-prompt-icon">â¬…ï¸</div>
                                <p>è¯·ä»å·¦ä¾§ä¸Šä¼ GLBæ–‡ä»¶å¼€å§‹ä½“éªŒ</p>
                            </div>

                            <!-- é‡å¤å†…å®¹ç”¨äºæ— ç¼æ»šåŠ¨ -->
                            <div class="welcome-icon">ğŸ¯</div>
                            <h2>3Dæ¨¡å‹é¢„è§ˆå™¨</h2>
                            <p class="welcome-subtitle">ä¸“ä¸šçš„GLBæ ¼å¼3Dæ¨¡å‹æŸ¥çœ‹å·¥å…·</p>
                            
                            <div class="feature-grid">
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ“</div>
                                    <h3>æ–‡ä»¶ä¸Šä¼ </h3>
                                    <p>æ”¯æŒæ‹–æ‹½ä¸Šä¼ GLBæ ¼å¼æ–‡ä»¶</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ®</div>
                                    <h3>äº¤äº’æ§åˆ¶</h3>
                                    <p>360Â°æ—‹è½¬ã€ç¼©æ”¾ã€å¹³ç§»æ“ä½œ</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ’¡</div>
                                    <h3>å…‰ç…§è°ƒèŠ‚</h3>
                                    <p>ç¯å¢ƒå…‰å’Œä¸»å…‰æºå¼ºåº¦æ§åˆ¶</p>
                                </div>
                                <div class="feature-item">
                                    <div class="feature-icon">ğŸ¬</div>
                                    <h3>åŠ¨ç”»æ’­æ”¾</h3>
                                    <p>æ”¯æŒæ¨¡å‹å†…ç½®åŠ¨ç”»æ’­æ”¾</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ModelViewer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.model = null;
                this.mixer = null;
                this.clock = new THREE.Clock();
                this.ambientLight = null;
                this.directionalLight = null;
                this.wireframeMode = false;
                this.originalMaterials = [];
                this.animationActions = [];
                this.isAnimationPlaying = false;
                this.baseScaleFactor = 1; // å­˜å‚¨åŸºç¡€ç¼©æ”¾å› å­
                
                this.init();
                this.setupEventListeners();
                this.animate();
            }

            init() {
                const canvas = document.getElementById('viewer');
                const container = canvas.parentElement;

                // åˆ›å»ºåœºæ™¯
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf0f0f0);

                // åˆ›å»ºç›¸æœº
                this.camera = new THREE.PerspectiveCamera(
                    75,
                    container.clientWidth / container.clientHeight,
                    0.1,
                    1000
                );
                this.camera.position.set(5, 5, 5);

                // åˆ›å»ºæ¸²æŸ“å™¨
                this.renderer = new THREE.WebGLRenderer({ 
                    canvas: canvas, 
                    antialias: true 
                });
                this.renderer.setSize(container.clientWidth, container.clientHeight);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.renderer.outputEncoding = THREE.sRGBEncoding;
                this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
                this.renderer.toneMappingExposure = 1;

                // åˆ›å»ºæ§åˆ¶å™¨
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = false;
                this.controls.minDistance = 1;
                this.controls.maxDistance = 100;

                // æ·»åŠ å…‰ç…§
                this.setupLighting();

                // åˆå§‹åŒ–æ—¶ä¸æ·»åŠ ç½‘æ ¼ï¼Œç­‰æ¨¡å‹åŠ è½½åå†æ·»åŠ 
                this.gridHelper = null;

                // å¤„ç†çª—å£å¤§å°å˜åŒ–
                window.addEventListener('resize', () => this.onWindowResize());
            }

            setupLighting() {
                // ç¯å¢ƒå…‰
                this.ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                this.scene.add(this.ambientLight);

                // ä¸»å…‰æº
                this.directionalLight = new THREE.DirectionalLight(0xffffff, 1);
                this.directionalLight.position.set(10, 10, 5);
                this.directionalLight.castShadow = true;
                this.directionalLight.shadow.mapSize.width = 2048;
                this.directionalLight.shadow.mapSize.height = 2048;
                this.directionalLight.shadow.camera.near = 0.5;
                this.directionalLight.shadow.camera.far = 50;
                this.scene.add(this.directionalLight);

                // è¡¥å…‰
                const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);
                fillLight.position.set(-10, -10, -5);
                this.scene.add(fillLight);
            }

            addGrid(modelSize, modelCenter) {
                // ç§»é™¤æ—§çš„ç½‘æ ¼
                if (this.gridHelper) {
                    this.scene.remove(this.gridHelper);
                }

                // æ ¹æ®æ¨¡å‹å¤§å°è°ƒæ•´ç½‘æ ¼å°ºå¯¸
                const gridSize = Math.max(modelSize * 1.5, 10);
                const divisions = Math.max(Math.floor(gridSize / 2), 10);
                
                this.gridHelper = new THREE.GridHelper(gridSize, divisions, 0x888888, 0xcccccc);
                
                // åˆå§‹å°†ç½‘æ ¼å®šä½åˆ°æ¨¡å‹åº•éƒ¨ä¸­å¿ƒ
                const initialY = -modelSize / 2;
                this.gridHelper.position.set(
                    modelCenter.x, 
                    initialY, 
                    modelCenter.z
                );
                
                // æ›´æ–°æ»‘å—èŒƒå›´å’Œåˆå§‹å€¼
                const gridHeightSlider = document.getElementById('gridHeight');
                const gridHeightValue = document.getElementById('gridHeightValue');
                gridHeightSlider.min = -50;
                gridHeightSlider.max = 50;
                gridHeightSlider.value = initialY;
                gridHeightSlider.disabled = false;
                gridHeightValue.textContent = initialY.toFixed(1);
                
                this.scene.add(this.gridHelper);
            }

            setupEventListeners() {
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');

                // æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
                uploadArea.addEventListener('click', () => fileInput.click());
                uploadArea.addEventListener('dragover', this.handleDragOver.bind(this));
                uploadArea.addEventListener('dragleave', this.handleDragLeave.bind(this));
                uploadArea.addEventListener('drop', this.handleDrop.bind(this));
                fileInput.addEventListener('change', this.handleFileSelect.bind(this));

                // æ§åˆ¶å™¨äº‹ä»¶
                document.getElementById('ambientLight').addEventListener('input', (e) => {
                    this.ambientLight.intensity = parseFloat(e.target.value);
                    document.getElementById('ambientValue').textContent = e.target.value;
                });

                document.getElementById('directionalLight').addEventListener('input', (e) => {
                    this.directionalLight.intensity = parseFloat(e.target.value);
                    document.getElementById('directionalValue').textContent = e.target.value;
                });

                document.getElementById('modelScale').addEventListener('input', (e) => {
                    const relativeScale = parseFloat(e.target.value);
                    if (this.model && this.baseScaleFactor) {
                        // åŸºäºåŸå§‹ç¼©æ”¾å› å­è¿›è¡Œç›¸å¯¹ç¼©æ”¾
                        const actualScale = this.baseScaleFactor * relativeScale;
                        this.model.scale.setScalar(actualScale);
                    }
                    document.getElementById('scaleValue').textContent = e.target.value;
                });

                document.getElementById('gridHeight').addEventListener('input', (e) => {
                    const height = parseFloat(e.target.value);
                    if (this.gridHelper) {
                        this.gridHelper.position.y = height;
                        // æ›´æ–°è½¨é“æ§åˆ¶çš„ç›®æ ‡ç‚¹ï¼Œä½¿æ—‹è½¬ä¸­å¿ƒè·ŸéšåŸºå‡†é¢
                        this.controls.target.y = height;
                        this.controls.update();
                    }
                    document.getElementById('gridHeightValue').textContent = e.target.value;
                });

                document.getElementById('resetCamera').addEventListener('click', () => {
                    this.resetCamera();
                });

                document.getElementById('toggleWireframe').addEventListener('click', () => {
                    this.toggleWireframe();
                });

                document.getElementById('toggleAnimation').addEventListener('click', () => {
                    this.toggleAnimation();
                });

                document.getElementById('clearModel').addEventListener('click', () => {
                    this.clearModel();
                });
            }

            handleDragOver(e) {
                e.preventDefault();
                e.currentTarget.classList.add('dragover');
            }

            handleDragLeave(e) {
                e.currentTarget.classList.remove('dragover');
            }

            handleDrop(e) {
                e.preventDefault();
                e.currentTarget.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.loadModel(files[0]);
                }
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.loadModel(file);
                }
            }

            loadModel(file) {
                if (!file.name.toLowerCase().endsWith('.glb')) {
                    this.showMessage('è¯·é€‰æ‹©GLBæ ¼å¼çš„æ–‡ä»¶', 'error');
                    return;
                }

                this.showLoading(true);
                this.clearMessages();

                const reader = new FileReader();
                reader.onload = (e) => {
                    const arrayBuffer = e.target.result;
                    const loader = new THREE.GLTFLoader();

                    loader.parse(arrayBuffer, '', (gltf) => {
                        this.onModelLoaded(gltf, file);
                    }, (error) => {
                        this.showLoading(false);
                        this.showMessage('æ¨¡å‹åŠ è½½å¤±è´¥: ' + error.message, 'error');
                    });
                };

                reader.onerror = () => {
                    this.showLoading(false);
                    this.showMessage('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
                };

                reader.readAsArrayBuffer(file);
            }

            onModelLoaded(gltf, file) {
                // æ¸…é™¤ä¹‹å‰çš„æ¨¡å‹
                if (this.model) {
                    this.scene.remove(this.model);
                }

                // åœæ­¢ä¹‹å‰çš„åŠ¨ç”»
                if (this.mixer) {
                    this.mixer.stopAllAction();
                }

                // æ¸…ç©ºåŸå§‹æè´¨æ•°ç»„
                this.originalMaterials = [];

                this.model = gltf.scene;
                this.scene.add(this.model);

                // è®¾ç½®æ¨¡å‹å±æ€§å¹¶ä¿å­˜åŸå§‹æè´¨
                this.model.traverse((child) => {
                    if (child.isMesh) {
                        child.castShadow = true;
                        child.receiveShadow = true;
                        // ä¸ºæ¯ä¸ªmeshä¿å­˜å…¶åŸå§‹æè´¨çš„å¼•ç”¨
                        child.userData.originalMaterial = child.material;
                        this.originalMaterials.push(child.material);
                    }
                });

                // è®¡ç®—è¾¹ç•Œç›’
                const box = new THREE.Box3().setFromObject(this.model);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());

                // å°†æ¨¡å‹å±…ä¸­åˆ°åŸç‚¹
                this.model.position.sub(center);

                // è‡ªåŠ¨ç¼©æ”¾æ¨¡å‹ä»¥é€‚åº”è§†å£
                const maxDim = Math.max(size.x, size.y, size.z);
                const targetSize = 8; // ç›®æ ‡å¤§å°ï¼Œå¯ä»¥è°ƒæ•´è¿™ä¸ªå€¼æ¥æ§åˆ¶æ¨¡å‹çš„é»˜è®¤å¤§å°
                const scaleFactor = targetSize / maxDim;
                this.baseScaleFactor = scaleFactor; // ä¿å­˜åŸºç¡€ç¼©æ”¾å› å­
                this.model.scale.setScalar(scaleFactor);

                // é‡ç½®ç¼©æ”¾æ»‘å—ä¸º1.0ï¼ˆè¡¨ç¤ºå½“å‰æ˜¾ç¤ºçš„å¤§å°ä¸ºåŸºå‡†ï¼‰
                document.getElementById('modelScale').value = 1.0;
                document.getElementById('scaleValue').textContent = '1.0';

                // è®¡ç®—åŸºå‡†é¢åˆå§‹ä½ç½®
                const scaledSize = maxDim * scaleFactor;
                const initialGridY = -scaledSize / 2; // åŸºå‡†é¢ä½ç½®åœ¨æ¨¡å‹åº•éƒ¨
                
                // æ·»åŠ ä»¥æ¨¡å‹ä¸ºä¸­å¿ƒçš„ç½‘æ ¼
                this.addGrid(scaledSize, new THREE.Vector3(0, 0, 0));

                // è°ƒæ•´ç›¸æœºä½ç½®ä»¥è·å¾—æ›´å¥½çš„è§†è§’
                const fov = this.camera.fov * (Math.PI / 180);
                let cameraDistance = Math.abs(scaledSize / 2 / Math.tan(fov / 2));
                cameraDistance *= 2.5; // ç•™è¶³å¤Ÿçš„ç©ºé—´

                // è®¾ç½®ç›¸æœºä½ç½®ï¼Œä½¿ç”¨æ›´å¥½çš„è§’åº¦
                this.camera.position.set(
                    cameraDistance * 0.8,
                    initialGridY + cameraDistance * 0.6,
                    cameraDistance * 0.8
                );
                
                // è®¾ç½®è½¨é“æ§åˆ¶çš„ç›®æ ‡ç‚¹ä¸ºåŸºå‡†é¢ä¸­å¿ƒ
                this.camera.lookAt(0, initialGridY, 0);
                this.controls.target.set(0, initialGridY, 0);
                
                // è°ƒæ•´æ§åˆ¶å™¨çš„è·ç¦»é™åˆ¶
                this.controls.minDistance = cameraDistance * 0.1;
                this.controls.maxDistance = cameraDistance * 5;
                this.controls.update();

                // è®¾ç½®åŠ¨ç”»
                this.setupAnimations(gltf);

                // æ˜¾ç¤ºæ¨¡å‹ä¿¡æ¯
                this.displayModelInfo(gltf, file, scaleFactor);

                // å¯ç”¨æ¸…é™¤æ¨¡å‹æŒ‰é’®
                document.getElementById('clearModel').disabled = false;

                // éšè—æ¬¢è¿ç•Œé¢
                document.getElementById('welcomeScreen').style.display = 'none';

                this.showLoading(false);
                this.showMessage('æ¨¡å‹åŠ è½½æˆåŠŸï¼', 'success');
            }

            setupAnimations(gltf) {
                this.animationActions = [];
                
                if (gltf.animations && gltf.animations.length > 0) {
                    this.mixer = new THREE.AnimationMixer(this.model);
                    
                    gltf.animations.forEach((clip) => {
                        const action = this.mixer.clipAction(clip);
                        this.animationActions.push(action);
                    });

                    document.getElementById('toggleAnimation').disabled = false;
                } else {
                    document.getElementById('toggleAnimation').disabled = true;
                }
            }

            displayModelInfo(gltf, file, scaleFactor) {
                let vertexCount = 0;
                let faceCount = 0;

                this.model.traverse((child) => {
                    if (child.isMesh && child.geometry) {
                        const geometry = child.geometry;
                        if (geometry.attributes.position) {
                            vertexCount += geometry.attributes.position.count;
                        }
                        if (geometry.index) {
                            faceCount += geometry.index.count / 3;
                        } else if (geometry.attributes.position) {
                            faceCount += geometry.attributes.position.count / 3;
                        }
                    }
                });

                document.getElementById('fileName').textContent = file.name;
                document.getElementById('fileSize').textContent = this.formatFileSize(file.size);
                document.getElementById('vertexCount').textContent = vertexCount.toLocaleString();
                document.getElementById('faceCount').textContent = Math.floor(faceCount).toLocaleString();
                document.getElementById('animationCount').textContent = gltf.animations ? gltf.animations.length : 0;

                document.getElementById('modelInfo').style.display = 'block';
            }

            formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            resetCamera() {
                if (this.model) {
                    // è·å–å½“å‰æ¨¡å‹çš„å®é™…å¤§å°ï¼ˆè€ƒè™‘ç¼©æ”¾ï¼‰
                    const box = new THREE.Box3().setFromObject(this.model);
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    
                    const fov = this.camera.fov * (Math.PI / 180);
                    let cameraDistance = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                    cameraDistance *= 2.5; // ç•™è¶³å¤Ÿçš„ç©ºé—´

                    // è·å–å½“å‰åŸºå‡†é¢çš„é«˜åº¦
                    const currentGridY = this.gridHelper ? this.gridHelper.position.y : 0;

                    // è®¾ç½®ç›¸æœºä½ç½®ï¼Œä½¿ç”¨æ›´å¥½çš„è§’åº¦ï¼Œä½†Yåæ ‡è¦è€ƒè™‘åŸºå‡†é¢é«˜åº¦
                    this.camera.position.set(
                        cameraDistance * 0.8,
                        currentGridY + cameraDistance * 0.6,
                        cameraDistance * 0.8
                    );
                    
                    // ç¡®ä¿è½¨é“æ§åˆ¶ç›®æ ‡åœ¨å½“å‰åŸºå‡†é¢ä½ç½®
                    this.camera.lookAt(0, currentGridY, 0);
                    this.controls.target.set(0, currentGridY, 0);
                    
                    // è°ƒæ•´æ§åˆ¶å™¨çš„è·ç¦»é™åˆ¶
                    this.controls.minDistance = cameraDistance * 0.1;
                    this.controls.maxDistance = cameraDistance * 5;
                    this.controls.update();
                }
            }

            toggleWireframe() {
                if (!this.model) return;

                this.wireframeMode = !this.wireframeMode;
                
                this.model.traverse((child) => {
                    if (child.isMesh) {
                        if (this.wireframeMode) {
                            // ä¿å­˜å½“å‰æè´¨å¹¶åˆ‡æ¢åˆ°çº¿æ¡†æ¨¡å¼
                            if (!child.userData.originalMaterial) {
                                child.userData.originalMaterial = child.material;
                            }
                            child.material = new THREE.MeshBasicMaterial({
                                color: 0x00ff00,
                                wireframe: true
                            });
                        } else {
                            // æ¢å¤åŸå§‹æè´¨
                            if (child.userData.originalMaterial) {
                                child.material = child.userData.originalMaterial;
                            }
                        }
                    }
                });

                const btn = document.getElementById('toggleWireframe');
                btn.textContent = this.wireframeMode ? 'é€€å‡ºçº¿æ¡†æ¨¡å¼' : 'åˆ‡æ¢çº¿æ¡†æ¨¡å¼';
            }

            toggleAnimation() {
                if (!this.mixer || this.animationActions.length === 0) return;

                if (this.isAnimationPlaying) {
                    this.animationActions.forEach(action => action.stop());
                    this.isAnimationPlaying = false;
                    document.getElementById('toggleAnimation').textContent = 'æ’­æ”¾åŠ¨ç”»';
                } else {
                    this.animationActions.forEach(action => {
                        action.reset();
                        action.play();
                    });
                    this.isAnimationPlaying = true;
                    document.getElementById('toggleAnimation').textContent = 'åœæ­¢åŠ¨ç”»';
                }
            }

            clearModel() {
                // ç§»é™¤æ¨¡å‹
                if (this.model) {
                    this.scene.remove(this.model);
                    this.model = null;
                }

                // åœæ­¢åŠ¨ç”»
                if (this.mixer) {
                    this.mixer.stopAllAction();
                    this.mixer = null;
                }

                // ç§»é™¤ç½‘æ ¼
                if (this.gridHelper) {
                    this.scene.remove(this.gridHelper);
                    this.gridHelper = null;
                }

                // é‡ç½®å˜é‡
                this.originalMaterials = [];
                this.animationActions = [];
                this.isAnimationPlaying = false;
                this.wireframeMode = false;
                this.baseScaleFactor = 1;

                // é‡ç½®æ§åˆ¶å™¨
                document.getElementById('modelScale').value = 1;
                document.getElementById('scaleValue').textContent = '1.0';
                document.getElementById('gridHeight').value = 0;
                document.getElementById('gridHeight').disabled = true;
                document.getElementById('gridHeightValue').textContent = '0.0';

                // é‡ç½®æŒ‰é’®çŠ¶æ€
                document.getElementById('toggleWireframe').textContent = 'åˆ‡æ¢çº¿æ¡†æ¨¡å¼';
                document.getElementById('toggleAnimation').disabled = true;
                document.getElementById('toggleAnimation').textContent = 'æ’­æ”¾åŠ¨ç”»';
                document.getElementById('clearModel').disabled = true;

                // éšè—æ¨¡å‹ä¿¡æ¯
                document.getElementById('modelInfo').style.display = 'none';

                // æ˜¾ç¤ºæ¬¢è¿ç•Œé¢
                document.getElementById('welcomeScreen').style.display = 'flex';

                // é‡ç½®ç›¸æœºä½ç½®
                this.camera.position.set(5, 5, 5);
                this.camera.lookAt(0, 0, 0);
                this.controls.target.set(0, 0, 0);
                this.controls.minDistance = 1;
                this.controls.maxDistance = 100;
                this.controls.update();

                // æ¸…é™¤æ–‡ä»¶è¾“å…¥
                document.getElementById('fileInput').value = '';

                this.showMessage('æ¨¡å‹å·²æ¸…é™¤ï¼Œå¯ä»¥é‡æ–°ä¸Šä¼ ', 'success');
            }

            showLoading(show) {
                document.getElementById('loading').style.display = show ? 'block' : 'none';
            }

            showMessage(message, type) {
                const messageArea = document.getElementById('messageArea');
                const messageDiv = document.createElement('div');
                messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
                messageDiv.textContent = message;
                messageArea.appendChild(messageDiv);

                // 3ç§’åè‡ªåŠ¨ç§»é™¤æ¶ˆæ¯
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 3000);
            }

            clearMessages() {
                document.getElementById('messageArea').innerHTML = '';
            }

            onWindowResize() {
                const canvas = document.getElementById('viewer');
                const container = canvas.parentElement;
                
                this.camera.aspect = container.clientWidth / container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(container.clientWidth, container.clientHeight);
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                // æ›´æ–°æ§åˆ¶å™¨
                this.controls.update();

                // æ›´æ–°åŠ¨ç”»
                if (this.mixer) {
                    this.mixer.update(this.clock.getDelta());
                }

                // æ¸²æŸ“åœºæ™¯
                this.renderer.render(this.scene, this.camera);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new ModelViewer();
        });
    </script>
</body>
</html>
