<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>深度单位换算器</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.1;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.2em;
            margin-bottom: 20px;
            position: relative;
        }

        .feature-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin: 0 5px;
            backdrop-filter: blur(10px);
        }

        .main-content {
            padding: 40px;
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            gap: 40px;
            align-items: start;
        }

        .input-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .input-group select,
        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .input-group select:focus,
        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .category-tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
        }

        .category-tab {
            padding: 15px;
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #495057;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .category-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .category-tab:hover {
            background: linear-gradient(135deg, #dee2e6 0%, #ced4da 100%);
            transform: translateY(-2px);
        }

        .results-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            max-height: 600px;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
        }

        .results-header h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin: 0;
        }

        .results-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .result-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .result-item .unit {
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .result-item .value {
            font-family: 'Fira Code', 'Courier New', monospace;
            font-size: 1.2em;
            color: #667eea;
            font-weight: 600;
        }

        .delete-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
        }

        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .custom-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(255, 235, 156, 0.5);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        }

        .custom-section h3 {
            color: #856404;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-align: center;
        }

        .formula-input {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 20px;
        }

        .formula-input input {
            padding: 15px;
            border: 2px solid #ffeaa7;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }

        .formula-input input:focus {
            outline: none;
            border-color: #fd7e14;
            box-shadow: 0 0 0 3px rgba(253, 126, 20, 0.1);
        }

        .formula-input button {
            padding: 15px;
            background: linear-gradient(135deg, #fd7e14 0%, #f76707 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(253, 126, 20, 0.3);
        }

        .formula-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(253, 126, 20, 0.4);
        }

        .dpi-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid rgba(255, 193, 7, 0.3);
        }

        .dpi-section h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .dpi-controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
        }

        .dpi-controls input {
            padding: 12px;
            border: 2px solid #ffeaa7;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .dpi-controls button {
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .dpi-controls button:hover {
            transform: translateY(-2px);
        }

        .footer {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }

        .footer p {
            margin: 0;
            font-size: 1.1em;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-item {
            animation: fadeIn 0.3s ease;
        }

        /* 滚动条样式 */
        .results-section::-webkit-scrollbar {
            width: 8px;
        }

        .results-section::-webkit-scrollbar-track {
            background: #f1f3f4;
            border-radius: 4px;
        }

        .results-section::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .results-section::-webkit-scrollbar-thumb:hover {
            background: #5a67d8;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .input-section,
            .results-section,
            .custom-section {
                padding: 20px;
            }
            
            .category-tabs {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            }
            
            .formula-input {
                grid-template-columns: 1fr;
            }
            
            .dpi-controls {
                grid-template-columns: 1fr;
            }
            
            .feature-badge {
                display: block;
                margin: 5px 0;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .header p {
                font-size: 1em;
            }
            
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .delete-btn {
                margin-left: 0;
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>深度单位换算器</h1>
            <p>专业级多维度单位转换工具，支持高精度计算与自定义公式</p>
            <div style="margin-top: 20px;">
                <span class="feature-badge">多类别支持</span>
                <span class="feature-badge">高精度计算</span>
                <span class="feature-badge">实时同步</span>
                <span class="feature-badge">自定义公式</span>
                <span class="feature-badge">专业领域</span>
            </div>
        </div>

        <div class="main-content">
            <div class="input-section">
                <div class="input-group">
                    <label for="inputValue">输入数值：</label>
                    <input type="number" id="inputValue" step="any" placeholder="请输入数值" value="1">
                </div>

                <div class="input-group">
                    <label for="inputUnit">选择单位：</label>
                    <select id="inputUnit">
                        <optgroup label="公制单位">
                            <option value="km">千米 (km)</option>
                            <option value="m">米 (m)</option>
                            <option value="dm">分米 (dm)</option>
                            <option value="cm">厘米 (cm)</option>
                            <option value="mm">毫米 (mm)</option>
                            <option value="um">微米 (μm)</option>
                            <option value="nm">纳米 (nm)</option>
                            <option value="pm">皮米 (pm)</option>
                        </optgroup>
                        <optgroup label="英制单位">
                            <option value="ft">英尺 (ft)</option>
                            <option value="in">英寸 (in)</option>
                            <option value="yd">码 (yd)</option>
                            <option value="mi">英里 (mi)</option>
                        </optgroup>
                        <optgroup label="航海单位">
                            <option value="nmi">海里 (nmi)</option>
                            <option value="fathom">英寻 (fathom)</option>
                        </optgroup>
                        <optgroup label="天文单位">
                            <option value="au">天文单位 (AU)</option>
                            <option value="ly">光年 (ly)</option>
                            <option value="pc">秒差距 (pc)</option>
                        </optgroup>
                        <optgroup label="像素单位">
                            <option value="px">像素 (px)</option>
                        </optgroup>
                        <optgroup label="数据存储">
                            <option value="B">字节 (B)</option>
                            <option value="KB">千字节 (KB)</option>
                            <option value="MB">兆字节 (MB)</option>
                        </optgroup>
                        <optgroup label="能量单位">
                            <option value="J">焦耳 (J)</option>
                            <option value="kJ">千焦 (kJ)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="category-tabs">
                    <button class="category-tab active" data-category="all">全部单位</button>
                    <button class="category-tab" data-category="metric">公制单位</button>
                    <button class="category-tab" data-category="imperial">英制单位</button>
                    <button class="category-tab" data-category="nautical">航海单位</button>
                    <button class="category-tab" data-category="astronomical">天文单位</button>
                    <button class="category-tab" data-category="pixel">像素单位</button>
                    <button class="category-tab" data-category="storage">数据存储</button>
                    <button class="category-tab" data-category="energy">能量单位</button>
                </div>
            </div>

            <div class="results-section" id="resultsContainer">
                <div class="results-header">
                    <h3>换算结果</h3>
                    <span class="results-count" id="resultsCount">0 个单位</span>
                </div>
                <!-- 结果将通过JavaScript动态生成 -->
            </div>

            <div class="custom-section">
                <h3>自定义单位公式</h3>
                <div class="formula-input">
                    <input type="text" id="customUnitName" placeholder="单位名称 (如: 丈)">
                    <input type="text" id="customFormula" placeholder="换算公式 (如: value * 3.333)">
                    <button onclick="addCustomUnit()">添加单位</button>
                </div>
                <p>提示：公式中使用 "value" 表示输入值，例如：value * 1000 表示将输入值转换为毫米</p>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ffeaa7;">
                    <h4>DPI设置（像素与毫米转换）</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div>
                            <label for="dpiInput">DPI值：</label>
                            <input type="number" id="dpiInput" value="96" min="1" max="1000" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="opacity: 0;">更新</label>
                            <button onclick="updateDpi()" style="width: 100%; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">更新DPI</button>
                        </div>
                    </div>
                    <p style="font-size: 0.9em; color: #666;">当前DPI: <span id="currentDpi">96</span> (1像素 = <span id="pixelToMm">0.264583</span> 毫米)</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>© 2024 深度单位换算器 | 高精度计算 | 支持多类别单位换算</p>
        </div>
    </div>

    <script>
        // 单位换算基准（以米为基准）
        const unitConversions = {
            // 公制单位
            'km': 1000,
            'm': 1,
            'dm': 0.1,
            'cm': 0.01,
            'mm': 0.001,
            'um': 0.000001,
            'nm': 0.000000001,
            'pm': 0.000000000001,
            
            // 英制单位
            'ft': 0.3048,
            'in': 0.0254,
            'yd': 0.9144,
            'mi': 1609.344,
            
            // 航海单位
            'nmi': 1852,
            'fathom': 1.8288,
            
            // 天文单位
            'au': 149597870700,
            'ly': 9460730472580800,
            'pc': 30856775814913670,
            
            // 像素单位（基于96 DPI标准）
            'px': 0.2645833333, // 1px = 0.264583mm (96 DPI)
            
            // 数据存储单位
            'B': 1,
            'KB': 1024,
            'MB': 1048576,
            
            // 能量单位
            'J': 1,
            'kJ': 1000
        };

        // 单位分类
        const unitCategories = {
            'metric': ['km', 'm', 'dm', 'cm', 'mm', 'um', 'nm', 'pm'],
            'imperial': ['ft', 'in', 'yd', 'mi'],
            'nautical': ['nmi', 'fathom'],
            'astronomical': ['au', 'ly', 'pc'],
            'pixel': ['px'],
            'storage': ['B', 'KB', 'MB'],
            'energy': ['J', 'kJ']
        };

        // 单位显示名称
        const unitDisplayNames = {
            'km': '千米',
            'm': '米',
            'dm': '分米',
            'cm': '厘米',
            'mm': '毫米',
            'um': '微米',
            'nm': '纳米',
            'pm': '皮米',
            'ft': '英尺',
            'in': '英寸',
            'yd': '码',
            'mi': '英里',
            'nmi': '海里',
            'fathom': '英寻',
            'au': '天文单位',
            'ly': '光年',
            'pc': '秒差距',
            'px': '像素',
            'B': '字节',
            'KB': '千字节',
            'MB': '兆字节',
            'J': '焦耳',
            'kJ': '千焦'
        };

        let customUnits = {};
        let currentCategory = 'all';
        let currentDpi = 96;

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateResults();
            setupEventListeners();
        });

        function setupEventListeners() {
            // 输入值变化监听
            document.getElementById('inputValue').addEventListener('input', updateResults);
            document.getElementById('inputUnit').addEventListener('change', updateResults);
            
            // 分类标签点击监听
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentCategory = tab.dataset.category;
                    updateResults();
                });
            });
        }

        function updateDpi() {
            const newDpi = parseInt(document.getElementById('dpiInput').value) || 96;
            if (newDpi >= 1 && newDpi <= 1000) {
                currentDpi = newDpi;
                // 更新像素单位换算（1英寸 = 25.4毫米）
                unitConversions['px'] = 25.4 / currentDpi;
                
                document.getElementById('currentDpi').textContent = currentDpi;
                document.getElementById('pixelToMm').textContent = (25.4 / currentDpi).toFixed(6);
                
                updateResults();
                alert(`DPI已更新为 ${currentDpi}`);
            } else {
                alert('请输入有效的DPI值（1-1000）');
            }
        }

        function updateResults() {
            const inputValue = parseFloat(document.getElementById('inputValue').value) || 0;
            const inputUnit = document.getElementById('inputUnit').value;
            
            // 转换为基准单位（米）
            let baseValue;
            if (inputUnit === 'px') {
                // 像素单位特殊处理：基于当前DPI
                baseValue = inputValue * (25.4 / currentDpi) / 1000; // 转换为米
            } else {
                baseValue = inputValue * unitConversions[inputUnit];
            }
            
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = `
                <div class="results-header">
                    <h3>换算结果</h3>
                    <span class="results-count" id="resultsCount">0 个单位</span>
                </div>
            `;
            
            // 获取当前分类的单位
            let unitsToShow = [];
            if (currentCategory === 'all') {
                unitsToShow = Object.keys(unitConversions);
                // 只在全部单位模式下添加自定义单位一次
                Object.keys(customUnits).forEach(unit => {
                    if (!unitsToShow.includes(unit)) {
                        unitsToShow.push(unit);
                    }
                });
            } else {
                unitsToShow = unitCategories[currentCategory] || [];
            }
            
            let resultCount = 0;
            
            // 计算并显示结果
            unitsToShow.forEach((unit, index) => {
                let convertedValue;
                let displayName;
                
                if (customUnits[unit]) {
                    // 自定义单位
                    try {
                        const formula = customUnits[unit].replace(/value/g, inputValue.toString());
                        convertedValue = eval(formula);
                        displayName = unit;
                    } catch (error) {
                        console.error('自定义单位计算错误:', error);
                        return;
                    }
                } else if (unit === 'px') {
                    // 像素单位特殊处理：基于当前DPI
                    convertedValue = (baseValue * 1000) / (25.4 / currentDpi); // 转换为像素
                    displayName = unitDisplayNames[unit] || unit;
                } else {
                    // 标准单位
                    convertedValue = baseValue / unitConversions[unit];
                    displayName = unitDisplayNames[unit] || unit;
                }
                
                const resultItem = document.createElement('div');
                resultItem.className = 'result-item';
                resultItem.style.animationDelay = `${index * 0.05}s`;
                resultItem.innerHTML = `
                    <span class="unit">${displayName} (${unit})</span>
                    <span class="value">${formatNumber(convertedValue)}</span>
                    ${customUnits[unit] ? `<button class="delete-btn" onclick="deleteCustomUnit('${unit}')">删除</button>` : ''}
                `;
                resultsContainer.appendChild(resultItem);
                resultCount++;
            });
            
            // 更新结果计数
            document.getElementById('resultsCount').textContent = `${resultCount} 个单位`;
            
            // 如果没有结果，显示提示信息
            if (resultCount === 0) {
                const noResults = document.createElement('div');
                noResults.className = 'result-item';
                noResults.innerHTML = `
                    <span class="unit">暂无结果</span>
                    <span class="value">-</span>
                `;
                resultsContainer.appendChild(noResults);
            }
        }

        function formatNumber(num) {
            // 高精度数字格式化
            if (Math.abs(num) < 0.000001) {
                return num.toExponential(6);
            } else if (Math.abs(num) > 1000000) {
                return num.toExponential(6);
            } else {
                // 根据数值大小动态调整小数位数
                const absNum = Math.abs(num);
                let decimals = 6;
                
                if (absNum < 0.001) decimals = 10;
                else if (absNum < 0.1) decimals = 8;
                else if (absNum < 1) decimals = 7;
                else if (absNum > 1000) decimals = 4;
                else if (absNum > 100) decimals = 5;
                
                return num.toFixed(decimals).replace(/(\.\d*?[1-9])0+$/, '$1').replace(/\.$/, '');
            }
        }

        function addCustomUnit() {
            const unitName = document.getElementById('customUnitName').value.trim();
            const formula = document.getElementById('customFormula').value.trim();
            
            if (!unitName || !formula) {
                alert('请输入单位名称和换算公式');
                return;
            }
            
            // 检查是否与系统单位冲突
            if (unitConversions.hasOwnProperty(unitName)) {
                alert('该单位名称与系统内置单位冲突，请使用其他名称');
                return;
            }
            
            // 验证公式安全性（简单验证）
            if (!/^[value0-9+\-*/().\s]+$/.test(formula)) {
                alert('公式包含非法字符，请只使用数字、运算符和value变量');
                return;
            }
            
            customUnits[unitName] = formula;
            
            // 清空输入框
            document.getElementById('customUnitName').value = '';
            document.getElementById('customFormula').value = '';
            
            updateResults();
            alert(`自定义单位 "${unitName}" 添加成功！`);
        }

        function deleteCustomUnit(unitName) {
            if (confirm(`确定要删除自定义单位 "${unitName}" 吗？`)) {
                delete customUnits[unitName];
                updateResults();
                alert(`自定义单位 "${unitName}" 已删除`);
            }
        }

        // 支持键盘快捷键
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                updateResults();
            }
        });
    </script>
</body>
</html>
