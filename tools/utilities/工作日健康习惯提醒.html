<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å·¥ä½œæ—¥å¥åº·ä¹ æƒ¯æé†’</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --bg: #f7f9fc;
      --card: #ffffff;
      --text: #1a1f36;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --accent: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --border: #e5e7eb;
    }
    * { box-sizing: border-box }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
    }
    header {
      padding: 24px 16px;
      background: linear-gradient(90deg, #e0f2fe, #ecfeff);
      border-bottom: 1px solid var(--border);
    }
    header .title {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    header h1 { margin: 0; font-size: 24px }
    header p { margin: 4px 0 0; color: var(--muted) }
    .container {
      max-width: 980px;
      margin: 24px auto;
      padding: 0 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .full { grid-column: 1 / -1 }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(31,41,55,0.06);
      padding: 16px;
    }
    .card h2 {
      margin: 0 0 12px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .section { margin-top: 12px }
    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
    }
    .control {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    .control label { color: var(--muted) }
    input[type="number"], select {
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      width: 100px;
      background: #fff;
    }
    button {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #fff;
      color: var(--text);
      cursor: pointer;
      transition: background .15s ease, transform .06s ease;
    }
    button.primary { background: var(--primary); border-color: var(--primary); color: #fff }
    button.primary:hover { background: var(--primary-dark) }
    button.accent { background: var(--accent); border-color: var(--accent); color: #fff }
    button.warning { background: var(--warning); border-color: var(--warning); color: #fff }
    button.danger { background: var(--danger); border-color: var(--danger); color: #fff }
    button:hover { transform: translateY(-1px) }
    .small { font-size: 12px; color: var(--muted) }
    .muted { color: var(--muted) }
    .progress {
      height: 12px;
      background: #eef2ff;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--border);
      box-shadow: inset 0 1px 3px rgba(31,41,55,0.08);
    }
    .progress > div {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #60a5fa, #34d399);
      transition: width .3s ease;
    }
    .habit {
      position: relative;
      background: linear-gradient(180deg,#ffffff, #f9fafb);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 8px 24px rgba(31,41,55,0.06);
      transition: transform .12s ease, box-shadow .2s ease;
    }
    .habit::before {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 4px;
      background: linear-gradient(90deg, #60a5fa, #34d399);
    }
    .habit:hover { transform: translateY(-2px); box-shadow: 0 16px 32px rgba(31,41,55,0.08) }
    .habit h3 {
      margin: 0 0 8px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .habit .stats {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .grid-3 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px;
      align-items: start;
    }
    .habit .progress { margin-top: 8px }
    .history {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .history th, .history td {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid var(--border);
      background: linear-gradient(90deg,#eef2ff,#f0fdf4);
      color: var(--text);
    }
    .timer {
      display: flex; align-items: center; gap: 12px; flex-wrap: wrap;
    }
    .embed { border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    .embed iframe { width: 100%; height: 720px; border: 0; background: #fff }
    .timer-display { font-size: 32px; font-weight: 600 }
    .status { color: var(--muted) }
    .status.active { color: var(--text) }
    .stat-card { border: 1px solid var(--border); border-radius: 10px; padding: 12px; background:#fff }
    .stat-label { font-size: 13px; color: var(--muted) }
    .stat-value { font-size: 20px; font-weight: 600; margin-top: 4px }
    #historyList { display: grid; gap: 8px }
    .history-item { display:flex; justify-content:space-between; border:1px solid var(--border); border-radius:8px; padding:8px; background:#fff }
    /* Flow redesigned styles */
    .flow { display: grid; gap: 16px }
    .flow-hero {
      position: relative;
      padding: 20px;
      border-radius: 16px;
      color: #fff;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
      box-shadow: 0 12px 32px rgba(99,102,241,0.25);
      overflow: hidden;
    }
    .flow-hero::after {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(600px 200px at 10% 10%, rgba(255,255,255,.15), transparent 60%),
                  radial-gradient(600px 200px at 90% 90%, rgba(255,255,255,.12), transparent 60%);
      pointer-events: none;
    }
    .flow-title { font-size: 18px; opacity: .9; margin-bottom: 6px }
    .flow-display { font-size: 44px; font-weight: 700; letter-spacing: .5px; text-shadow: 0 2px 8px rgba(0,0,0,.25) }
    .flow-status { margin-top: 6px; opacity: .95 }
    .flow-actions { margin-top: 14px; display: flex; gap: 12px; flex-wrap: wrap }
    .btn-large { padding: 12px 16px; font-size: 16px }
    .flow-suggestion { border: 1px solid var(--border); border-radius: 12px; padding: 12px; background: #fff }
    .flow-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px }
    .flow-history { }
    .circle {
      width: 80px; height: 80px; border-radius: 50%;
      background: conic-gradient(var(--primary) 0deg, #e5e7eb 0deg);
      display: grid; place-items: center; color: var(--text);
      border: 1px solid var(--border);
    }
    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      display: grid;
      gap: 8px;
      z-index: 9999;
    }
    .toast .item {
      background: #111827;
      color: #fff;
      padding: 12px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      min-width: 280px;
    }
    .item .title { font-weight: 600; margin-bottom: 6px }
    .item .actions { display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap }
    .item button { background: #1f2937; color: #e5e7eb; border-color: #374151 }
    .item button:hover { background: #374151 }
    footer {
      text-align: center;
      color: var(--muted);
      padding: 16px;
    }
  </style>
  <!-- è”ç³»æˆ‘ä»¬æ ·å¼ -->
  <style>
    .contact-btn { position: fixed; left: 50%; bottom: 28px; transform: translateX(-50%); background: linear-gradient(135deg,#ff7a59,#ff4d4d); color:#fff; border:none; border-radius:999px; padding:12px 22px; box-shadow:0 8px 20px rgba(0,0,0,.25); display:flex; align-items:center; gap:10px; font-weight:700; cursor:pointer; z-index:20; transition:transform .2s ease, box-shadow .2s ease; }
    .contact-btn i { font-size:18px }
    .contact-btn:hover { transform: translateX(-50%) translateY(-2px); box-shadow:0 12px 24px rgba(0,0,0,.35) }
    .contact-overlay { position: fixed; inset:0; background: rgba(0,0,0,.35); backdrop-filter: blur(3px); display:none; align-items:center; justify-content:center; z-index:50 }
    .contact-modal { width:min(760px,92vw); background:#fff; color:#111; border-radius:20px; box-shadow:0 24px 60px rgba(0,0,0,.30); overflow:hidden }
    .contact-header { display:flex; align-items:center; justify-content:space-between; padding:18px 22px; background: linear-gradient(135deg,#7c4dff,#5b8bff); color:#fff }
    .contact-header .left { display:flex; align-items:center; gap:12px; font-size:24px; font-weight:800 }
    .contact-close { background:transparent; border:none; color:#fff; font-size:22px; cursor:pointer }
    .contact-body { padding:20px }
    .contact-item { display:flex; align-items:center; gap:16px; background:#f5f7fb; border-radius:16px; padding:16px; border-left:6px solid #5b8bff }
    .contact-item + .contact-item { margin-top:16px }
    .contact-item .icon { width:50px; height:50px; border-radius:50%; display:flex; align-items:center; justify-content:center; background: linear-gradient(135deg,#6a8cff,#7c4dff); color:#fff; font-size:22px; flex:0 0 50px }
    .contact-item .info { display:flex; align-items:center; gap:10px; flex-wrap:wrap }
    .contact-item .label { font-weight:800; color:#1f2937 }
    .contact-item .value { background:#fff; border-radius:10px; padding:8px 12px; color:#374151; box-shadow:0 2px 8px rgba(0,0,0,.08) }
    .contact-footer { margin:16px 20px 22px; padding:14px 18px; border-radius:14px; color:#fff; background: linear-gradient(135deg,#7c4dff,#5b8bff); text-align:center; font-weight:700 }
  </style>
</head>
<body>
  <header>
    <div class="title">
      <div>
        <h1>å·¥ä½œæ—¥å¥åº·ä¹ æƒ¯æé†’</h1>
        <p>ä¿ƒè¿›åŠå…¬å¥åº·ï¼šå®šæ—¶æé†’ã€æ¯æ—¥è®°å½•ã€æ‹‰ä¼¸æŒ‡å¯¼ä¸æŠ¤çœ¼è®¡æ—¶å™¨</p>
      </div>
      <div style="margin-left:auto" class="control">
        <button id="enableNotify" class="primary">å¯ç”¨ç³»ç»Ÿé€šçŸ¥</button>
        <span class="small" id="notifyStatus">é€šçŸ¥æƒé™ï¼šæœªç”³è¯·</span>
        <button id="openFlowInline">æ‰“å¼€ç•ªèŒ„é’Ÿ</button>
        <label class="small" for="pomodoroLink">ç•ªèŒ„é’Ÿè”åŠ¨</label>
        <input type="checkbox" id="pomodoroLink" />
        <label class="small" for="pauseWaterOnFocus">ä¸“æ³¨æ—¶æš‚åœæ°´æé†’</label>
        <input type="checkbox" id="pauseWaterOnFocus" />
      </div>
    </div>
  </header>
  <nav class="control" style="margin:8px 16px">
    <label class="small">é¡µé¢åˆ‡æ¢</label>
    <button id="navHealth" class="primary">å¥åº·ä¹ æƒ¯é¡µ</button>
    <button id="navFlow">å¿ƒæµè®¡æ—¶å™¨</button>
  </nav>

  <main id="page-health" class="container">
    <section class="card full" id="reminders">
      <h2>â° å®šæ—¶æé†’</h2>
      <p class="small muted" style="margin:4px 0 12px">åœ¨è®¾å®šçš„é—´éš”å†…ä»¥ç³»ç»Ÿé€šçŸ¥ä¸åå¸æ–¹å¼æé†’ï¼Œæ”¯æŒéšæ—¶å¼€å§‹/åœæ­¢ã€‚</p>
      <div class="row">
        <div class="habit" data-habit="stand">
          <h3>ğŸš¶ ç«™ç«‹æ´»åŠ¨</h3>
          <div class="control">
            <label>é—´éš”(åˆ†é’Ÿ)</label>
            <input type="number" min="5" step="5" id="interval-stand" value="60" />
            <button class="primary" data-action="start">å¼€å§‹æé†’</button>
            <button data-action="stop">åœæ­¢</button>
            <span class="small" id="next-stand">ä¸‹ä¸€æ¬¡ï¼šæœªå®‰æ’</span>
          </div>
        </div>
        <div class="habit" data-habit="water">
          <h3>ğŸ’§ å–æ°´æé†’</h3>
          <div class="control">
            <label>é—´éš”(åˆ†é’Ÿ)</label>
            <input type="number" min="10" step="5" id="interval-water" value="45" />
            <button class="primary" data-action="start">å¼€å§‹æé†’</button>
            <button data-action="stop">åœæ­¢</button>
            <span class="small" id="next-water">ä¸‹ä¸€æ¬¡ï¼šæœªå®‰æ’</span>
          </div>
        </div>
        <div class="habit" data-habit="far">
          <h3>ğŸ‘€ è¿œçœºæ”¾æ¾</h3>
          <div class="control">
            <label>é—´éš”(åˆ†é’Ÿ)</label>
            <input type="number" min="10" step="5" id="interval-far" value="20" />
            <button class="primary" data-action="start">å¼€å§‹æé†’</button>
            <button data-action="stop">åœæ­¢</button>
            <span class="small" id="next-far">ä¸‹ä¸€æ¬¡ï¼šæœªå®‰æ’</span>
          </div>
        </div>
      </div>
      <p class="small muted">æç¤ºï¼šå…è®¸ç³»ç»Ÿé€šçŸ¥åï¼Œå³ä½¿åˆ‡æ¢æ ‡ç­¾é¡µä¹Ÿèƒ½å¼¹å‡ºæé†’ï¼›ä¹Ÿå¯ä½¿ç”¨ä¸‹æ–¹åå¸æç¤ºã€‚</p>
    </section>

    <section class="card full" id="custom">
      <h2>ğŸ› ï¸ è‡ªå®šä¹‰æé†’</h2>
      <div class="control">
        <label>åç§°</label>
        <input type="text" id="customName" placeholder="ä¾‹å¦‚ï¼šä¼¸å±•è‚©é¢ˆ" />
        <label>é—´éš”(åˆ†é’Ÿ)</label>
        <input type="number" min="1" step="1" id="customInterval" value="60" />
        <button id="addCustom">æ·»åŠ æé†’</button>
      </div>
      <div id="customList" class="section"></div>
    </section>

    <section class="card full" id="tracking">
      <h2>ğŸ“ˆ æ¯æ—¥ä¹ æƒ¯å®Œæˆæƒ…å†µ</h2>
      <p class="small muted" style="margin:4px 0 12px">è®¾ç½®ç›®æ ‡åï¼Œä»Šæ—¥æ¬¡æ•°ä»…åœ¨ 0 ä¸ç›®æ ‡å€¼ä¹‹é—´å˜åŠ¨ï¼Œè¿›åº¦æ¡æœ€å¤šæ˜¾ç¤º 100%ã€‚</p>
      <div class="grid-3">
        <div class="habit">
          <h3>ğŸš¶ ç«™ç«‹æ´»åŠ¨</h3>
          <div class="stats">
            <span class="badge">ä»Šæ—¥æ¬¡æ•°ï¼š<button class="small" data-dec="stand">â–</button> <span id="count-stand">0</span>/<span id="target-stand">8</span> <button class="small" data-inc="stand">â•</button></span>
            <button class="accent" data-mark="stand">æ ‡è®°å®Œæˆä¸€æ¬¡</button>
            <label>ç›®æ ‡</label>
            <input type="number" min="1" max="24" id="set-target-stand" value="8" />
          </div>
          <div class="progress"><div id="progress-stand"></div></div>
        </div>
        <div class="habit">
          <h3>ğŸ’§ å–æ°´</h3>
          <div class="stats">
            <span class="badge">ä»Šæ—¥æ¯æ•°ï¼š<button class="small" data-dec="water">â–</button> <span id="count-water">0</span>/<span id="target-water">8</span> <button class="small" data-inc="water">â•</button></span>
            <button class="accent" data-mark="water">æ ‡è®°å®Œæˆä¸€æ¬¡</button>
            <label>ç›®æ ‡</label>
            <input type="number" min="1" max="24" id="set-target-water" value="8" />
          </div>
          <div class="progress"><div id="progress-water"></div></div>
        </div>
        <div class="habit">
          <h3>ğŸ‘€ è¿œçœºæ”¾æ¾</h3>
          <div class="stats">
            <span class="badge">ä»Šæ—¥æ¬¡æ•°ï¼š<button class="small" data-dec="far">â–</button> <span id="count-far">0</span>/<span id="target-far">8</span> <button class="small" data-inc="far">â•</button></span>
            <button class="accent" data-mark="far">æ ‡è®°å®Œæˆä¸€æ¬¡</button>
            <label>ç›®æ ‡</label>
            <input type="number" min="1" max="24" id="set-target-far" value="8" />
          </div>
          <div class="progress"><div id="progress-far"></div></div>
        </div>
      </div>
      <div class="section">
        <h3 class="muted" style="margin:0 0 8px">è¿‘7æ—¥æ¦‚è§ˆ</h3>
        <table class="history" id="historyTable">
          <thead>
            <tr>
              <th>æ—¥æœŸ</th>
              <th>ç«™ç«‹</th>
              <th>å–æ°´</th>
              <th>è¿œçœº</th>
              <th>æ˜¯å¦è¾¾æ ‡</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="small">è¿ç»­è¾¾æ ‡å¤©æ•°ï¼š<span id="streak">0</span></p>
      </div>
    </section>

    <section class="card" id="stretch">
      <h2>ğŸ§˜ åŠå…¬æ¤…æ‹‰ä¼¸æŒ‡å¯¼</h2>
      <div id="stretchInfo" class="small muted">æ¯ä¸ªåŠ¨ä½œå»ºè®® 30 ç§’ï¼›å…± 6 ä¸ªåŠ¨ä½œã€‚</div>
      <div style="margin:8px 0">
        <div id="stretchName" style="font-weight:600">å‡†å¤‡å¼€å§‹</div>
        <ul id="stretchSteps" class="small">
          <li>ç‚¹å‡»â€œå¼€å§‹æ‹‰ä¼¸â€åï¼ŒæŒ‰æ­¥éª¤è¿›è¡Œï¼Œæ¯ä¸ªåŠ¨ä½œå°†è‡ªåŠ¨è®¡æ—¶ã€‚</li>
        </ul>
      </div>
      <div class="timer">
        <div class="circle" id="stretchCircle">00:30</div>
        <div class="control">
          <button class="primary" id="stretchStart">å¼€å§‹æ‹‰ä¼¸</button>
          <button id="stretchPause">æš‚åœ</button>
          <button id="stretchNext">è·³è¿‡/ä¸‹ä¸€ä¸ª</button>
          <span class="small" id="stretchStatus">æœªå¼€å§‹</span>
          <label style="margin-left:12px">æ¯åŠ¨ä½œæ—¶é•¿(ç§’)</label>
          <input type="number" min="10" step="5" id="stretchSeconds" value="30" />
        </div>
      </div>
    </section>

    <section class="card" id="eye">
      <h2>çœ¼ç›æ”¾æ¾ç»ƒä¹ è®¡æ—¶å™¨</h2>
      <p class="small muted">éµå¾ªâ€œ20-20-20â€åŸåˆ™ï¼šæ¯ 20 åˆ†é’Ÿï¼Œçœºæœ› 20 è‹±å°ºï¼ˆçº¦ 6 ç±³ï¼‰å¤–è‡³å°‘ 20 ç§’ã€‚</p>
      <div class="timer">
        <div class="circle" id="eyeCircle">00:20</div>
        <div class="control">
          <label>æ—¶é•¿(ç§’)</label>
          <input type="number" min="10" step="5" id="eyeSeconds" value="20" />
          <button class="primary" id="eyeStart">å¼€å§‹</button>
          <button id="eyePause">æš‚åœ</button>
          <button id="eyeReset">é‡ç½®</button>
          <span class="small" id="eyeStatus">æœªå¼€å§‹</span>
        </div>
      </div>
    </section>

    <section class="card full">
      <h2>å¿«é€Ÿæ“ä½œ</h2>
      <div class="control">
        <button class="warning" id="snoozeAll">å…¨éƒ¨ç¨åæé†’ï¼ˆ+5 åˆ†é’Ÿï¼‰</button>
        <button class="danger" id="clearToday">æ¸…é™¤ä»Šæ—¥è®°å½•</button>
        <button id="exportData">å¯¼å‡ºè®°å½•</button>
        <input type="file" id="importData" accept="application/json" style="display:none" />
        <button id="importBtn">å¯¼å…¥è®°å½•</button>
      </div>
    </section>
  </main>

  <main id="page-flow" class="container full" style="display:none">
    <section class="card full flow">
      <div class="flow-hero">
        <div class="flow-title">å¿ƒæµä¸“æ³¨è®¡æ—¶å™¨</div>
        <div class="flow-display" id="timerDisplay">00:00:00</div>
        <div class="flow-status status" id="status"><span class="status-icon"></span>å‡†å¤‡å¼€å§‹ä¸“æ³¨</div>
        <div class="flow-actions">
          <button class="primary btn-large" id="startBtn">ğŸš€ å¼€å§‹ä¸“æ³¨</button>
          <button class="danger btn-large" id="stopBtn" disabled>â¹ï¸ ç»“æŸä¸“æ³¨</button>
        </div>
      </div>
      <div id="suggestion" class="flow-suggestion" style="display:none">
        <h3 class="muted" style="margin:0 0 6px">ğŸ‰ ä¸“æ³¨å®Œæˆï¼</h3>
        <p id="suggestionText" class="small"></p>
      </div>
      <div class="flow-stats">
        <div class="stat-card">
          <div class="stat-label">ä»Šæ—¥ä¸“æ³¨</div>
          <div class="stat-value" id="todayCount">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ä»Šæ—¥æ—¶é•¿</div>
          <div class="stat-value" id="todayTotal">0åˆ†</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å¹³å‡æ—¶é•¿</div>
          <div class="stat-value" id="avgDuration">0åˆ†</div>
        </div>
      </div>
      <div class="flow-history">
        <h3 class="muted" style="margin:0 0 8px">ğŸ“Š ä¸“æ³¨å†å²</h3>
        <div id="historyList"></div>
        <button id="clearFocusHistory" class="warning" style="margin-top:8px">ğŸ—‘ï¸ æ¸…ç©ºè®°å½•</button>
      </div>
    </section>
  </main>

  <div class="toast" id="toast"></div>

  <footer>
    <div>ä¿é‡èº«ä½“ï¼Œå·¥ä½œæ›´é«˜æ•ˆ ğŸ’ª</div>
  </footer>
  <!-- è”ç³»æˆ‘ä»¬ï¼šè§¦å‘æŒ‰é’®ä¸æ¨¡æ€ -->
  <button id="contactBtn" class="contact-btn"><i class="fa-solid fa-phone"></i> è”ç³»æˆ‘ä»¬</button>
  <div id="contactOverlay" class="contact-overlay" aria-hidden="true">
    <div class="contact-modal" role="dialog" aria-modal="true" aria-labelledby="contactTitle">
      <div class="contact-header">
        <div class="left"><i class="fa-solid fa-phone"></i><span id="contactTitle">è”ç³»æˆ‘ä»¬</span></div>
        <button id="contactClose" class="contact-close" aria-label="å…³é—­"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="contact-body">
        <div class="contact-item">
          <div class="icon"><i class="fa-brands fa-qq"></i></div>
          <div class="info">
            <div class="label">QQé‚®ç®±:</div>
            <div class="value">1990909398@qq.com</div>
          </div>
        </div>
        <div class="contact-item">
          <div class="icon"><i class="fa-brands fa-weixin"></i></div>
          <div class="info">
            <div class="label">å¾®ä¿¡å·:</div>
            <div class="value">y8849112640</div>
          </div>
        </div>
      </div>
      <div class="contact-footer">å‘æˆ‘ä»¬å‘é€æ¶ˆæ¯ å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä¸‹é¢çš„é‚®ç®±æˆ–å¾®ä¿¡è”ç³»æˆ‘ä»¬</div>
    </div>
  </div>

  <script>
    // ====== å®ç”¨å·¥å…· ======
    const now = () => new Date();
    const pad = n => String(n).padStart(2, '0');
    const fmtTime = ms => {
      const s = Math.max(0, Math.floor(ms / 1000));
      const mm = pad(Math.floor(s / 60));
      const ss = pad(s % 60);
      return mm + ':' + ss;
    };
    const todayKey = () => {
      const d = now();
      return d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate());
    };
    const storageKey = d => 'workday-health-' + d;
    const targetsKey = 'workday-targets';
    // è·¨é¡µé¢è”åŠ¨å¸¸é‡
    const pomodoroKey = 'workday-pomodoro-enabled';
    const waterPauseKey = 'workday-pause-water-on-focus';
    const customKey = 'workday-custom-reminders';
    const stretchSecondsKey = 'workday-stretch-seconds';
    const SYNC_CHANNEL = 'workday-sync';
    let bc = null;
    try { bc = new BroadcastChannel(SYNC_CHANNEL); } catch (e) { bc = null; }
    const clamp = (val, min, max) => Math.max(min, Math.min(max, val));
    const dayShift = (date, shiftDays) => {
      const d = new Date(date);
      d.setDate(d.getDate() + shiftDays);
      return d;
    };
    const fmtDate = dateObj => {
      const d = new Date(dateObj);
      return d.getFullYear() + '-' + pad(d.getMonth()+1) + '-' + pad(d.getDate());
    };

    // ====== é¡µé¢åˆ‡æ¢ ======
    const navHealth = document.getElementById('navHealth');
    const navFlow = document.getElementById('navFlow');
    const pageHealth = document.getElementById('page-health');
    const pageFlow = document.getElementById('page-flow');
    function switchPage(name) {
      const isHealth = name !== 'flow';
      pageHealth.style.display = isHealth ? 'grid' : 'none';
      pageFlow.style.display = isHealth ? 'none' : 'grid';
      navHealth.classList.toggle('primary', isHealth);
      navFlow.classList.toggle('primary', !isHealth);
      location.hash = isHealth ? '#health' : '#flow';
    }
    navHealth.addEventListener('click', () => switchPage('health'));
    navFlow.addEventListener('click', () => switchPage('flow'));
    document.getElementById('openFlowInline')?.addEventListener('click', () => switchPage('flow'));
    // åˆå§‹åŒ–æ ¹æ®å“ˆå¸Œå±•ç¤º
    if (location.hash === '#flow') switchPage('flow'); else switchPage('health');

    // ====== å¿ƒæµè®¡æ—¶å™¨ï¼ˆå†…åµŒç»„ä»¶ï¼‰ ======
    let startTime = null;
    let timerInterval = null;
    let isRunning = false;
    const timerDisplay = document.getElementById('timerDisplay');
    const statusEl = document.getElementById('status');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const suggestionEl = document.getElementById('suggestion');
    const suggestionText = document.getElementById('suggestionText');
    const todayCountEl = document.getElementById('todayCount');
    const todayTotalEl = document.getElementById('todayTotal');
    const avgDurationEl = document.getElementById('avgDuration');
    const historyList = document.getElementById('historyList');

    const loadFocus = () => {
      try { return JSON.parse(localStorage.getItem('focusTimerData') || 'null') || []; } catch { return []; }
    };
    const saveFocus = (sessions) => { try { localStorage.setItem('focusTimerData', JSON.stringify(sessions)); } catch {} };
    const formatHMS = (seconds) => {
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = seconds % 60;
      return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    };
    const formatDuration = (seconds) => {
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const remainingMinutes = minutes % 60;
      return hours > 0 ? `${hours}å°æ—¶${remainingMinutes}åˆ†é’Ÿ` : `${minutes}åˆ†é’Ÿ`;
    };
    function emitSync(message) {
      const payload = { ...message, ts: Date.now() };
      try { bc && bc.postMessage(payload); } catch {}
      try { localStorage.setItem('workday-sync-event', JSON.stringify(payload)); } catch {}
    }
    function updateTimer() {
      if (!isRunning || !startTime) return;
      const elapsed = Math.floor((Date.now() - startTime.getTime()) / 1000);
      timerDisplay.textContent = formatHMS(elapsed);
    }
    function showSuggestion(duration) {
      const restTime = Math.floor(duration / 5);
      suggestionText.innerHTML = `æ‚¨ä¸“æ³¨äº† <strong>${formatDuration(duration)}</strong>ï¼Œå»ºè®®ä¼‘æ¯ <strong>${formatDuration(restTime)}</strong>ã€‚`;
      suggestionEl.style.display = 'block';
    }
    function updateStats() {
      const sessions = loadFocus();
      const todayStr = new Date().toDateString();
      const todaySessions = sessions.filter(s => new Date(s.date).toDateString() === todayStr);
      const totalMinutes = Math.floor(todaySessions.reduce((acc, s) => acc + s.duration, 0) / 60);
      const avgMinutes = todaySessions.length ? Math.floor(totalMinutes / todaySessions.length) : 0;
      todayCountEl.textContent = String(todaySessions.length);
      todayTotalEl.textContent = totalMinutes + 'åˆ†';
      avgDurationEl.textContent = avgMinutes + 'åˆ†';
    }
    function updateHistory() {
      const sessions = loadFocus().slice().reverse();
      historyList.innerHTML = '';
      sessions.forEach(s => {
        const date = new Date(s.date);
        const dateStr = date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `<span>${dateStr}</span><span>${formatDuration(s.duration)}</span>`;
        historyList.appendChild(item);
      });
    }
    function clearFocusHistory() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ä¸“æ³¨å†å²å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
        try { localStorage.removeItem('focusTimerData'); } catch {}
        updateStats(); updateHistory();
      }
    }
    function startTimer() {
      startTime = new Date();
      isRunning = true;
      startBtn.disabled = true; stopBtn.disabled = false;
      statusEl.innerHTML = '<span class="status-icon"></span>ä¸“æ³¨è¿›è¡Œä¸­...';
      statusEl.classList.add('active');
      suggestionEl.style.display = 'none';
      timerInterval = setInterval(updateTimer, 1000);
      emitSync({ type: 'pomodoro:started', startISO: startTime.toISOString() });
    }
    function stopTimer() {
      if (!isRunning || !startTime) return;
      const endTime = new Date();
      const duration = Math.floor((endTime.getTime() - startTime.getTime()) / 1000);
      isRunning = false; clearInterval(timerInterval);
      startBtn.disabled = false; stopBtn.disabled = true;
      statusEl.innerHTML = '<span class="status-icon"></span>ä¸“æ³¨å·²ç»“æŸ';
      statusEl.classList.remove('active');
      const sessions = loadFocus();
      sessions.push({ date: endTime.toISOString(), duration, startTime: startTime.toISOString(), endTime: endTime.toISOString() });
      saveFocus(sessions);
      showSuggestion(duration);
      updateStats(); updateHistory();
      emitSync({ type: 'pomodoro:finished', endISO: endTime.toISOString(), duration });
    }
    startBtn && (startBtn.onclick = startTimer);
    stopBtn && (stopBtn.onclick = stopTimer);
    document.getElementById('clearFocusHistory')?.addEventListener('click', clearFocusHistory);
    // é”®ç›˜å¿«æ·é”®ï¼šç©ºæ ¼å¼€å§‹/ç»“æŸ
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault(); if (isRunning) { stopTimer(); } else { startTimer(); }
      }
    });
    // é¡µé¢å…³é—­æé†’
    window.addEventListener('beforeunload', function(e) {
      if (isRunning) { e.preventDefault(); e.returnValue = 'æ‚¨æ­£åœ¨ä¸“æ³¨ä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ'; return e.returnValue; }
    });
    // åˆå§‹åŒ–å¿ƒæµç»Ÿè®¡
    updateStats(); updateHistory();

    // ====== åå¸æé†’ ======
    const toastEl = document.getElementById('toast');
    function showToast(title, text, actions = []) {
      const item = document.createElement('div');
      item.className = 'item';
      item.innerHTML = '<div class="title">' + title + '</div><div>' + text + '</div>';
      const act = document.createElement('div');
      act.className = 'actions';
      actions.forEach(a => {
        const b = document.createElement('button');
        b.textContent = a.label;
        b.onclick = () => { a.onClick?.(); item.remove(); };
        act.appendChild(b);
      });
      const closeBtn = document.createElement('button');
      closeBtn.textContent = 'å…³é—­';
      closeBtn.onclick = () => item.remove();
      act.appendChild(closeBtn);
      item.appendChild(act);
      toastEl.appendChild(item);
      // è‡ªåŠ¨ç§»é™¤
      setTimeout(() => { item.remove(); }, 60_000);
    }

    // ç®€å•èœ‚é¸£éŸ³
    function beep() {
      try {
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioCtx();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = 'sine'; o.frequency.value = 880;
        o.connect(g); g.connect(ctx.destination);
        g.gain.setValueAtTime(0.001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.3, ctx.currentTime + 0.05);
        o.start();
        setTimeout(() => { g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.2); o.stop(); ctx.close(); }, 600);
      } catch (e) {}
    }

    // ç³»ç»Ÿé€šçŸ¥
    const enableNotifyBtn = document.getElementById('enableNotify');
    const notifyStatus = document.getElementById('notifyStatus');
    const pomodoroSwitch = document.getElementById('pomodoroLink');
    const pauseWaterSwitch = document.getElementById('pauseWaterOnFocus');
    const customNameInput = document.getElementById('customName');
    const customIntervalInput = document.getElementById('customInterval');
    const addCustomBtn = document.getElementById('addCustom');
    const customListEl = document.getElementById('customList');
    function notify(title, body) {
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification(title, { body });
      }
    }
    function updateNotifyStatus() {
      if (!('Notification' in window)) {
        notifyStatus.textContent = 'é€šçŸ¥æƒé™ï¼šä¸æ”¯æŒ';
      } else {
        notifyStatus.textContent = 'é€šçŸ¥æƒé™ï¼š' + Notification.permission;
      }
    }
    enableNotifyBtn.onclick = async () => {
      if (!('Notification' in window)) {
        showToast('é€šçŸ¥ä¸å¯ç”¨', 'å½“å‰æµè§ˆå™¨ä¸æ”¯æŒç³»ç»Ÿé€šçŸ¥');
        return;
      }
      if (Notification.permission !== 'granted') {
        await Notification.requestPermission();
      }
      updateNotifyStatus();
      showToast('å·²å¯ç”¨é€šçŸ¥', 'å³ä½¿åˆ‡æ¢æ ‡ç­¾é¡µä¹Ÿå¯æ”¶åˆ°æé†’');
    };
    updateNotifyStatus();

    // è·¨é¡µé¢è”åŠ¨æ¥æ”¶ï¼ˆç•ªèŒ„é’Ÿç»“æŸ -> å¯å¯åŠ¨æŠ¤çœ¼ï¼‰
    function onSyncMessage(msg) {
      if (!msg || typeof msg !== 'object') return;
      if (msg.type === 'pomodoro:finished') {
        const enabled = (localStorage.getItem(pomodoroKey) === 'true');
        if (enabled) {
          showToast('ç•ªèŒ„é’Ÿç»“æŸ', 'è‡ªåŠ¨å¯åŠ¨ä¸€æ¬¡æŠ¤çœ¼æ”¾æ¾è®¡æ—¶', [
            { label: 'å¼€å§‹æŠ¤çœ¼', onClick: () => { try { startEye(); } catch {} } },
            { label: 'å–æ¶ˆ', onClick: () => {} }
          ]);
          try { bc && bc.postMessage({ type: 'eye:started', ts: Date.now() }); } catch (e) {}
          try { localStorage.setItem('workday-sync-event', JSON.stringify({ type: 'eye:started', ts: Date.now() })); } catch (e) {}
        }
        // æ¢å¤ç«™ç«‹æé†’
        if (pausedStandByFocus) {
          pausedStandByFocus = false;
          try { schedule('stand'); } catch {}
          showToast('ä¸“æ³¨ç»“æŸ', 'å·²æ¢å¤ä¹…åè®¡æ•°ï¼ˆç«™ç«‹æé†’ï¼‰');
        }
        // æ¢å¤æ°´æé†’ï¼ˆå¦‚ä¹‹å‰å› ä¸“æ³¨æš‚åœï¼‰
        if (pausedWaterByFocus) {
          pausedWaterByFocus = false;
          try { schedule('water'); } catch {}
          showToast('ä¸“æ³¨ç»“æŸ', 'å·²æ¢å¤å–æ°´æé†’');
        }
      } else if (msg.type === 'pomodoro:started') {
        // ç•ªèŒ„é’Ÿå¼€å§‹ -> è‹¥è”åŠ¨å¼€å¯ï¼Œåˆ™æš‚åœç«™ç«‹æé†’ï¼ˆä¹…åè®¡æ•°ï¼‰
        const enabled = (localStorage.getItem(pomodoroKey) === 'true');
        if (enabled) {
          try { stop('stand'); } catch {}
          pausedStandByFocus = true;
          try { nextEls['stand'].textContent = 'ä¸‹ä¸€æ¬¡ï¼šå·²æš‚åœï¼ˆä¸“æ³¨ä¸­ï¼‰'; } catch {}
          showToast('ä¸“æ³¨å¼€å§‹', 'å·²æš‚åœä¹…åè®¡æ•°ï¼ˆç«™ç«‹æé†’ï¼‰ï¼Œä¸“æ³¨ç»“æŸå°†è‡ªåŠ¨æ¢å¤', [
            { label: 'ç«‹å³æ¢å¤', onClick: () => { try { pausedStandByFocus = false; schedule('stand'); } catch {} } }
          ]);
        }
        // å¦‚å¼€å¯â€œä¸“æ³¨æ—¶æš‚åœæ°´æé†’â€ï¼Œåˆ™æš‚åœæ°´æé†’
        const pauseWaterEnabled = (localStorage.getItem(waterPauseKey) === 'true');
        if (pauseWaterEnabled) {
          try { stop('water'); } catch {}
          pausedWaterByFocus = true;
          try { nextEls['water'].textContent = 'ä¸‹ä¸€æ¬¡ï¼šå·²æš‚åœï¼ˆä¸“æ³¨ä¸­ï¼‰'; } catch {}
          showToast('ä¸“æ³¨å¼€å§‹', 'å·²æš‚åœå–æ°´æé†’ï¼Œä¸“æ³¨ç»“æŸå°†è‡ªåŠ¨æ¢å¤', [
            { label: 'ç«‹å³æ¢å¤', onClick: () => { try { pausedWaterByFocus = false; schedule('water'); } catch {} } }
          ]);
        }
      }
    }
    try {
      if (bc) { bc.onmessage = (ev) => onSyncMessage(ev.data); }
    } catch (e) {}
    window.addEventListener('storage', (e) => {
      if (e.key === 'workday-sync-event' && e.newValue) {
        try { onSyncMessage(JSON.parse(e.newValue)); } catch {}
      }
    });

    // ç•ªèŒ„é’Ÿè”åŠ¨å¼€å…³æŒä¹…åŒ–
    try {
      pomodoroSwitch.checked = localStorage.getItem(pomodoroKey) === 'true';
      pauseWaterSwitch.checked = localStorage.getItem(waterPauseKey) === 'true';
      const ssec = parseInt(localStorage.getItem(stretchSecondsKey) || '30', 10);
      if (!isNaN(ssec)) {
        const input = document.getElementById('stretchSeconds');
        if (input) input.value = ssec;
      }
    } catch {}
    pomodoroSwitch.addEventListener('change', () => {
      localStorage.setItem(pomodoroKey, pomodoroSwitch.checked ? 'true' : 'false');
      showToast('è”åŠ¨å·²' + (pomodoroSwitch.checked ? 'å¼€å¯' : 'å…³é—­'), 'è¿œçœºæé†’è§¦å‘æ—¶' + (pomodoroSwitch.checked ? 'å°†è‡ªåŠ¨å¼€å§‹æŠ¤çœ¼è®¡æ—¶' : 'ä¸å†è‡ªåŠ¨å¼€å§‹æŠ¤çœ¼è®¡æ—¶'));
    });
    pauseWaterSwitch.addEventListener('change', () => {
      localStorage.setItem(waterPauseKey, pauseWaterSwitch.checked ? 'true' : 'false');
      showToast('è®¾ç½®å·²ä¿å­˜', (pauseWaterSwitch.checked ? 'ä¸“æ³¨æœŸé—´å°†æš‚åœæ°´æé†’' : 'ä¸“æ³¨æœŸé—´ä¸æš‚åœæ°´æé†’'));
    });

    // ====== æ•°æ®å­˜å‚¨ ======
    const defaultTargets = { stand: 8, water: 8, far: 8 };
    const loadTargets = () => {
      try {
        const t = JSON.parse(localStorage.getItem(targetsKey) || 'null');
        if (!t) return { ...defaultTargets };
        return { ...defaultTargets, ...t };
      } catch { return { ...defaultTargets }; }
    };
    const saveTargets = t => localStorage.setItem(targetsKey, JSON.stringify(t));
    const loadDay = (day = todayKey()) => {
      try {
        return JSON.parse(localStorage.getItem(storageKey(day)) || 'null') || {
          date: day, stand: { done: 0 }, water: { done: 0 }, far: { done: 0 }
        };
      } catch {
        return { date: day, stand: { done: 0 }, water: { done: 0 }, far: { done: 0 } };
      }
    };
    const saveDay = (data) => localStorage.setItem(storageKey(data.date), JSON.stringify(data));

    // ====== è¿›åº¦å±•ç¤º ======
    const countEls = {
      stand: document.getElementById('count-stand'),
      water: document.getElementById('count-water'),
      far: document.getElementById('count-far')
    };
    const targetEls = {
      stand: document.getElementById('target-stand'),
      water: document.getElementById('target-water'),
      far: document.getElementById('target-far')
    };
    const progressEls = {
      stand: document.getElementById('progress-stand'),
      water: document.getElementById('progress-water'),
      far: document.getElementById('progress-far')
    };
    const setTargetInputs = {
      stand: document.getElementById('set-target-stand'),
      water: document.getElementById('set-target-water'),
      far: document.getElementById('set-target-far')
    };
    function refreshProgress() {
      const day = loadDay();
      const targets = loadTargets();
      ['stand','water','far'].forEach(k => {
        const t = clamp(targets[k], 1, 24);
        const done = clamp(day[k].done || 0, 0, t);
        countEls[k].textContent = done;
        targetEls[k].textContent = t;
        setTargetInputs[k].value = t;
        const pct = Math.min(100, Math.round(done / t * 100));
        progressEls[k].style.width = pct + '%';
      });
      refreshHistory();
    }
    Object.entries(setTargetInputs).forEach(([k, input]) => {
      input.addEventListener('change', () => {
        const t = loadTargets(); t[k] = clamp(parseInt(input.value || '0', 10), 1, 24);
        saveTargets(t); refreshProgress();
      });
    });
    document.querySelectorAll('button[data-mark]').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.getAttribute('data-mark');
        const t = loadTargets();
        const data = loadDay(); data[key].done = clamp((data[key].done || 0) + 1, 0, t[key]); saveDay(data);
        refreshProgress();
      });
    });

    // æ‰‹åŠ¨è°ƒèŠ‚ä»Šæ—¥æ¬¡æ•°ï¼ˆåŠ å‡ï¼‰
    document.querySelectorAll('button[data-inc]').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.getAttribute('data-inc');
        const t = loadTargets();
        const d = loadDay(); d[key].done = clamp((d[key].done || 0) + 1, 0, t[key]); saveDay(d); refreshProgress();
      });
    });
    document.querySelectorAll('button[data-dec]').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.getAttribute('data-dec');
        const t = loadTargets();
        const d = loadDay(); d[key].done = clamp((d[key].done || 0) - 1, 0, t[key]); saveDay(d); refreshProgress();
      });
    });

    // ====== å†å²ä¸è¿ç»­å¤©æ•° ======
    const historyTbody = document.querySelector('#historyTable tbody');
    const streakEl = document.getElementById('streak');
    function refreshHistory() {
      const targets = loadTargets();
      historyTbody.innerHTML = '';
      let streak = 0;
      for (let i=6;i>=0;i--) {
        const dateObj = dayShift(now(), -i);
        const key = fmtDate(dateObj);
        const d = loadDay(key);
        const okStand = (d.stand?.done || 0) >= targets.stand;
        const okWater = (d.water?.done || 0) >= targets.water;
        const okFar = (d.far?.done || 0) >= targets.far;
        const ok = okStand && okWater && okFar;
        const tr = document.createElement('tr');
        tr.innerHTML = '<td>' + key + '</td>' +
          '<td>' + (d.stand?.done || 0) + '</td>' +
          '<td>' + (d.water?.done || 0) + '</td>' +
          '<td>' + (d.far?.done || 0) + '</td>' +
          '<td>' + (ok ? 'âœ… è¾¾æ ‡' : 'â€”') + '</td>';
        historyTbody.appendChild(tr);
        if (i === 0 && ok) {
          // ä»ä»Šå¤©å¼€å§‹å‘å‰è®¡ç®—è¿ç»­å¤©æ•°
          let days = 1;
          for (let j=1;j<30;j++) {
            const prevKey = fmtDate(dayShift(now(), -j));
            const pd = loadDay(prevKey);
            const pOk = (pd.stand?.done || 0) >= targets.stand &&
                        (pd.water?.done || 0) >= targets.water &&
                        (pd.far?.done || 0) >= targets.far;
            if (pOk) days++; else break;
          }
          streak = days;
        }
      }
      streakEl.textContent = streak;
    }

    // ====== å®šæ—¶æé†’ ======
    const nextEls = {
      stand: document.getElementById('next-stand'),
      water: document.getElementById('next-water'),
      far: document.getElementById('next-far')
    };
    const intervalInputs = {
      stand: document.getElementById('interval-stand'),
      water: document.getElementById('interval-water'),
      far: document.getElementById('interval-far')
    };
    const timers = {
      stand: { id: null, nextAt: null, snoozeId: null },
      water: { id: null, nextAt: null, snoozeId: null },
      far: { id: null, nextAt: null, snoozeId: null }
    };
    let pausedStandByFocus = false;
    let pausedWaterByFocus = false;
    const customTimers = {};
    const loadCustom = () => { try { return JSON.parse(localStorage.getItem(customKey) || '[]') || []; } catch { return []; } };
    const saveCustom = (list) => localStorage.setItem(customKey, JSON.stringify(list));
    function renderCustomList() {
      const list = loadCustom();
      customListEl.innerHTML = list.length ? '' : '<p class="small muted">æš‚æ— è‡ªå®šä¹‰æé†’ï¼Œæ·»åŠ åå¯å•ç‹¬å¼€å§‹/åœæ­¢ä¸åˆ é™¤ã€‚</p>';
      list.forEach(item => {
        const row = document.createElement('div');
        row.className = 'habit';
        row.setAttribute('data-id', item.id);
        row.innerHTML = '<h3>' + item.name + '</h3>' +
          '<div class="control">' +
          '<label>é—´éš”(åˆ†é’Ÿ)</label>' +
          '<input type="number" min="1" step="1" value="' + (item.interval || 60) + '" class="custom-interval" />' +
          '<button class="primary" data-act="start">å¼€å§‹æé†’</button>' +
          '<button data-act="stop">åœæ­¢</button>' +
          '<button data-act="snooze">ç¨å(+5)</button>' +
          '<button class="danger" data-act="delete">åˆ é™¤</button>' +
          '<span class="small" id="custom-next-' + item.id + '">ä¸‹ä¸€æ¬¡ï¼šæœªå®‰æ’</span>' +
          '</div>';
        customListEl.appendChild(row);
        const intervalInput = row.querySelector('.custom-interval');
        intervalInput.addEventListener('change', () => {
          const l = loadCustom();
          const it = l.find(x => x.id === item.id);
          if (it) { it.interval = clamp(parseInt(intervalInput.value || '0', 10), 1, 480); saveCustom(l); }
        });
        row.querySelector('[data-act="start"]').addEventListener('click', () => scheduleCustom(item.id));
        row.querySelector('[data-act="stop"]').addEventListener('click', () => stopCustom(item.id));
        row.querySelector('[data-act="snooze"]').addEventListener('click', () => snoozeCustom(item.id));
        row.querySelector('[data-act="delete"]').addEventListener('click', () => deleteCustom(item.id));
      });
    }
    function scheduleCustom(id) {
      const list = loadCustom();
      const it = list.find(x => x.id === id);
      if (!it) return;
      // clear existing
      stopCustom(id);
      const mins = clamp(parseInt(it.interval || '60', 10), 1, 480);
      const delay = mins * 60 * 1000;
      const nextAt = Date.now() + delay;
      customTimers[id] = { id, nextAt, idTimeout: setTimeout(() => fireCustom(id), delay), snoozeId: null };
      const nextEl = document.getElementById('custom-next-' + id);
      if (nextEl) nextEl.textContent = 'ä¸‹ä¸€æ¬¡ï¼š' + new Date(nextAt).toLocaleTimeString();
    }
    function stopCustom(id) {
      const t = customTimers[id];
      if (t) { clearTimeout(t.idTimeout); clearTimeout(t.snoozeId); }
      customTimers[id] = null;
      const nextEl = document.getElementById('custom-next-' + id);
      if (nextEl) nextEl.textContent = 'ä¸‹ä¸€æ¬¡ï¼šæœªå®‰æ’';
    }
    function snoozeCustom(id) {
      const t = customTimers[id];
      if (t && t.idTimeout) { clearTimeout(t.idTimeout); }
      const nextEl = document.getElementById('custom-next-' + id);
      const nextAt = Date.now() + 5*60*1000;
      if (!customTimers[id]) customTimers[id] = { id, nextAt: null, idTimeout: null, snoozeId: null };
      customTimers[id].snoozeId = setTimeout(() => fireCustom(id), 5*60*1000);
      if (nextEl) nextEl.textContent = 'ä¸‹ä¸€æ¬¡(ç¨å)ï¼š' + new Date(nextAt).toLocaleTimeString();
    }
    function fireCustom(id) {
      const list = loadCustom();
      const it = list.find(x => x.id === id);
      if (!it) return;
      beep();
      showToast('è‡ªå®šä¹‰æé†’', it.name + ' æ—¶é—´åˆ°', [
        { label: 'ç¨å(+5åˆ†é’Ÿ)', onClick: () => { snoozeCustom(id); } },
        { label: 'å…³é—­', onClick: () => {} }
      ]);
      notify('è‡ªå®šä¹‰æé†’', it.name + ' æ—¶é—´åˆ°');
      scheduleCustom(id);
    }
    function deleteCustom(id) {
      stopCustom(id);
      const list = loadCustom().filter(x => x.id !== id);
      saveCustom(list);
      renderCustomList();
      showToast('å·²åˆ é™¤', 'è‡ªå®šä¹‰æé†’å·²ç§»é™¤');
    }
    function schedule(habit) {
      const mins = clamp(parseInt(intervalInputs[habit].value || '0', 10), 1, 480);
      clearTimeout(timers[habit].id);
      const delay = mins * 60 * 1000;
      timers[habit].nextAt = Date.now() + delay;
      nextEls[habit].textContent = 'ä¸‹ä¸€æ¬¡ï¼š' + new Date(timers[habit].nextAt).toLocaleTimeString();
      timers[habit].id = setTimeout(() => fireReminder(habit), delay);
    }
    function stop(habit) {
      clearTimeout(timers[habit].id); timers[habit].id = null;
      clearTimeout(timers[habit].snoozeId); timers[habit].snoozeId = null;
      timers[habit].nextAt = null; nextEls[habit].textContent = 'ä¸‹ä¸€æ¬¡ï¼šæœªå®‰æ’';
    }
    function fireReminder(habit) {
      const titleMap = { stand: 'ç«™ç«‹æ´»åŠ¨æ—¶é—´åˆ°', water: 'å–æ°´æ—¶é—´åˆ°', far: 'è¿œçœºæ”¾æ¾æ—¶é—´åˆ°' };
      const textMap = {
        stand: 'èµ·èº«æ´»åŠ¨ 1-3 åˆ†é’Ÿï¼Œèˆ’å±•ç­‹éª¨ã€‚',
        water: 'å–ä¸€æ¯æ°´ï¼Œè¡¥å……æ°´åˆ†ã€‚',
        far: 'è¿œçœº 20 ç§’ï¼Œè®©çœ¼ç›æ”¾æ¾ã€‚'
      };
      beep();
      showToast(titleMap[habit], textMap[habit], [
        { label: 'æ ‡è®°å®Œæˆ', onClick: () => {
          const d = loadDay(); d[habit].done = (d[habit].done || 0) + 1; saveDay(d); refreshProgress();
        }},
        { label: 'ç¨åæé†’(+5åˆ†é’Ÿ)', onClick: () => {
          clearTimeout(timers[habit].id);
          timers[habit].snoozeId = setTimeout(() => fireReminder(habit), 5 * 60 * 1000);
          timers[habit].nextAt = Date.now() + 5*60*1000;
          nextEls[habit].textContent = 'ä¸‹ä¸€æ¬¡(ç¨å)ï¼š' + new Date(timers[habit].nextAt).toLocaleTimeString();
        }}
      ]);
      notify(titleMap[habit], textMap[habit]);
      // å¦‚æœæ˜¯è¿œçœºæé†’ä¸”å¼€å¯äº†ç•ªèŒ„é’Ÿè”åŠ¨ï¼Œåˆ™è‡ªåŠ¨å¯åŠ¨æŠ¤çœ¼è®¡æ—¶å™¨
      if (habit === 'far') {
        const enabled = (localStorage.getItem(pomodoroKey) === 'true');
        if (enabled) {
          try { startEye(); } catch {}
          // åŒæ­¥çŠ¶æ€ï¼šæŠ¤çœ¼å¼€å§‹
          try { bc && bc.postMessage({ type: 'eye:started', ts: Date.now() }); } catch (e) {}
          try { localStorage.setItem('workday-sync-event', JSON.stringify({ type: 'eye:started', ts: Date.now() })); } catch (e) {}
        }
      }
      schedule(habit); // å®‰æ’ä¸‹ä¸€æ¬¡
    }
    document.querySelectorAll('#reminders .habit').forEach(card => {
      const habit = card.getAttribute('data-habit');
      card.querySelector('[data-action="start"]').addEventListener('click', () => schedule(habit));
      card.querySelector('[data-action="stop"]').addEventListener('click', () => stop(habit));
    });

    // ====== å¿«é€Ÿæ“ä½œ ======
    document.getElementById('snoozeAll').onclick = () => {
      ['stand','water','far'].forEach(h => {
        if (timers[h].id) { clearTimeout(timers[h].id); }
        timers[h].snoozeId = setTimeout(() => fireReminder(h), 5 * 60 * 1000);
        timers[h].nextAt = Date.now() + 5*60*1000;
        nextEls[h].textContent = 'ä¸‹ä¸€æ¬¡(ç¨å)ï¼š' + new Date(timers[h].nextAt).toLocaleTimeString();
      });
      showToast('å·²å…¨éƒ¨ç¨å', 'ä¸‰é¡¹æé†’å‡æ¨è¿Ÿ 5 åˆ†é’Ÿ');
    };
    document.getElementById('clearToday').onclick = () => {
      const day = todayKey();
      localStorage.removeItem(storageKey(day));
      refreshProgress();
      showToast('å·²æ¸…é™¤ä»Šæ—¥è®°å½•', 'ä»Šæ—¥æ•°æ®å·²é‡ç½®ä¸º 0');
    };

    // ====== è‡ªå®šä¹‰æé†’ï¼šæ·»åŠ å…¥å£ä¸åˆå§‹åŒ–æ¸²æŸ“ ======
    addCustomBtn.addEventListener('click', () => {
      const name = (customNameInput.value || '').trim();
      const interval = clamp(parseInt(customIntervalInput.value || '0', 10), 1, 480);
      if (!name) { showToast('åç§°ä¸ºç©º', 'è¯·è¾“å…¥æé†’åç§°'); return; }
      const list = loadCustom();
      const id = Date.now();
      list.push({ id, name, interval });
      saveCustom(list);
      customNameInput.value = '';
      renderCustomList();
      showToast('å·²æ·»åŠ ', 'è‡ªå®šä¹‰æé†’ï¼š' + name);
    });
    renderCustomList();
    document.getElementById('exportData').onclick = () => {
      const data = {};
      Object.keys(localStorage).forEach(k => {
        if (k.startsWith('workday-health-') || k === targetsKey) {
          data[k] = localStorage.getItem(k);
        }
      });
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'å·¥ä½œæ—¥å¥åº·ä¹ æƒ¯æ•°æ®.json';
      a.click();
      URL.revokeObjectURL(a.href);
      showToast('å·²å¯¼å‡º', 'JSON æ–‡ä»¶å·²ä¸‹è½½');
    };
    document.getElementById('importBtn').onclick = () => document.getElementById('importData').click();
    document.getElementById('importData').addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;
      try {
        const text = await file.text();
        const data = JSON.parse(text);
        Object.entries(data).forEach(([k, v]) => {
          localStorage.setItem(k, v);
        });
        refreshProgress();
        showToast('å¯¼å…¥å®Œæˆ', 'è®°å½•å·²æ›´æ–°åˆ°æœ¬åœ°');
      } catch (err) {
        showToast('å¯¼å…¥å¤±è´¥', 'è¯·ç¡®è®¤æ–‡ä»¶ä¸ºæœ‰æ•ˆ JSON');
      }
    });

    // ====== æ‹‰ä¼¸æŒ‡å¯¼ ======
    const stretches = [
      { name: 'é¢ˆéƒ¨ä¾§å€¾æ‹‰ä¼¸', seconds: 30, steps: ['åç›´ï¼Œè‚©æ”¾æ¾','å¤´éƒ¨ç¼“æ…¢å‘å³ä¾§å€¾ï¼Œæ„Ÿå—å·¦ä¾§é¢ˆéƒ¨æ‹‰ä¼¸','ä¿æŒ 15 ç§’ï¼Œæ¢å¦ä¸€ä¾§','å‘¼å¸å‡åŒ€ï¼Œä¸è¦å¼ºæ‹‰'] },
      { name: 'è‚©éƒ¨ç»•åœˆ', seconds: 30, steps: ['åç›´æˆ–ç«™ç«‹','åŒè‚©å‘å‰ç¼“æ…¢ç»•åœˆ 10 æ¬¡','å†å‘åç»•åœˆ 10 æ¬¡','åŠ¨ä½œç¼“æ…¢é…åˆå‘¼å¸'] },
      { name: 'èƒŒéƒ¨æ‰­è½¬', seconds: 30, steps: ['ååœ¨æ¤…å­ä¸Š','å·¦æ‰‹æ‰¶æ¤…èƒŒï¼Œèº¯å¹²ç¼“æ…¢å‘å·¦æ‰­è½¬','ä¿æŒ 15 ç§’ï¼Œæ¢å‘å³','ä¿æŒè„ŠæŸ±å»¶å±•'] },
      { name: 'è…˜ç»³è‚Œä¼¸å±•', seconds: 30, steps: ['ååœ¨æ¤…è¾¹','å³è…¿ä¼¸ç›´ï¼Œè„šå°–æœä¸Š','é«‹éƒ¨å‰å€¾ï¼Œæ„Ÿå—å¤§è…¿åä¾§æ‹‰ä¼¸','ä¿æŒ 15 ç§’ï¼Œæ¢å¦ä¸€ä¾§'] },
      { name: 'å°è…¿æè¸µ', seconds: 30, steps: ['ç«™ç«‹ï¼Œæ‰‹æ‰¶æ¤…èƒŒ','è„šè·Ÿæ…¢æ…¢æŠ¬èµ·è‡³æœ€é«˜','ç¼“æ…¢ä¸‹é™ï¼Œé‡å¤ 12 æ¬¡','æ³¨æ„è„šè¸ç¨³å®š'] },
      { name: 'æ‰‹è…•ä¼¸å±•', seconds: 30, steps: ['ä¼¸å‡ºå³è‡‚ï¼ŒæŒå¿ƒå‘å¤–','å·¦æ‰‹è½»æ¡å³æ‰‹æŒ‡å‘åæ‹‰','ä¿æŒ 15 ç§’ï¼Œæ¢å¦ä¸€ä¾§','é¿å…è¿‡åº¦ç”¨åŠ›'] },
    ];
    let stretchIdx = 0;
    const stretchSecondsInput = document.getElementById('stretchSeconds');
    const getStretchSeconds = () => clamp(parseInt(stretchSecondsInput?.value || (localStorage.getItem(stretchSecondsKey) || '30'), 10), 10, 600);
    let stretchRemain = getStretchSeconds();
    let stretchTimer = null;
    const stretchNameEl = document.getElementById('stretchName');
    const stretchStepsEl = document.getElementById('stretchSteps');
    const stretchCircle = document.getElementById('stretchCircle');
    const stretchStatus = document.getElementById('stretchStatus');
    const stretchStartBtn = document.getElementById('stretchStart');
    const stretchPauseBtn = document.getElementById('stretchPause');
    const stretchNextBtn = document.getElementById('stretchNext');
    function renderStretch() {
      const s = stretches[stretchIdx];
      stretchNameEl.textContent = 'åŠ¨ä½œ ' + (stretchIdx+1) + '/' + stretches.length + 'ï¼š' + s.name;
      stretchStepsEl.innerHTML = s.steps.map(x => '<li>' + x + '</li>').join('');
      stretchCircle.textContent = fmtTime(stretchRemain*1000);
      const pct = Math.round((1 - stretchRemain / getStretchSeconds()) * 360);
      stretchCircle.style.background = 'conic-gradient(var(--accent) ' + pct + 'deg, #e5e7eb ' + pct + 'deg)';
    }
    function nextStretch() {
      stretchIdx = (stretchIdx + 1) % stretches.length;
      stretchRemain = getStretchSeconds();
      renderStretch();
    }
    function startStretch() {
      if (stretchTimer) clearInterval(stretchTimer);
      stretchStatus.textContent = 'è¿›è¡Œä¸­';
      stretchTimer = setInterval(() => {
        stretchRemain -= 1;
        renderStretch();
        if (stretchRemain <= 0) {
          beep();
          nextStretch();
        }
      }, 1000);
    }
    function pauseStretch() {
      if (stretchTimer) { clearInterval(stretchTimer); stretchTimer = null; }
      stretchStatus.textContent = 'å·²æš‚åœ';
    }
    stretchStartBtn.onclick = startStretch;
    stretchPauseBtn.onclick = pauseStretch;
    stretchNextBtn.onclick = () => { nextStretch(); };
    stretchSecondsInput.addEventListener('change', () => {
      const secs = getStretchSeconds();
      try { localStorage.setItem(stretchSecondsKey, String(secs)); } catch {}
      if (!stretchTimer) { stretchRemain = secs; renderStretch(); }
    });
    renderStretch();

    // ====== çœ¼ç›æ”¾æ¾è®¡æ—¶å™¨ ======
    const eyeCircle = document.getElementById('eyeCircle');
    const eyeSecondsInput = document.getElementById('eyeSeconds');
    const eyeStartBtn = document.getElementById('eyeStart');
    const eyePauseBtn = document.getElementById('eyePause');
    const eyeResetBtn = document.getElementById('eyeReset');
    const eyeStatus = document.getElementById('eyeStatus');
    let eyeRemain = parseInt(eyeSecondsInput.value || '20', 10);
    let eyeTimer = null;
    function renderEye() {
      eyeCircle.textContent = fmtTime(eyeRemain*1000);
      const total = clamp(parseInt(eyeSecondsInput.value || '20', 10), 5, 600);
      const pct = Math.round((1 - eyeRemain / total) * 360);
      eyeCircle.style.background = 'conic-gradient(var(--primary) ' + pct + 'deg, #e5e7eb ' + pct + 'deg)';
    }
    function startEye() {
      if (eyeTimer) clearInterval(eyeTimer);
      eyeStatus.textContent = 'è¿›è¡Œä¸­';
      eyeTimer = setInterval(() => {
        eyeRemain -= 1;
        renderEye();
        if (eyeRemain <= 0) {
          clearInterval(eyeTimer); eyeTimer = null;
          eyeStatus.textContent = 'å®Œæˆ';
          beep();
          showToast('æ”¾æ¾ç»“æŸ', 'å®Œæˆä¸€æ¬¡çœ¼éƒ¨æ”¾æ¾ç»ƒä¹ ï¼Œåšå¾—å¥½ï¼', [
            { label: 'è®°å½•åˆ°è¿œçœº', onClick: () => {
              const d = loadDay(); d.far.done = (d.far.done || 0) + 1; saveDay(d); refreshProgress();
            } }
          ]);
        }
      }, 1000);
    }
    function pauseEye() {
      if (eyeTimer) { clearInterval(eyeTimer); eyeTimer = null; }
      eyeStatus.textContent = 'å·²æš‚åœ';
    }
    function resetEye() {
      pauseEye();
      eyeRemain = clamp(parseInt(eyeSecondsInput.value || '20', 10), 5, 600);
      eyeStatus.textContent = 'æœªå¼€å§‹';
      renderEye();
    }
    eyeStartBtn.onclick = startEye;
    eyePauseBtn.onclick = pauseEye;
    eyeResetBtn.onclick = resetEye;
    eyeSecondsInput.addEventListener('change', resetEye);
    renderEye();

    // åˆå§‹åˆ·æ–°
    refreshProgress();
  </script>
  <!-- è”ç³»æˆ‘ä»¬äº¤äº’è„šæœ¬ -->
  <script>
    (function(){
      const btn = document.getElementById('contactBtn');
      const overlay = document.getElementById('contactOverlay');
      const closeBtn = document.getElementById('contactClose');
      function openContact(){ overlay.style.display = 'flex'; document.body.style.overflow = 'hidden'; }
      function closeContact(){ overlay.style.display = 'none'; document.body.style.overflow = ''; }
      btn.addEventListener('click', openContact);
      closeBtn.addEventListener('click', closeContact);
      overlay.addEventListener('click', (e)=>{ if(e.target === overlay) closeContact(); });
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeContact(); });
    })();
  </script>
</body>
</html>
