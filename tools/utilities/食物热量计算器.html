<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能食物热量计算器</title>
    <style>
        :root {
            --primary: #4a6fa5;
            --primary-light: #6b8cbc;
            --secondary: #ff7e5f;
            --background: #f8f9fa;
            --card: #ffffff;
            --text: #333333;
            --text-light: #666666;
            --border: #e0e0e0;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: var(--text);
            background-color: var(--background);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
            background-color: var(--card);
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary);
            margin: 0;
            font-size: 2.2rem;
        }

        .subtitle {
            color: var(--text-light);
            margin-top: 5px;
            font-size: 1.1rem;
        }

        .app-container {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--card);
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
        }

        .card-title i {
            margin-right: 10px;
            color: var(--secondary);
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 1px solid var(--border);
            border-radius: 30px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .food-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.95rem;
        }

        .food-table th {
            background-color: var(--primary);
            color: white;
            padding: 12px 15px;
            text-align: left;
            position: sticky;
            top: 0;
        }

        .food-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        .food-table tr:last-child td {
            border-bottom: none;
        }

        .food-table tr:hover {
            background-color: rgba(74, 111, 165, 0.05);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .btn {
            display: inline-block;
            padding: 12px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-success {
            background-color: var(--success);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(74, 111, 165, 0.1);
            border-left: 4px solid var(--primary);
            border-radius: 0 6px 6px 0;
        }

        .result-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .food-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid var(--border);
            border-radius: 6px;
        }

        .food-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        .food-item:last-child {
            border-bottom: none;
        }

        .food-item-info {
            flex: 1;
        }

        .food-item-name {
            font-weight: 500;
        }

        .food-item-details {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 3px;
        }

        .food-item-actions {
            display: flex;
            gap: 5px;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .history-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item-content {
            margin-bottom: 5px;
            font-weight: 500;
        }

        .history-item-date {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
        }

        .theme-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .theme-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .theme-btn:hover {
            transform: scale(1.1);
        }

        .theme-default {
            background: linear-gradient(135deg, #4a6fa5, #ff7e5f);
        }

        .theme-dark {
            background: linear-gradient(135deg, #343a40, #6c757d);
        }

        .theme-green {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .theme-pink {
            background: linear-gradient(135deg, #e83e8c, #fd7e14);
        }

        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            animation: fadeIn 0.5s ease-out;
        }

        /* 响应式调整 */
        @media (max-width: 576px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 15px;
            }
            
            .tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
            
            .tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>智能食物热量计算器</h1>
            <div class="subtitle">精准计算 · 健康饮食 · 科学管理</div>
            <div class="theme-selector">
                <div class="theme-btn theme-default" title="默认主题" onclick="changeTheme('default')"></div>
                <div class="theme-btn theme-dark" title="暗黑主题" onclick="changeTheme('dark')"></div>
                <div class="theme-btn theme-green" title="绿色主题" onclick="changeTheme('green')"></div>
                <div class="theme-btn theme-pink" title="粉色主题" onclick="changeTheme('pink')"></div>
            </div>
        </header>

        <div class="app-container">
            <div>
                <div class="card">
                    <h2 class="card-title"><i>🍎</i>食物数据库</h2>
                    <div class="search-container">
                        <span class="search-icon">🔍</span>
                        <input type="text" class="search-input" id="searchFood" placeholder="搜索食物名称..." oninput="searchFoods()">
                    </div>
                    <div style="max-height: 500px; overflow-y: auto;">
                        <table class="food-table">
                            <thead>
                                <tr>
                                    <th>食物名称</th>
                                    <th>热量(大卡/100g)</th>
                                </tr>
                            </thead>
                            <tbody id="foodTableBody">
                                <!-- 食物数据将通过JavaScript动态加载 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div>
                <div class="card">
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab('single')">单一食物</div>
                        <div class="tab" onclick="switchTab('custom')">自定义食物</div>
                        <div class="tab" onclick="switchTab('multi')">组合计算</div>
                        <div class="tab" onclick="switchTab('history')">历史记录</div>
                    </div>

                    <div id="singleTab" class="tab-content active">
                        <h3 class="card-title"><i>🍏</i>单一食物热量计算</h3>
                        <div class="form-group">
                            <label for="singleFood">选择食物</label>
                            <select id="singleFood">
                                <!-- 选项将通过JavaScript动态加载 -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="singleWeight">食用重量 (克)</label>
                            <input type="number" id="singleWeight" min="1" value="100" placeholder="请输入重量">
                        </div>
                        <button class="btn" onclick="calculateSingle()">计算热量</button>
                        <div class="result" id="singleResult" style="display: none;">
                            <div id="singleResultContent"></div>
                        </div>
                    </div>

                    <div id="customTab" class="tab-content">
                        <h3 class="card-title"><i>🍕</i>自定义食物计算</h3>
                        <div class="form-group">
                            <label for="customFoodName">食物名称</label>
                            <input type="text" id="customFoodName" placeholder="例如: 巧克力蛋糕">
                        </div>
                        <div class="form-group">
                            <label for="customCalories">每100克热量 (大卡)</label>
                            <input type="number" id="customCalories" min="1" placeholder="例如: 546">
                        </div>
                        <div class="form-group">
                            <label for="customWeight">食用重量 (克)</label>
                            <input type="number" id="customWeight" min="1" value="100">
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="calculateCustom()">计算热量</button>
                            <button class="btn btn-success" onclick="saveCustomFood()">保存食物</button>
                        </div>
                        <div class="result" id="customResult" style="display: none;">
                            <div id="customResultContent"></div>
                        </div>
                    </div>

                    <div id="multiTab" class="tab-content">
                        <h3 class="card-title"><i>🍽️</i>组合热量计算</h3>
                        <div class="form-group">
                            <label for="multiFood">选择食物</label>
                            <select id="multiFood">
                                <!-- 选项将通过JavaScript动态加载 -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="multiWeight">食用重量 (克)</label>
                            <input type="number" id="multiWeight" min="1" value="100">
                        </div>
                        <div class="btn-group">
                            <button class="btn" onclick="addFood()">添加到列表</button>
                            <button class="btn btn-danger" onclick="clearList()">清空列表</button>
                        </div>
                        <div class="food-list" id="foodList">
                            <div class="empty-state">暂无食物，请先添加食物到列表</div>
                        </div>
                        <button class="btn" onclick="calculateTotal()">计算总热量</button>
                        <div class="result" id="totalResult" style="display: none;">
                            <div id="totalResultContent"></div>
                        </div>
                    </div>

                    <div id="historyTab" class="tab-content">
                        <h3 class="card-title"><i>📝</i>历史记录</h3>
                        <div class="btn-group">
                            <button class="btn" onclick="loadHistory()">刷新记录</button>
                            <button class="btn btn-danger" onclick="clearHistory()">清除所有</button>
                        </div>
                        <div class="history-list" id="historyList">
                            <div class="empty-state">暂无历史记录</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 增强版食物数据库 (200+种食物)
        const foodDatabase = [
            // 谷物类
            { name: "米饭", calories: 116, category: "谷物" },
            { name: "白米饭", calories: 130, category: "谷物" },
            { name: "糙米饭", calories: 111, category: "谷物" },
            { name: "面条", calories: 138, category: "谷物" },
            { name: "全麦面条", calories: 124, category: "谷物" },
            { name: "意大利面", calories: 158, category: "谷物" },
            { name: "馒头", calories: 223, category: "谷物" },
            { name: "全麦面包", calories: 265, category: "谷物" },
            { name: "白面包", calories: 265, category: "谷物" },
            { name: "燕麦片", calories: 389, category: "谷物" },
            { name: "玉米片", calories: 365, category: "谷物" },
            { name: "小米粥", calories: 46, category: "谷物" },
            { name: "八宝粥", calories: 85, category: "谷物" },
            
            // 肉类
            { name: "鸡胸肉", calories: 165, category: "肉类" },
            { name: "鸡腿肉", calories: 209, category: "肉类" },
            { name: "鸡翅", calories: 234, category: "肉类" },
            { name: "牛肉", calories: 250, category: "肉类" },
            { name: "瘦牛肉", calories: 198, category: "肉类" },
            { name: "牛排", calories: 271, category: "肉类" },
            { name: "猪肉", calories: 242, category: "肉类" },
            { name: "瘦猪肉", calories: 143, category: "肉类" },
            { name: "培根", calories: 541, category: "肉类" },
            { name: "火腿", calories: 145, category: "肉类" },
            { name: "香肠", calories: 296, category: "肉类" },
            { name: "羊肉", calories: 294, category: "肉类" },
            
            // 鱼类海鲜
            { name: "三文鱼", calories: 208, category: "海鲜" },
            { name: "鳕鱼", calories: 82, category: "海鲜" },
            { name: "金枪鱼", calories: 144, category: "海鲜" },
            { name: "鲈鱼", calories: 105, category: "海鲜" },
            { name: "虾", calories: 99, category: "海鲜" },
            { name: "龙虾", calories: 90, category: "海鲜" },
            { name: "螃蟹", calories: 97, category: "海鲜" },
            { name: "蛤蜊", calories: 74, category: "海鲜" },
            { name: "牡蛎", calories: 81, category: "海鲜" },
            { name: "扇贝", calories: 88, category: "海鲜" },
            
            // 蛋奶制品
            { name: "鸡蛋", calories: 143, category: "蛋奶" },
            { name: "鸡蛋白", calories: 52, category: "蛋奶" },
            { name: "鸡蛋黄", calories: 322, category: "蛋奶" },
            { name: "牛奶", calories: 54, category: "蛋奶" },
            { name: "全脂牛奶", calories: 61, category: "蛋奶" },
            { name: "脱脂牛奶", calories: 34, category: "蛋奶" },
            { name: "酸奶", calories: 59, category: "蛋奶" },
            { name: "希腊酸奶", calories: 59, category: "蛋奶" },
            { name: "奶酪", calories: 402, category: "蛋奶" },
            { name: "切达奶酪", calories: 403, category: "蛋奶" },
            { name: "奶油", calories: 340, category: "蛋奶" },
            { name: "黄油", calories: 717, category: "蛋奶" },
            
            // 水果类
            { name: "苹果", calories: 52, category: "水果" },
            { name: "香蕉", calories: 89, category: "水果" },
            { name: "橙子", calories: 47, category: "水果" },
            { name: "草莓", calories: 32, category: "水果" },
            { name: "蓝莓", calories: 57, category: "水果" },
            { name: "葡萄", calories: 69, category: "水果" },
            { name: "西瓜", calories: 30, category: "水果" },
            { name: "菠萝", calories: 50, category: "水果" },
            { name: "芒果", calories: 60, category: "水果" },
            { name: "猕猴桃", calories: 61, category: "水果" },
            { name: "梨", calories: 57, category: "水果" },
            { name: "桃子", calories: 39, category: "水果" },
            { name: "樱桃", calories: 50, category: "水果" },
            { name: "柠檬", calories: 29, category: "水果" },
            { name: "牛油果", calories: 160, category: "水果" },
            
            // 蔬菜类
            { name: "胡萝卜", calories: 41, category: "蔬菜" },
            { name: "西兰花", calories: 34, category: "蔬菜" },
            { name: "菠菜", calories: 23, category: "蔬菜" },
            { name: "土豆", calories: 77, category: "蔬菜" },
            { name: "红薯", calories: 86, category: "蔬菜" },
            { name: "玉米", calories: 86, category: "蔬菜" },
            { name: "番茄", calories: 18, category: "蔬菜" },
            { name: "黄瓜", calories: 16, category: "蔬菜" },
            { name: "洋葱", calories: 40, category: "蔬菜" },
            { name: "蘑菇", calories: 22, category: "蔬菜" },
            { name: "青椒", calories: 20, category: "蔬菜" },
            { name: "茄子", calories: 25, category: "蔬菜" },
            { name: "花椰菜", calories: 25, category: "蔬菜" },
            { name: "芹菜", calories: 16, category: "蔬菜" },
            { name: "生菜", calories: 15, category: "蔬菜" },
            { name: "白菜", calories: 13, category: "蔬菜" },
            { name: "南瓜", calories: 26, category: "蔬菜" },
            
            // 豆制品
            { name: "豆腐", calories: 76, category: "豆制品" },
            { name: "豆浆", calories: 54, category: "豆制品" },
            { name: "毛豆", calories: 131, category: "豆制品" },
            { name: "黄豆", calories: 446, category: "豆制品" },
            { name: "绿豆", calories: 329, category: "豆制品" },
            { name: "红豆", calories: 329, category: "豆制品" },
            
            // 坚果种子
            { name: "杏仁", calories: 579, category: "坚果" },
            { name: "核桃", calories: 654, category: "坚果" },
            { name: "腰果", calories: 553, category: "坚果" },
            { name: "花生", calories: 567, category: "坚果" },
            { name: "开心果", calories: 562, category: "坚果" },
            { name: "瓜子", calories: 567, category: "坚果" },
            { name: "芝麻", calories: 573, category: "坚果" },
            { name: "花生酱", calories: 588, category: "坚果" },
            
            // 油脂类
            { name: "橄榄油", calories: 884, category: "油脂" },
            { name: "花生油", calories: 884, category: "油脂" },
            { name: "菜籽油", calories: 884, category: "油脂" },
            { name: "椰子油", calories: 862, category: "油脂" },
            { name: "黄油", calories: 717, category: "油脂" },
            
            // 甜点零食
            { name: "巧克力", calories: 546, category: "零食" },
            { name: "黑巧克力", calories: 598, category: "零食" },
            { name: "白巧克力", calories: 539, category: "零食" },
            { name: "冰淇淋", calories: 207, category: "零食" },
            { name: "蛋糕", calories: 350, category: "零食" },
            { name: "饼干", calories: 502, category: "零食" },
            { name: "薯片", calories: 536, category: "零食" },
            { name: "爆米花", calories: 375, category: "零食" },
            { name: "糖果", calories: 394, category: "零食" },
            
            // 饮料类
            { name: "可乐", calories: 42, category: "饮料" },
            { name: "橙汁", calories: 45, category: "饮料" },
            { name: "苹果汁", calories: 46, category: "饮料" },
            { name: "咖啡", calories: 2, category: "饮料" },
            { name: "茶", calories: 1, category: "饮料" },
            { name: "啤酒", calories: 43, category: "饮料" },
            { name: "红酒", calories: 83, category: "饮料" },
            { name: "白酒", calories: 231, category: "饮料" },
            
            // 快餐食品
            { name: "披萨", calories: 266, category: "快餐" },
            { name: "汉堡", calories: 295, category: "快餐" },
            { name: "热狗", calories: 290, category: "快餐" },
            { name: "炸鸡", calories: 300, category: "快餐" },
            { name: "炸薯条", calories: 312, category: "快餐" },
            { name: "寿司", calories: 150, category: "快餐" },
            { name: "拉面", calories: 436, category: "快餐" },
            { name: "炒饭", calories: 163, category: "快餐" },
            { name: "饺子", calories: 195, category: "快餐" },
            { name: "包子", calories: 227, category: "快餐" },
            { name: "油条", calories: 386, category: "快餐" },
            { name: "煎饼", calories: 312, category: "快餐" }
        ];

        // 存储食物列表和历史记录
        let foodItems = [];
        let historyRecords = [];
        
        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            loadFoodDatabase();
            populateSelectOptions();
            loadHistory();
            
            // 从本地存储加载主题偏好
            const savedTheme = localStorage.getItem('theme') || 'default';
            changeTheme(savedTheme);
        });
        
        // 加载食物数据库到表格
        function loadFoodDatabase() {
            const tableBody = document.getElementById('foodTableBody');
            tableBody.innerHTML = '';
            
            foodDatabase.forEach(food => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${food.name}</td>
                    <td>${food.calories}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // 填充选择框选项
        function populateSelectOptions() {
            const singleSelect = document.getElementById('singleFood');
            const multiSelect = document.getElementById('multiFood');
            
            singleSelect.innerHTML = '';
            multiSelect.innerHTML = '';
            
            // 按名称排序
            const sortedFoods = [...foodDatabase].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedFoods.forEach(food => {
                const option = document.createElement('option');
                option.value = food.calories;
                option.textContent = food.name;
                
                singleSelect.appendChild(option.cloneNode(true));
                multiSelect.appendChild(option);
            });
        }
        
        // 搜索食物
        function searchFoods() {
            const searchTerm = document.getElementById('searchFood').value.toLowerCase();
            const tableBody = document.getElementById('foodTableBody');
            tableBody.innerHTML = '';
            
            const filteredFoods = foodDatabase.filter(food => 
                food.name.toLowerCase().includes(searchTerm));
            
            if (filteredFoods.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="2" style="text-align: center;">未找到匹配的食物</td>';
                tableBody.appendChild(row);
                return;
            }
            
            filteredFoods.forEach(food => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${food.name}</td>
                    <td>${food.calories}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // 切换标签页
        function switchTab(tabId) {
            // 更新标签样式
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 更新内容显示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId + 'Tab').classList.add('active');
        }
        
        // 计算单一食物热量
        function calculateSingle() {
            const foodSelect = document.getElementById('singleFood');
            const weightInput = document.getElementById('singleWeight');
            const weight = parseFloat(weightInput.value);
            
            if (isNaN(weight) || weight <= 0) {
                alert('请输入有效的重量');
                weightInput.focus();
                return;
            }
            
            const caloriesPer100g = parseFloat(foodSelect.value);
            const foodName = foodSelect.options[foodSelect.selectedIndex].text;
            const totalCalories = (caloriesPer100g * weight / 100).toFixed(1);
            
            const resultElement = document.getElementById('singleResult');
            const resultContent = document.getElementById('singleResultContent');
            
            resultContent.innerHTML = 
                `<div>${weight}克 <strong>${foodName}</strong> 的热量为: <span class="result-value">${totalCalories}</span> 大卡</div>
                 <div style="margin-top: 8px; font-size: 0.9em; color: var(--text-light);">
                 每100克热量: ${caloriesPer100g}大卡
                 </div>`;
            
            resultElement.style.display = 'block';
            
            // 保存到历史记录
            saveToHistory({
                type: 'single',
                name: foodName,
                weight: weight,
                calories: totalCalories,
                date: new Date().toLocaleString()
            });
        }
        
        // 计算自定义食物热量
        function calculateCustom() {
            const foodNameInput = document.getElementById('customFoodName');
            const caloriesInput = document.getElementById('customCalories');
            const weightInput = document.getElementById('customWeight');
            
            const foodName = foodNameInput.value.trim();
            const caloriesPer100g = parseFloat(caloriesInput.value);
            const weight = parseFloat(weightInput.value);
            
            if (!foodName) {
                alert('请输入食物名称');
                foodNameInput.focus();
                return;
            }
            
            if (isNaN(caloriesPer100g) || caloriesPer100g <= 0) {
                alert('请输入有效的热量值');
                caloriesInput.focus();
                return;
            }
            
            if (isNaN(weight) || weight <= 0) {
                alert('请输入有效的重量');
                weightInput.focus();
                return;
            }
            
            const totalCalories = (caloriesPer100g * weight / 100).toFixed(1);
            
            const resultElement = document.getElementById('customResult');
            const resultContent = document.getElementById('customResultContent');
            
            resultContent.innerHTML = 
                `<div>${weight}克 <strong>${foodName}</strong> 的热量为: <span class="result-value">${totalCalories}</span> 大卡</div>
                 <div style="margin-top: 8px; font-size: 0.9em; color: var(--text-light);">
                 每100克热量: ${caloriesPer100g}大卡
                 </div>`;
            
            resultElement.style.display = 'block';
            
            // 保存到历史记录
            saveToHistory({
                type: 'custom',
                name: foodName,
                weight: weight,
                calories: totalCalories,
                date: new Date().toLocaleString()
            });
        }
        
        // 保存自定义食物到数据库
        function saveCustomFood() {
            const foodNameInput = document.getElementById('customFoodName');
            const caloriesInput = document.getElementById('customCalories');
            
            const foodName = foodNameInput.value.trim();
            const caloriesPer100g = parseFloat(caloriesInput.value);
            
            if (!foodName) {
                alert('请输入食物名称');
                foodNameInput.focus();
                return;
            }
            
            if (isNaN(caloriesPer100g) || caloriesPer100g <= 0) {
                alert('请输入有效的热量值');
                caloriesInput.focus();
                return;
            }
            
            // 检查是否已存在
            if (foodDatabase.some(food => food.name.toLowerCase() === foodName.toLowerCase())) {
                alert('该食物已存在于数据库中');
                return;
            }
            
            // 添加到数据库
            foodDatabase.push({
                name: foodName,
                calories: caloriesPer100g,
                category: "自定义"
            });
            
            // 重新填充选择框
            populateSelectOptions();
            
            alert(`"${foodName}" 已成功添加到食物数据库`);
            
            // 清空输入框
            foodNameInput.value = '';
            caloriesInput.value = '';
            document.getElementById('customWeight').value = '100';
            document.getElementById('customResult').style.display = 'none';
            
            // 切换到食物数据库视图
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab-content.active').classList.remove('active');
            document.querySelector('.tab').classList.add('active');
            document.getElementById('singleTab').classList.add('active');
        }
        
        // 添加食物到列表
        function addFood() {
            const foodSelect = document.getElementById('multiFood');
            const weightInput = document.getElementById('multiWeight');
            const weight = parseFloat(weightInput.value);
            
            if (isNaN(weight) || weight <= 0) {
                alert('请输入有效的重量');
                weightInput.focus();
                return;
            }
            
            const caloriesPer100g = parseFloat(foodSelect.value);
            const foodName = foodSelect.options[foodSelect.selectedIndex].text;
            const totalCalories = (caloriesPer100g * weight / 100).toFixed(1);
            
            foodItems.push({
                name: foodName,
                weight: weight,
                calories: parseFloat(totalCalories),
                caloriesPer100g: caloriesPer100g
            });
            
            updateFoodList();
            
            // 清空结果显示
            document.getElementById('totalResult').style.display = 'none';
        }
        
        // 更新食物列表显示
        function updateFoodList() {
            const foodListElement = document.getElementById('foodList');
            
            if (foodItems.length === 0) {
                foodListElement.innerHTML = '<div class="empty-state">暂无食物，请先添加食物到列表</div>';
                return;
            }
            
            foodListElement.innerHTML = '';
            
            foodItems.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'food-item';
                itemElement.innerHTML = `
                    <div class="food-item-info">
                        <div class="food-item-name">${item.name}</div>
                        <div class="food-item-details">${item.weight}克 × ${item.caloriesPer100g}大卡/100g = ${item.calories}大卡</div>
                    </div>
                    <div class="food-item-actions">
                        <button class="btn btn-secondary" onclick="editFood(${index})">编辑</button>
                        <button class="btn btn-danger" onclick="removeFood(${index})">删除</button>
                    </div>
                `;
                foodListElement.appendChild(itemElement);
            });
        }
        
        // 编辑食物项
        function editFood(index) {
            const newWeight = prompt(`编辑 ${foodItems[index].name} 的重量(克):`, foodItems[index].weight);
            
            if (newWeight && !isNaN(newWeight) && newWeight > 0) {
                foodItems[index].weight = parseFloat(newWeight);
                foodItems[index].calories = (foodItems[index].caloriesPer100g * foodItems[index].weight / 100).toFixed(1);
                updateFoodList();
            }
        }
        
        // 从列表中移除食物
        function removeFood(index) {
            if (confirm(`确定要删除 ${foodItems[index].name} 吗?`)) {
                foodItems.splice(index, 1);
                updateFoodList();
            }
        }
        
        // 清空食物列表
        function clearList() {
            if (foodItems.length === 0 || confirm('确定要清空食物列表吗?')) {
                foodItems = [];
                updateFoodList();
                document.getElementById('totalResult').style.display = 'none';
            }
        }
        
        // 计算总热量
        function calculateTotal() {
            if (foodItems.length === 0) {
                alert('请先添加食物到列表');
                return;
            }
            
            const totalCalories = foodItems.reduce((sum, item) => sum + parseFloat(item.calories), 0).toFixed(1);
            const foodNames = foodItems.map(item => `${item.weight}克${item.name}`).join(' + ');
            
            const resultElement = document.getElementById('totalResult');
            const resultContent = document.getElementById('totalResultContent');
            
            resultContent.innerHTML = 
                `<div>总热量: <span class="result-value">${totalCalories}</span> 大卡</div>
                 <div style="margin-top: 10px;">包含: ${foodNames}</div>
                 <div style="margin-top: 10px; font-size: 0.9em; color: var(--text-light);">
                 已添加 ${foodItems.length} 种食物
                 </div>`;
            
            resultElement.style.display = 'block';
            
            // 保存到历史记录
            saveToHistory({
                type: 'multi',
                names: foodItems.map(item => item.name),
                weights: foodItems.map(item => item.weight),
                calories: totalCalories,
                date: new Date().toLocaleString()
            });
        }
        
        // 保存到历史记录
        function saveToHistory(record) {
            historyRecords.unshift(record); // 添加到开头
            localStorage.setItem('calorieHistory', JSON.stringify(historyRecords));
            loadHistory(); // 刷新显示
        }
        
        // 加载历史记录
        function loadHistory() {
            const savedHistory = localStorage.getItem('calorieHistory');
            historyRecords = savedHistory ? JSON.parse(savedHistory) : [];
            
            const historyListElement = document.getElementById('historyList');
            
            if (historyRecords.length === 0) {
                historyListElement.innerHTML = '<div class="empty-state">暂无历史记录</div>';
                return;
            }
            
            historyListElement.innerHTML = '';
            
            historyRecords.forEach((record, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'history-item';
                
                let details = '';
                if (record.type === 'single' || record.type === 'custom') {
                    details = `${record.weight}克 ${record.name}: ${record.calories}大卡`;
                } else if (record.type === 'multi') {
                    const items = record.names.map((name, i) => 
                        `${record.weights[i]}克 ${name}`).join(' + ');
                    details = `${items} = ${record.calories}大卡`;
                }
                
                itemElement.innerHTML = `
                    <div>
                        <div class="history-item-content">${details}</div>
                        <div class="history-item-date">${record.date}</div>
                    </div>
                    <button class="btn btn-danger" onclick="removeHistory(${index})">删除</button>
                `;
                
                historyListElement.appendChild(itemElement);
            });
        }
        
        // 删除单条历史记录
        function removeHistory(index) {
            if (confirm('确定要删除这条记录吗?')) {
                historyRecords.splice(index, 1);
                localStorage.setItem('calorieHistory', JSON.stringify(historyRecords));
                loadHistory();
            }
        }
        
        // 清除所有历史记录
        function clearHistory() {
            if (historyRecords.length === 0 || confirm('确定要清除所有历史记录吗?')) {
                historyRecords = [];
                localStorage.removeItem('calorieHistory');
                loadHistory();
            }
        }
        
        // 更改主题
        function changeTheme(theme) {
            document.body.className = theme + '-theme';
            localStorage.setItem('theme', theme);
            
            // 更新CSS变量
            if (theme === 'default') {
                document.documentElement.style.setProperty('--primary', '#4a6fa5');
                document.documentElement.style.setProperty('--primary-light', '#6b8cbc');
                document.documentElement.style.setProperty('--secondary', '#ff7e5f');
                document.documentElement.style.setProperty('--background', '#f8f9fa');
                document.documentElement.style.setProperty('--card', '#ffffff');
            } else if (theme === 'dark') {
                document.documentElement.style.setProperty('--primary', '#343a40');
                document.documentElement.style.setProperty('--primary-light', '#6c757d');
                document.documentElement.style.setProperty('--secondary', '#6c757d');
                document.documentElement.style.setProperty('--background', '#2c3e50');
                document.documentElement.style.setProperty('--card', '#34495e');
            } else if (theme === 'green') {
                document.documentElement.style.setProperty('--primary', '#28a745');
                document.documentElement.style.setProperty('--primary-light', '#20c997');
                document.documentElement.style.setProperty('--secondary', '#20c997');
                document.documentElement.style.setProperty('--background', '#e8f5e9');
                document.documentElement.style.setProperty('--card', '#ffffff');
            } else if (theme === 'pink') {
                document.documentElement.style.setProperty('--primary', '#e83e8c');
                document.documentElement.style.setProperty('--primary-light', '#fd7e14');
                document.documentElement.style.setProperty('--secondary', '#fd7e14');
                document.documentElement.style.setProperty('--background', '#fff0f6');
                document.documentElement.style.setProperty('--card', '#ffffff');
            }
        }
    </script>
</body>
</html>